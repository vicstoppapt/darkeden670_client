// VS_UI_GameCommon.cpp

#include "client_PCH.h"
#include "VS_UI_GameCommon.h"
#include "VS_UI_GameCommon2.h"
#include "VS_UI_GlobalResource.h"
#include "VS_UI_filepath.h"
#include "VS_UI_Mouse_pointer.h"
//#include "VS_UI_Item.h"
#include "VS_UI.h"
#include "VS_UI_Message.h"

#include "MPriceManager.h"
#include "MCreatureTable.h"
#include "CDirectInput.h"
#include "MNPCTable.h"
#include "MParty.h"

#include "MGuildMarkManager.h"
#include "MGuildInfoMapper.h"
#include "ExperienceTable.h"
#include "UserOption.h"
#include "UserInformation.h"
#include "MItemOptionTable.h"
#include "MGameStringTable.H"
//#include "ex\DebugInfo.h"
#include "RankBonusDef.H"
#include "RankBonusTable.H"
#include "KeyAccelerator.h"
#include "UIMessageManager.h"
#include "VS_UI_Message.h"

#include "MZoneTable.h"
#include "FameInfo.h"
#include "MMonsterKillQuestInfo.h"
#include "SystemAvailabilities.h"
#include "SkinManager.h"

#include <algorithm>
#include <time.h>
#include <set>

#include "../client/packet/types/WarTypes.h"

#include "MHelpDef.h"
#include "VS_UI_ExtraDialog.h"
#include "DebugInfo.h"
#include "MItemFinder.h"


#include "MPlayer.h"

#include "UIDialog.h"

#include "CMessageArray.h"			
#include "MTimeItemManager.H"

#if __CONTENTS(__TITLE_UI_RENWEAL)
	#include "VS_UI_NewTitle.h"
#else	//__TITLE_UI_RENWEAL
	#include "VS_UI_Title.h"
#endif //__TITLE_UI_RENWEAL

#if __CONTENTS(__FRIEND_ADDITION)
#include "VS_UI_Friend_System.h"
#endif //__FRIEND_ADDITION


#define WHISPER_MAX 10	// by larosel

#define MAX_SLAYER_ATTR_OLD				200
#define MAX_SLAYER_ATTR_SUM_OLD			300
#define MAX_SLAYER_DOMAIN_SUM_OLD		100
#define MAX_VAMPIRE_LEVEL_OLD			100

#define	MAX_SLAYER_ATTR					290
#define	MAX_SLAYER_ATTR_SUM				435
#define MAX_VAMPIRE_LEVEL				150


extern BOOL g_bLButtonDown;

#if __CONTENTS(__GPS_ADD)
C_VS_UI_GPS						*gpC_Gps		= NULL;
WORD							gwMiniMapCount	= 0;
#endif // __GPS_ADD

bool					gbl_mine_progress = false;
DWORD					gi_mine_progress;

extern CDirectInput*			g_pDXInput;
extern MStorage*				g_pStorageTemp;

extern BOOL g_bActiveGame;
extern DWORD g_CurrentFrame;
CSpritePack	C_VS_UI_SKILL::m_C_spk; // Skill icon Sprite list
CSpritePack	C_VS_UI_SKILL::m_C_spk_mini; // Skill icon Sprite list
CSpritePack C_VS_UI_SKILL::m_C_spk_mini_new;
CSpritePack	C_VS_UI_SKILL::m_C_spk_comboCnt;

int C_VS_UI_INFO::m_selected_grade_skill	= -1;
int C_VS_UI_INFO::m_selected_skill_domain	= -1;
int C_VS_UI_INFO::m_ousters_Magic			= -1;
int C_VS_UI_INFO::m_vampire_ACType			= -1;
int C_VS_UI_INFO::m_selected_ACSkillID		= -1;

extern int		g_LeftPremiumDays;
extern	CMessageArray*		g_pSystemMessage;
//C_SPRITE_PACK	* C_VS_UI_INFO::m_pC_info_spk=NULL;


void	g_StartSellConfirmDialog(int _x, int _y);
void	g_StartSellAllConfirmDialog(int _x, int _y, int price);
void	g_StartSellFinishDialog(int _x, int _y);
void	g_StartSwapAdvanceItemDialog(int _x, int _y);
void	g_StartSwapConfirmDialog(int _x, int _y);

void	g_StartRepairConfirmDialog(int _x, int _y, bool bChargeItem);
void	g_StartRepairAllConfirmDialog(int _x, int _y, int price);
void	g_StartRepairFinishDialog(int _x, int _y);

void	g_StartSilveringConfirmDialog(int _x, int _y);
void	g_StartSilveringFinishDialog(int _x, int _y);

static C_VS_UI_DIALOG *	gpC_dialog_sellall_confirm = NULL;
static C_VS_UI_DIALOG *	gpC_dialog_sell_confirm = NULL;
static C_VS_UI_DIALOG * gpC_dialog_connot_sell_confirm = NULL;
static C_VS_UI_DIALOG *	gpC_dialog_sell_finish = NULL;
static C_VS_UI_DIALOG *	gpC_dialog_swap_confirm = NULL;

static C_VS_UI_DIALOG *	gpC_dialog_repairall_confirm = NULL;
static C_VS_UI_DIALOG *	gpC_dialog_repair_confirm = NULL;
static C_VS_UI_DIALOG *	gpC_dialog_repair_finish = NULL;

static C_VS_UI_DIALOG *	gpC_dialog_silvering_confirm = NULL;
static C_VS_UI_DIALOG *	gpC_dialog_silvering_finish = NULL;
static C_VS_UI_DIALOG * gpC_dialog_confirm_change_sex = NULL;
extern C_VS_UI_DIALOG *	gpC_dialog_select_item_from_shop = NULL;

extern C_VS_UI_DIALOG * gpC_dialog_game_over = NULL;
extern C_VS_UI_DIALOG * gpC_dialog_all_stage_clear = NULL;
extern C_VS_UI_DIALOG * gpC_dialog_show_web_page = NULL;

static C_VS_UI_DIALOG * gpC_dialog_Asking_Recall = NULL;
static C_VS_UI_DIALOG * gpC_dialog_ReLearnOusterSkill = NULL;
static C_VS_UI_DIALOG * gpC_dialog_ReLearnVampireSkill = NULL;

//const int PCS_CHAT_LINE_START_X =	40;
//const int CHAT_LINE_START_X =			20;
//const int CHAT_LINE_START_Y =			RESOLUTION_Y-20;
//const int CHAT_HISTORY_START_Y =		RESOLUTION_Y-40;

static char g_szBugReportBuffer[256];

const char g_sz_chat_id_divisor[CLD_TOTAL][3] = 
{
	">",
	">",
	"->",
	")",
	"}",
	":",
	":",
	":",
};

int g_HISTORY_LINE = 4;

#define FONT_GAP							17

char g_mark[MARK_MAX][9][3] =
{

#if __CONTENTS(__JAPAN_UI)
	{"걫","걬","걭","걮","걯","겍","걲","걳","걵"},
	{"걶","걹","걻","걼","걽","걾","걿","겂","겇"},
	{"겈","겏","겑","겒","겓","괅","겕","괈","괅"},
#else 
	{"＃","＆","＊","＠","§","※","☆","★","○"},
	{"●","◎","◇","◆","□","■","△","▲","▽"},
	{"▼","→","←","↑","↓","↔","〓","◁","◀"},
	{"▷","▶","♤","♠","♡","♥","♧","♣","⊙"},
	{"◈","▣","◐","◑","▒","▤","▥","▨","▧"},
	{"▦","▩","♨","☏","☎","☜","☞","¶","†"},
#endif //__JAPAN_UI
};

COLORREF g_color[4][4] = 
{
	RGB(0, 0, 0),		RGB(132, 0, 0),	RGB(0, 130, 0),	RGB(132, 130, 0),
	RGB(0, 0, 132),		RGB(132, 0, 132),	RGB(0, 130, 132),	RGB(132, 130, 132),
	RGB(198, 195, 198),	RGB(255, 0, 0),	RGB(0, 255, 0),	RGB(255, 255, 0),
	RGB(0, 0, 255),		RGB(255, 0, 255),	RGB(0, 255, 255),	RGB(255, 255, 255),
};

//
// g_char_slot_ingame
//
// 게임중에 계속 update시키는 char-slot이다.
// 이것이 실시간으로 update되어야 info Window에 옳바로 표시된다.
//
S_SLOT	g_char_slot_ingame; // any character info slot in game.

static MItem *	m_p_sell_item;
static MItem *	m_p_repair_item;
static MItem *	m_p_silvering_item;
static MItem *	m_p_persnal_item;
static C_VS_UI_MONEY_DIALOG *	m_pC_dialog_drop_money;
static C_VS_UI_MONEY_DIALOG *	m_pC_dialog_bring_fee;



// Item blink color table
int ga_item_blink_color_table[INTERFACE_BLINK_VALUE_MAX] = {
	LIGHT_BLUE, SKY_BLUE, WHITE, BLUE
};

//
// Inventory/Gear/QuickItem ... 에서 item을 특정위치에 놓을 때 참조하는 값.
// [global effect. slayer/vampire Inventory, Gear 등에서 참조한다. 즉, 
//  Game class의 object가 참조한다.
//
//           +-------+
//           | 1   2 |
//           |       |
//           | 3   4 |
//           +-------+
//					(a item)
//
// item에 대한 '참조점' 4개를 설정한다. 이것은 item 크기에따라 적절하게 위치
// 하여야 한다. 이것은 원점으로부터의 거리이다.
// Inventory나 Gear에서는 이 점을 순서대로 검색하여 item이 놓일 위치를 결정한다.
//
Point g_item_ref_point[ITEM_REF_POINT_COUNT];

MItem* g_pTempItem = NULL;

//-----------------------------------------------------------------------------
// g_SetItemRefPoint
//
// 참조점을 설정한다.
//-----------------------------------------------------------------------------
#define REFPOINT_DISTANCE_DEFAULT	5
void g_SetItemRefPoint(int item_rect_w, int item_rect_h)
{
	g_item_ref_point[0].x = REFPOINT_DISTANCE_DEFAULT;
	g_item_ref_point[0].y = REFPOINT_DISTANCE_DEFAULT;
	g_item_ref_point[1].x = item_rect_w - REFPOINT_DISTANCE_DEFAULT;
	g_item_ref_point[1].y = REFPOINT_DISTANCE_DEFAULT;
	g_item_ref_point[2].x = REFPOINT_DISTANCE_DEFAULT;
	g_item_ref_point[2].y = item_rect_h - REFPOINT_DISTANCE_DEFAULT;
	g_item_ref_point[3].x = item_rect_w - REFPOINT_DISTANCE_DEFAULT;
	g_item_ref_point[3].y = item_rect_h - REFPOINT_DISTANCE_DEFAULT;
}

//-----------------------------------------------------------------------------
// Exec functions
//-----------------------------------------------------------------------------
void ExecF_SellConfirm2(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	int item_count = 0;
	MItem * p_olditem = NULL;
	MItem * p_Newitem = NULL;

	switch (id)
	{
	case DIALOG_EXECID_OK:
		
		//assert(m_select_item_slot != NOT_SELECTED);
		
		if (m_pC_dialog_drop_money != NULL)
		{
			item_count = m_pC_dialog_drop_money->GetValue();
			
		}
		
		m_p_persnal_item->SetPersnalPrice(item_count);
		//p_item->SetPersnalPrice(item_count);
		//C_VS_UI_INVENTORY::AutoMove2(m_p_persnal_item->GetGridX(),m_p_persnal_item->GetGridY());
		//MItem* pModifyItem = g_pInventory->GetItem( pItem->GetID() )
//		p_olditem = g_pInventory->GetItem(m_p_persnal_item->GetGridX(),m_p_persnal_item->GetGridY());
//		p_Newitem = p_olditem;
//		p_Newitem->SetPersnal(true);
//		g_pInventory->ReplaceItem(p_Newitem,m_p_persnal_item->GetGridX(),m_p_persnal_item->GetGridY(),p_olditem);
		
		

		if( m_p_persnal_item == NULL )
			return;
		
		gpC_base->SendMessage(UI_DISPLAY_ITEM, 0, 0,(MItem*)m_p_persnal_item);
		gC_vs_ui.AcquireChatting();
		//			gpC_mouse_pointer->DropItem();
		//g_pInventory->RemoveItem(pItem->GetGridX(), pItem->GetGridY());
		//gpC_base->SendMessage(UI_SELECT_PERSNALSHOP_SLOT,3, 3, NULL);
		break;
	case DIALOG_EXECID_CANCEL:
		gpC_mouse_pointer->DropItem();
		gC_vs_ui.AcquireChatting();
		break;
		
	}

	//m_select_item_slot = NOT_SELECTED;
	// re-acquire chatting
//	gC_vs_ui.AcquireChatting();
}

void ExecF_LearnGradeSkillConfirm(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch(id)
	{
	case DIALOG_EXECID_OK :
		if(C_VS_UI_INFO::m_selected_grade_skill != -1)
			gpC_base->SendMessage(UI_SELECT_GRADE_SKILL,C_VS_UI_INFO::m_selected_grade_skill,0,NULL);

		C_VS_UI_INFO::m_selected_grade_skill = -1;
		break;
	}
}

void ExecF_LearnAdvenceSkillConfirm2(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch(id)
	{
	case DIALOG_EXECID_OK :
		gpC_base->SendMessage(UI_LEARN_ADVANCE_SKILL,C_VS_UI_INFO::m_selected_grade_skill,C_VS_UI_INFO::m_selected_skill_domain,NULL);
		break;
	}
}
void ExecF_LearnAdvenceSkillConfirm(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch(id)
	{
	case DIALOG_EXECID_OK :

		// 뱀파이어는 승직 스킬을 선택할때 계열이 결정되기 때문에
		// 경고문구를 살벌하게 띄워준다.
		if(g_eRaceInterface == RACE_VAMPIRE && C_VS_UI_INFO::m_vampire_ACType == -1)
		{
			gpC_dialog_ReLearnVampireSkill = new C_VS_UI_DIALOG(-1, -1, 3, 0, ExecF_LearnAdvenceSkillConfirm2, DIALOG_OK | DIALOG_CANCEL);

			int SkillID		= C_VS_UI_INFO::m_selected_ACSkillID;

			bool bWarrior	= (*g_pSkillInfoTable)[SkillID].GetSkillStep() == SKILL_STEP_VAMPIRE_WARRIOR_ADVANCEMENT;
			LPCSTR pACType	= bWarrior ?
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ACVAMPIRE_WARRIOR_TYPE].GetString() :
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ACVAMPIRE_MAGICIAN_TYPE].GetString();
			
			static char szBuf[128];
			sprintf(szBuf, (*g_pGameStringTable)[UI_STRING_MESSAGE_LEARN_SKILL_ACVAMPIRE_2].GetString(),
				g_pUserInformation->CharacterID.GetString(), pACType);	
			
			static char *ppmsg[] = { szBuf };
			
			gpC_dialog_ReLearnVampireSkill->SetMessage((char**)ppmsg, 1, SMO_FIT, 2);
			gpC_dialog_ReLearnVampireSkill->WH(400, 140);
			gpC_dialog_ReLearnVampireSkill->Start();	
			
		}
		else
		{
			if(g_eRaceInterface == RACE_OUSTERS && C_VS_UI_INFO::m_ousters_Magic == -1)
			{
				gpC_dialog_ReLearnOusterSkill = new C_VS_UI_DIALOG(-1,-1,3,0,ExecF_LearnAdvenceSkillConfirm2,DIALOG_OK|DIALOG_CANCEL);
				static char * ppmsg[] = { (*g_pGameStringTable)[UI_STRING_MESSAGE_LEARN_SKILL2].GetString() };
				
				gpC_dialog_ReLearnOusterSkill->SetMessage((char**)ppmsg, 1, SMO_FIT, 2);
				gpC_dialog_ReLearnOusterSkill->WH(400, 140);
				gpC_dialog_ReLearnOusterSkill->Start();				
				
			}
			else
			{
				gpC_base->SendMessage(UI_LEARN_ADVANCE_SKILL,C_VS_UI_INFO::m_selected_grade_skill,C_VS_UI_INFO::m_selected_skill_domain,NULL);
				
				// 피의 향연은 한번에 두개의 스킬을 배운다.
				if(C_VS_UI_INFO::m_selected_grade_skill == SKILL_BLOODS_SYMPOSION_ATTACK)
					gpC_base->SendMessage(UI_LEARN_ADVANCE_SKILL, SKILL_BLOOD_CURSE ,C_VS_UI_INFO::m_selected_skill_domain,NULL);
			}
		}
		
		break;
	}
}





void ExecF_SellFinish(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_ITEM_SELL_FINISHED);
		break;
	}
}

void ExecF_SwapAdvancementItemFinish(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_CLOSE_SWAPADVANCEMENTITEM);
		break;
	}
}
void ExecF_SwapConfirm(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		assert(m_p_sell_item != NULL);
		
		gpC_base->SendMessage(UI_SWAPADVANCEMENTITEM, m_p_sell_item->GetGridX(), m_p_sell_item->GetGridY(), m_p_sell_item);
		break;
	}
}

void ExecF_SellConfirm(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		assert(m_p_sell_item != NULL);
		
		gpC_base->SendMessage(UI_SELL_ITEM, m_p_sell_item->GetGridX(), m_p_sell_item->GetGridY(), m_p_sell_item);
		break;
	}
}

void ExecF_MouseItemToZone(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_ITEM_DROP_TO_CLIENT, 0, 0, gpC_mouse_pointer->GetPickUpItem());
		break;
	}
}

void ExecF_ConnotSellConfirm(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{

}
void ExecF_SellAllConfirm(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_SELL_ALL_ITEM);
		break;
	}
}

void ExecF_RepairFinish(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_ITEM_REPAIR_FINISHED);
		break;
	}
}

void ExecF_RepairConfirm(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		assert(m_p_repair_item != NULL);
		
		gpC_base->SendMessage(UI_REPAIR_ITEM, m_p_repair_item->GetID(), 0, m_p_repair_item);
		break;
	}
}
#if __CONTENTS(!__REPAIRSYSTEM_RENEWAL)
void ExecF_RepairAllConfirm(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_REPAIR_ITEM, 0, 0, NULL);
		break;
	}
}
#else
void ExecF_RepairAllConfirm(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_REQUEST_REPAIRINFO, 0, 0, NULL);
		break;
	}
}
#endif //__REPAIRSYSTEM_RENEWAL
void ExecF_SilveringFinish(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_ITEM_SILVERING_FINISHED);
		break;
	}
}

void ExecF_SilveringConfirm(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		assert(m_p_silvering_item != NULL);
		
		gpC_base->SendMessage(UI_SILVERING_ITEM, m_p_silvering_item->GetID(), 0, m_p_silvering_item);
		break;
	}
}

void ExecF_DropMoney(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch (id)
	{
	case DIALOG_EXECID_OK:
		if (gC_vs_ui.IsRunningStorage())
		{
			gpC_base->SendMessage(UI_DEPOSIT_MONEY, m_pC_dialog_drop_money->GetValue());
		}
		//else if (gC_vs_ui.IsRunningExchange())
		//{
		//gpC_base->SendMessage(UI_EXCHANGE_MONEY, m_pC_dialog_drop_money->GetValue());
		//}
		else
		{
			// by sigi
			gpC_base->SendMessage(UI_DROP_MONEY, m_pC_dialog_drop_money->GetValue());
		}
		break;
	}
	gC_vs_ui.AcquireChatting();
}

void Execf_BringFee(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch(id)
	{
	case DIALOG_EXECID_OK :
		gC_vs_ui.SetBringFee((UINT)m_pC_dialog_bring_fee->GetValue());
		break;
	}
	gC_vs_ui.AcquireChatting();
}

void Execf_ConfirmChangeSex(C_VS_UI_DIALOG * p_this_dialog, id_t id )
{
	switch( id )
	{
	case DIALOG_EXECID_OK :
		gpC_base->SendMessage(UI_ITEM_USE, g_pTempItem->GetID(), 0, (void*)g_pTempItem);
		break;
	}
}
void Execf_AskingRecall(C_VS_UI_DIALOG * p_this_dialog, id_t id )
{
	switch( id )
	{
	case DIALOG_EXECID_OK :
		{
			gpC_base->SendMessage(UI_RECALL_BY_NAME);
		}
		break;
	}
}

void g_StartAskingRecall( int _x, int _y , char* str)
{
	DeleteNew( gpC_dialog_confirm_change_sex );

	gpC_dialog_Asking_Recall = new C_VS_UI_DIALOG(_x,_y,2,0, Execf_AskingRecall, DIALOG_OK|DIALOG_CANCEL);
	char * pp_msg[1] = {str};
	gpC_dialog_Asking_Recall->SetMessage( pp_msg, 1, SMO_NOFIT );
	gpC_dialog_Asking_Recall->Start();
}

void g_StartConfirmChangeSex( int _x, int _y )
{
	DeleteNew( gpC_dialog_confirm_change_sex );

	gpC_dialog_confirm_change_sex = new C_VS_UI_DIALOG(_x,_y,2,0, Execf_ConfirmChangeSex, DIALOG_OK|DIALOG_CANCEL);
	char * pp_msg[1] = {(*g_pGameStringTable)[UI_STRING_MESSAGE_CONFIRM_CHANGE_SEX].GetString()};
	gpC_dialog_confirm_change_sex->SetMessage( pp_msg, 1, SMO_NOFIT );
	gpC_dialog_confirm_change_sex->Start();
}


void g_StartConfirmMouseItemToZone( int _x, int _y )
{
	DeleteNew( gpC_dialog_confirm_change_sex );

	gpC_dialog_confirm_change_sex = new C_VS_UI_DIALOG(_x,_y,2,0, ExecF_MouseItemToZone, DIALOG_OK|DIALOG_CANCEL);
	char * pp_msg[1] = {(*g_pGameStringTable)[UI_STRING_MESSAGE_CONFIRM_CHANGE_SEX].GetString()};
	gpC_dialog_confirm_change_sex->SetMessage( pp_msg, 1, SMO_NOFIT );
	gpC_dialog_confirm_change_sex->Start();
}
//-----------------------------------------------------------------------------
// g_StartSellConfirmDialog
//
// 
//-----------------------------------------------------------------------------
void g_StartSellConfirmDialog(int _x, int _y)
{
	DeleteNew(gpC_dialog_sell_confirm);
	
	gpC_dialog_sell_confirm = new C_VS_UI_DIALOG(_x, _y, 2, 0, ExecF_SellConfirm, DIALOG_OK|DIALOG_CANCEL);
	char * pp_dmsg_sell_confirm[1] = {(*g_pGameStringTable)[UI_STRING_MESSAGE_SELL_CONFIRM].GetString()};
	gpC_dialog_sell_confirm->SetMessage(pp_dmsg_sell_confirm, 1, SMO_NOFIT);
	
	gpC_dialog_sell_confirm->Start();
}
void g_StartCannotSellConfirmDialog(int _x, int _y)
{
	DeleteNew(gpC_dialog_connot_sell_confirm);
	
	gpC_dialog_connot_sell_confirm = new C_VS_UI_DIALOG(_x, _y, 2, 0, ExecF_ConnotSellConfirm, DIALOG_OK);
	char * pp_dmsg_cannot_sell_confirm[1] = {(*g_pGameStringTable)[UI_STRING_MESSAGE_WITHDRAW_LIMIT].GetString()};
	gpC_dialog_connot_sell_confirm->SetMessage(pp_dmsg_cannot_sell_confirm, 1, SMO_NOFIT);
	
	gpC_dialog_connot_sell_confirm->Start();
}
//-----------------------------------------------------------------------------
// g_StartSwapConfirmDialog
//
// 
//-----------------------------------------------------------------------------
void g_StartSwapConfirmDialog(int _x, int _y)
{
	DeleteNew(gpC_dialog_swap_confirm);
	
	gpC_dialog_swap_confirm = new C_VS_UI_DIALOG(_x, _y, 2, 0, ExecF_SwapConfirm, DIALOG_OK|DIALOG_CANCEL);
	char * pp_dmsg_sell_confirm[1] = {(*g_pGameStringTable)[UI_STRING_MESSAGE_SWAP_CONFIRM].GetString()};
	gpC_dialog_swap_confirm->SetMessage(pp_dmsg_sell_confirm, 1, SMO_NOFIT);
	
	gpC_dialog_swap_confirm->Start();
}
//-----------------------------------------------------------------------------
// g_StartSellAllConfirmDialog
//
// 
//-----------------------------------------------------------------------------
void g_StartSellAllConfirmDialog(int _x, int _y, int price)
{
	// 비상용으로 땜빵.
	DeleteNew(gpC_dialog_sellall_confirm);
	
	gpC_dialog_sellall_confirm = new C_VS_UI_DIALOG(_x, _y, 2, 0, ExecF_SellAllConfirm, DIALOG_OK|DIALOG_CANCEL);
	
	char sz_buf[512];
	static char temp[100];
	wsprintf(sz_buf, "%d", price);
	std::string sstr = sz_buf;
	for(int i = 3; i <= 13; i += 4)
		if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
	sprintf(sz_buf, "%s", sstr.c_str());	
	
	wsprintf(temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_ALL_PRICE].GetString(), sz_buf);
	
	static char *pp_dmsg_sellall_confirm[2] = {
		temp, 
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ALL_SELL_CONFIRM].GetString(),
	};
	gpC_dialog_sellall_confirm->SetMessage(pp_dmsg_sellall_confirm, 2, SMO_NOFIT);		
	gpC_dialog_sellall_confirm->Start();
}

//-----------------------------------------------------------------------------
// g_StartRepairAllConfirmDialog
//
// 
//-----------------------------------------------------------------------------
#if __CONTENTS(!__REPAIRSYSTEM_RENEWAL)
void g_StartRepairAllConfirmDialog(int _x, int _y, int price)
{
	//비상용 땜빵 
	DeleteNew(gpC_dialog_repairall_confirm);
	
	gpC_dialog_repairall_confirm = new C_VS_UI_DIALOG(_x, _y, 2, 0, ExecF_RepairAllConfirm, DIALOG_OK|DIALOG_CANCEL);
	
	static char temp[100];	
	char sz_buf[512];
	wsprintf(sz_buf, "%d", price);
	std::string sstr = sz_buf;
	for(int i = 3; i <= 13; i += 4)
		if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
	sprintf(sz_buf, "%s", sstr.c_str());	

	wsprintf(temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_ALL_PRICE].GetString(), sz_buf);
	
	static char *pp_dmsg_repairall_confirm[2] = {		
		temp,
		(*g_pGameStringTable)[UI_STRING_MESSAGE_REPAIR_CONFIRM].GetString(),
	};

	gpC_dialog_repairall_confirm->SetMessage(pp_dmsg_repairall_confirm, 2, SMO_NOFIT);
	gpC_dialog_repairall_confirm->Start();
}
#else
void g_StartRepairAllConfirmDialog(int _x, int _y, int price)
{

	//비상용 땜빵 
	DeleteNew(gpC_dialog_repairall_confirm);

	gpC_dialog_repairall_confirm = new C_VS_UI_DIALOG(_x, _y, 2, 0, ExecF_RepairAllConfirm, DIALOG_OK);
	

	static char *pp_dmsg_repairall_confirm[1] = {		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_DC_PRICE_COUNT].GetString(),
	};

	gpC_dialog_repairall_confirm->SetMessage(pp_dmsg_repairall_confirm, 1, SMO_NOFIT);
	gpC_dialog_repairall_confirm->Start();
}
#endif //__REPAIRSYSTEM_RENEWAL

//-----------------------------------------------------------------------------
// g_StartSellFinishDialog
//
// 
//-----------------------------------------------------------------------------
void g_StartSellFinishDialog(int _x, int _y)
{
	DeleteNew(gpC_dialog_sell_finish);
	
	gpC_dialog_sell_finish = new C_VS_UI_DIALOG(_x, _y, 2, 1, ExecF_SellFinish, DIALOG_OK);
	static char * pp_dmsg_sell_finish[4] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLICK_TRADE_ITEM].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLICK_OK_BUTTON_TO_END].GetString(),
		"",
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TIP_SELL_ALL_VAMPIRE_HEAD].GetString(),
	};
	gpC_dialog_sell_finish->SetMessage(pp_dmsg_sell_finish, 4, SMO_NOFIT);
	
	gpC_dialog_sell_finish->StartByPinMode();
}

//-----------------------------------------------------------------------------
// g_StartSwapAdvanceItemDialog
//
// 
//-----------------------------------------------------------------------------
void g_StartSwapAdvanceItemDialog(int _x, int _y)
{
	DeleteNew(gpC_dialog_sell_finish);
	
	gpC_dialog_sell_finish = new C_VS_UI_DIALOG(_x, _y, 2, 1, ExecF_SwapAdvancementItemFinish, DIALOG_OK);
	static char * pp_dmsg_sell_finish[2] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_CLICK_EXCHANGE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLICK_OK_BUTTON_TO_END].GetString(),
	};
	gpC_dialog_sell_finish->SetMessage(pp_dmsg_sell_finish, 2, SMO_NOFIT);
	
	gpC_dialog_sell_finish->StartByPinMode();
}

//-----------------------------------------------------------------------------
// g_StartRepairConfirmDialog
//
// Gear/Inventory에 해당하므로 global로 함.
//-----------------------------------------------------------------------------
void g_StartRepairConfirmDialog(int _x, int _y, bool bChargeItem)
{
	DeleteNew(gpC_dialog_repair_confirm);
	
	gpC_dialog_repair_confirm = new C_VS_UI_DIALOG(_x, _y, 2, 0, ExecF_RepairConfirm, DIALOG_OK|DIALOG_CANCEL);
	
	char * pp_dmsg_repair_confirm[1] = {(*g_pGameStringTable)[UI_STRING_MESSAGE_THIS_ITEM_REPAIR_CONFIRM].GetString()};
	char * pp_dmsg_charge_confirm[1] = {(*g_pGameStringTable)[UI_STRING_MESSAGE_THIS_ITEM_CHARGE_CONFIRM].GetString()};
	
	if(bChargeItem)
		gpC_dialog_repair_confirm->SetMessage(pp_dmsg_charge_confirm, 1, SMO_NOFIT);
	else
		gpC_dialog_repair_confirm->SetMessage(pp_dmsg_repair_confirm, 1, SMO_NOFIT);
	
	gpC_dialog_repair_confirm->Start();
}

//-----------------------------------------------------------------------------
// g_StartRepairFinishDialog
//
// 
//-----------------------------------------------------------------------------
void g_StartRepairFinishDialog(int _x, int _y)
{
	DeleteNew(gpC_dialog_repair_finish);
	
	gpC_dialog_repair_finish = new C_VS_UI_DIALOG(_x, _y, 4, 180, ExecF_RepairFinish, DIALOG_OK);
	static char * pp_dmsg_repair_finish[] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLICK_REPAIR_ITEM].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLICK_OK_BUTTON_TO_END].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TIP_REPAIR_ALL_ITEM].GetString(),
	};
	gpC_dialog_repair_finish->SetMessage(pp_dmsg_repair_finish, 3, SMO_NOFIT);
	
	gpC_dialog_repair_finish->StartByPinMode();
}

// g_StartSilveringConfirmDialog
//
// Gear/Inventory에 해당하므로 global로 함.
//-----------------------------------------------------------------------------
void g_StartSilveringConfirmDialog(int _x, int _y)
{
	DeleteNew(gpC_dialog_silvering_confirm);
	
	gpC_dialog_silvering_confirm = new C_VS_UI_DIALOG(_x, _y, 2, 0, ExecF_SilveringConfirm, DIALOG_OK|DIALOG_CANCEL);
	static char * pp_dmsg_silvering_confirm[] = {(*g_pGameStringTable)[UI_STRING_MESSAGE_THIS_ITEM_SILVERING_CONFIRM].GetString()};
	gpC_dialog_silvering_confirm->SetMessage(pp_dmsg_silvering_confirm, 1, SMO_NOFIT);
	
	gpC_dialog_silvering_confirm->Start();
}

//-----------------------------------------------------------------------------
// g_StartSilveringFinishDialog
//
// 
//-----------------------------------------------------------------------------
void g_StartSilveringFinishDialog(int _x, int _y)
{
	DeleteNew(gpC_dialog_silvering_finish);
	
	gpC_dialog_silvering_finish = new C_VS_UI_DIALOG(_x, _y, 3, 0, ExecF_SilveringFinish, DIALOG_OK);
	
	static char * pp_dmsg_silvering_finish[2] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLICK_SILVERING_ITEM].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLICK_OK_BUTTON_TO_END].GetString()
	};
	
	gpC_dialog_silvering_finish->SetMessage(pp_dmsg_silvering_finish, 2, SMO_NOFIT);
	
	gpC_dialog_silvering_finish->StartByPinMode();
}


//----------------------------------------------------------------------------
// Operations
//----------------------------------------------------------------------------

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::C_VS_UI_TRIBE
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_TRIBE::C_VS_UI_TRIBE()
{
	g_RegisterWindow(this);
	
	AttrKeyboardControl(true);
	
	AttrPin(true);
	m_pC_inventory = new C_VS_UI_INVENTORY;
	m_pC_quest_status = new C_VS_UI_QUEST_STATUS;
	
	m_pC_hpbar = new C_VS_UI_HPBAR;
	m_pC_BloodBurst = new C_VS_UI_BLOOD_BURST; 

	//m_pC_Market =  new  C_VS_UI_MARKET_ACCOUNT ; 

	m_pC_effect_status = new C_VS_UI_EFFECT_STATUS;
	m_pc_tmall = new C_VS_UI_TMALL;
	m_pc_payevent = new C_VS_UI_PAYEVENT;
	m_pC_minimap = new C_VS_UI_MINIMAP;
	m_pc_gamehook = new C_VS_UI_GAMEHOOK;
	m_pc_hollywar = new C_VS_UI_HOLYWAR;

	m_pc_military = new C_VS_UI_MILITARYDLG;

	m_pC_chatting = NULL;
	m_pC_skill = new C_VS_UI_SKILL;
	m_pC_common_button_group = new ButtonGroup(this);

	for(int i = 0; i < MENU_BUTTON_GROUP_COUNT; ++i)
		m_pC_menu_button_groups[i] = new ButtonGroup(this);
	
	m_pC_level_up = NULL;
	
	// TIMER
	m_dw_prev_tickcount = GetTickCount();
	m_dw_millisec = 100;

	m_OpenedHelpIdx = EXEC_MAX;
	
	m_selected_menu = -1;
	
	//	m_bl_help = false;
	//	m_bl_party = false;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::~C_VS_UI_TRIBE
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_TRIBE::~C_VS_UI_TRIBE()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::MAINMENU, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::MAINMENU, GetAttributes()->autohide);
	//gpC_vs_ui_window_manager->SetMainMenu(GetSelectedMenu());

	g_UnregisterWindow(this);

	DeleteNew(m_pC_hpbar);
	DeleteNew(m_pC_BloodBurst);
	//DeleteNew(m_pC_Market);
	
	DeleteNew(m_pC_quest_status);	
	DeleteNew(m_pC_effect_status);
	DeleteNew(m_pC_minimap);
	DeleteNew(m_pc_gamehook);
	DeleteNew( m_pc_military );
	DeleteNew( m_pc_tmall );
	DeleteNew( m_pc_payevent );
	DeleteNew( m_pc_hollywar );
	DeleteNew(m_pC_inventory);
	DeleteNew(m_pC_skill);
	
	DeleteNew(m_pC_main_spk);
	DeleteNew(m_pC_sys_button_spk);
	
	DeleteNew(m_pC_common_button_group);

	for(int i = 0; i < MENU_BUTTON_GROUP_COUNT; ++i)
		DeleteNew(m_pC_menu_button_groups[i]);

	DeleteNew(m_pC_level_up);

	DeleteNew(gpC_dialog_select_item_from_shop);
	DeleteNew(gpC_dialog_game_over);
	DeleteNew(gpC_dialog_all_stage_clear);
	DeleteNew(gpC_dialog_show_web_page);
	
	
	FinishItemSelling();
	FinishItemRepairing(); // to release dialog mem
	FinishItemSilvering(); // to release dialog mem


}

void C_VS_UI_TRIBE::SetupMenuItems(const char* mainSpkFileName, const char* sysButtonSpkFileName)
{
	//////////////////////////////////////////////////////////////////////////
	// load spk
	m_pC_main_spk = new C_SPRITE_PACK(mainSpkFileName);

	Set(g_pUserInformation->iResolution_x-m_pC_main_spk->GetWidth()+1,
		g_pUserInformation->iResolution_y-m_pC_main_spk->GetHeight()+1,
		m_pC_main_spk->GetWidth()-1, m_pC_main_spk->GetHeight()-1);

	m_pC_sys_button_spk = new C_SPRITE_PACK(sysButtonSpkFileName);

	//////////////////////////////////////////////////////////////////////////
	// common buttons
	int tab_x = 51, tab_y = 179, tab_gap = 24;

	m_pC_common_button_group->Add( new C_VS_UI_EVENT_BUTTON(tab_x, tab_y,
		m_pC_sys_button_spk->GetWidth(TAB_INFO_NORMAL), m_pC_sys_button_spk->GetHeight(TAB_INFO_NORMAL),
		MENU_INFO_ID, this, TAB_INFO_NORMAL) );
	tab_x += tab_gap;

	m_pC_common_button_group->Add( new C_VS_UI_EVENT_BUTTON(tab_x, tab_y,
		m_pC_sys_button_spk->GetWidth(TAB_GUILD_NORMAL), m_pC_sys_button_spk->GetHeight(TAB_GUILD_NORMAL),
		MENU_GUILD_ID, this, TAB_GUILD_NORMAL) );
	tab_x += tab_gap;

	m_pC_common_button_group->Add( new C_VS_UI_EVENT_BUTTON(tab_x, tab_y,
		m_pC_sys_button_spk->GetWidth(TAB_COMMUNITY_NORMAL), m_pC_sys_button_spk->GetHeight(TAB_COMMUNITY_NORMAL),
		MENU_COMMUNITY_ID, this, TAB_COMMUNITY_NORMAL) );
	tab_x += tab_gap;

	m_pC_common_button_group->Add( new C_VS_UI_EVENT_BUTTON(tab_x, tab_y,
		m_pC_sys_button_spk->GetWidth(TAB_SHOP_NORMAL), m_pC_sys_button_spk->GetHeight(TAB_SHOP_NORMAL),
		MENU_SHOP_ID, this, TAB_SHOP_NORMAL) );
	tab_x += tab_gap;

	m_pC_common_button_group->Add( new C_VS_UI_EVENT_BUTTON(tab_x, tab_y,
		m_pC_sys_button_spk->GetWidth(TAB_HELP_NORMAL), m_pC_sys_button_spk->GetHeight(TAB_HELP_NORMAL),
		MENU_HELP_ID, this, TAB_HELP_NORMAL) );
	tab_x += tab_gap;

	m_pC_common_button_group->Add( new C_VS_UI_EVENT_BUTTON(tab_x, tab_y,
		m_pC_sys_button_spk->GetWidth(TAB_SYSTEM_NORMAL), m_pC_sys_button_spk->GetHeight(TAB_SYSTEM_NORMAL),
		SYSTEM_ID, this, TAB_SYSTEM_NORMAL) );
	tab_x += tab_gap;

#if	__CONTENTS(__USER_GRADE) // 이미지가 없어서 일단 주석 처리
//  	m_pC_common_button_group->Add( new C_VS_UI_EVENT_BUTTON(50, 161,
// 		m_pC_main_spk->GetWidth(BUTTON_USER_GRADE), m_pC_main_spk->GetHeight(BUTTON_USER_GRADE), USER_GRADE, this, BUTTON_USER_GRADE));
#endif
	// Push Pin
	m_pC_common_button_group->Add( new C_VS_UI_EVENT_BUTTON(175, 161,
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN),
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN),
		PUSHPIN_ID, this,C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN ) );

	//////////////////////////////////////////////////////////////////////////
	// Menu Items
	
	// 밑에서 부터 추가 
	const int button_x_start = 21, button_y_start = 117, button_x_gap = 0, button_y_gap = 26;
	const int button_w = m_pC_sys_button_spk->GetWidth(SUB_MENU_BUTTON_NORMAL);
	const int button_h = m_pC_sys_button_spk->GetHeight(SUB_MENU_BUTTON_NORMAL);

	ButtonGroup *menuBtnGroup;
	int menu_idx = -1, button_x = 0, button_y = 0;

	// 정보
	menu_idx = MENU_INFO_ID - MENU_INFO_ID;
	menuBtnGroup = m_pC_menu_button_groups[menu_idx];
	button_x = button_x_start + tab_gap*menu_idx;
	button_y = button_y_start;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		NAMING_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		QUEST_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		INFO_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		GEAR_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;
	
	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		INVENTORY_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		MILITARY_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	// 팀, 클랜, 길드
	menu_idx = MENU_GUILD_ID - MENU_INFO_ID;
	menuBtnGroup = m_pC_menu_button_groups[menu_idx];
	button_x = button_x_start + tab_gap*menu_idx;
	button_y = button_y_start;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		TEAM_UNION_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		TEAM_WAIT_LIST_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		TEAM_LIST_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		TEAM_MEMBER_LIST_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;
	
	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		TEAM_INFO_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	// 커뮤니티
	menu_idx = MENU_COMMUNITY_ID - MENU_INFO_ID;
	menuBtnGroup = m_pC_menu_button_groups[menu_idx];
	button_x = button_x_start + tab_gap*menu_idx;
	button_y = button_y_start;

#if __CONTENTS(__SMS_SERVICES)
	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		SMS_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;
#endif

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		MAIL_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		PARTY_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

#if __CONTENTS(__FRIEND_ADDITION)
	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		UTIL_FRIEND_WAIT, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;
	
	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		UTIL_FRIEND_SYSTEM, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;
#endif //__FRIEND_ADDITION

	// 상점
	menu_idx = MENU_SHOP_ID - MENU_INFO_ID;
	menuBtnGroup = m_pC_menu_button_groups[menu_idx];
	button_x = button_x_start + tab_gap*menu_idx;
	button_y = button_y_start;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		UTIL_MARKETB_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

#if __CONTENTS(__DARKEDEN_MARKET)
	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		UTIL_MARKETM_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;
#endif //__DARKEDEN_MARKET
	
	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		UTIL_STORE_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	// 도움말
	menu_idx = MENU_HELP_ID - MENU_INFO_ID;
	menuBtnGroup = m_pC_menu_button_groups[menu_idx];
	button_x = button_x_start + tab_gap*menu_idx;
	button_y = button_y_start;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		GUILD_HELP_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		SKILL_HELP_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		BATTLE_HELP_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		CHAT_HELP_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;
	
	menuBtnGroup->Add( new C_VS_UI_EVENT_BUTTON(button_x, button_y,	button_w, button_h,
		HELP_ID, this, SUB_MENU_BUTTON_NORMAL) );
	button_y -= button_y_gap;

}

void	C_VS_UI_TRIBE::Show()
{
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_pC_main_spk->BltLocked(x, y, MAIN_WINDOW);

		int sec = 0, min = 0, hour = 0;
		char sz_temp[20];
		strcpy(sz_temp, m_time.c_str());
		sec = atoi(sz_temp+strlen(sz_temp)-2);
		sz_temp[strlen(sz_temp)-3] = '\0';
		min = atoi(sz_temp+strlen(sz_temp)-2);
		sz_temp[strlen(sz_temp)-3] = '\0';
		hour = atoi(sz_temp);
		
		const int icon_x = 88+24, icon_y = 29+23;
		if(hour >= 8 && hour < 16)	// 낮이다
			m_pC_main_spk->BltLocked(x+icon_x, y+icon_y, ICON_SUN);
		else if(hour >= 20 || hour < 4)	// 밤이다
			m_pC_main_spk->BltLocked(x+icon_x+3, y+icon_y, ICON_MOON);
		else	// 낮밤 교체의 시기-_- 시기-_-?;;
		{
			if(hour >=4 && hour < 8)	// 해뜨는 시간
			{
				int time = (hour-4)*60+min;
				// 해랑 달이랑 사이즈가 달라서 귀찮네-_-;
				Rect rect(0, 0, m_pC_main_spk->GetWidth(ICON_MOON), m_pC_main_spk->GetHeight(ICON_MOON)*(240-time)/240);
				rect.y = m_pC_main_spk->GetHeight(ICON_MOON)-rect.h;
				m_pC_main_spk->BltLockedClip(x+icon_x+3, y+icon_y-rect.y, rect, ICON_MOON);
				rect.w = m_pC_main_spk->GetWidth(ICON_SUN);
				rect.h = m_pC_main_spk->GetHeight(ICON_SUN)*(time)/240;
				rect.y = 0;
				m_pC_main_spk->BltLockedClip(x+icon_x, y+icon_y+m_pC_main_spk->GetHeight(ICON_SUN)-rect.h, rect, ICON_SUN);
			}
			else						// 아니면 해지는 시간이겠지-_-
			{
				int time = (hour-16)*60+min;
				// 해랑 달이랑 사이즈가 달라서 귀찮네-_-;
				Rect rect(0, 0, m_pC_main_spk->GetWidth(ICON_SUN), m_pC_main_spk->GetHeight(ICON_SUN)*(240-time)/240);
				rect.y = m_pC_main_spk->GetHeight(ICON_SUN)-rect.h;
				m_pC_main_spk->BltLockedClip(x+icon_x, y+icon_y-rect.y, rect, ICON_SUN);
				rect.w = m_pC_main_spk->GetWidth(ICON_MOON);
				rect.h = m_pC_main_spk->GetHeight(ICON_MOON)*(time)/240;
				rect.y = 0;
				m_pC_main_spk->BltLockedClip(x+icon_x+3, y+icon_y+m_pC_main_spk->GetHeight(ICON_MOON)-rect.h, rect, ICON_MOON);
			}
		}


		gpC_base->m_p_DDSurface_back->Unlock();
	}

	g_FL2_GetDC();

	m_pC_common_button_group->ShowDescription();
	
//	g_PrintColorStr(x +128 - g_GetStringWidth(m_date.c_str(), gpC_base->m_chatting_pi.hfont)/2, y+10, m_date.c_str() ,gpC_base->m_chatting_pi, RGB_WHITE);	
//	g_PrintColorStr(x + 6+128 - g_GetStringWidth(m_time.c_str(), gpC_base->m_chatting_pi.hfont)/2, y+31, m_time.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);	

	g_PrintColorStr(x +152 - g_GetStringWidth(m_date.c_str(), gpC_base->m_chatting_pi.hfont)/2, y+37, m_date.c_str() ,gpC_base->m_chatting_pi, RGB_WHITE);	
	g_PrintColorStr(x + 6+152 - g_GetStringWidth(m_time.c_str(), gpC_base->m_chatting_pi.hfont)/2, y+54, m_time.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);	

	g_FL2_ReleaseDC();


	//////////////////////////////////////////////////////////////////////////
	// 각 종족별 경험치 표시
	ShowExp();
	//
	//////////////////////////////////////////////////////////////////////////

	m_pC_skill->Show2();

	static const char* slayer_menu_string[] =
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MENU].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM].GetString(),
 		(*g_pGameStringTable)[UI_STRING_MESSAGE_EXP].GetString(),		// 커뮤니티
 		(*g_pGameStringTable)[UI_STRING_MESSAGE_MESSAGE].GetString(),	// 상점
 		(*g_pGameStringTable)[UI_STRING_MESSAGE_HELP].GetString(),
	};

	static const char* vampire_menu_string[] =
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MENU].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN].GetString(),
 		(*g_pGameStringTable)[UI_STRING_MESSAGE_EXP].GetString(),		// 커뮤니티
 		(*g_pGameStringTable)[UI_STRING_MESSAGE_MESSAGE].GetString(),	// 상점
 		(*g_pGameStringTable)[UI_STRING_MESSAGE_HELP].GetString(),
	};

	static const char* ousters_menu_string[] =
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MENU].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD].GetString(),
 		(*g_pGameStringTable)[UI_STRING_MESSAGE_EXP].GetString(),		// 커뮤니티
 		(*g_pGameStringTable)[UI_STRING_MESSAGE_MESSAGE].GetString(),	// 상점
 		(*g_pGameStringTable)[UI_STRING_MESSAGE_HELP].GetString(),
	};

	const char** menuStrings = NULL;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:	menuStrings = slayer_menu_string;	break;
	case RACE_VAMPIRE:	menuStrings = vampire_menu_string;	break;
	case RACE_OUSTERS:	menuStrings = ousters_menu_string;	break;
	}


	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_pC_common_button_group->Show();

		if(m_selected_menu >= MENU_INFO_ID && m_selected_menu <= MENU_HELP_ID)
		{
			int menuIdx = m_selected_menu - MENU_INFO_ID;

			const int sub_menu_bottom_x = 21 + menuIdx*24;
			const int sub_menu_bottom_y = 141;

			m_pC_sys_button_spk->BltLocked(x + sub_menu_bottom_x, y + sub_menu_bottom_y, SUB_MENU_BOTTOM);
			m_pC_menu_button_groups[menuIdx]->Show();

			gpC_base->m_p_DDSurface_back->Unlock();
			
			g_FL2_GetDC();
			m_pC_menu_button_groups[menuIdx]->ShowDescription();

			const char* menuString = menuStrings[menuIdx];
			
			PrintInfo* pi = &gpC_base->m_chatting_pi;
			int strW = g_GetStringWidth(menuString, pi->hfont);
			int strH = g_GetStringHeight(menuString, pi->hfont);
			
			int strX = sub_menu_bottom_x + (m_pC_sys_button_spk->GetWidth(SUB_MENU_BOTTOM) - strW)/2;
			int strY = sub_menu_bottom_y + (m_pC_sys_button_spk->GetHeight(SUB_MENU_BOTTOM) - strH)/2;
			
			g_PrintColorStrShadow(x + strX, y + strY + 5, menuString, *pi, RGB_WHITE, RGB_BLACK);

			g_FL2_ReleaseDC();
		}
		else
		{
			gpC_base->m_p_DDSurface_back->Unlock();
		}
	}
}

void	C_VS_UI_TRIBE::Process()
{
	if(!m_pC_skill->IsPixel(gpC_mouse_pointer->GetX(), gpC_mouse_pointer->GetY()))
	{
		ProcessHide(68);
	}
	m_pC_common_button_group->Process();

	for(int i = 0; i < MENU_BUTTON_GROUP_COUNT; ++i)
		m_pC_menu_button_groups[i]->Process();
}

void	C_VS_UI_TRIBE::WindowEventReceiver(id_t event)
{
	switch (event)
	{
	case EVENT_WINDOW_MOVE:
		m_pC_skill->SetStartPoint(x+67, y+30);
		EMPTY_MOVE;
		break;
	}
}
void	C_VS_UI_TRIBE::SetSelectMenu(int tab)
{
 	switch(g_eRaceInterface)
 	{
 	case RACE_SLAYER:
 		if(tab == MENU_INFO_ID || tab == MENU_GUILD_ID || tab == MENU_COMMUNITY_ID || tab == MENU_SHOP_ID || tab == MENU_HELP_ID)
 			m_selected_menu = tab;
 		break;
 
 	case RACE_VAMPIRE:
 		if(tab == MENU_INFO_ID || tab == MENU_GUILD_ID || tab == MENU_COMMUNITY_ID || tab == MENU_SHOP_ID || tab == MENU_HELP_ID)
 			m_selected_menu = tab; 
 		break;
 
 	case RACE_OUSTERS:
 		if(tab == MENU_INFO_ID || tab == MENU_GUILD_ID || tab == MENU_COMMUNITY_ID || tab == MENU_SHOP_ID || tab == MENU_HELP_ID)
 			m_selected_menu = tab;
 		break;		
 	}	
}



//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRIBE::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{


// 	switch(g_eRaceInterface)
// 	{
// 	case RACE_SLAYER:
// 		if(p_button->GetID() == PUSHPIN_ID && GetAttributes()->autohide)
// 			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)slayer_string[EXEC_MAX],0,0);
// 		else
// 			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)slayer_string[p_button->GetID()],0,0);
// 		break;
// 		
// 	case RACE_VAMPIRE:
// 		if(p_button->GetID() == PUSHPIN_ID && GetAttributes()->autohide)
// 			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)vampire_string[EXEC_MAX],0,0);		else
// 			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)vampire_string[p_button->GetID()],0,0);
// 		break;
// 		
// 	case RACE_OUSTERS:
// 		if(p_button->GetID() == PUSHPIN_ID && GetAttributes()->autohide)
// 			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)ousters_string[EXEC_MAX],0,0);		else
// 			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)ousters_string[p_button->GetID()],0,0);
// 		break;
// 	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRIBE::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	//	ShowButtonDescription(p_button);
	if(p_button->GetID() == PUSHPIN_ID)
	{
		if(GetAttributes()->autohide)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN_PUSHED);
	}
#if	__CONTENTS(__USER_GRADE)
	else if(p_button->GetID() == USER_GRADE)
	{
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_pC_main_spk->BltLocked(x+p_button->x, y+p_button->y+1, p_button->m_image_index+1);
			else
				m_pC_main_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+1);
		}
		else
			m_pC_main_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
	}
#endif	//__USER_GRADE
	else
	{
		if(p_button->GetID() == m_selected_menu)
		{
			m_pC_sys_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+2);
		}
		else if(p_button->GetFocusState()) 
		{
			if(p_button->GetPressState())
			{
				m_pC_sys_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+2);
			}
			else
			{
				m_pC_sys_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+1);
			}
		}
		else
			m_pC_sys_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
	}

		const static char* slayer_string[EXEC_MAX+1] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_ON].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_GAME_MENU].GetString(),
// 			
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_MENU].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_EXP].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_MESSAGE].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_UTIL].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_HELP].GetString(),
		"",
		"",
		"",
		"",
		"",
		"",
			
		// Menu TAB
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INVENTORY].GetString(),
		"쌓섬괜柯",
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GEAR_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_PARTY_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MAILBOX].GetString(),
#if __CONTENTS(__SMS_SERVICES)
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SMS_WINDOW].GetString(),
#endif
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NAMING_WINDOW].GetString(),
			
		// Guild Tab
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_MEMBER_LIST].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_COMMAND_WINDOW],
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_LIST_WINDOW],
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_WAIT_LIST_WINDOW],
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_UNION_WINDOW],

		// util tab
		(*g_pGameStringTable)[UI_STRING_MESSAGE_PERSONAL_STORE].GetString(),
//#if __CONTENTS(__POWER_JJANG_ID)
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_POWER_JJANG].GetString(),
//#endif
#if __CONTENTS(__DARKEDEN_MARKET)
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DARKEDEN_MARKET].GetString(),
#endif //__DARKEDEN_MARKET
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOPPING_BASKET].GetString(),
#if __CONTENTS(__FRIEND_ADDITION)
		(*g_pGameStringTable)[UI_STRING_MESSAGE_FRIEND_SYSTEM].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_FRIEND_WAIT].GetString(),
#endif //__FRIEND_ADDITION	


		// HELP TAB
		(*g_pGameStringTable)[UI_STRING_MESSAGE_BASIC_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CHATTING_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_WAR_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SKILL_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_WORLD_MAP].GetString(),

		//USER GRADE
#if	__CONTENTS(__USER_GRADE)		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_USERGRADE].GetString(),
#endif	//__USER_GRADE			
		// MAX+
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_OFF].GetString(),
	};
	
	const static char* vampire_string[EXEC_MAX+1] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_ON].GetString(),
//  		(*g_pGameStringTable)[UI_STRING_MESSAGE_GAME_MENU].GetString(),
//  			
//  		(*g_pGameStringTable)[UI_STRING_MESSAGE_MENU].GetString(),
//  		(*g_pGameStringTable)[UI_STRING_MESSAGE_EXP].GetString(),
//  		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN].GetString(),
//  		(*g_pGameStringTable)[UI_STRING_MESSAGE_MESSAGE].GetString(),
//  		(*g_pGameStringTable)[UI_STRING_MESSAGE_UTIL].GetString(),
//  		(*g_pGameStringTable)[UI_STRING_MESSAGE_HELP].GetString(),

		"",
		"",
		"",
		"",
		"",
		"",
		
		// Menu TAB
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INVENTORY].GetString(),
		"쌓섬괜柯",
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GEAR_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_PARTY_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MAILBOX].GetString(),
#if __CONTENTS(__SMS_SERVICES)
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SMS_WINDOW].GetString(),
#endif
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NAMING_WINDOW].GetString(),
			
		// Guild Tab
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN_MEMBER_LIST].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN_COMMAND_WINDOW],// = "클랜 명령(Clan Command)";
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN_LIST_WINDOW],// = "클랜 목록(Clan List)";
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN_WAIT_LIST_WINDOW],// = "대기 클랜 목록(Wait Clan List)";
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN_UNION_WINDOW],// = "클랜 연합(Clan Union)";

		// util tab
		(*g_pGameStringTable)[UI_STRING_MESSAGE_PERSONAL_STORE].GetString(),
//#if __CONTENTS(__POWER_JJANG_ID)
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_POWER_JJANG].GetString(),
//#endif
#if __CONTENTS(__DARKEDEN_MARKET)
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DARKEDEN_MARKET].GetString(),
#endif //__DARKEDEN_MARKET
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOPPING_BASKET].GetString(),
#if __CONTENTS(__FRIEND_ADDITION)
		(*g_pGameStringTable)[UI_STRING_MESSAGE_FRIEND_SYSTEM].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_FRIEND_WAIT].GetString(),
#endif //__FRIEND_ADDITION	

		// HELP TAB
		(*g_pGameStringTable)[UI_STRING_MESSAGE_BASIC_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CHATTING_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_WAR_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MAGIC_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_WORLD_MAP].GetString(),
		
		//USER GRADE
#if	__CONTENTS(__USER_GRADE)
		(*g_pGameStringTable)[UI_STRING_MESSAGE_USERGRADE].GetString(),
#endif	//__USER_GRADE			
		// MAX+
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_OFF].GetString(),
	};
	
	const static char* ousters_string[EXEC_MAX+1] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_ON].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_GAME_MENU].GetString(),
// 		
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_MENU].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_EXP].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_MESSAGE].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_UTIL].GetString(),
// 		(*g_pGameStringTable)[UI_STRING_MESSAGE_HELP].GetString(),

		"",
		"",
		"",
		"",
		"",
		"",
		
		// Menu TAB
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INVENTORY].GetString(),
		"쌓섬괜柯",
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GEAR_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_PARTY_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MAILBOX].GetString(),
#if __CONTENTS(__SMS_SERVICES)
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SMS_WINDOW].GetString(),
#endif
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NAMING_WINDOW].GetString(),
		
		// Guild Tab
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_MEMBER_LIST].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_COMMAND_WINDOW],// = "길드 명령(Guild Command)";
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_LIST_WINDOW],// = "길드 목록(Guild List)";
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_WAIT_LIST_WINDOW],// = "대기 길드 목록(Wait Guild List)";
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_UNION_WINDOW],// = "길드 연합(Guild Union)";
			
		// util tab
		(*g_pGameStringTable)[UI_STRING_MESSAGE_PERSONAL_STORE].GetString(),
//#if __CONTENTS(__POWER_JJANG_ID)
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_POWER_JJANG].GetString(),
//#endif
#if __CONTENTS(__DARKEDEN_MARKET)
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DARKEDEN_MARKET].GetString(),
#endif //__DARKEDEN_MARKET
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOPPING_BASKET].GetString(),
#if __CONTENTS(__FRIEND_ADDITION)
		(*g_pGameStringTable)[UI_STRING_MESSAGE_FRIEND_SYSTEM].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_FRIEND_WAIT].GetString(),
#endif //__FRIEND_ADDITION	
		
		// HELP TAB
		(*g_pGameStringTable)[UI_STRING_MESSAGE_BASIC_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CHATTING_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_WAR_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MAGIC_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_WORLD_MAP].GetString(),

		//USER GRADE
#if	__CONTENTS(__USER_GRADE)		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_USERGRADE].GetString(),
#endif	//__USER_GRADE		

		// MAX+
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_OFF].GetString(),
	};	

	const char** buttonStrings = NULL;
	const char* buttonString = NULL;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:	buttonStrings = slayer_string;	break;
	case RACE_VAMPIRE:	buttonStrings = vampire_string;	break;
	case RACE_OUSTERS:	buttonStrings = ousters_string;	break;
	}

	if(p_button->GetID() >= 0 && p_button->GetID() < EXEC_MAX)
		buttonString = buttonStrings[p_button->GetID()];

	if(buttonString && p_button->GetID() >= INVENTORY_ID && p_button->GetID() <= WORLD_MAP_HELP_ID)
	{
		gpC_base->m_p_DDSurface_back->Unlock();

		PrintInfo* pi = &gpC_base->m_chatting_pi;

		int strW = g_GetStringWidth(buttonString, pi->hfont);
		int strH = g_GetStringHeight(buttonString, pi->hfont);

		int strX = p_button->x + (p_button->w - strW)/2;
		int strY = p_button->y + (p_button->h - strH)/2;

		g_FL2_GetDC();
		g_PrintColorStrShadow(x + strX, y + strY, buttonString, *pi, RGB_WHITE, RGB_BLACK);
		g_FL2_ReleaseDC();

		gpC_base->m_p_DDSurface_back->Lock();
	}

	
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::Run
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRIBE::Run(id_t id)
{
	int old_selected_menu = m_selected_menu;
	m_selected_menu = -1;

	switch(id)
	{
	case PUSHPIN_ID:
		if(GetAttributes()->autohide)
			AttrAutoHide(ATTRIBUTES_HIDE_NOT);
		else
			AttrAutoHide(ATTRIBUTES_HIDE_HEIGHT);
		EMPTY_MOVE;
		break;
		
	case SYSTEM_ID:
		gC_vs_ui.ToggleESC4UI();
		EMPTY_MOVE;
		break;
		
	case MENU_INFO_ID:
	case MENU_GUILD_ID:
	case MENU_COMMUNITY_ID:
	case MENU_SHOP_ID:
	case MENU_HELP_ID:
//	case TAB_SYSTEM_ID:
		if(old_selected_menu != id)
			m_selected_menu = id;
		break;
		
		// MENU TAB
	case INVENTORY_ID:
		HotKey_Inventory();
		break;

	case MILITARY_ID:
		HotKey_Military();
		break;
		
	case GEAR_ID:
		HotKey_Gear();
		break;
		
	case INFO_ID:
		HotKey_CharInfo();
		break;
		
	case PARTY_ID:
		HotKey_Party();
		break;
		
	case QUEST_ID:
		HotKey_Quest();
		break;

	case MAIL_ID:
		HotKey_MailBox();
		break;
#if __CONTENTS(__SMS_SERVICES)
	case SMS_ID:
		HotKey_SMSWindow();
		break;
#endif
	case NAMING_ID:
		HotKey_NamingWindow();
		break;
		// TEAM TAB
	case TEAM_INFO_ID:
		if(g_pUserInformation->GuildGrade != 4)
			gpC_base->SendMessage(UI_REQUEST_GUILD_INFO, 0, 0, NULL);
		break;
		
	case TEAM_MEMBER_LIST_ID:
		if(g_pUserInformation->GuildGrade != 4)
		{
			gC_vs_ui.RunTeamMemberList();
			gpC_base->SendMessage(UI_REQUEST_GUILD_MEMBER_LIST);
		}
		break;
//	case TEAM_COMMAND_ID: // 길드 명령
//		break;
	case TEAM_LIST_ID: // 길드 리스트
		  gpC_base->SendMessage(UI_REQUEST_UNION_REQUEST_GUILD_LIST, 1,0,NULL);
			break;
	case TEAM_WAIT_LIST_ID: // 대기 길드 리스트
		gpC_base->SendMessage(UI_REQUEST_UNION_REQUEST_GUILD_LIST, 0,0,NULL);
		break;
	case TEAM_UNION_ID:		// 연합 명령
		gpC_base->SendMessage(UI_REQUEST_UNION_REQUEST_INFO,0,0,NULL);
		break;

	// HELP TAB
	case HELP_ID:
	case CHAT_HELP_ID:
	case BATTLE_HELP_ID:
	case SKILL_HELP_ID:
	case GUILD_HELP_ID:
		OnClick_HelpTap( id );
		break;

	case WORLD_MAP_HELP_ID:
		gC_vs_ui.ToggleWorldMap();
		break;
/*
	case HELP_ID:
		HotKey_Help();
		break;
		
	case CHAT_HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::CHATTING);
		break;
		
	case BATTLE_HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::BATTLE);
		break;
		
	case SKILL_HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::SKILL);
		break;
		
	case GUILD_HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::GUILD);
		break;
*/

	case UTIL_STORE_ID:
		gpC_base->SendMessage(UI_REQUEST_STORE_INFO,0,1,NULL);
		break;

		break;
//#if __CONTENTS(__POWER_JJANG_ID)
//	case UTIL_POWER_JJANG_ID:
//		if(gC_vs_ui.IsRunningPowerjjang())
//			gpC_base->SendMessage(UI_CLOSE_POWER_JJANG);
//		else
//			gC_vs_ui.RunPowerjjang();
//		break;
//#endif
#if __CONTENTS(__DARKEDEN_MARKET)
	case UTIL_MARKETM_ID:
		gpC_base->SendMessage(UI_MARKET_ACCOUNT ,  0 , 0) ;
		break;
#endif //__DARKEDEN_MARKET
	case UTIL_MARKETB_ID:
		gpC_base->SendMessage(UI_MARKET_ACCOUNT ,  1, 0) ;	
		break;
#if __CONTENTS(__FRIEND_ADDITION)
	case UTIL_FRIEND_SYSTEM:
		{
			C_VS_UI_FRIEND_SYSTEM* pFriend = (C_VS_UI_FRIEND_SYSTEM*)gpC_window_manager->GetWindowbyName("FriendSystem");
			if (pFriend)
			{
				if (pFriend->Running())
					pFriend->Finish();
				else
					pFriend->Start();
			}
			else
			{
				pFriend = new C_VS_UI_FRIEND_SYSTEM;
				pFriend->SetWindowName("FriendSystem");
				pFriend->Start();
			}
		}
		break;
	case UTIL_FRIEND_WAIT:
		{
			C_VS_UI_FRIEND_WAIT* pFriend = (C_VS_UI_FRIEND_WAIT*)gpC_window_manager->GetWindowbyName("FriendWaitList");
			if (pFriend)
			{
				if (pFriend->Running())
					pFriend->Finish();
				else
					pFriend->Start();
			}
			else
			{
				pFriend = new C_VS_UI_FRIEND_WAIT;
				pFriend->SetWindowName("FriendWaitList");
				pFriend->Start();
			}
		}
		break;
#endif //__FRIEND_ADDITION	

#if __CONTENTS(__USER_GRADE)
	case USER_GRADE:
		gC_vs_ui.ToggleUserGrade();
		break;
#endif
	}
	
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_TRIBE::IsPixel(int _x, int _y)
{
	bool re;
	re = m_pC_main_spk->IsPixel(_x-x, _y-y);
	re |= m_pC_skill->IsPixel2(_x, _y);
	
	re |= m_pC_common_button_group->IsInRect(_x-x, _y-y) ? true : false;
	for(int i = 0; i < MENU_BUTTON_GROUP_COUNT; ++i)
		re |= m_pC_menu_button_groups[i]->IsInRect(_x-x, _y-y) ? true : false;

	return re;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::OpenInventoryToSell
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRIBE::OpenInventoryToSell()
{
	POINT ptOffset = {
		(RESOLUTION_X - 800) / 2, (RESOLUTION_Y - 600) / 2
	};

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		InventoryXY(380 + ptOffset.x, 150 + ptOffset.y);
		break;

	case RACE_VAMPIRE:
		InventoryXY(380 + ptOffset.x, 150 + ptOffset.y);
		break;

	case RACE_OUSTERS:
		InventoryXY(380 + ptOffset.x, 150 + ptOffset.y);
		break;
	}		
	
	g_StartSellFinishDialog(30 + ptOffset.x, 150 + ptOffset.y);
	
	OpenInventory(false);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::OpenInventoryToSwapAdvanceItem
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRIBE::OpenInventoryToSwapAdvanceItem()
{
	POINT ptOffset = {
		(RESOLUTION_X - 800) / 2, (RESOLUTION_Y - 600) / 2
	};

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		InventoryXY(380 + ptOffset.x, 150 + ptOffset.y);
		break;

	case RACE_VAMPIRE:
		InventoryXY(380 + ptOffset.x, 150 + ptOffset.y);
		break;

	case RACE_OUSTERS:
		InventoryXY(380 + ptOffset.x, 150 + ptOffset.y);
		break;
	}		
	
	g_StartSwapAdvanceItemDialog(30 + ptOffset.x, 150 + ptOffset.y);
	
	OpenInventory(false);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::OpenInventoryToRepair
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRIBE::OpenInventoryToRepair()
{
	POINT ptOffset = {
		(RESOLUTION_X - 800) / 2, (RESOLUTION_Y - 600) / 2
	};

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		InventoryXY(30 + ptOffset.x, 30 + ptOffset.y);
		GearXY(500 + ptOffset.x, 30 + ptOffset.y);
		break;

	case RACE_VAMPIRE:
		InventoryXY(30 + ptOffset.x, 30 + ptOffset.y);
		GearXY(500 + ptOffset.x, 60 + ptOffset.y);
		break;

	case RACE_OUSTERS:
		InventoryXY(30 + ptOffset.x, 30 + ptOffset.y);
		GearXY(500 + ptOffset.x, 60 + ptOffset.y);
		break;
	}	
	
	g_StartRepairFinishDialog(0 + ptOffset.x, 300 + ptOffset.y);
	
	OpenInventory(false);
	OpenGear(false);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::OpenInventoryToSilvering
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRIBE::OpenInventoryToSilvering()
{
	POINT ptOffset = {
		(RESOLUTION_X - 800) / 2, (RESOLUTION_Y - 600) / 2
	};

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		InventoryXY(30 + ptOffset.x, 30 + ptOffset.y);
		GearXY(500 + ptOffset.x, 30 + ptOffset.y);
		break;

	case RACE_VAMPIRE:
		InventoryXY(30 + ptOffset.x, 30 + ptOffset.y);
		GearXY(500 + ptOffset.x, 60 + ptOffset.y);
		break;

	case RACE_OUSTERS:
		InventoryXY(30 + ptOffset.x, 30 + ptOffset.y);
		GearXY(500 + ptOffset.x, 60 + ptOffset.y);
		break;		
	}	
	
	g_StartSilveringFinishDialog(0 + ptOffset.x, 300 + ptOffset.y);
	
	OpenInventory(false);
	OpenGear(false);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::FinishItemSelling
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_TRIBE::FinishItemSelling()
{
	DeleteNew(gpC_dialog_sell_finish);
	DeleteNew(gpC_dialog_sell_confirm);
	DeleteNew(gpC_dialog_sellall_confirm);	
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::FinishSwapAdvancementItem
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_TRIBE::FinishSwapAdvancementItem()
{
	DeleteNew(gpC_dialog_sell_finish);
	DeleteNew(gpC_dialog_swap_confirm);
	DeleteNew(gpC_dialog_sellall_confirm);	
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::FinishItemRepairing
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_TRIBE::FinishItemRepairing()
{
	DeleteNew(gpC_dialog_repair_finish);
	DeleteNew(gpC_dialog_repair_confirm);
	DeleteNew(gpC_dialog_repairall_confirm);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::FinishItemSilvering
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_TRIBE::FinishItemSilvering()
{
	DeleteNew(gpC_dialog_silvering_finish);
	DeleteNew(gpC_dialog_silvering_confirm);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::SetChattingInterface
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_TRIBE::SetChattingInterface(C_VS_UI_CHATTING * p_chatting)
{
	m_pC_chatting = p_chatting;
}

//-----------------------------------------------------------------------------
// Shop RunningAnnounced
//-----------------------------------------------------------------------------
void	
C_VS_UI_TRIBE::ShopRunningAnnounced() // Shop을 위한 필요한 Window를 띄운다.
{
	POINT ptOffset = {
		(RESOLUTION_X - 800) / 2, (RESOLUTION_Y - 600) / 2
	};

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		InventoryXY(380 + ptOffset.x, 85 + ptOffset.y);
		break;

	case RACE_VAMPIRE:
		InventoryXY(380 + ptOffset.x, 80 + ptOffset.y);
		break;

	case RACE_OUSTERS:
		InventoryXY(380 + ptOffset.x, 80 + ptOffset.y);
		break;
	}	
	OpenInventory(false);
}


void	C_VS_UI_TRIBE::Inventory_Item_Position_Remove()
{
	if(m_pC_inventory	!= NULL)
		m_pC_inventory->Prev_Item_Position_Remove();
}


//-----------------------------------------------------------------------------
// Storage RunningAnnounced
//-----------------------------------------------------------------------------
void	
C_VS_UI_TRIBE::StorageRunningAnnounced()
{
	POINT ptOffset = {
		(RESOLUTION_X - 800) / 2, (RESOLUTION_Y - 600) / 2
	};

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		InventoryXY(380 + ptOffset.x, 85 + ptOffset.y);
		break;

	case RACE_VAMPIRE:
		InventoryXY(380 + ptOffset.x, 80 + ptOffset.y);
		break;

	case RACE_OUSTERS:
		InventoryXY(380 + ptOffset.x, 80 + ptOffset.y);
		break;
	}	
	OpenInventory(false);
}

void
C_VS_UI_TRIBE::GetItemBoxRunningAnnounced()
{
	POINT ptOffset = {
		(RESOLUTION_X - 800) / 2, (RESOLUTION_Y - 600) / 2
	};

	InventoryXY(380 + ptOffset.x, 100 + ptOffset.y);
	
	OpenInventory( false );
}

//-----------------------------------------------------------------------------
// Exchange RunningAnnounced
//-----------------------------------------------------------------------------
void	
C_VS_UI_TRIBE::ExchangeRunningAnnounced()
{
	POINT ptOffset = {
		(RESOLUTION_X - 800) / 2, (RESOLUTION_Y - 600) / 2
	};

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		GearXY(426 + ptOffset.x, 80 + ptOffset.y);
		break;

	case RACE_VAMPIRE:
		GearXY(426 + ptOffset.x, 150 + ptOffset.y);
		break;

	case RACE_OUSTERS:
		GearXY(426 + ptOffset.x, 150 + ptOffset.y);
		break;		
	}	
	OpenGear(false);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::CloseInventoryGearWindow
//
// event lock걸려있으면 닫지 못한다.
//-----------------------------------------------------------------------------
bool C_VS_UI_TRIBE::CloseInventoryGearWindow()
{
	if (gpC_base->EventOccured())
		return false;
	
	bool inventory, gear;
	
	inventory = gpC_window_manager->GetShowState(GetInventoryWindow());
	gear = gpC_window_manager->GetShowState(GetGearWindow());
	
	if (inventory)
		HotKey_Inventory();
	if (gear)
		HotKey_Gear();
	
	return (inventory || gear);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::GetInventoryOpenState
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_TRIBE::GetInventoryOpenState() const
{
	if( m_pC_inventory != NULL )
		return m_pC_inventory->Running();
	
	return false;
}

bool C_VS_UI_TRIBE::GetGearOtherOpenState() const
{
	return GetGearOtherWindow()->Running();
}

bool C_VS_UI_TRIBE::GetTMallOpenState() const
{
	if( m_pc_tmall != NULL )
		return m_pc_tmall->Running();

	return false;
}

bool C_VS_UI_TRIBE::GetPayEventState() const
{
	if( m_pc_payevent != NULL )
		return m_pc_payevent->Running();

	return false;
}

bool C_VS_UI_TRIBE::GetHollyWarOpenState() const
{
	if( m_pc_hollywar != NULL )
		return m_pc_hollywar->Running();

	return false;
}

bool C_VS_UI_TRIBE::GetMilitaryOpenState() const
{
	if( m_pc_military!= NULL )
		return m_pc_military->Running();

	return false;
}

void C_VS_UI_TRIBE::AddHollyScore(C_VS_UI_HOLYWAR::PlayerScore score, int nRace)
{
	if ( m_pc_hollywar != NULL )
		m_pc_hollywar->AddHollyScore(score, nRace);
}

void C_VS_UI_TRIBE::AddHollyRace(C_VS_UI_HOLYWAR::RaceData * data)
{
	if ( m_pc_hollywar != NULL )
		m_pc_hollywar->AddHollyRace(data);
}

void C_VS_UI_TRIBE::AddPlayerData(C_VS_UI_HOLYWAR::PlayerData data)
{
	if ( m_pc_hollywar )
		m_pc_hollywar->AddPlayerData(data);
}
//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::GetGearOpenState
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_TRIBE::GetGearOpenState() const
{
	return GetGearWindow()->Running();
}

void C_VS_UI_TRIBE::HotKey_Military()
{
	if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
	
	if (!GetMilitaryOpenState())
		gC_vs_ui.ToggleMilitary();
	else
	{
		CloseMilitary();
	}
}
//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::HotKey_Inventory
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_TRIBE::HotKey_Inventory(bool IsCheckSubInventory)
{
	if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
	
	if (!GetInventoryOpenState())
		OpenInventory();
	else
	{
		// 2005, 3, 7, sobeit modify start - 서브인벤 처리 
		//*
		CloseInventory();
		//gC_vs_ui.CloseAllSubInventory();
		/*/
		if(!IsCheckSubInventory)
			CloseInventory();
		else
		{
			// 서브 인벤이 열렸으면 둘다 닫는다.
			if(gC_vs_ui.IsRunningSubInventory())
			{
				gC_vs_ui.CloseSubInventory();
				CloseInventory();
			}
			else
			{
				bool IsSubWindowOpen = false;
				// 서브 인벤이 있으면 서브 인벤을 연다.
				if(NULL != g_pInventory)
				{
					MItem* pSubInventory = ((MItemManager*)g_pInventory)->FindItem( MItemClassFinder(ITEM_CLASS_SUB_INVENTORY) );
					if( NULL != pSubInventory )
					{
						gpC_base->SendMessage(UI_ITEM_USE, pSubInventory->GetID(), 0, (MItem *)pSubInventory);
						IsSubWindowOpen = true;
					}
				}
				// 서브 인벤이 없으면 걍 인벤을 닫는다.
				if(!IsSubWindowOpen)
					CloseInventory();
			}
		}
		//*/
		// 2005, 3, 7, sobeit modify end - 서브인벤 처리 
	}

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::HotKey_Gear
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_TRIBE::HotKey_Gear()
{
	if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
	
	if (!GetGearOpenState())
		OpenGear();
	else
		CloseGear();
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::HotKey_GearChange
//
// 
//-----------------------------------------------------------------------------
#if __CONTENTS(__GEAR_SWAP_CHANGE)		// C_VS_UI_TRIBE::HotKey_GearChange()
void C_VS_UI_TRIBE::HotKey_GearChange()
{
	if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
	
	RunGearChange();
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
}

void C_VS_UI_TRIBE::HotKey_GearChangeShow()
{
	if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
	
	if (!GetGearOpenState())
		OpenGear();
//	else
//		CloseGear();
	
	RunGearChange();
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
}
#endif	//__GEAR_SWAP_CHANGE

//-----------------------------------------------------------------------------
// C_VS_UI_TRIBE::HotKey_Skill
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRIBE::HotKey_Mark()
{
	if (gpC_base->EventOccured() == true)
		return;
	
	m_pC_chatting->Run(C_VS_UI_CHATTING::MARK_ID);
}

void	C_VS_UI_TRIBE::HotKey_Skill()
{
	if (gpC_base->EventOccured() == true)
		return;
	
	GetSkillWindow()->ToggleWindow();
}

void	C_VS_UI_TRIBE::HotKey_CharInfo()
{
	if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
	
	if(gC_vs_ui.IsRunningCharInfo())
		gC_vs_ui.CloseInfo();
	else
		gC_vs_ui.RunInfo(C_VS_UI_INFO::CHARACTER_INFO_MODE);
}

void	C_VS_UI_TRIBE::HotKey_SkillInfo()
{
	if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
	
	if(gC_vs_ui.IsRunningSkillInfo())
		gC_vs_ui.CloseInfo();
	else
		gC_vs_ui.RunInfo(C_VS_UI_INFO::SKILL_INFO_MODE);
}

void	C_VS_UI_TRIBE::HotKey_Grade1Info()
{
	if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
	
	if(gC_vs_ui.IsRunningGrade1Info())
		gC_vs_ui.CloseInfo();
	else
		gC_vs_ui.RunInfo(C_VS_UI_INFO::GRADE1_INFO_MODE);
}

void	C_VS_UI_TRIBE::HotKey_Grade3Info()
{
	if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
	
	if(gC_vs_ui.IsRunningGrade3Info())
		gC_vs_ui.CloseInfo();
	else
	{
		if(g_char_slot_ingame.m_AdvancementLevel>0)
		{
			gC_vs_ui.RunInfo(C_VS_UI_INFO::GRADE3_INFO_MODE);
		}
	}
}

void	C_VS_UI_TRIBE::HotKey_Grade2Info()
{
	if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
	
	if(gC_vs_ui.IsRunningGrade2Info())
		gC_vs_ui.CloseInfo();
	else
		gC_vs_ui.RunInfo(C_VS_UI_INFO::GRADE2_INFO_MODE);
}


void	C_VS_UI_TRIBE::HotKey_Help()
{
	OnClick_HelpTap(HELP_ID);
}


void	C_VS_UI_TRIBE::OnClick_HelpTap( id_t execidx )
{
	if( execidx < HELP_ID || execidx > GUILD_HELP_ID ) return;

	// RunDescDialog 넘길 파라미터 저장
	void *pParm;
	switch( execidx )
	{
	case HELP_ID:			pParm = NULL;										break;
	case CHAT_HELP_ID:		pParm = (void *)C_VS_UI_DESC_DIALOG::CHATTING;		break;
	case BATTLE_HELP_ID:	pParm = (void *)C_VS_UI_DESC_DIALOG::BATTLE;		break;
	case SKILL_HELP_ID:		pParm = (void *)C_VS_UI_DESC_DIALOG::SKILL;			break;
	case GUILD_HELP_ID:		pParm = (void *)C_VS_UI_DESC_DIALOG::GUILD;			break;
	}
	
	if( gC_vs_ui.IsRunningMainHelp() )
	{
		gC_vs_ui.CloseDescDialog();
		gC_vs_ui.RunDescDialog(DID_HELP, pParm);
	}
	else
	{
		if(gC_vs_ui.IsRunningDescDialog())
		{
			id_t backup = m_OpenedHelpIdx;
			gC_vs_ui.CloseDescDialog();
			m_OpenedHelpIdx = backup;
		}
		
		if(m_OpenedHelpIdx != execidx)
		{
			gC_vs_ui.RunDescDialog(DID_HELP, pParm);
		}
		else
		{
			execidx = EXEC_MAX;
		}
	}

	m_OpenedHelpIdx = execidx;		// 어떤 창을 열었는지 기억한다.


	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:	PlaySound(SOUND_SLAYER_BUTTON);		break;
	case RACE_VAMPIRE:	PlaySound(SOUND_VAMPIRE_BUTTON);	break;
	case RACE_OUSTERS:	PlaySound(SOUND_OUSTERS_INTERFACE);	break;
	}	

}


void	C_VS_UI_TRIBE::HotKey_Party()
{
	if(/*m_bl_party && */gC_vs_ui.IsRunningPartyManager())
	{
		gC_vs_ui.ClosePartyManager();
		//		m_bl_party = false;
	}
	else
	{
		//		if(gC_vs_ui.IsRunningPartyManager())return;
		gC_vs_ui.RunPartyManager();
		//		m_bl_party = true;
	}
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
	
}

void	C_VS_UI_TRIBE::HotKey_WorldMap()
{
	gC_vs_ui.ToggleWorldMap();
	EMPTY_MOVE;
}


void	C_VS_UI_TRIBE::HotKey_Minimap()
{
	ToggleMinimap();
	EMPTY_MOVE;
}

void C_VS_UI_TRIBE::HotKey_ExtendChat()		// ctrl + e
{
	m_pC_chatting->Extend();
}

void C_VS_UI_TRIBE::HotKey_Chat_Up()		// ctrl + PgUp
{

	int chat_mode = m_pC_chatting->GetChatMode();

	if(chat_mode >= 0 && chat_mode < 6)
	{
		int chat[]={5,0,1,2,3,4};
		for (int index=0; index<7 ; ++index)
		{
			if(chat_mode == index)
			{
				chat_mode = chat[index];
				break;
			}
		}
	}

	m_pC_chatting->Run(C_VS_UI_CHATTING::CHAT_NORMAL_ID + chat_mode);
}
void C_VS_UI_TRIBE::HotKey_Chat_Dn()		// ctrl + PgDn
{

	int chat_mode = m_pC_chatting->GetChatMode();

	if(chat_mode >= 0 && chat_mode < 6)
	{
		int chat[]={1,2,3,4,5,0};
		for (int index=0; index<7 ; ++index)
		{
			if(chat_mode == index)
			{
				chat_mode = chat[index];
				break;
			}
		}
	}

	m_pC_chatting->Run(C_VS_UI_CHATTING::CHAT_NORMAL_ID + chat_mode);
}

void C_VS_UI_TRIBE::HotKey_Tribe_Prior()		// alt + PgUp
{
if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;
// 
// 	int tab[] = {7,2,3,2,4,6};
// 	int tab_vamp[] = {7,2,2,2,4,6};
// 	int index = 2;
// 
// 	switch(g_eRaceInterface)
// 	{
// 	case RACE_SLAYER:
// 	case RACE_OUSTERS:
// 		
// 		for (index = 2; index < 8;++index )
// 		{
// 			if (m_selected_menu == index)
// 			{
// 				m_selected_menu = tab[index-2];
// 				break;
// 			}
// 		}
// 		break;
// 
// 	case RACE_VAMPIRE:
// 		
// 		for (index = 2; index < 8;++index )
// 		{
// 			if (m_selected_menu == index)
// 			{
// 				m_selected_menu = tab_vamp[index-2];
// 				break;
// 			}
// 		}
// 		break;
// 	}	
}

void C_VS_UI_TRIBE::HotKey_Tribe_Next()		// alt + PgDn
{
if (gpC_base == NULL || gpC_base->EventOccured() == true)
		return;

// 	int tab[] = {3,4,6,2,7,2};
// 	int tab_vamp[] = {4,2,6,2,7,2};
// 	int index = 2;
// 	
// 
// 	switch(g_eRaceInterface)
// 	{
// 	case RACE_SLAYER:
// 	case RACE_OUSTERS:
// 		
// 		for (index = 2; index < 8;++index )
// 		{
// 			if (m_selected_tab == index)
// 			{
// 				m_selected_tab = tab[index-2];
// 				break;
// 			}
// 		}
// 		break;
// 
// 	case RACE_VAMPIRE:
// 		
// 		for (index = 2; index < 8;++index )
// 		{
// 			if (m_selected_tab == index)
// 			{
// 				m_selected_tab = tab_vamp[index-2];
// 				break;
// 			}
// 		}
// 		break;
// 	}	
}

void C_VS_UI_TRIBE::HotKey_Guild_Info()		//ctrl + v
{
	if(g_pUserInformation->GuildGrade != 4)
		gpC_base->SendMessage(UI_REQUEST_GUILD_INFO, 0, 0, NULL);
}

void C_VS_UI_TRIBE::HotKey_Guild_Member_List()//ctrl + l
{
	if(g_pUserInformation->GuildGrade != 4)
	{
		gC_vs_ui.RunTeamMemberList();
		gpC_base->SendMessage(UI_REQUEST_GUILD_MEMBER_LIST);
	}
}

void C_VS_UI_TRIBE::HotKey_Coer_Attack()	//crtl + o
{
	gpC_base->SendMessage(UI_FORCEATTACK_SET);
}

#if __CONTENTS(__AUTO_ATTACT)	//__AUTO_ATTACT
void C_VS_UI_TRIBE::HotKey_Auto_Attack()	//crtl + j
{
	gpC_base->SendMessage(UI_AUTOATTACK_SET);
}
#endif //__AUTO_ATTACT
void C_VS_UI_TRIBE::HotKey_ZoneChat()		// ctrl + z
{
	m_pC_chatting->Run(C_VS_UI_CHATTING::CHAT_ZONE_ID);
}
void C_VS_UI_TRIBE::HotKey_GuildChat()		// ctrl + g
{
	m_pC_chatting->Run(C_VS_UI_CHATTING::CHAT_GUILD_ID);
}
void C_VS_UI_TRIBE::HotKey_UnionChat()		// ctrl + d
{
	m_pC_chatting->Run(C_VS_UI_CHATTING::CHAT_UNION_ID);
}
void C_VS_UI_TRIBE::HotKey_Whisper()		// ctrl + w
{
	m_pC_chatting->Run(C_VS_UI_CHATTING::CHAT_WHISPER_ID);
}
/*
void C_VS_UI_TRIBE::HotKey_F9()
{
	C_VS_UI_SKILL * p_skill = GetSkillWindow();
	
	int slot = p_skill->GetFocusedSlot();
	int id = p_skill->GetSkillID(slot);
	if (id != NOT_SELECTED)
	{
		p_skill->SetHotkey(C_VS_UI_SKILL::HOTKEY1, (ACTIONINFO)id);
	}
	else
	{
		// use
		p_skill->ChangeSkillByHotkey(C_VS_UI_SKILL::HOTKEY1);
	}
}

void C_VS_UI_TRIBE::HotKey_F10()			
{
	C_VS_UI_SKILL * p_skill = GetSkillWindow();
	
	int slot = p_skill->GetFocusedSlot();
	int id = p_skill->GetSkillID(slot);
	if (id != NOT_SELECTED)
	{
		p_skill->SetHotkey(C_VS_UI_SKILL::HOTKEY2, (ACTIONINFO)id);
	}
	else
	{
		// use
		p_skill->ChangeSkillByHotkey(C_VS_UI_SKILL::HOTKEY2);
	}
}

void C_VS_UI_TRIBE::HotKey_F11()			
{
	C_VS_UI_SKILL * p_skill = GetSkillWindow();
	
	int slot = p_skill->GetFocusedSlot();
	int id = p_skill->GetSkillID(slot);
	if (id != NOT_SELECTED)
	{
		p_skill->SetHotkey(C_VS_UI_SKILL::HOTKEY3, (ACTIONINFO)id);
	}
	else
	{
		// use
		p_skill->ChangeSkillByHotkey(C_VS_UI_SKILL::HOTKEY3);
	}
}

void C_VS_UI_TRIBE::HotKey_F12()
{
	C_VS_UI_SKILL * p_skill = GetSkillWindow();
	
	int slot = p_skill->GetFocusedSlot();
	int id = p_skill->GetSkillID(slot);
	if (id != NOT_SELECTED)
	{
		p_skill->SetHotkey(C_VS_UI_SKILL::HOTKEY4, (ACTIONINFO)id);
	}
	else
	{
		// use
		p_skill->ChangeSkillByHotkey(C_VS_UI_SKILL::HOTKEY4);
	}
}
*/

void C_VS_UI_TRIBE::HotKey_PartyChat()
{
	m_pC_chatting->Run(C_VS_UI_CHATTING::CHAT_PARTY_ID);
}

void C_VS_UI_TRIBE::HotKey_NormalChat()
{
	m_pC_chatting->Run(C_VS_UI_CHATTING::CHAT_NORMAL_ID);
}

void C_VS_UI_TRIBE::HotKey_Quest()
{	
//	if(m_pC_quest_status->Running())
//		m_pC_quest_status->Finish();		
//	else
//		m_pC_quest_status->Start();
//	
	gC_vs_ui.RunQuestManager();
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;

	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;

	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
}

void C_VS_UI_TRIBE::HotKey_MailBox()
{	

	if(gC_vs_ui.IsRunningMailBox() && gC_vs_ui.IsNewMail() == false)
		gC_vs_ui.CloseMailBox();
	else
		gC_vs_ui.RunMailBox();
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;
		
	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;
		
	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
}

void C_VS_UI_TRIBE::HotKey_Sysrq()
{
	//과연 이걸 굳이 여기 까지 끌고 와야 했을까?
	gpC_base->SendMessage(UI_SCREENSHOT);
}

void C_VS_UI_TRIBE::HotKey_Slash()
{
	/*
	Rect rect(-1,-1,-1,-1);
	for(int index=0 ; index < C_VS_UI_WINDOW_MANAGER::WINDOW_TOTAL ; ++index)
	{
		gpC_vs_ui_window_manager->SetRect( (C_VS_UI_WINDOW_MANAGER::WINDOW_ID) index, rect);
	}
	*/
}

void C_VS_UI_TRIBE::HotKey_Where()
{
}

void C_VS_UI_TRIBE::HotKey_Background_Music()
{
	gpC_base->SendMessage( UI_CHANGE_OPTION, C_VS_UI_OPTION::CHECK_MUSIC, !g_pUserOption->PlayMusic );
}

void C_VS_UI_TRIBE::HotKey_Effect_Music()
{
	gpC_base->SendMessage( UI_CHANGE_OPTION, C_VS_UI_OPTION::CHECK_SOUND, !g_pUserOption->PlaySound );
}

void C_VS_UI_TRIBE::HotKey_Chat_Help()
{
	OnClick_HelpTap(CHAT_HELP_ID);
}


void C_VS_UI_TRIBE::HotKey_PetInfo()
{	

	if(gC_vs_ui.IsRunningPetInfo())
		gC_vs_ui.ClosePetInfo();
	else
	{
		PETINFO* PetInfo = gC_vs_ui.GetMyPetInfo();
		if(NULL == PetInfo || PetInfo->EXIST == false)
			return;
		else
		gC_vs_ui.RunPetInfo(PetInfo);
	}
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;
		
	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;
		
	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
}

void C_VS_UI_TRIBE::HotKey_SMSWindow()
{	

	if(gC_vs_ui.IsRunningSMSMessage())
		gpC_base->SendMessage(UI_CLOSE_SMS_MESSAGE);
	else
		gC_vs_ui.RunSMSMessage();
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;
		
	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;
		
	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
}


void C_VS_UI_TRIBE::HotKey_NamingWindow()
{	

	if(gC_vs_ui.IsRunningNaming())
		gpC_base->SendMessage(UI_CLOSE_NAMING);
	else
		gC_vs_ui.RunNaming();
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;
		
	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;
		
	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}	
}
void C_VS_UI_TRIBE::HotKey_SummonPet()
{	
	if(	gbl_item_lock || gbl_gear_lock )
		return;
	
	MItem* pSubInventory = NULL;
	MItem* pItem = ((MItemManager*)g_pInventory)->FindItemAll( MItemClassFinder(ITEM_CLASS_PET_ITEM) , pSubInventory);
	
	if (pItem!=NULL && pItem->IsAffectStatus())
	{
		if(NULL != pSubInventory)
		{
			gpC_base->SendMessage(UI_ITEM_USE_SUBINVENTORY, pItem->GetID(), pSubInventory->GetID(), (MItem *)pItem);
		}
		else
			gpC_base->SendMessage(UI_ITEM_USE, pItem->GetID(), 0, (MItem *)pItem);
	}
//	for(int i = 0; i< 10; i++)
//	for(int j = 0; j < 6; j++)
//	{
//		const MItem * p_item = g_pInventory->GetItem(i, j);
//
//		if (p_item) // Item이 있다.
//		{
//			if(p_item->GetItemClass() == ITEM_CLASS_PET_ITEM)
//			{
//				gpC_base->SendMessage(UI_ITEM_USE, p_item->GetID(), 0, (MItem *)p_item);
//				return;
//			}
//		}
//	}
}
void	C_VS_UI_TRIBE::DoCommonActionBeforeEventOccured()
{
	//
	// 불필요한 Window들을 닫는다.
	//
	gC_vs_ui.CloseInfo();
	CloseInventory();
	CloseGear();
	GetSkillWindow()->CloseInterface();
	
	// stop all Window move
	GetInventoryWindow()->AttrWindowMove(false);
	GetGearWindow()->AttrWindowMove(false);
	
	// backup xy
	m_backup_inventory_xy.x = GetInventoryWindow()->x;
	m_backup_inventory_xy.y = GetInventoryWindow()->y;
	m_backup_gear_xy.x = GetGearWindow()->x;
	m_backup_gear_xy.y = GetGearWindow()->y;
	
	gpC_base->StartEvent();
}

//-----------------------------------------------------------------------------
// Timer
//
//-----------------------------------------------------------------------------
bool C_VS_UI_TRIBE::Timer()
{
	if(m_dw_prev_tickcount+m_dw_millisec <= GetTickCount())
	{
		m_dw_prev_tickcount = GetTickCount();
		return true;
	}
	
	return false;
}

bool C_VS_UI_TRIBE::MouseControl(UINT message, int _x, int _y)
{
	_x -= x; _y -= y;

	bool bMenuFocus = false;

	m_pC_common_button_group->MouseControl(message, _x, _y);
	bMenuFocus |= m_pC_common_button_group->IsInRect(_x, _y) ? true : false;

	if(m_selected_menu >= MENU_INFO_ID && m_selected_menu <= MENU_HELP_ID)
	{
		int menuIdx = m_selected_menu - MENU_INFO_ID;
		m_pC_menu_button_groups[menuIdx]->MouseControl(message, _x, _y);
		bMenuFocus |= m_pC_menu_button_groups[menuIdx]->IsInRect(_x, _y) ? true : false;
		bMenuFocus |= m_pC_sys_button_spk->IsPixel(_x - 21 - menuIdx*24, _y - 141, SUB_MENU_BOTTOM);
	}

	if(bMenuFocus)
		return true;

	// EXP 는 버튼이 없다
	if(g_eRaceInterface == RACE_SLAYER)
	{
		//			char* exp_bar_string[1] = 
		//			{
		//				(*g_pGameStringTable)[UI_STRING_MESSAGE_CURRENT_EXP].GetString(),
		//				(*g_pGameStringTable)[UI_STRING_MESSAGE_NEXT_LEVEL].GetString(),
		//				(*g_pGameStringTable)[UI_STRING_MESSAGE_LEFT_EXP].GetString(),
		//			};
		static char temp_str[1][50];
		static LPSTR str[1] = { temp_str[0] };//, temp_str[1] };//, temp_str[2] };
		str[0] = temp_str[0];
		//			str[1] = temp_str[1];
		//			str[2] = temp_str[2];
		
		const int bar_x = 98, bar_y = 74, str_x = 27, num_x = 76, bar_gap = 12;
		int num[2] = {-1, -1};//, -1};
		
		
		if(_x > str_x && _x < 165 && _y > bar_y && _y < bar_y + bar_gap*6)
		{
			int domain[3];
			domain[0] = -1;
			domain[1] = -1;
			domain[2] = -1;
			
			bool bMax = false, bFame = false;			
			
			int TotalAttr = g_char_slot_ingame.STR_PURE + g_char_slot_ingame.DEX_PURE + g_char_slot_ingame.INT_PURE;
			int DomainLevelMax = -1;
			int fame=-1;
			
			
			if((_y-bar_y)/bar_gap > 2)
			{
				for(int i = 0; i < 3; i++)
				{
					int high_level = -1;
					
					for(int d = SKILLDOMAIN_BLADE ; d <= SKILLDOMAIN_ENCHANT; d++)
					{
						const int domain_level = (*g_pSkillManager)[d].GetDomainLevel();
						if(d != domain[0] && d != domain[1] && d != domain[2] && domain_level > high_level)
						{
							domain[i] = d;
							high_level = domain_level;
						}
						
						DomainLevelMax = max(DomainLevelMax, (*g_pSkillManager)[d].GetDomainLevel() ) ;
					}
				}
			}
			
			
			switch((_y-bar_y)/bar_gap)
			{
			case 0:	// str
				{
					const __int64 goal_exp = g_pExperienceTable->GetSTRInfo(g_char_slot_ingame.STR_PURE).GoalExp;
					num[0] = g_char_slot_ingame.STR_EXP_REMAIN;
					
					num[1] = (goal_exp - num[0])*100/max(1, (goal_exp));
					//						num[2] = g_pExperienceTable->GetSTRInfo(g_char_slot_ingame.STR_PURE).AccumExp - g_char_slot_ingame.STR_EXP_CUR;
					
					// 도메인 레벨이 100이하이면서 능력치 총합이 300이하이면..
					// 하나의 능력치는 200을 넘을 수 없다.
					if( DomainLevelMax <= MAX_SLAYER_DOMAIN_SUM_OLD && TotalAttr <= MAX_SLAYER_ATTR_SUM_OLD )
					{
						if( g_char_slot_ingame.STR_PURE >= MAX_SLAYER_ATTR_OLD )
							bMax = true;
					}
				}
				break;
				
			case 1:	// dex
				{
					const __int64 goal_exp = g_pExperienceTable->GetDEXInfo(g_char_slot_ingame.DEX_PURE).GoalExp;
					num[0] = g_char_slot_ingame.DEX_EXP_REMAIN;
					
					num[1] = (goal_exp - num[0])*100/max(1, (goal_exp));
					//						num[2] = g_pExperienceTable->GetSTRInfo(g_char_slot_ingame.STR_PURE).AccumExp - g_char_slot_ingame.STR_EXP_CUR;
					
					// 도메인 레벨이 100이하이면서 능력치 총합이 300이하이면..
					// 하나의 능력치는 200을 넘을 수 없다.
					if( DomainLevelMax <= MAX_SLAYER_DOMAIN_SUM_OLD && TotalAttr <= MAX_SLAYER_ATTR_SUM_OLD )
					{
						if( g_char_slot_ingame.DEX_PURE >= MAX_SLAYER_ATTR_OLD )
							bMax = true;
					}
				}
				break;
				
			case 2:	// int
				{
					const __int64 goal_exp = g_pExperienceTable->GetINTInfo(g_char_slot_ingame.INT_PURE).GoalExp;
					num[0] = g_char_slot_ingame.INT_EXP_REMAIN;
					
					num[1] = (goal_exp - num[0])*100/max(1, (goal_exp));
					//						num[2] = g_pExperienceTable->GetSTRInfo(g_char_slot_ingame.STR_PURE).AccumExp - g_char_slot_ingame.STR_EXP_CUR;
					
					// 도메인 레벨이 100이하이면서 능력치 총합이 300이하이면..
					// 하나의 능력치는 200을 넘을 수 없다.
					if( DomainLevelMax <= MAX_SLAYER_DOMAIN_SUM_OLD && TotalAttr <= MAX_SLAYER_ATTR_SUM_OLD )
					{
						if( g_char_slot_ingame.INT_PURE >= MAX_SLAYER_ATTR_OLD )
							bMax = true;
					}
				}
				break;
				
			case 3:	// skill1
				if(g_pSkillManager)
				{
					int domainIndex = domain[0];
					int level = (*g_pSkillManager)[domainIndex].GetDomainLevel();
					int exp_remain = (*g_pSkillManager)[domainIndex].GetDomainExpRemain();
					
					if(level >= 0 && exp_remain >= 0)
					{
						//							int next_exp = (*g_pSkillManager)[domainIndex].GetExpInfo(level).AccumExp;
						const __int64 goal_exp = (*g_pSkillManager)[domainIndex].GetExpInfo(level).GoalExp;
						
						num[0] = exp_remain;
						num[1] = (goal_exp-exp_remain)*100/max(1, (goal_exp));
						//							num[2] = next_exp - exp;
					}
					
					fame = g_pFameInfoTable->GetFameForLevel( (SKILLDOMAIN) domainIndex, level );
					
					if(g_char_slot_ingame.FAME < fame )
						bFame = true;							
				}
				break;
				
			case 4:	// skill2
				if(g_pSkillManager)
				{
					int domainIndex = domain[1];
					int level = (*g_pSkillManager)[domainIndex].GetDomainLevel();
					int exp_remain = (*g_pSkillManager)[domainIndex].GetDomainExpRemain();
					
					if(level >= 0 && exp_remain >= 0)
					{
						//							int next_exp = (*g_pSkillManager)[domainIndex].GetExpInfo(level).AccumExp;
						const __int64 goal_exp = (*g_pSkillManager)[domainIndex].GetExpInfo(level).GoalExp;
						
						num[0] = exp_remain;
						num[1] = (goal_exp-exp_remain)*100/max(1, (goal_exp));
						//							num[2] = next_exp - exp;
					}
					
					fame = g_pFameInfoTable->GetFameForLevel( (SKILLDOMAIN) domainIndex, level );
					
					if(g_char_slot_ingame.FAME < fame )
						bFame = true;							
				}
				break;
				
			case 5:	// skill3
				if(g_pSkillManager)
				{
					int domainIndex = domain[2];
					int level = (*g_pSkillManager)[domainIndex].GetDomainLevel();
					int exp_remain = (*g_pSkillManager)[domainIndex].GetDomainExpRemain();
					
					if(level >= 0 && exp_remain >= 0)
					{
						//							int next_exp = (*g_pSkillManager)[domainIndex].GetExpInfo(level).AccumExp;
						const __int64 goal_exp = (*g_pSkillManager)[domainIndex].GetExpInfo(level).GoalExp;
						
						num[0] = exp_remain;
						num[1] = (goal_exp-exp_remain)*100/max(1, (goal_exp));
						//							num[2] = next_exp - exp;
					}
					
					fame = g_pFameInfoTable->GetFameForLevel( (SKILLDOMAIN) domainIndex, level );
					
					if(g_char_slot_ingame.FAME < fame )
						bFame = true;							
				}
				break;
				}
				
				
				// 숫자사이에 ,넣기
				wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), g_GetNumberString(num[0]).c_str(), g_GetNumberString(num[1]).c_str());
				
				if(num[0] < 0)
					bMax = true;	// 레벨업맥스
				
				if(bMax)
				{
					strcpy(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_STAT].GetString());
					//					str[2] = NULL;
					g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str, 1);
				}
				else
					if(bFame)
					{
						wsprintf(temp_str[0],"%s(%s:%d)",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL_BY_FAME].GetString(), 
							(*g_pGameStringTable)[UI_STRING_MESSAGE_NEED_FAME].GetString(),
							fame - g_char_slot_ingame.FAME );					
						//					str[2] = NULL;
						g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str, 1);					
					} else
						g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str, 1);
					
			}
		}
		else if(g_eRaceInterface == RACE_OUSTERS)
		{
			const int bar_x = 110, bar_y = 95, str_x = 27, num_x = 46, bar_gap = 14;
			if(_y >= bar_y && _y <= bar_y+14)
			{
				static std::string hpbar_string[2];
				const static char *help_string[3] = {NULL, NULL, NULL};
				
				char temp_string[512];
				
				int LeftExp = g_char_slot_ingame.EXP_REMAIN;//g_pExperienceTable->GetOustersInfo(g_char_slot_ingame.level).AccumExp - g_char_slot_ingame.EXP_CUR;
				wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_LEVEL_DESCRIPTION].GetString(), g_char_slot_ingame.level);
				hpbar_string[0]=temp_string;
				
				int fame = g_pFameInfoTable->GetFameForLevel( SKILLDOMAIN_OUSTERS, g_char_slot_ingame.level );
				
				if(LeftExp < 0)
				{
					hpbar_string[1]=(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL].GetString();					
				}
				else if(g_char_slot_ingame.FAME < fame)
				{
					wsprintf(temp_string, "%s(%s:%d)",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL_BY_FAME].GetString(), 
						(*g_pGameStringTable)[UI_STRING_MESSAGE_NEED_FAME].GetString(), 
						fame- g_char_slot_ingame.FAME);
					hpbar_string[1] = temp_string;
				}
				else
				{
					std::string temp[2];
					char szTemp[256]={0,};
					wsprintf(szTemp,"%d",g_char_slot_ingame.EXP_REMAIN);
					temp[0] = szTemp;
					for(int i = 3; i <= 13; i += 4)
					{
						if(temp[0].size() > i) temp[0].insert(temp[0].size()-i, ",");
					}
					
					__int64 goal_exp = g_pExperienceTable->GetOustersInfo(g_char_slot_ingame.level).GoalExp;
					wsprintf(szTemp,"%d",(goal_exp-g_char_slot_ingame.EXP_REMAIN)*100/max(1, (goal_exp)));
					
					temp[1] = szTemp;
					for(i = 3; i <= 13; i += 4)
					{
						if(temp[1].size() > i)temp[1].insert(temp[1].size()-i, ",");
					}
					//					wsprintf(szTemp,"%d",LeftExp);
					//					temp[2] = szTemp;
					//					for(i = 3; i <= 13; i += 4)
					//					{
					//						if(temp[2].size() > i)temp[2].insert(temp[2].size()-i, ",");
					//					}
					
					wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), 
						temp[0].c_str(),temp[1].c_str());//,temp[2].c_str());
					//						g_char_slot_ingame.EXP_CUR, 
					//						g_pExperienceTable->GetVampireInfo(g_char_slot_ingame.level).AccumExp, 	LeftExp);
					hpbar_string[1]=temp_string;
				}
				help_string[2] = hpbar_string[1].c_str();
				help_string[0] = hpbar_string[0].c_str();
				g_descriptor_manager.Set(DID_HELP, x+bar_x, y+bar_y, (void *)help_string);
			}
		}


	if(m_pC_skill->IsPixel2(_x+x, _y+y))
		m_pC_skill->MouseControl(message, _x+x, _y+y);

	return true;	
}

void C_VS_UI_TRIBE::Start()
{
	PI_Processor::Start();
	
	gpC_window_manager->AppearWindow(this);
	
	m_pC_chatting->Start();
	m_pC_common_button_group->Init();

	for(int i = 0; i < MENU_BUTTON_GROUP_COUNT; ++i)
		m_pC_menu_button_groups[i]->Init();
	
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::MAINMENU));
	AttrAutoHide(gpC_vs_ui_window_manager->GetAutoHide(C_VS_UI_WINDOW_MANAGER::MAINMENU));
//	SetSelectMenu(gpC_vs_ui_window_manager->GetMainMenu());
}
/*-----------------------------------------------------------------------------
- C_VS_UI_GEAR
-
-----------------------------------------------------------------------------*/
C_VS_UI_GEAR::C_VS_UI_GEAR()
{
	g_RegisterWindow(this);

	m_bIsGearOther = false;

	m_focus_slot = NOT_SELECTED;
	
	m_pC_button_group = new ButtonGroup(this);

	int level = -1;
	int close_button_offset_x, close_button_offset_y, help_button_offset_x, help_button_offset_y;
	int alpha_button_offset_x, alpha_button_offset_y;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		// by csm 2004.12.31
//		if(g_char_slot_ingame.m_AdvancementLevel> 0) // 2차 전직 용 기어 인터페이스 
//		{
			m_bl_Abvencement = true;
			m_pC_gear_spk = new C_SPRITE_PACK(SPK_SLAYER_ADVANCEMENTGEAR);	

			close_button_offset_x = 183;
			close_button_offset_y = 409;

		#if __CONTENTS(__080405_FIREST_UI_UPDATE)
			alpha_button_offset_x = 183-26-26;
			alpha_button_offset_y = 409;
			help_button_offset_x = 183-26;
			help_button_offset_y = 409;
		#else
			help_button_offset_x = 157;
			help_button_offset_y = 409;
			alpha_button_offset_x = 19;
			alpha_button_offset_y = 414;
		#endif //__080405_FIREST_UI_UPDATE


#if __CONTENTS(__GEAR_SWAP_CHANGE)	//  C_VS_UI_GEAR::C_VS_UI_GEAR() 장착창 초기 설정
			m_dwGearChange_ID1_Button_Pos_X		= 13;													//자착창을 교체할 버튼의 위치
			m_dwGearChange_ID1_Button_Pos_Y		= 21;
			m_dwGearChange_ID2_Button_Pos_X		= 181;													//자착창을 교체할 버튼의 위치
			m_dwGearChange_ID2_Button_Pos_Y		= 21;
#endif	//__GEAR_SWAP_CHANGE
			
//		}
//		else
//		{
//			m_bl_Abvencement = false;
//			m_pC_gear_spk = new C_SPRITE_PACK(SPK_SLAYER_GEAR);
//			close_button_offset_x = 183;
//			close_button_offset_y = 369;
//			help_button_offset_x = 157;
//			help_button_offset_y = 369;
//			alpha_button_offset_x = 19;
//			alpha_button_offset_y = 374;
//			
//		}

		m_pC_gear_slot_spk = new C_SPRITE_PACK(SPK_SLAYER_GEAR_SLOT);
		Set(426, 128, m_pC_gear_spk->GetWidth(0), m_pC_gear_spk->GetHeight(0));
		
		break;

	case RACE_VAMPIRE:

//		if(g_char_slot_ingame.m_AdvancementLevel> 0) // 2차 전직 용 기어 인터페이스 
//		{
			m_bl_Abvencement = true;
			m_pC_gear_spk = new C_SPRITE_PACK(SPK_VAMPIRE_ADVANCEMENTGEAR);
		
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
			alpha_button_offset_x = 84;
			alpha_button_offset_y = 296;
			help_button_offset_x = 84+26;
			help_button_offset_y = 296;
			close_button_offset_x = 84+26+26;
			close_button_offset_y = 296;
	#else
			close_button_offset_x = 175;
			close_button_offset_y = 290;
			help_button_offset_x = 150;
			help_button_offset_y = 290;
			alpha_button_offset_x = 49;
			alpha_button_offset_y = 295;
	#endif //__080405_FIREST_UI_UPDATE


#if __CONTENTS(__GEAR_SWAP_CHANGE)	//  C_VS_UI_GEAR::C_VS_UI_GEAR() 장착창 초기 설정
			m_dwGearChange_ID1_Button_Pos_X		= 25;													//자착창을 교체할 버튼의 위치
			m_dwGearChange_ID1_Button_Pos_Y		= 16;
			m_dwGearChange_ID2_Button_Pos_X		= 193;													//자착창을 교체할 버튼의 위치
			m_dwGearChange_ID2_Button_Pos_Y		= 16;
#endif	//__GEAR_SWAP_CHANGE

//		}
//		else
//		{
//			m_bl_Abvencement = false;
//			m_pC_gear_spk = new C_SPRITE_PACK(SPK_VAMPIRE_GEAR);
//			close_button_offset_x = 175;
//			close_button_offset_y = 250;
//			help_button_offset_x = 150;
//			help_button_offset_y = 250;
//			alpha_button_offset_x = 49;
//			alpha_button_offset_y = 255;
//		}
		m_pC_gear_slot_spk = new C_SPRITE_PACK(SPK_VAMPIRE_GEAR_SLOT);
		
		Set(526, 128, m_pC_gear_spk->GetWidth(0), m_pC_gear_spk->GetHeight(0));
		
		break;
		
	case RACE_OUSTERS:
//		if(g_char_slot_ingame.m_AdvancementLevel > 0) // 2차 전직 용 기어 인터페이스 
//		{
			m_bl_Abvencement = true;
			m_pC_gear_spk = new C_SPRITE_PACK(SPK_OUSTERS_ADVANCEMENTGEAR);
		
		#if __CONTENTS(__080405_FIREST_UI_UPDATE)
			alpha_button_offset_x = 229-26-26;
			alpha_button_offset_y = 388;
			help_button_offset_x = 229-26;
			help_button_offset_y = 388;
			close_button_offset_x = 229;
			close_button_offset_y = 388;
		#else
			close_button_offset_x = 237;
			close_button_offset_y = 395;
			help_button_offset_x = 213;
			help_button_offset_y = 395;
			alpha_button_offset_x = 41;
			alpha_button_offset_y = 395;
		#endif //__080405_FIREST_UI_UPDATE
			
#if __CONTENTS(__GEAR_SWAP_CHANGE)	//  C_VS_UI_GEAR::C_VS_UI_GEAR() 장착창 초기 설정
			m_dwGearChange_ID1_Button_Pos_X		= 99;													//자착창을 교체할 버튼의 위치
			m_dwGearChange_ID1_Button_Pos_Y		= 32;
			m_dwGearChange_ID2_Button_Pos_X		= 163;													//자착창을 교체할 버튼의 위치
			m_dwGearChange_ID2_Button_Pos_Y		= 32;
#endif	//__GEAR_SWAP_CHANGE
			
//		}
//		else
//		{
//			m_bl_Abvencement = false;
//			m_pC_gear_spk = new C_SPRITE_PACK(SPK_OUSTERS_GEAR);
//			close_button_offset_x = 237;
//			close_button_offset_y = 355;
//			help_button_offset_x = 213;
//			help_button_offset_y = 355;
//			alpha_button_offset_x = 41;
//			alpha_button_offset_y = 355;
//			
//		}
		m_pC_gear_slot_spk = new C_SPRITE_PACK(SPK_OUSTERS_GEAR_SLOT);
		Set(526, 128, m_pC_gear_spk->GetWidth(0), m_pC_gear_spk->GetHeight(0));
		
		break;		
	}

#if __CONTENTS(__GEAR_SWAP_CHANGE)	//C_VS_UI_GEAR::C_VS_UI_GEAR() 장착창 버튼 추가 설정
	m_dwSendGearID						= 0;
	m_dwAccepGearID						= 0;
	
	m_dwGearChange_ID1_Button_Width		= m_pC_gear_spk->GetWidth(GEAR_CHANGE_ID1_CHECK);		//장착창을 교체할 버튼의 크기
	m_dwGearChange_ID1_Button_Height	= m_pC_gear_spk->GetHeight(GEAR_CHANGE_ID1_CHECK);
	m_dwGearChange_ID2_Button_Width		= m_pC_gear_spk->GetWidth(GEAR_CHANGE_ID2_CHECK);		//장착창을 교체할 버튼의 크기
	m_dwGearChange_ID2_Button_Height	= m_pC_gear_spk->GetHeight(GEAR_CHANGE_ID2_CHECK);

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(
													m_dwGearChange_ID1_Button_Pos_X, m_dwGearChange_ID1_Button_Pos_Y, 
													m_dwGearChange_ID1_Button_Width,
													m_dwGearChange_ID1_Button_Height,
													GEAR_ID1, this, GEAR_CHANGE_ID1_CHECK
													)
							);
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(
													m_dwGearChange_ID2_Button_Pos_X, m_dwGearChange_ID2_Button_Pos_Y, 
													m_dwGearChange_ID2_Button_Width,
													m_dwGearChange_ID2_Button_Height,
													GEAR_ID2, this, GEAR_CHANGE_ID2_CHECK
													)
							);
#endif

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(help_button_offset_x, help_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION), HELP_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(close_button_offset_x, close_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_X), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_X), CLOSE_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_X));
#if __CONTENTS(__080405_FIREST_UI_UPDATE)
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_button_offset_x, alpha_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW));
#else
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_button_offset_x, alpha_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA));
#endif //__080405_FIREST_UI_UPDATE
	m_bl_set_load = false;
}

/*-----------------------------------------------------------------------------
- ~C_VS_UI_GEAR
-
-----------------------------------------------------------------------------*/
C_VS_UI_GEAR::~C_VS_UI_GEAR()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::GEAR, GetAttributes()->alpha);
	if(m_bl_set_load)
	{
		gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::GEAR, Rect(x, y, w, h));
	}
	
	g_UnregisterWindow(this);
	
	DeleteNew(m_pC_gear_spk);
	DeleteNew(m_pC_gear_slot_spk);
	DeleteNew(m_pC_button_group);
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::CancelPushState
//
// 
//-----------------------------------------------------------------------------
//void	C_VS_UI_GEAR::CancelPushState()
//{
//	m_bl_close_button_pushed = false;
//	m_bl_help_button_pushed = false;
//}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::MouseControl
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_GEAR::MouseControl(UINT message, int _x, int _y)
{
	const static char* m_gear_button_string[2] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_GEAR_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP_GEAR_WINDOW].GetString(),
	};
	
	const static char* m_slayer_help_string[30] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_HELM].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_NECKLACE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_ARMOR].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_SHIELD].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_WEAPON].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_GLOVE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BELT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_TROUSER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BRACELET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BRACELET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_RING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_RING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_RING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_RING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_SHOES].GetString(),
		NULL,
		NULL,
		NULL,
		NULL,
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_PDA].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_SHOULDER].GetString(),
		NULL,
		NULL,
		NULL,
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),

	};
	
	const static char* m_vampire_help_string[31] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_NECKLACE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_VAMPIRE_COAT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BRACELET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BRACELET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_RING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_RING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_RING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_RING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_EARRING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_EARRING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_WEAPON].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_WEAPON].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_AMULET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_AMULET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_AMULET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_AMULET].GetString(),
		NULL,
		NULL,
		NULL,
		NULL,
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_DERMIS].GetString(), 
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_PERSONA].GetString(),
		NULL,
		NULL,
		NULL,
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
	};
	
	const static char* m_ousters_help_string[31] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_CIRCLET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_COAT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_WEAPON].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_WEAPON].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_BOOTS].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_ARMSBAND].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_ARMSBAND].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_RING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_RING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_PENDENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_PENDENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_PENDENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_STONE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_STONE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_STONE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_OUSTERS_STONE].GetString(),
		NULL,
		NULL,
		NULL,
		NULL,
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_FASCIA].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_MITTEN].GetString(),
		NULL,
		NULL,
		NULL,
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EQUIP_BLOOD_BIBLE].GetString(),
	};
	
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	
	bool re = m_pC_button_group->MouseControl(message, _x, _y);
	
	int i;
	
	const MItem * p_selected_item;
	
	switch (message)
	{
	case M_MOVING:
		for (i = 0 ; i < m_slot_size; i++)
		{

			if(!m_bl_Abvencement && g_eRaceInterface == RACE_VAMPIRE)
			{
				if(C_VS_UI_VAMPIRE_GEAR::SN_DERMIS == i|| C_VS_UI_VAMPIRE_GEAR::SN_PERSONA == i)
					return false;
			}
			if(!m_bl_Abvencement &&g_eRaceInterface == RACE_SLAYER)
			{
				if(C_VS_UI_SLAYER_GEAR::SN_PDA == i|| C_VS_UI_SLAYER_GEAR::SN_SHOULDER == i)
					return false;
			}
			if(!m_bl_Abvencement && g_eRaceInterface == RACE_OUSTERS)
			{
				if(C_VS_UI_OUSTERS_GEAR::SN_FASCIA == i|| C_VS_UI_OUSTERS_GEAR::SN_MITTEN == i)
					return false;
			}
			int m;
			int loop;
			int px, py;
			
			if (gpC_mouse_pointer->GetPickUpItem())
				loop = ITEM_REF_POINT_COUNT;
			else
				loop = 1;
			
			for (m=0; m < loop; m++)
			{


				
				if (loop == ITEM_REF_POINT_COUNT)
				{
					px = g_item_ref_point[m].x+gpC_mouse_pointer->GetPointerX();
					py = g_item_ref_point[m].y+gpC_mouse_pointer->GetPointerY();
				}
				else
				{
					px = _x+x;
					py = _y+y;
				}
				
				if (m_p_slot_rect[i].IsInRect(SCR2WIN_X(px), SCR2WIN_Y(py)))
				{
					if(m_focus_slot != i)
					{
						m_focus_slot = i;
						gpC_Imm->ForceUI(CImm::FORCE_UI_GRID);
					}
					
					if ( !m_bIsGearOther )
						p_selected_item = gC_vs_ui.GetGearItem(m_focus_slot);
					else
						p_selected_item = gC_vs_ui.GetGearOtherItem(m_focus_slot);
					
					if(!gpC_mouse_pointer->GetPickUpItem())
					{
						if (p_selected_item == NULL)
						{
							void *pString = NULL;
							switch(g_eRaceInterface)
							{
							case RACE_SLAYER:
								pString = (void *)m_slayer_help_string[i];
								break;
								
							case RACE_VAMPIRE:
								pString = (void *)m_vampire_help_string[i];
								break;
								
							case RACE_OUSTERS:
								pString = (void *)m_ousters_help_string[i];
								break;
							}
							if(pString != NULL)
								g_descriptor_manager.Set(DID_INFO, x+m_p_slot_rect[m_focus_slot].x-2, y+m_p_slot_rect[m_focus_slot].y -2, pString);
						}
						
						//						if (loop == ITEM_REF_POINT_COUNT)
						//						{
						//							// slot에 들어갈 수 있는 Item인가?
						//							MItem * p_old_item;
						//							if (gC_vs_ui.CanReplaceItemInGear(gpC_mouse_pointer->GetPickUpItem(), i, p_old_item) == false)
						//								continue;
						//						}
						
						//						if (p_selected_item != NULL)
						else
						{
							const MItem* pAddedItem = NULL;

							if ( !m_bIsGearOther )
								pAddedItem = gC_vs_ui.GetGearCoreZapItem(m_focus_slot);
							else
								pAddedItem = gC_vs_ui.GetGearOtherCoreZapItem(m_focus_slot);

							g_descriptor_manager.Set(DID_ITEM, x+m_p_slot_rect[m_focus_slot].x, y+m_p_slot_rect[m_focus_slot].y, (void *)p_selected_item, 0, (int)pAddedItem);
							
#if __CONTENTS(__REPAIRSYSTEM_RENEWAL)
							//20090317 p_selected_item가 널일 때를 위애서 else에 걸리는 if에서 체크한다. 따라서 여기선 체크 안함
							if(gbl_repair_running && 
								!g_pPriceManager->IsRepairPriceListHave(p_selected_item->GetID()) &&
								p_selected_item->GetID() != g_pPriceManager->GetOldRepairItemID() &&
								p_selected_item->IsRepairableItem()
								)
							{
								gpC_base->SendMessage(UI_REQUEST_REPAIRINFO, 0, 0, (void*)p_selected_item);
								g_pPriceManager->SetOldRepairItemID(p_selected_item->GetID());
							}
#endif //__REPAIRSYSTEM_RENEWAL
						}
					}
					//						m_focus_slot = NOT_SELECTED;
					return true;
				}
			}
		}
		if(m_focus_slot != NOT_SELECTED)
		{
			m_focus_slot = NOT_SELECTED;
			gpC_Imm->ForceUI(CImm::FORCE_UI_GRID);
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if ( !m_bIsGearOther )
		{
			if (gpC_mouse_pointer->GetPickUpItem() == false && re && gC_vs_ui.GetGearItem(m_focus_slot) == false && gC_vs_ui.GetGearCoreZapItem(m_focus_slot) == NULL)
			{
				MoveReady();
				SetOrigin(_x, _y);
				break;
			}

			{
				bool ret = Click(x, y, m_p_slot_rect);

				// belt를 놓거나 집었을 경우는 quick item을 reset해야 한다.
				//if ((MSlayerGear::GEAR_SLAYER)m_focus_slot == MSlayerGear::GEAR_SLAYER_BELT)
				//{
				//	gC_vs_ui.ResetSlayerQuickItemSize();
				//}

				if (ret)
					EMPTY_MOVE;
			}
		}
		break;
		
	case M_LEFTBUTTON_UP:
		break;
		
	case M_RIGHTBUTTON_DOWN:
		if ( m_bIsGearOther )
			break;
		// 전체 수리
		if (gbl_repair_running == true && m_focus_slot != -1)
		{
			if (gbl_item_trade_lock == false)
			{
#if __CONTENTS(!__REPAIRSYSTEM_RENEWAL)
				MItem * p_item;
				
				if(gC_vs_ui.GetGearItem(m_focus_slot) == NULL)break;
				
				int sum = 0;
				for(int i = 0; i < gC_vs_ui.GetGearSize(); i++)
				{
					p_item = (MItem *)gC_vs_ui.GetGearItem(i);
					if(p_item != NULL)
					{
						if(i == MSlayerGear::GEAR_SLAYER_LEFTHAND && !p_item->IsGearSlotLeftHand())
							continue;

						// 뱀파이어의 경우 왼손 슬롯의 무기와
						// 오른손 슬롯의 무기가 같다면
						// 한번만 계산해 준다.
						if( 
#ifdef _LIB
							g_pPlayer->IsVampire() &&
#endif
							i == MVampireGear::GEAR_VAMPIRE_RIGHTHAND &&
							p_item->GetID() == gC_vs_ui.GetGearItem(MVampireGear::GEAR_VAMPIRE_LEFTHAND)->GetID() )
							continue;
						
						if (gbl_item_trade_lock == false && 
							//p_item->GetItemClass() != ITEM_CLASS_EVENT_GIFT_BOX && 
							//p_item->GetItemClass() != ITEM_CLASS_EVENT_STAR &&
							//p_item->GetItemClass() != ITEM_CLASS_VAMPIRE_AMULET &&
							//p_item->GetItemClass() != ITEM_CLASS_EVENT_TREE &&
							//p_item->GetItemClass() != ITEM_CLASS_EVENT_ETC &&
							p_item->IsRepairableItem() &&
							!p_item->IsUniqueItem() &&
							!p_item->IsQuestItem())
						{
							sum += g_pPriceManager->GetItemPrice(p_item, MPriceManager::REPAIR);
						}
					}
				}
				if(sum > 0)
				{
					g_StartRepairAllConfirmDialog(x+m_p_slot_rect[m_focus_slot].x, y+m_p_slot_rect[m_focus_slot].Down(), sum);
				}
#else
				gpC_base->SendMessage(UI_REQUEST_REPAIRINFO, 0, 0, NULL);
#endif //__REPAIRSYSTEM_RENEWAL
			}
		}
		else 
			Use();
		break;
	}
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_GEAR::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	const static char *m_inventory_button_string[7] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP_GEAR_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_GEAR_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_FIRST_GEAR_SET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SECOND_GEAR_SET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),
#if __CONTENTS(__GEAR_SWAP_CHANGE)	// C_VS_UI_GEAR::ShowButtonDescription 버튼 설명 문자열 추가
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GEAR_CHANGE].GetString(),
#endif // __GEAR_SWAP_CHANGE
	};
	
	if(p_button->GetID() == ALPHA_ID)
	{
		if(GetAttributes()->alpha)
		{
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_inventory_button_string[5],0,0);
		}
		else
		{
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_inventory_button_string[p_button->GetID()],0,0);
		}
	} else if(p_button->GetID() == FIRST_ID || p_button->GetID() == SECOND_ID)
	{
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_inventory_button_string[p_button->GetID()],0,0);	
	}
#if __CONTENTS(__GEAR_SWAP_CHANGE)	//C_VS_UI_GEAR::ShowButtonDescription 버튼 설명
	else if (p_button->GetID() == GEAR_ID1 || p_button->GetID() == GEAR_ID2) 
	{
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_inventory_button_string[6],0,0);	
	} 
#endif // __GEAR_SWAP_CHANGE
	else
	{
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_inventory_button_string[p_button->GetID()],0,0);
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_GEAR::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(p_button->GetID() == ALPHA_ID)
	{
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		if(GetAttributes()->alpha)
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW);
		}
		else
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED_NEW);
		}
	#else
		if(GetAttributes()->alpha)
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA);
		}
		else
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED);
		}
	#endif //__080405_FIREST_UI_UPDATE
	}
	else if(p_button->GetID() == FIRST_ID || p_button->GetID() == SECOND_ID)
	{
		if(p_button->GetFocusState())
		{			
			if(p_button->GetPressState())
				m_pC_gear_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index+2);
			else
				m_pC_gear_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index+1);
		}
		else
			m_pC_gear_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index);
	}
#if __CONTENTS(__GEAR_SWAP_CHANGE) // C_VS_UI_GEAR::ShowButtonWidget 버튼 그리기
	else if(p_button->GetID() == GEAR_ID1 || p_button->GetID() == GEAR_ID2)
	{
		GearChangeButtonShow();
	}
#endif //__GEAR_SWAP_CHANGE
	else if(p_button->GetFocusState())
	{		
		if(p_button->GetPressState())
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_PUSHED_OFFSET);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_HILIGHTED_OFFSET);
	}
	else
		gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index);
	
}

//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_GEAR::Run(id_t id)
{
	switch (id)
	{
	case HELP_ID:
		if ( !m_bIsGearOther )
			gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::GEAR);
		break;
		
	case CLOSE_ID:
		if ( !m_bIsGearOther )
		{
			if (gbl_repair_running)
			{
				gpC_base->SendMessage(UI_ITEM_REPAIR_FINISHED);
			}
			else if (gbl_silvering_running)
			{
				gpC_base->SendMessage(UI_ITEM_SILVERING_FINISHED);
			}
			else if (gC_vs_ui.IsRunningExchange())
			{
				gpC_base->SendMessage(UI_CLOSE_EXCHANGE);
			}
			else
			{
				gC_vs_ui.HotKey_Gear();
			}
		}
		else
		{
			Finish();
		}

		break;
		
	case ALPHA_ID:
		if  ( !m_bIsGearOther )
		{
			AttrAlpha(!GetAttributes()->alpha);
			gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::GEAR, GetAttributes()->alpha);
			EMPTY_MOVE;
		}
		break;

#if __CONTENTS(__GEAR_SWAP_CHANGE) // C_VS_UI_GEAR::Run(id_t id) 버튼 클릭시 장착창 교체
	case GEAR_ID1:
		if ( !m_bIsGearOther )
		{
			m_dwSendGearID	= 0;
			GearChange(0);
		}
		break;

	case GEAR_ID2:
		if ( !m_bIsGearOther )
		{
			m_dwSendGearID	= 1;
			GearChange(1);
		}
		break;
#endif // __GEAR_SWAP_CHANGE
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::Show
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_GEAR::Show()
{
	const static char *m_help_string[2] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CAN_EQUIP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_EQUIP].GetString(),
	};
	
#if __CONTENTS(__GEAR_SWAP_CHANGE)	//C_VS_UI_GEAR::Show()
	bool	bActive	= true;
	switch(g_pPlayer->GetRace())
	{
	case RACE_SLAYER:
		bActive			= g_pSlayerGear->GetActive();
		break;

	case RACE_VAMPIRE:
		bActive			= g_pVampireGear->GetActive();
		break;
		
	case RACE_OUSTERS:
		bActive			= g_pOustersGear->GetActive();
		break;
	}
#endif	// __GEAR_SWAP_CHANGE

	if (gpC_base->m_p_DDSurface_back->Lock())
	{
		if(GetAttributes()->alpha)
		{
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				{
					if(m_bl_Abvencement)
					{
						RECT alpha_rect= { x+5, y+11, x+215, y+435 };
						DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					}
					else
					{						
						RECT alpha_rect= { x+5, y+11, x+215, y+391 };
						DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					}
				
				}
				break;

			case RACE_OUSTERS:
				{
					if(m_bl_Abvencement)
					{
						RECT alpha_rect = { x+16, y+14, x+271, y+420 };
						DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					}
					else
					{						
						RECT alpha_rect = { x+16, y+14, x+271, y+381 };
						DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					}

				}
				break;
			}
			m_pC_gear_spk->BltLocked(x, y, GEAR_WINDOW_ALPHA);
		}
		else
			m_pC_gear_spk->BltLocked(x, y, GEAR_WINDOW);
		
		const MItem * p_selected_item = NULL;

		if ( !m_bIsGearOther )
			p_selected_item = gC_vs_ui.GetGearItem(m_focus_slot);
		else
			p_selected_item = gC_vs_ui.GetGearOtherItem(m_focus_slot);
		
		for (int i=0; i<m_slot_size; i++)
		{
			if(!m_bl_Abvencement && g_eRaceInterface == RACE_VAMPIRE)
			{
				if(C_VS_UI_VAMPIRE_GEAR::SN_DERMIS == i|| C_VS_UI_VAMPIRE_GEAR::SN_PERSONA == i)
					continue;
			}
			if(!m_bl_Abvencement &&g_eRaceInterface == RACE_SLAYER)
			{
				if(C_VS_UI_SLAYER_GEAR::SN_PDA == i|| C_VS_UI_SLAYER_GEAR::SN_SHOULDER == i)
				{
					continue;
				}
			}
			if(!m_bl_Abvencement && g_eRaceInterface == RACE_OUSTERS)
			{
				if(C_VS_UI_OUSTERS_GEAR::SN_FASCIA == i|| C_VS_UI_OUSTERS_GEAR::SN_MITTEN == i)
				{
					continue;
				}
			}

			if(GetAttributes()->alpha && g_eRaceInterface == RACE_VAMPIRE)
			{
				if(i<C_VS_UI_VAMPIRE_GEAR::SN_COREZAP1 || i>C_VS_UI_VAMPIRE_GEAR::SN_COREZAP4) // 코어잽 은 안찍는다..-_-; 일단..이렇게
				{
					RECT alpha_rect;
					alpha_rect.left = m_p_slot_rect[i].x+x;
					alpha_rect.top = m_p_slot_rect[i].y+y;
					alpha_rect.right = alpha_rect.left+m_p_slot_rect[i].w;
					alpha_rect.bottom = alpha_rect.top+m_p_slot_rect[i].h;
					
					DrawAlphaBox(&alpha_rect, 2, 0, 0, g_pUserOption->ALPHA_DEPTH);
					
				}
			}
			
			const MItem* p_item = NULL;

			if ( !m_bIsGearOther )
				p_item = gC_vs_ui.GetGearItem(i);
			else
				p_item = gC_vs_ui.GetGearOtherItem(i);
			
			if (p_item==NULL)
			{
				if (m_pC_gear_slot_spk != NULL && m_p_slot_image[i] != -1)
				{
					// 2004, 10, 20, sobeit add & modify start
					bool IsBloodBibleSlotClose = gC_vs_ui.IsCloseBloodBibleSlot(i);

					if(!IsBloodBibleSlotClose)
					{
						int slotX = m_p_slot_rect[i].x+x+m_p_slot_rect[i].w/2-m_pC_gear_slot_spk->GetWidth(m_p_slot_image[i])/2;
						int slotY = m_p_slot_rect[i].y+y+m_p_slot_rect[i].h/2-m_pC_gear_slot_spk->GetHeight(m_p_slot_image[i])/2;
						m_pC_gear_slot_spk->BltLocked(slotX, slotY, m_p_slot_image[i]);
					}
					else
					{
						int slotX = m_p_slot_rect[i].x+x;
						int slotY = m_p_slot_rect[i].y+y;
						m_pC_gear_spk->BltLocked(slotX, slotY, GEAR_BLOOD_BIBLE_BLOCK);
					}

					// 2004, 10, 20, sobeit add & modify end
				}
			}
			else
			{
				// Item이 있는 slot
				
				TYPE_FRAMEID frame_id = p_item->GetInventoryFrameID();
				
				int item_x = x+m_p_slot_rect[i].x+m_p_slot_rect[i].w/2-gpC_item->GetWidth(frame_id)/2;
				int item_y = y+m_p_slot_rect[i].y+m_p_slot_rect[i].h/2-gpC_item->GetHeight(frame_id)/2;

				if(p_item->GetItemClass() == ITEM_CLASS_BLOOD_BIBLE_SIGN)
					DrawBloodBibleEffect_InGear(x+m_p_slot_rect[i].x-8, y+m_p_slot_rect[i].y+7);
				
				if (p_selected_item && (p_selected_item->GetID() == p_item->GetID()))
				{
//					if(p_item->IsQuestItem())
//						CIndexSprite::SetUsingColorSet(p_item->GetQuestItemColorset(), 0);
//					else
//					if(p_item->IsUniqueItem())
//						CIndexSprite::SetUsingColorSet(p_item->GetUniqueItemColorset(), 0);
					if(p_item->IsSpecialColorItem())
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetSpecialColorItemColorset(), 0);
					else if(const_cast<MItem *>(p_item)->GetItemOptionColorSet() >= OPTIONEXT_ITEM_COLOR)	 		
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetItemOptionExtColorSet(), 0);
					else			
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetItemOptionColorSet(), 0);
					gpC_item->BltLockedOutline(item_x, item_y, WHITE, frame_id);
					if(p_item->GetItemClass() == ITEM_CLASS_OUSTERS_WRISTLET && g_eRaceInterface == RACE_OUSTERS)
					{
						ITEMTABLE_INFO::ELEMENTAL_TYPE eType = (*g_pItemTable)[p_item->GetItemClass()][p_item->GetItemType()].ElementalType;
						if(eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_FIRE ||
							eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_WATER ||
							eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_EARTH
							)
						{
							gpC_global_resource->m_pC_info_spk->BltLockedOutline(x+m_p_slot_rect[i].x, y+m_p_slot_rect[i].y, RGB_WHITE, C_GLOBAL_RESOURCE::OUSTERS_ELEMENTAL_MARK_FIRE+eType);
						}
					}
				}
				else
				{
//					if(p_item->IsQuestItem())
//						CIndexSprite::SetUsingColorSet(p_item->GetQuestItemColorset(), 0);
//					else
//					if(p_item->IsUniqueItem())
//						CIndexSprite::SetUsingColorSet(p_item->GetUniqueItemColorset(), 0);
										
					if(p_item->IsSpecialColorItem() )
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetSpecialColorItemColorset(), 0);
					else if(const_cast<MItem *>(p_item)->GetItemOptionColorSet() >= OPTIONEXT_ITEM_COLOR)	 		
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetItemOptionExtColorSet(), 0);
					else			
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetItemOptionColorSet(), 0);

#if __CONTENTS(__GEAR_SWAP_CHANGE)	//C_VS_UI_GEAR::Show()	bActive
					if (p_item->IsAffectStatus() || p_item->IsQuestItem() && bActive)
#else
					if (p_item->IsAffectStatus() || p_item->IsQuestItem())
#endif
					{
						// frame id -> sprite id
						gpC_item->BltLocked(item_x, item_y, frame_id);
						if(p_item->GetItemClass() == ITEM_CLASS_OUSTERS_WRISTLET && g_eRaceInterface == RACE_OUSTERS)
						{
							ITEMTABLE_INFO::ELEMENTAL_TYPE eType = (*g_pItemTable)[p_item->GetItemClass()][p_item->GetItemType()].ElementalType;
							if(eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_FIRE ||
								eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_WATER ||
								eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_EARTH
								)
							{
								gpC_global_resource->m_pC_info_spk->BltLocked(x+m_p_slot_rect[i].x, y+m_p_slot_rect[i].y, C_GLOBAL_RESOURCE::OUSTERS_ELEMENTAL_MARK_FIRE+eType);
							}
						}
					}
					else
					{
						gpC_item->BltLockedColorSet(item_x, item_y, frame_id, ITEM_DISABLE_COLOR_SET);
						if(p_item->GetItemClass() == ITEM_CLASS_OUSTERS_WRISTLET && g_eRaceInterface == RACE_OUSTERS)
						{
							ITEMTABLE_INFO::ELEMENTAL_TYPE eType = (*g_pItemTable)[p_item->GetItemClass()][p_item->GetItemType()].ElementalType;
							if(eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_FIRE ||
								eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_WATER ||
								eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_EARTH
								)
							{
								gpC_global_resource->m_pC_info_spk->BltLockedColor(x+m_p_slot_rect[i].x, y+m_p_slot_rect[i].y, C_GLOBAL_RESOURCE::OUSTERS_ELEMENTAL_MARK_FIRE+eType, 0);
							}
						}
					}
				}
			}

			// 들고 있는 아이템이 어디에 착용 가능한지 보여주기
			MItem* pPickUpItem = gpC_mouse_pointer->GetPickUpItem();
			MItem * pOldItem;
			if(pPickUpItem && !m_bIsGearOther)
			{
				if (gC_vs_ui.CanReplaceItemInGear(pPickUpItem, i, pOldItem) &&
					m_pC_gear_slot_spk != NULL && m_p_slot_image[i] != -1)
				{
					//int slotX = m_p_slot_rect[i].x+x+m_p_slot_rect[i].w/2-m_pC_gear_slot_spk->GetWidth(m_p_slot_image[i])/2;
					int slotY = m_p_slot_rect[i].y+y+m_p_slot_rect[i].h/2-m_pC_gear_slot_spk->GetHeight(m_p_slot_image[i])/2;
					//m_pC_gear_slot_spk->BltLockedColor(slotX, slotY, m_p_slot_image[i], 17);
					
					Rect& otherRect = m_p_slot_rect[i];
					RECT rect = {
						x + otherRect.x,
						y + otherRect.y,
						x + otherRect.x + otherRect.w,
						y + otherRect.y + otherRect.h
					};
					
					gpC_base->m_p_DDSurface_back->Unlock();

					gpC_base->m_p_DDSurface_back->DrawRect(&rect, YELLOWGREEN);

					RECT smallrect = { rect.left + 1, rect.top + 1, rect.right - 1, rect.bottom - 1 };
					gpC_base->m_p_DDSurface_back->DrawRect(&smallrect, WHITE);

					gpC_base->m_p_DDSurface_back->Lock();
				}
			}
		}
		
		// 놓는 위치 미리 알 수 있도록 한다.
		if (gpC_mouse_pointer->GetPickUpItem() && m_focus_slot != NOT_SELECTED && !m_bIsGearOther )
		{
			MItem * p_item = gpC_mouse_pointer->GetPickUpItem();
			
#if __CONTENTS(__GEAR_SWAP_CHANGE)
			g_pPlayer->CheckAffectStatus(gpC_mouse_pointer->GetPickUpItem());
#endif //__GEAR_SWAP_CHANGE

			TYPE_FRAMEID frame_id = p_item->GetInventoryFrameID();
			
			int item_x = x+m_p_slot_rect[m_focus_slot].x+m_p_slot_rect[m_focus_slot].w/2-gpC_item->GetWidth(frame_id)/2;
			int item_y = y+m_p_slot_rect[m_focus_slot].y+m_p_slot_rect[m_focus_slot].h/2-gpC_item->GetHeight(frame_id)/2;
			
			MItem * p_old_item;
#if __CONTENTS(__GEAR_SWAP_CHANGE)	//_CGAddMouseToGear.setGearSlotID(right);
			if (gC_vs_ui.CanReplaceItemInGear(p_item, m_focus_slot, p_old_item) && bActive)
#else
			if (gC_vs_ui.CanReplaceItemInGear(p_item, m_focus_slot, p_old_item))
#endif
			{
				
				if (p_old_item)
					gpC_item->BltLockedOutlineOnly(item_x, item_y, ga_item_blink_color_table[g_blink_value], frame_id);
				else
					gpC_item->BltLockedOutlineOnly(item_x, item_y, POSSIBLE_COLOR, frame_id);
				
				gpC_base->m_p_DDSurface_back->Unlock();

				g_descriptor_manager.Set(DID_INFO, x+m_p_slot_rect[m_focus_slot].x-2, y+m_p_slot_rect[m_focus_slot].y -2, (void*)m_help_string[0], RGB_GREEN);
				
				gpC_base->m_p_DDSurface_back->Lock();
			}
			else
			{
				gpC_base->m_p_DDSurface_back->Unlock();
				g_descriptor_manager.Set(DID_INFO, x+m_p_slot_rect[m_focus_slot].x-2, y+m_p_slot_rect[m_focus_slot].y -2, (void*)m_help_string[1], RGB_RED);
				gpC_base->m_p_DDSurface_back->Lock();
			}			
		}		
		m_pC_button_group->Show();
		gpC_base->m_p_DDSurface_back->Unlock();
	}
	m_pC_button_group->ShowDescription();
	
/*			m_dwSendGearID						= 0;
			m_dwGearChange_ID1_Button_Pos_X		= 50;													//자착창을 교체할 버튼의 위치
			m_dwGearChange_ID1_Button_Pos_Y		= 50;
			m_dwGearChange_ID1_Button_Width		= m_pC_gear_spk->GetWidth(GEAR_CHANGE_ID1_CHECK);		//장착창을 교체할 버튼의 크기
			m_dwGearChange_ID1_Button_Height	= m_pC_gear_spk->GetHeight(GEAR_CHANGE_ID2_CHECK);
			m_dwGearChange_ID2_Button_Pos_X		= 100;													//자착창을 교체할 버튼의 위치
			m_dwGearChange_ID2_Button_Pos_Y		= 50;
			m_dwGearChange_ID2_Button_Width		= m_pC_gear_spk->GetWidth(GEAR_CHANGE_ID1_CHECK);		//장착창을 교체할 버튼의 크기
			m_dwGearChange_ID2_Button_Height	= m_pC_gear_spk->GetHeight(GEAR_CHANGE_ID2_CHECK);
*/
	SHOW_WINDOW_ATTR;
	/*
	#ifndef _LIB
	//
	// focus slot rect -- Test
	//
	if (gpC_base->m_p_DDSurface_back->Lock())
	{
	S_SURFACEINFO surface_info;
	SetSurfaceInfo(&surface_info, gpC_base->m_p_DDSurface_back->GetDDSD());
	
	  if (m_focus_slot != NOT_SELECTED)
	  {
	  S_RECT rect;
	  SetRect(rect, m_p_slot_rect[m_focus_slot].x+x, m_p_slot_rect[m_focus_slot].y+y, 
	  m_p_slot_rect[m_focus_slot].w, m_p_slot_rect[m_focus_slot].h);
	  filledRect(&surface_info, &rect, 0xFF);
	  }
	  
		//for (int i=0; i < ITEM_REF_POINT_COUNT; i++)
		//{
		//	putPixel(&surface_info, 
		//		      g_item_ref_point[i].x+gpC_mouse_pointer->GetPointerX(),
		//				g_item_ref_point[i].y+gpC_mouse_pointer->GetPointerY(),
		//				RED);
		//}
		}
		
		  gpC_base->m_p_DDSurface_back->Unlock();
		  char str[100];
		  sprintf(str, "Gear focus slot = %d", m_focus_slot);
		  g_Print(10, 420, str);
		  #endif
	*/
//	if(g_pPriceManager->IsRepairPriceListHave(0))
//	{
//	static char temp[100];	
//	char sz_buf[512];
//	wsprintf(sz_buf, "%d", 30);
//	std::string sstr = sz_buf;
//	for(int i = 3; i <= 13; i += 4)
//		if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
//	sprintf(sz_buf, "%s", sstr.c_str());	
//
//	wsprintf(temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_ALL_PRICE].GetString(), sz_buf);
//	
//	static char *pp_dmsg_repairall_confirm[2] = {		
//		temp,
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_REPAIR_CONFIRM].GetString(),
//	};
//	gpC_dialog_repairall_confirm->SetMessage(pp_dmsg_repairall_confirm, 2, SMO_NOFIT);
//	}
}


#if __CONTENTS(__GEAR_SWAP_CHANGE) // C_VS_UI_GEAR::GearChangeButtonShow()
void	C_VS_UI_GEAR::GearChangeButtonShow()
{
	switch(g_pPlayer->GetRace())
	{
	case RACE_SLAYER:
		if ( !m_bIsGearOther )
			m_dwAccepGearID	= g_pSlayerGear->GetAccepGearID();
		else
			m_dwAccepGearID = g_pSlayerGearOther->GetAccepGearID();
		break;

	case RACE_VAMPIRE:
		if ( !m_bIsGearOther )
			m_dwAccepGearID	= g_pVampireGear->GetAccepGearID();
		else
			m_dwAccepGearID = g_pVampireGearOther->GetAccepGearID();
		break;
		
	case RACE_OUSTERS:
		if ( !m_bIsGearOther )
			m_dwAccepGearID	= g_pOustersGear->GetAccepGearID();
		else
			m_dwAccepGearID = g_pOustersGearOther->GetAccepGearID();
		break;
	}

	switch(m_dwAccepGearID)
	{
	case 0:							// 장창착의 번호가 0이면 장착창 1번 버튼 선택
		m_pC_gear_spk->BltLocked(x + m_dwGearChange_ID1_Button_Pos_X, y + m_dwGearChange_ID1_Button_Pos_Y, GEAR_CHANGE_ID1_CHECK);
		m_pC_gear_spk->BltLocked(x + m_dwGearChange_ID2_Button_Pos_X, y + m_dwGearChange_ID2_Button_Pos_Y, GEAR_CHANGE_ID2_UNCHECK);
		break;

	case 1:							// 장착창의 번호가 1이면 장착창 2번 버튼 선택 
		m_pC_gear_spk->BltLocked(x + m_dwGearChange_ID1_Button_Pos_X, y + m_dwGearChange_ID1_Button_Pos_Y, GEAR_CHANGE_ID1_UNCHECK);
		m_pC_gear_spk->BltLocked(x + m_dwGearChange_ID2_Button_Pos_X, y + m_dwGearChange_ID2_Button_Pos_Y, GEAR_CHANGE_ID2_CHECK);
		break;
	}
}
#endif // __GEAR_SWAP_CHANGE


//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::Start
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_GEAR::Start(bool bl_set_load)
{
	m_bl_set_load = bl_set_load;
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::GEAR));
	if(bl_set_load == true)
	{
		Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::GEAR);
		if(rect.w != -1)
		{
			x = rect.x;
			y = rect.y;
		}
	}
	
	PI_Processor::Start();
	
	AttrPin(true);
	gpC_window_manager->AppearWindow(this);
	
	//	m_bl_close_button_focused = false;
	//	m_bl_close_button_pushed = false;
	//	m_bl_help_button_focused = false;
	//	m_bl_help_button_pushed = false;
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::Finish
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_GEAR::Finish()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::GEAR, GetAttributes()->alpha);
	if(m_bl_set_load)
	{
		gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::GEAR, Rect(x, y, w, h));
	}
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// UnacquireMouseFocus
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_GEAR::UnacquireMouseFocus()
{
	m_focus_slot = NOT_SELECTED;
	m_pC_button_group->UnacquireMouseFocus();
	//	m_bl_close_button_focused = false;
	//	m_bl_help_button_focused = false;
}

//-----------------------------------------------------------------------------
// Click
//
// 현재 Item을 들고 있으면 놓던가(놓을 수 있으면) 교체하고, 들고 있지 않으면
// Gear에 있는 것을 집는다.
//
// 뭔가 했으면 true를, 그렇지않으면 false를 반환한다.
//-----------------------------------------------------------------------------
bool C_VS_UI_GEAR::Click(int window_x, int window_y, Rect * slot_rect)
{

	if (m_focus_slot == NOT_SELECTED || 
		gbl_item_lock == true || 
		gbl_gear_lock == true)
	{
		return false;
	}

	if ( m_bIsGearOther )
		return false;
	
	int item_x, item_y;

#if __CONTENTS(__GEAR_SWAP_CHANGE)	//_CGAddMouseToGear.setGearSlotID(right);
	bool	bGearChange	= false;
	switch(g_pPlayer->GetRace())
	{
	case RACE_SLAYER:
		bGearChange		= g_pSlayerGear->GetProcessingGearChange();
//		g_pSlayerGear->SetProcessingGearChange(true);
		break;

	case RACE_VAMPIRE:
		bGearChange		= g_pVampireGear->GetProcessingGearChange();
//		g_pSlayerGear->SetProcessingGearChange(true);
		break;
		
	case RACE_OUSTERS:
		bGearChange		= g_pOustersGear->GetProcessingGearChange();
//		g_pSlayerGear->SetProcessingGearChange(true);
		break;
	}

	if(bGearChange)		//장착 창이 교체 중일때에는 아이템을 교체 할 수 없다.
	{
		return false;
	}
#endif	// __GEAR_SWAP_CHANGE

	if(ACTION_STAND	!= g_pPlayer->GetAction())	//스킬을 사용중일때는 아이템 착용 불가
	{
		return false;
	}

	if (gpC_mouse_pointer->GetPickUpItem()) // 들고 있는가?
	{

#if __CONTENTS(__GEAR_SWAP_CHANGE)	//_CGAddMouseToGear.setGearSlotID(right);
		bool	bActive	= true;
		switch(g_pPlayer->GetRace())
		{
		case RACE_SLAYER:
			m_dwAccepGearID	= g_pSlayerGear->GetAccepGearID();
			g_pSlayerGear->SetSendGearID(m_dwAccepGearID);
			bActive			= g_pSlayerGear->GetActive();
//			bGearChange		= g_pSlayerGear->GetProcessingGearChange();
			break;

		case RACE_VAMPIRE:
			m_dwAccepGearID	= g_pVampireGear->GetAccepGearID();
			g_pVampireGear->SetSendGearID(m_dwAccepGearID);
			bActive			= g_pVampireGear->GetActive();
//			bGearChange		= g_pVampireGear->GetProcessingGearChange();
			break;
		
		case RACE_OUSTERS:
			m_dwAccepGearID	= g_pOustersGear->GetAccepGearID();
			g_pOustersGear->SetSendGearID(m_dwAccepGearID);
			bActive			= g_pOustersGear->GetActive();
//			bGearChange		= g_pOustersGear->GetProcessingGearChange();
			break;
		}

		if(bGearChange)		//장착 창이 교체 중일때에는 아이템을 교체 할 수 없다.
		{
			return false;
		}

		if(!bActive) 
		{
			g_pSystemMessage->Add((*g_pGameStringTable)[STRING_MESSAGE_PRIMEUM_ADDMIN].GetString());
			return false;
		}
		g_pPlayer->CheckAffectStatus(gpC_mouse_pointer->GetPickUpItem());
#endif	// __GEAR_SWAP_CHANGE

		const MItem* p_cur_item = gC_vs_ui.GetGearItem(m_focus_slot);

		if (gpC_mouse_pointer->GetPickUpItem()->IsInsertToItem( p_cur_item ))
		{
			// 이전에 있던 item에 추가될 수 있는 경우
			
			// 대상 Item과 들고 있는(추가할 Item)을 Client에서 알아야 한다.
			// 들고 있는 Item은 Client에서 access할 수 있으므로 대상 Item을 보낸다.
			gpC_base->SendMessage(UI_ITEM_INSERT_FROM_GEAR,
				m_focus_slot, 
				0, 
				(void *)p_cur_item); // 대상 Item
		}
		else
		{
			MItem * p_old_item = NULL;
			
			if (gC_vs_ui.CanReplaceItemInGear(gpC_mouse_pointer->GetPickUpItem(), m_focus_slot, p_old_item))
			{
				if (p_old_item != NULL) // replace 되는가?
				{
					item_x = window_x+slot_rect[m_focus_slot].x+slot_rect[m_focus_slot].w/2-gpC_item->GetWidth(p_old_item->GetInventoryFrameID());
					item_y = window_y+slot_rect[m_focus_slot].y+slot_rect[m_focus_slot].h/2-gpC_item->GetHeight(p_old_item->GetInventoryFrameID());
					
					gpC_base->SendMessage(UI_ITEM_DROP_TO_GEAR,
						m_focus_slot, 
						MAKEDWORD(item_x, item_y), 
						p_old_item); // 교환될 거
					
					// UI에서 바꿔야 한다.
					//gpC_mouse_pointer->PickUpItem((MItem *)p_old_item);
				}
				else
				{
					// not replace, just drop at empty grid.
					
					gpC_base->SendMessage(UI_ITEM_DROP_TO_GEAR, 
						m_focus_slot, 
						0, 
						NULL);
					
					// 100% 놓을 수 있으니까 UI에서 drop시킨다.
					//gpC_mouse_pointer->DropItem();
				}
				
				// 기어에 넣은 아이템이 벨트라면 벨트를 연다.
				if(gpC_mouse_pointer->GetPickUpItem()->GetItemClass() == ITEM_CLASS_BELT && !m_bIsGearOther)
					gC_vs_ui.RunQuickItemSlot();
				
			}
			else
			{
				// failed.
				return false;
			}
		}
	}
	else
	{
		// 집는다.
		// GetGearItem_PickUp()는 m_focus_slot를 바꿀수도 있다. by sobeit - 코어잽 때문에
		const MItem * p_item = gC_vs_ui.GetGearItem_PickUp(m_focus_slot);

		if (p_item != NULL) // Item이 있다.
		{
			if(gpC_mouse_pointer->IsCursorDescription())
			{
				// 2004, 7, 6 sobeit add start
				const MItem * p_OriginItem = NULL;
				if(p_item->GetItemClass() == ITEM_CLASS_CORE_ZAP)
				{
					p_OriginItem = gC_vs_ui.GetGearCoreZapedItem(m_focus_slot);
					gC_vs_ui.RunDescDialog(DID_ITEM, (void *)p_OriginItem, (void*)p_item);
				}
				// 2004, 7, 6 sobeit add end
				else if(p_item->GetItemClass() == ITEM_CLASS_ETHEREAL_CHAIN)
				{
					p_OriginItem = gC_vs_ui.GetGearCoreZapedItem(m_focus_slot);
					gC_vs_ui.RunDescDialog(DID_ITEM, (void *)p_OriginItem, (void*)p_item);
				}
				else if(p_item->GetItemClass() == ITEM_CLASS_CUE_OF_ADAM)
				{
					p_OriginItem = gC_vs_ui.GetGearCoreZapedItem(m_focus_slot);
					gC_vs_ui.RunDescDialog(DID_ITEM, (void *)p_OriginItem, (void*)p_item);
				}
				else
					gC_vs_ui.RunDescDialog(DID_ITEM, (void *)p_item);
			}
			// 2004, 10, 21, sobeit add start
			else if(p_item->GetItemClass() == ITEM_CLASS_BLOOD_BIBLE_SIGN )
			{
				return false; // 기어창에서 블러드 바이블은 처리 하지 않는다.
			}
			// 2004, 10, 21, sobeit add end
			else if (gbl_repair_running == true)
			{
				if (gbl_item_trade_lock == false && 
					//p_item->GetItemClass() != ITEM_CLASS_EVENT_GIFT_BOX && 
					//p_item->GetItemClass() != ITEM_CLASS_EVENT_STAR &&
					//p_item->GetItemClass() != ITEM_CLASS_VAMPIRE_AMULET &&
					//p_item->GetItemClass() != ITEM_CLASS_EVENT_TREE &&
					//p_item->GetItemClass() != ITEM_CLASS_EVENT_ETC &&
					p_item->IsRepairableItem() &&
					!p_item->IsUniqueItem() &&
					!p_item->IsQuestItem())
				{
					// repair 가격이 0보다 클 때... by sigi
					if (g_pPriceManager->GetItemPrice((MItem*)p_item, MPriceManager::REPAIR) > 0)
					{
						m_p_repair_item = (MItem *)p_item;
						g_StartRepairConfirmDialog(window_x+slot_rect[m_focus_slot].x, window_y+slot_rect[m_focus_slot].Down(), p_item->IsChargeItem());
					}
				} else
				{
					gpC_base->SendMessage(UI_MESSAGE_BOX, 
						STRING_MESSAGE_CANNOT_REPAIR, 
						0, 
						NULL);					
				}
			}
			else if (gbl_silvering_running == true)
			{
				if (gbl_item_trade_lock == false)
				{
					// silvering 가격이 0보다 클 때... by larosel
					if (g_pPriceManager->GetItemPrice((MItem*)p_item, MPriceManager::SILVERING) > 0)
					{
						m_p_silvering_item = (MItem *)p_item;
						g_StartSilveringConfirmDialog(window_x+slot_rect[m_focus_slot].x, window_y+slot_rect[m_focus_slot].Down());
					}
				}
			}
			else
			{
				item_x = window_x+slot_rect[m_focus_slot].x+slot_rect[m_focus_slot].w/2-gpC_item->GetWidth(p_item->GetInventoryFrameID())/2;
				item_y = window_y+slot_rect[m_focus_slot].y+slot_rect[m_focus_slot].h/2-gpC_item->GetHeight(p_item->GetInventoryFrameID())/2;
				//gC_vs_ui.RemoveItemInGear(m_focus_slot);
				
				gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_GEAR,
					m_focus_slot, 
					MAKEDWORD(item_x, item_y), 
					(MItem *)p_item);
				// SHIFT누르고 클릭했을때 아이템 자동 이동 처리 -> 인벤토리
				if(g_pDXInput->KeyDown(DIK_LSHIFT))
				{
					POINT point;
					if(p_item != NULL && g_pInventory->GetFitPosition((MItem *)p_item, point))
					{
						const MItem* p_cur_item = g_pInventory->GetItem(point.x, point.y);
						
						// 총에 탄창을 끼우는 것과 같은 것이 insert item이다.
						// 위치가 완전히 일치할경우에만 추가한다.
						if (p_item->IsInsertToItem( p_cur_item ) && p_cur_item->GetGridX() == point.x && p_cur_item->GetGridY() == point.y
							&& (((g_pTimeItemManager->IsExist(p_item->GetID()) == true)	&& (g_pTimeItemManager->IsExist(p_cur_item->GetID()) == true))
							|| ((g_pTimeItemManager->IsExist(p_item->GetID()) == false)	&& (g_pTimeItemManager->IsExist(p_cur_item->GetID()) == false))))
							//시간제는 시간제 아이템 끼리만, 아닌것은 아닌것 끼리만 인서트 된다.
						{
							// 이전에 있던 item에 추가될 수 있는 경우
							
							// 대상 Item과 들고 있는(추가할 Item)을 Client에서 알아야 한다.
							// 들고 있는 Item은 Client에서 access할 수 있으므로 대상 Item을 보낸다.
							gpC_base->SendMessage(UI_ITEM_INSERT_FROM_INVENTORY,
								point.x, point.y,
								(void *)p_cur_item); // 대상 Item
						}
						else
						{	
							// 추가될 수 없는 경우
							MItem* p_old_item  = NULL;
							
							if (g_pInventory->CanReplaceItem((MItem *)p_item,		// 추가할 item
								point.x, point.y,	// 추가할 위치 
								p_old_item))								// 원래있던 item
							{
								
								gpC_base->SendMessage(UI_ITEM_DROP_TO_INVENTORY, 
									point.x, point.y,
									(void *)p_item);
								
							}
							else
							{
								// failed.
								return false;
							}
						}						
					}
				}
			}
		}
	}	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::Use
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_GEAR::Use()
{
	if (m_focus_slot == NOT_SELECTED ||
		gbl_item_lock)
		return;
	
	if (gpC_mouse_pointer->GetPickUpItem())
	{
		
	}
	else
	{
		MPlayerGear *pGear;
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			pGear = g_pSlayerGear;
			break;

		case RACE_VAMPIRE:
			pGear = g_pVampireGear;
			break;

		case RACE_OUSTERS:
			pGear = g_pOustersGear;
			break;
		}
		
		const MItem * p_item = pGear->GetItem(m_focus_slot);
		
		if (p_item) // Item이 있다.
		{
			if(IsPlayerInSafePosition() && (p_item->GetItemClass() == ITEM_CLASS_COUPLE_RING || p_item->GetItemClass() == ITEM_CLASS_VAMPIRE_COUPLE_RING || 
				p_item->GetItemClass()  != ITEM_CLASS_OUSTERS_HARMONIC_PENDENT))
				return;
			
			gpC_base->SendMessage(UI_ITEM_USE_GEAR, m_focus_slot, 0, (MItem *)p_item);
		}
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_GEAR::WindowEventReceiver(id_t event)
{
	switch (event)
	{
	case EVENT_WINDOW_MOVE:
		break;
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::AcquireMouseFocus
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_GEAR::AcquireMouseFocus()
{
	gpC_base->SendMessage(UI_REMOVE_BACKGROUND_MOUSE_FOCUS);
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::AcquireDisappear
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_GEAR::AcquireDisappear()
{
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::IsPixel
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_GEAR::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	return AnyMatchWindowPixel(_x, _y);
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::AnyMatchWindowPixel
//
// Window image의 pixel이 (x, y) 한 점이라도 일치하면 true를 아니면 false를 반환한다.
//
// Item을 들고 있을 때에는 'item 참조포인트'에 따라 진행한다.
//-----------------------------------------------------------------------------
bool C_VS_UI_GEAR::AnyMatchWindowPixel(int _x, int _y) const
{
	if (gpC_mouse_pointer->GetPickUpItem())
	{
		for (int i=0; i < ITEM_REF_POINT_COUNT; i++)
		{
			int px = g_item_ref_point[i].x+gpC_mouse_pointer->GetPointerX();
			int py = g_item_ref_point[i].y+gpC_mouse_pointer->GetPointerY();
			if (m_pC_gear_spk->IsPixel(px-x, py-y))
				return true;
			
		}		
		return false;
	}
	else
	{
		return m_pC_gear_spk->IsPixel(_x-x, _y-y);
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::AllMatchWindowPixel
//
//
//-----------------------------------------------------------------------------
bool C_VS_UI_GEAR::AllMatchWindowPixel(int _x, int _y) const
{
	if (gpC_mouse_pointer->GetPickUpItem())
	{
		for (int i=0; i < ITEM_REF_POINT_COUNT; i++)
		{
			int px = g_item_ref_point[i].x+gpC_mouse_pointer->GetPointerX();
			int py = g_item_ref_point[i].y+gpC_mouse_pointer->GetPointerY();
			if (m_pC_gear_spk->IsPixel(px-x, py-y) == false)
				return false;
			
		}
		
		return true;
	}
	else
	{
		return m_pC_gear_spk->IsPixel(_x-x, _y-y);
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_GEAR::TestSlotRect
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_GEAR::TestSlotRect(int _x, int _y) const
{
	for (int i = 0 ; i < m_slot_size; i++)
	{
		if (_x >= m_p_slot_rect[i].x && _x < m_p_slot_rect[i].x+m_p_slot_rect[i].w &&
			_y >= m_p_slot_rect[i].y && _y < m_p_slot_rect[i].y+m_p_slot_rect[i].h)
		{
			return true;
		}
	}
	return false;
}


#if __CONTENTS(__GEAR_SWAP_CHANGE)	// C_VS_UI_GEAR::GearChange()		4473
void C_VS_UI_GEAR::GearChange()
{
	if ( m_bIsGearOther )
		return;

	if(g_pPlayer)
	{
		bool	bGearChange	= true;
		bool	bUseSkill	= false;
		switch(g_pPlayer->GetRace())	//아이템이 교체중일때는 행동을 중단 한다.
		{
		case RACE_SLAYER:
			bGearChange		= g_pSlayerGear->GetProcessingGearChange();
			bUseSkill		= g_pSlayerGear->GetProcessingSkill();
			g_pSlayerGear->SetProcessingSkill(false);
			break;	
				
		case RACE_VAMPIRE:
			bGearChange		= g_pVampireGear->GetProcessingGearChange();
			bUseSkill		= g_pVampireGear->GetProcessingSkill();
			g_pVampireGear->SetProcessingSkill(false);
			break;
					
		case RACE_OUSTERS:
			bGearChange		= g_pOustersGear->GetProcessingGearChange();
			bUseSkill		= g_pOustersGear->GetProcessingSkill();
			g_pOustersGear->SetProcessingSkill(false);
			break;
		}
		if(bGearChange || bUseSkill)
			return;
	}

	switch(g_pPlayer->GetRace())
	{
	case RACE_SLAYER:
		m_dwAccepGearID	= 	g_pSlayerGear->GetAccepGearID();
		break;
	case RACE_VAMPIRE:
		m_dwAccepGearID	= 	g_pVampireGear->GetAccepGearID();
		break;

	case RACE_OUSTERS:
		m_dwAccepGearID	= 	g_pOustersGear->GetAccepGearID();
		break;
	}
	m_dwAccepGearID	= gC_vs_ui.GetGearID();
	m_dwSendGearID	= m_dwAccepGearID;
	m_dwSendGearID	= ++m_dwSendGearID	% 2;	//현재 서버는 2개까지 적용 된듯.. 맥스는 달라 질 수 있다.

	BYTE	btAction	= 	g_pPlayer->GetAction();

	if(!(btAction == ACTION_STAND))// || btAction == ACTION_MOVE))
		return;

	switch(g_pPlayer->GetRace())
	{
	case RACE_SLAYER:
		g_pSlayerGear->SetSendGearID(m_dwSendGearID);
		g_pSlayerGear->SetProcessingGearChange(true);
		break;

	case RACE_VAMPIRE:
		g_pVampireGear->SetSendGearID(m_dwSendGearID);
		g_pVampireGear->SetProcessingGearChange(true);
		break;
		
	case RACE_OUSTERS:
		g_pOustersGear->SetSendGearID(m_dwSendGearID);
		g_pOustersGear->SetProcessingGearChange(true);
		break;
	}

	gpC_base->SendMessage(UI_ITEM_USE_GEAR_CHANGE, 0, 0, NULL);
}
#endif	//__GEAR_SWAP_CHANGE


#if __CONTENTS(__GEAR_SWAP_CHANGE)		// C_VS_UI_GEAR::GearChange(DWORD	dwGearID)
void	C_VS_UI_GEAR::GearChange(DWORD	dwGearID)
{
	if ( m_bIsGearOther )
		return;
/*	if(g_ pPlayer)
	{ 
		bool	bGearChange	= true;
		switch(g_pPlayer->GetRace())	//아이템이 교체중일때는 행동을 중단 한다.
		{
		case RACE_SLAYER:
			bGearChange		= g_pSlayerGear->GetProcessingGearChange();	
			break;	
				
		case RACE_VAMPIRE:
			bGearChange		= g_pVampireGear->GetProcessingGearChange();
			break;
					
		case RACE_OUSTERS:
			bGearChange		= g_pOustersGear->GetProcessingGearChange();
			break;
		}
		if(bGearChange)
			return;
	}
	
	if(m_dwSendGearID == m_dwAccepGearID)	// 현재 착용중인 아이템을 현재 착용중인 아이템으로는 교체가 안된다. (무기 아이템이 장착 되지 않는 현상 발생)
		return;
*/
	if(g_pPlayer)
	{
		bool	bGearChange	= true;
		bool	bUseSkill	= false;
		switch(g_pPlayer->GetRace())	//아이템이 교체중일때는 행동을 중단 한다.
		{
		case RACE_SLAYER:
			bGearChange		= g_pSlayerGear->GetProcessingGearChange();
			bUseSkill		= g_pSlayerGear->GetProcessingSkill();
			g_pSlayerGear->SetProcessingSkill(false);
			break;	
				
		case RACE_VAMPIRE:
			bGearChange		= g_pVampireGear->GetProcessingGearChange();
			bUseSkill		= g_pVampireGear->GetProcessingSkill();
			g_pVampireGear->SetProcessingSkill(false);
			break;
					
		case RACE_OUSTERS:
			bGearChange		= g_pOustersGear->GetProcessingGearChange();
			bUseSkill		= g_pOustersGear->GetProcessingSkill();
			g_pOustersGear->SetProcessingSkill(false);
			break;
		}
		if(bGearChange || bUseSkill)
			return;
	}

	if(gC_vs_ui.GetGearID() == dwGearID)
		return;

	BYTE	btAction	= 	g_pPlayer->GetAction();

	if(!(btAction == ACTION_STAND))// || btAction == ACTION_MOVE))
		return;

	switch(g_pPlayer->GetRace())
	{
	case RACE_SLAYER:
		g_pSlayerGear->SetSendGearID(dwGearID);
		break;

	case RACE_VAMPIRE:
		g_pVampireGear->SetSendGearID(dwGearID);
		break;
		
	case RACE_OUSTERS:
		g_pOustersGear->SetSendGearID(dwGearID);
		break;
	}

	gpC_base->SendMessage(UI_ITEM_USE_GEAR_CHANGE, 0, 0, NULL);	
}
#endif	//__GEAR_SWAP_CHANGE

/*-----------------------------------------------------------------------------
- ResetScroll
- 
-----------------------------------------------------------------------------*/
void C_VS_UI_CHATTING::ResetScroll()
{
	
	m_pC_scroll_bar->SetSize(Rect(w-23, 35, -1, h-79));	

	int i=0, line = 0;
	C_VS_UI_CHAT_LINE * p_line;	
	while(p_line = m_pC_history_list.GetLine(i))
	{
		i++;
		const int _ID_GAP = 2;

		if(m_chat_filter[p_line->GetCondition()] == false)
			continue;

		int vx = CHAT_LINE_START_X;
		
		char* p_temp = NULL;
		if(p_temp = (char*)p_line->GetMsgString())
		{
			int	cut_length = CHAT_WINDOW_WIDTH/g_GetStringWidth("F", gpC_base->m_chatting_pi.hfont)
							- (p_line->GetIdString() == NULL ? 0 : (strlen(p_line->GetIdString())+2));

			int str_length = strlen(p_temp);
			int loopSum = cut_length;
			
			if(cut_length < str_length)
			{					
				for(;;)
				{					
					int len = cut_length;
					
					if(!g_PossibleStringCut(p_temp, loopSum))
					{
						--loopSum;
						--len;
					}
					
					++line;
					
					if(cut_length >= str_length - loopSum)
						break;
					
					loopSum += cut_length;
				}
			}
			
			++line;
		}
	}


	m_pC_scroll_bar->SetPosMax(line-g_HISTORY_LINE+1);
	m_pC_scroll_bar->SetScrollPos(0);
}

//-----------------------------------------------------------------------------
// RestoreHistoryTemp
//
// History temp에 있는 것들을 History에 입력한다.
//-----------------------------------------------------------------------------
void C_VS_UI_CHATTING::RestoreHistoryTemp()
{
	// 옛날 것부터 입력한다.
	
	//	m_bl_whisper_stacked = false;
	//	switch(CHAT)
	//	{
	//		case CHAT:
	//		case ZONE:
	//			m_bl_chat_stacked = false;
	//			m_bl_zone_chat_stacked = false;
	//			break;
	//	
	//		case GUILD:
	//			m_bl_guild_chat_stacked = false;
	//			break;
	//
	//		case PARTY:
	//			m_bl_party_chat_stacked = false;
	//			break;
	//	}
	
	while (m_pC_history_temp_list.Size() > 0)	
	{
		C_VS_UI_CHAT_LINE * p_line = m_pC_history_temp_list.PopBack();
		assert(p_line != NULL);
		
		AddToChatHistory(p_line->GetMsgString(), p_line->GetIdString(), p_line->GetCondition(), p_line->GetColor() );
		delete p_line;
	}
	
	//	while (m_pC_history_guild_temp_list.Size() > 0)
	//	{
	//		C_VS_UI_CHAT_LINE * p_line = m_pC_history_guild_temp_list.PopBack();
	//		assert(p_line != NULL);
	//
	//		AddToChatHistory(p_line->GetMsgString(), p_line->GetIdString(), p_line->GetCondition());
	//		delete p_line;
	//	}
	//
	//	while (m_pC_history_party_temp_list.Size() > 0)
	//	{
	//		C_VS_UI_CHAT_LINE * p_line = m_pC_history_party_temp_list.PopBack();
	//		assert(p_line != NULL);
	//
	//		AddToChatHistory(p_line->GetMsgString(), p_line->GetIdString(), p_line->GetCondition());
	//		delete p_line;
	//	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_CHATTING::SetGuildChat
// 길드채팅 <-> 일반채팅 변환
//-----------------------------------------------------------------------------
void C_VS_UI_CHATTING::SetGuildChat(bool guild)
{
	RestoreHistoryTemp();
	//	m_bl_guild = guild;
	ResetScroll();
}

/*-----------------------------------------------------------------------------
- AddChatToHistory
- history buffer에 추가한다.

  //`buffer size를 넘으면 다시 buf의 맨 앞에 추가하는 데, m_insert_index는 
  //바로 1순위 chat string이 있는 index이다. m_insert_index가 n이면, n 이전 것은
  //2순위 chat string이고, n 다음 것은 가장 옛날 chat string이다.
-----------------------------------------------------------------------------*/
void C_VS_UI_CHATTING::AddChatToHistory(const char * str, const char * sz_id, enum CHAT_LINE_CONDITION condition, DWORD color)
{
	assert(str);
	
	// history를 보고 있을 경우에는 입력하지 않는다.
#ifndef _LIB
	if (m_pC_scroll_bar->GetScrollPos() > 0)
#else
		if (m_pC_scroll_bar->GetScrollPos() > 0 || g_bActiveGame == FALSE)
#endif
		{
			switch(condition)
			{
			case CLD_NORMAL:
				//			m_bl_chat_stacked = true;
				break;
				
			case CLD_ZONECHAT:
				//			m_bl_zone_chat_stacked = true;
				break;
				
			case CLD_GUILD:
				//			m_bl_guild_chat_stacked = true;
				break;
				
			case CLD_PARTY:
				//			m_bl_party_chat_stacked = true;
				break;
				
			case CLD_WHISPER:
				//			m_bl_whisper_stacked = true;
				break;
			}
			
			
			// by larosel
			//		if ( (condition == CLD_PARTY) && m_pC_history_temp_list.Size() == HISTORY_SIZE_TEMP)
			//			delete m_pC_history_guild_temp_list.PopBack();
			//		if ( (condition == CLD_GUILD) && m_pC_history_temp_list.Size() == HISTORY_SIZE_TEMP)
			//			delete m_pC_history_guild_temp_list.PopBack();
			if ( /*(condition == CLD_NOMAL || condition == CLD_ZONECHAT) && */m_pC_history_temp_list.Size() == HISTORY_SIZE_TEMP)
				delete m_pC_history_temp_list.PopBack();
			
			//		if(condition == CLD_PARTY)m_pC_history_guild_temp_list.Add(sz_id, str, condition);
			//		if(condition == CLD_GUILD)m_pC_history_guild_temp_list.Add(sz_id, str, condition);
			//		if((condition == CLD_NOMAL || condition == CLD_ZONECHAT))
			m_pC_history_temp_list.Add(sz_id, str, condition, color );
			
			return;
		}
		
		switch(condition)
		{
		case CLD_NORMAL:
			//		if(chat_mode != CHAT && chat_mode != ZONE)m_bl_chat_stacked = true;
			break;
			
		case CLD_ZONECHAT:
			//		if(chat_mode != CHAT && chat_mode != ZONE)m_bl_zone_chat_stacked = true;
			break;
			
		case CLD_GUILD:
			///		if(chat_mode != GUILD)m_bl_guild_chat_stacked = true;
			break;
			
		case CLD_PARTY:
			//		if(chat_mode != PARTY)m_bl_party_chat_stacked = true;
			break;
			
		case CLD_WHISPER:
			//		// 스크롤이 안되있는 상태에서 WHISPER가 스택될수 없다
			
			break;
		}
		
		AddToChatHistory(str, sz_id, condition, color);
		if(condition == CLD_WHISPER)
		{
			//		AddToChatHistory(str, sz_id, condition);
			AddWhisperID(sz_id);
			if(g_pUserOption->PopupChatByWhisper&&m_chat_filter[FILTER_WHISPER_ID-FILTER_NORMAL_ID]) 
				TimerHide(true);
		}	
}

//-----------------------------------------------------------------------------
// C_VS_UI_CHATTING::AddToChatHistory
//
// //chat history에 sz_str을 넣고 스크롤바를 초기화한다.
//-----------------------------------------------------------------------------
void	C_VS_UI_CHATTING::AddToChatHistory(const char * sz_str, const char * sz_id, CHAT_LINE_CONDITION condition, DWORD color)
{
	if(m_pC_history_list.Size() >= HISTORY_SIZE)
		delete m_pC_history_list.PopBack();
	
	
	//
	// string이 chatting Window의 넓이를 넘으면 자른다.
	//
	// !실제로 출력하는 format과 같게 한 후 넓이를 테스트해야 한다.
	//
	//	char * p_temp = NULL;
	//	int size = 0;
	
	//	HFONT hfont;
	//	if (condition == CLD_ZONECHAT)
	//		hfont = gpC_base->m_user_id_pi.hfont;
	//	else
	//		hfont = gpC_base->m_chatting_pi.hfont;
	
	//	if (sz_id)
	//		size = strlen(sz_id)+1; // + '>'
	//	if (sz_str)
	//		size += strlen(sz_str);
	//
	//	if (size > 0)
	//	{
	//		p_temp = new char[size+1];
	//		memset(p_temp, 0, size+1);
	//
	//		if (sz_id)
	//		{
	//			strcat(p_temp, sz_id);
	//			strcat(p_temp, g_sz_chat_id_divisor);
	//		}
	//		if (sz_str)
	//			strcat(p_temp, sz_str);
	//
	m_pC_history_list.Add(sz_id, sz_str, condition, color);	// by larosel
	//	}
	
	//	DeleteNewArray(p_temp);
	if(m_pC_scroll_bar->GetScrollPos() == 0)
		ResetScroll();
}

/*-----------------------------------------------------------------------------
- MouseControl
- Slayer/Vampire main interface Mouse input.
-----------------------------------------------------------------------------*/
bool C_VS_UI_CHATTING::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	int scroll = m_pC_scroll_bar->GetScrollPos();
	
	bool re = true;// = m_pC_button_group->MouseControl(message, _x, _y);
	if(m_sub_window != 0 && m_sub_rect.IsInRect(_x, _y))
	{
		gpC_mouse_pointer->SetCursorDefault();
		// sub window 안에 있으면 sub scroll
		if(m_sub_window != 2)
			re &= m_pC_sub_scroll_bar->MouseControl(message, _x-m_sub_rect.x, _y-m_sub_rect.y);
		switch(message)
		{
		case M_LEFTBUTTON_DOWN:
		case M_LB_DOUBLECLICK:
			{
				POINT old_selected = m_sub_selected;
				if(m_sub_window == 1)	// mark
				{
					m_sub_selected.x = (_x - m_sub_rect.x-MARK_X)/14;
					m_sub_selected.y = (_y - m_sub_rect.y-MARK_Y)/14+m_pC_sub_scroll_bar->GetScrollPos();
					// 2004, 5, 10 sobeit add start - 클릭 위치 보정
					if(RACE_OUSTERS == g_eRaceInterface)
					{
						m_sub_selected.x -= 1;
						m_sub_selected.y -= 1;
					}
					// 2004, 5, 10 sobeit add end - 클릭 위치 보정
					if(m_sub_selected.x < 0 || m_sub_selected.x > 8 || m_sub_selected.y < 0 || m_sub_selected.y >= MARK_MAX)
						m_sub_selected.x = -1;
					if(m_sub_selected.x != -1 && !(g_pUserOption->UseEnterChat && m_bl_input_mode == false))
					{
						char_t ch;
						memcpy(&ch, g_mark[m_sub_selected.y][m_sub_selected.x], 2);
						InsertMark(ch);
					}
				}
				else if(m_sub_window == 2)	// color
				{
					
					m_sub_selected.x = (_x - m_sub_rect.x-COLOR_X)/30;
					m_sub_selected.y = (_y - m_sub_rect.y-COLOR_Y)/17;
					if(m_sub_selected.x < 0 || m_sub_selected.x > 3 || m_sub_selected.y < 0 || m_sub_selected.y > 3)
						m_sub_selected.x = -1;
					if(m_sub_selected.x != -1)
					{
						if(g_pUserOption->ChatWhite)
							g_pUserOption->ChattingColor = gpC_base->m_chatting_pi.text_color;
						else
							g_pUserOption->ChattingColor = g_color[m_sub_selected.y][m_sub_selected.x];
					
						
						IWin32Edite* pWin32Edite = gC_vs_ui.GetWin32Edite();
						if ( pWin32Edite )
							pWin32Edite->SetTextColor(g_pUserOption->ChattingColor);

						m_lev_chatting.SetInputStringColor(g_pUserOption->ChattingColor);
					}
					if(old_selected.x == m_sub_selected.x && old_selected.y == m_sub_selected.y)
						m_sub_window = 0;
				}
				
				//if(message == M_LB_DOUBLECLICK)
				//	m_sub_window = 0;
			}
			break;
			
		case M_WHEEL_UP:
			m_pC_sub_scroll_bar->ScrollUp();
			break;
			
		case M_WHEEL_DOWN:
			m_pC_sub_scroll_bar->ScrollDown();
			break;
		}
		return true;
	}
	
	_x -= x; _y -= y;
	re &= m_pC_button_group->MouseControl(message, _x, h-_y);
	re &= m_pC_scroll_bar->MouseControl(message, _x, _y);
	
	if(!g_pUserOption->UseEnterChat || m_bl_input_mode == true)
	{
		re &= m_pC_input_button_group->MouseControl(message, _x, h-_y);
		re &= m_pC_input_right_button_group->MouseControl(message, w-_x, h-_y);
	}
	
	
	switch (message)
	{
	case M_MOVING:
		if(!Moving())
		{
			m_resize = RESIZE_NOT;
			if(_x >= 0 && _x <= 5)
				m_resize = RESIZE_LEFT;
			if(_x >= w-5 && _x < w)
				m_resize = RESIZE_RIGHT;
			if(_y >= 0 && _y <= 5)
			{
				if(m_resize == RESIZE_LEFT)
					m_resize = RESIZE_LEFTTOP;
				else if(m_resize == RESIZE_RIGHT)
					m_resize = RESIZE_RIGHTTOP;
				else m_resize = RESIZE_TOP;
			}
			if(_y >= h-5 && _y < h)
			{
				if(m_resize == RESIZE_LEFT)
					m_resize = RESIZE_LEFTBOTTOM;
				else if(m_resize == RESIZE_RIGHT)
					m_resize = RESIZE_RIGHTBOTTOM;
				else m_resize = RESIZE_BOTTOM;
			}
			if(m_resize == RESIZE_NOT)
				gpC_mouse_pointer->SetCursorDefault();
			else
				gpC_mouse_pointer->SetCursorResize(this);
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		
		if(m_bl_whisper_mode && re)
		{
			if(IsSpreadID())
			{
				RECT rect = { CHAT_LINE_START_X+15-x, CHAT_LINE_START_Y-y - GetWhisperSize()*FONT_GAP -3, CHAT_LINE_START_X+85-x, CHAT_LINE_START_Y -3-y };			
				if(_x > rect.left && _x < rect.right && _y > rect.top && _y < rect.bottom)
				{
					int select = (_y - rect.top)/FONT_GAP;
					if(GetWhisperFocus())
					{
						m_lev_chatting.EraseAll();
						m_lev_chatting.AddString( GetWhisperID(select).c_str() );
					}
					else
					{
						m_sz_whisper_backup = GetWhisperID(select);
					}
					m_bl_spreadID = false;
					break;
				}
			}
			
			
			if(_y > 100 && _y < 120)
			{
				if(_x > 51 && _x < 129 && !m_bl_focus_whisper)
					ChangeWhisperFocus();
				else if(_x > 129 && _x < w-50 && m_bl_focus_whisper)
					ChangeWhisperFocus();
				break;
			}
		}
		if (gpC_mouse_pointer->GetPickUpItem() == false && re)
		{
			if(m_resize != RESIZE_NOT)
			{
				m_backup_window_point.x = x;
				m_backup_window_point.y = y;
				//					AttrStatch(false);
			}
			
			m_backup_rect.Set(x, y, w, h);
			MoveReady();
			SetOrigin(_x, _y);
			break;
		}
		break;
		
	case M_LEFTBUTTON_UP:
		CancelPushState();
		//			AttrStatch(true);
		break;
		
	case M_WHEEL_UP:
		m_pC_scroll_bar->ScrollUp();
		break;
		
	case M_WHEEL_DOWN:
		m_pC_scroll_bar->ScrollDown();
		break;
	}
	
	if(scroll > 0 && m_pC_scroll_bar->GetScrollPos() == 0)
		RestoreHistoryTemp();
		/*
		// Mouse Control Extra
		RECT rect;
		if(!m_bl_spreadID)
		{
		if (g_HISTORY_LINE > HISTORY_LINE)
		{
		int pixelY = (g_HISTORY_LINE - HISTORY_LINE) * FONT_GAP;
		
		  rect.left = 18;
		  rect.top = 506 - pixelY;
		  rect.right = 560;
		  rect.bottom = 574;
		  }
		  else
		  {
		  rect.left = 18;
		  rect.top = 506;
		  rect.right = 560;
		  rect.bottom = 574;
		  }
		  
			//------------------------------------------------------------
			// 일단, 전체 영역에 포함되는지 본다.
			//------------------------------------------------------------
			if (x > rect.left && x < rect.right
			&& y > rect.top && y < rect.bottom)
			{
			switch (message)
			{	
			case M_LEFTBUTTON_DOWN:
			case M_RIGHTBUTTON_DOWN:
			case M_LB_DOUBLECLICK:	
			{
			if (x > rect.left && x < rect.left + 120)
			{
			//------------------------------------------------------------
			// 채팅창에서 이름 선택하기 - by sigi
			//------------------------------------------------------------				
			// FONT_GAP으로 몇번째 줄인지 판단한다.
			int yLine = -((y - (CHAT_HISTORY_START_Y+FONT_GAP)) / FONT_GAP);				
			
			  //	by larosel
			  C_VS_UI_CHAT_LINE * p_line = NULL;	
			  switch(CHAT)//gC_vs_ui.GetChatMode())
			  {
			  case ZONE:
			  case CHAT:
			  p_line = m_pC_history_list.GetLine(yLine + m_chat_scrollbar.GetAmountToScroll());
			  break;
			  
				case GUILD:
				p_line = m_pC_history_guild_list.GetLine(yLine + m_chat_scrollbar.GetAmountToScroll());
				break;
				
				  case PARTY:
				  p_line = m_pC_history_party_list.GetLine(yLine + m_chat_scrollbar.GetAmountToScroll());
				  break;
				  }
				  
					if (p_line!=NULL)
					{
					const char* pID = p_line->GetIdString();
					
					  if (pID!=NULL)
					  {
					  //							gpC_base->SendMessage(UI_CHAT_SELECT_NAME, message, 0, (void*)pID);												
					  if(m_lev_chatting.GetString()[0] == '*')	// 운영자 명령어인경우 채팅창에 넣어준다
					  {
					  m_lev_chatting.AddString(" ");
					  m_lev_chatting.AddString(pID);
					  }
					  else
					  {
					  //									AddWhisperID(pID);
					  // 내가 귓속말 보낼때 '[쑥갓] 초변태>어쩌구' 를 클릭하면 '[쑥갓] 초변태'가 귓말 아이디에 들어가는거 방지
					  if(strchr(pID, ' ') != NULL)
					  SetWhisperID(strchr(pID,' ')+1);
					  else
					  SetWhisperID((char *)pID);
					  }
					  }
					  }
					  }
					  }
					  break;
					  
						case M_WHEEL_UP:
						Scroll(UP);
						break;
						
						  case M_WHEEL_DOWN:
						  Scroll(DOWN);
						  break;
						  
							}
							
							  return true;
							  }
							  }
							  else
							  {
							  SetRect(&rect, CHAT_LINE_START_X, CHAT_LINE_START_Y - GetWhisperSize()*FONT_GAP -3, CHAT_LINE_START_X+70, CHAT_LINE_START_Y -3);
							  
								if (x > rect.left && x < rect.right
								&& y > rect.top && y < rect.bottom)
								{
								switch (message)
								{	
								case M_LEFTBUTTON_DOWN:
								case M_RIGHTBUTTON_DOWN:
								case M_LB_DOUBLECLICK:	
								{
								//------------------------------------------------------------
								// 스프레드된 아이디 창에서 아이디 선택하기 by larosel
								//------------------------------------------------------------				
								// FONT_GAP으로 몇번째 줄인지 판단한다.
								int yLine = (y - rect.top)/FONT_GAP;
								SetWhisperID((char *)GetWhisperID(yLine).c_str());
								
								  m_bl_spreadID = false;
								  
									}
									break;
									}
									
									  return true;
									  }
									  
										}
										
*/
return true;
}

void C_VS_UI_CHATTING::SetWhisperID(char *id)
{
	if(!GetWhisperFocus())
	{
		m_sz_whisper_backup = id;
	}
	else
	{
		m_lev_chatting.EraseAll();
		m_lev_chatting.AddString(id);
		ChangeWhisperFocus();
	}
}
/*-----------------------------------------------------------------------------
- MouseControl Extra - by sigi
- Slayer/Vampire main interface Mouse input.

  UI구조상.. 영역 밖의 mouse입력이 어려워서..
-----------------------------------------------------------------------------*/
/*
bool C_VS_UI_CHATTING::MouseControlExtra(UINT message, int x, int y)
{
//------------------------------------------------------------
// 채팅창에서 이름 선택하기 - by sigi
//------------------------------------------------------------
RECT rect;
if(!m_bl_spreadID)
{
if (g_HISTORY_LINE > HISTORY_LINE)
{
int pixelY = (g_HISTORY_LINE - HISTORY_LINE) * FONT_GAP;

  rect.left = 18;
  rect.top = 506 - pixelY;
  rect.right = 560;
  rect.bottom = 574;
		}
		else
		{
		rect.left = 18;
		rect.top = 506;
		rect.right = 560;
		rect.bottom = 574;
		}
		
		  //------------------------------------------------------------
		  // 일단, 전체 영역에 포함되는지 본다.
		  //------------------------------------------------------------
		  if (x > rect.left && x < rect.right
		  && y > rect.top && y < rect.bottom)
		  {
		  switch (message)
		  {	
		  case M_LEFTBUTTON_DOWN:
		  case M_RIGHTBUTTON_DOWN:
		  case M_LB_DOUBLECLICK:	
		  {
		  if (x > rect.left && x < rect.left + 120)
		  {
		  //------------------------------------------------------------
		  // 채팅창에서 이름 선택하기 - by sigi
		  //------------------------------------------------------------				
		  // FONT_GAP으로 몇번째 줄인지 판단한다.
		  int yLine = -((y - (CHAT_HISTORY_START_Y+FONT_GAP)) / FONT_GAP);				
		  
			//	by larosel
			C_VS_UI_CHAT_LINE * p_line;	
			if(m_bl_guild)p_line = m_pC_history_guild_list.GetLine(yLine + m_chat_scrollbar.GetAmountToScroll());
			else p_line = m_pC_history_list.GetLine(yLine + m_chat_scrollbar.GetAmountToScroll());
			
			  if (p_line!=NULL)
			  {
			  const char* pID = p_line->GetIdString();
			  
				if (pID!=NULL)
				{
				//							gpC_base->SendMessage(UI_CHAT_SELECT_NAME, message, 0, (void*)pID);												
				AddWhisperID(pID);	// by larosel
				}
				}
				}
				}
				break;
				
				  case M_WHEEL_UP:
				  Scroll(UP);
				  break;
				  
					case M_WHEEL_DOWN:
					Scroll(DOWN);
					break;
					
					  }
					  
						return true;
						}
						}
						else
						{
						SetRect(&rect, CHAT_LINE_START_X, CHAT_LINE_START_Y - GetWhisperSize()*FONT_GAP -3, CHAT_LINE_START_X+70, CHAT_LINE_START_Y -3);
						
						  if (x > rect.left && x < rect.right
						  && y > rect.top && y < rect.bottom)
						  {
						  switch (message)
						  {	
						  case M_LEFTBUTTON_DOWN:
						  case M_RIGHTBUTTON_DOWN:
						  case M_LB_DOUBLECLICK:	
						  {
						  //------------------------------------------------------------
						  // 스프레드된 아이디 창에서 아이디 선택하기 by larosel
						  //------------------------------------------------------------				
						  // FONT_GAP으로 몇번째 줄인지 판단한다.
						  int yLine = (y - rect.top)/FONT_GAP;
						  if(!GetWhisperFocus())
						  {
						  m_sz_whisper_backup = GetWhisperID(yLine);
						  }
						  else
						  {
						  m_lev_chatting.EraseAll();
						  m_lev_chatting.AddString(GetWhisperID(yLine).c_str());
						  ChangeWhisperFocus();
						  }
						  
							m_bl_spreadID = false;
							
							  }
							  break;
							  }
							  
								return true;
								}
								
								  }
								  
									return false;
									}
*/


/*-----------------------------------------------------------------------------
- KeyboardControl
- Slayer/Vampire main interface Keyboard input.
-----------------------------------------------------------------------------*/
void C_VS_UI_CHATTING::KeyboardControl(UINT message, UINT key, long extra)
{
	if ( gC_vs_ui.GetWin32Edite() )
		return;

	if(g_pUserOption->UseEnterChat && m_bl_input_mode == false)
	{
		if(message == WM_KEYDOWN && key == VK_RETURN)
		{
			m_bl_input_mode = true;
		}
#if __CONTENTS(__JAPAN_UI)
		else if(message == WM_IME_COMPOSITION)
		{
			gC_ci->FinishImeRunning();
		}
#endif //__JAPAN_UI
		return;
	}
	
	// Hiding 중에는 키보드 입력 안받음
	if((x < 0 || x+w > RESOLUTION_X || y < 0 || y+h > RESOLUTION_Y) && g_pUserOption->UseEnterChat)
		return;

	// 스크롤중에 엔터를 안받는건 왜냐-ㅅ- 입력되면 스크롤 돌리구 입력해야지-_-;
	if (message == WM_KEYDOWN && key == VK_RETURN && m_pC_scroll_bar->GetScrollPos() > 0)
	{
		RestoreHistoryTemp();
	}

	if((message == WM_KEYDOWN || message == WM_CHAR || message == WM_KEYUP) && key == VK_SPACE && (g_pDXInput->KeyDown(DIK_LCONTROL) || g_pDXInput->KeyDown(DIK_RCONTROL)))
		return;
	
	int old_cursor = m_lev_chatting.GetCursor();

	gC_ci->IME_MessageProcessor(message, key, extra);
	
	/*	if (message == WM_CHAR)
	if (key == '/')
	if (m_lev_chatting.Size() == 1)
	{
				std::string ID = GetWhisperID();
				if(ID.size())
				{
				m_lev_chatting.AddString( ID.c_str() );
				m_lev_chatting.AddString( " " );
				}
				}
	*/
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_RETURN:
			if(IsCannotSendChatInput())
			{
				break;
			}
			
			if(GetWhisperFocus())
			{
				ChangeWhisperFocus();
				break;
			}
			// 입력된 것이 없으면 무효이다.
			if (m_lev_chatting.Size() > 0)
			{
				//
				// sz_chat_str
				//
				// DBCS를 ASCII로 바꿀 때 사용하는 buf.
				// 실제로 UI_CHAT_RETURN을 받을 때 chatting string이므로 메시지를 처리하고나서 반드시 DeleteNewArray를
				// 해줘야 한다.
				//
				// UI에서 이 ptr을 관리하면 동기화문제인지몰라도 글자가 깨지는 경우가 있다. UI_CHAT_RETURN이
				// 처리되지 않은 상태에서 g_Convert_DBCS_Ascii2SingleByte()가 실행되서 그런 것 같다.
				//
				
				char * sz_chat_str = NULL;
				g_Convert_DBCS_Ascii2SingleByte(m_lev_chatting.GetString(), m_lev_chatting.Size(), sz_chat_str);
				
				// 타이핑 했던 문장 기억하기
				if(m_history.size() == m_history_line)
				{
					if(m_history.size() == 20)
					{
						m_history.erase(&m_history[0]);
					}
					
					PAPERING_HISTORY temp_history;
					
					temp_history.m_string = sz_chat_str;
					temp_history.m_timer.push_back(GetTickCount());
					m_history.push_back(temp_history);
					m_history_line = m_history.size();
				}
				else
				{
					PAPERING_HISTORY temp_history = m_history[m_history_line];
					
					if(temp_history.m_timer.size() == 5)
					{
						
						if( !g_pUserInformation->attrOperator.GetValue() &&
							strstr(sz_chat_str, "*command") == NULL &&
							temp_history.m_timer[0] + 20000 > GetTickCount() /*&& sz_chat_str[0] != '*'*/ &&
							strstr(g_char_slot_ingame.sz_name.c_str(), (*g_pGameStringTable)[UI_STRING_MESSAGE_MASTER_NAME].GetString()) == NULL)
						{
							Timer(true);
							m_timer = TIMER_PAPERING;
							delete [] sz_chat_str;
							break;
						}
						else
						{
							temp_history.m_timer.erase(&temp_history.m_timer[0]);
						}
					}
					
					m_history.erase(&m_history[m_history_line]);
					temp_history.m_string = sz_chat_str;
					temp_history.m_timer.push_back(GetTickCount());
					m_history.push_back(temp_history);
					m_history_line = m_history.size();
				}
				//---------------------------------------------------------
				//                    채팅 명령어 처리 
				//---------------------------------------------------------
				const int ChatCommandCnt = 14;
				
				char *szEnglishCommand[ChatCommandCnt] = {
					"C", "Z", "W", "P", "G", "U","COXLDEHDNA","?","EHDNAAKF","EHDNA","H","HELP",
					"QORUDDMA","GYRHKDMA",
				};
				
				char *szKoreanCommand[ChatCommandCnt] = {
					"ㅊ", "ㅋ", "ㅈ", "ㅔ", "ㅎ", "ㅕ","채팅도움","?","도움말","도움","ㅗ","ㅗ디ㅔ",
					"배경음","효과음",
				};
				
				void (C_VS_UI::*pHotkeyFunction[ChatCommandCnt])() = {
					C_VS_UI::HotKey_NormalChat,
					C_VS_UI::HotKey_ZoneChat,
					C_VS_UI::HotKey_Whisper,
					C_VS_UI::HotKey_PartyChat,
					C_VS_UI::HotKey_GuildChat,
					C_VS_UI::HotKey_UnionChat,
					C_VS_UI::HotKey_Chat_Help,
					C_VS_UI::HotKey_Chat_Help,
					C_VS_UI::HotKey_Help,
					C_VS_UI::HotKey_Help,
					C_VS_UI::HotKey_Help,
					C_VS_UI::HotKey_Help,
					C_VS_UI::HotKey_Background_Music,
					C_VS_UI::HotKey_Effect_Music,

				};
				
				char* chat_str = NULL;
				g_Convert_DBCS_Ascii2SingleByte(m_lev_chatting.GetString(), m_lev_chatting.Size(), chat_str);
				strupr(chat_str);
				
				for(int i = 0; i < ChatCommandCnt; ++i)
				{
					char szEnglishBuf[16];
					char szKoreanBuf[16];
					
					sprintf(szEnglishBuf, "/%s", szEnglishCommand[i]);
					sprintf(szKoreanBuf, "/%s", szKoreanCommand[i]);

					if(!strcmp(chat_str, szEnglishBuf) ||
					!strcmp(chat_str, szKoreanBuf))
					{
						//채팅 모드 변경 명령어 처리 
						if(i < 6)
						{
							//SetChatMode(i);
							(gC_vs_ui.*pHotkeyFunction[i])();
							m_lev_chatting.EraseAll();
							break;
						}
						//그외 명령어 처리
						else
						{
							(gC_vs_ui.*pHotkeyFunction[i])();
						}
					}
				}
				
				delete [] chat_str;




				
				// 걸려있는 스킬중에 뮤트 스킬이 있으면 말할 수 없다
				bool bFoundMute = false;
				S_SLOT::UI_EFFECTSTATUS_TYPE::iterator itr = g_char_slot_ingame.STATUS.begin();
				S_SLOT::UI_EFFECTSTATUS_TYPE::iterator endItr = g_char_slot_ingame.STATUS.end();
				while(itr != endItr)
				{
					if(itr->actionInfo == SKILL_MUTE)
					{
						bFoundMute = true;
						break;
					}
					itr++;
				}
				if(bFoundMute && !g_pUserInformation->attrOperator.GetValue())
					break;
				
				// 2초동안 5문장 말하면 막기
				
				
				if( !g_pUserInformation->attrOperator.GetValue()	&&
					strstr(sz_chat_str, "*command") == NULL			&&
					m_dw_rep_tickcount.size()==5					&&
					m_dw_rep_tickcount[0] + 2000 > GetTickCount()	&&
					strstr(g_char_slot_ingame.sz_name.c_str(), (*g_pGameStringTable)[UI_STRING_MESSAGE_MASTER_NAME].GetString()) == NULL)
				{
					Timer(true);
					m_timer = TIMER_REP;
					delete [] sz_chat_str;
					break;
				}
				
				
				if(m_dw_rep_tickcount.size() == 5)
				{
					m_dw_rep_tickcount.erase(&m_dw_rep_tickcount[0]);
				}
				m_dw_rep_tickcount.push_back(GetTickCount());
				
				char *pTempstr;
				
				int condition = CLD_NORMAL;
				
				if(m_bl_whisper_mode)
				{
					condition = CLD_WHISPER;
					int lenght = strlen(sz_chat_str) + m_sz_whisper_backup.size() + 5;
					pTempstr = new char[lenght];
					strcpy(pTempstr, "/w ");
					strcat(pTempstr, m_sz_whisper_backup.c_str());
					strcat(pTempstr, " ");
					strcat(pTempstr, sz_chat_str);
					delete [] sz_chat_str;
				}else
				{
					condition = m_chat_mode;
					pTempstr = sz_chat_str;
					if(condition == CLD_ZONECHAT)
					{
						if(strstr(g_char_slot_ingame.sz_name.c_str(), (*g_pGameStringTable)[UI_STRING_MESSAGE_MASTER_NAME].GetString()) == NULL)
						{
							Timer(true);
							m_timer = TIMER_ZONECHAT;
						}
					}
				}
				
				
				if(g_pUserOption->ChatWhite)
					gpC_base->SendMessage(UI_CHAT_RETURN, condition, gpC_base->m_chatting_pi.text_color, pTempstr);	// by larosel
				else
					gpC_base->SendMessage(UI_CHAT_RETURN, condition, g_pUserOption->ChattingColor, pTempstr);	// by larosel
				//by diesirace
				if(pTempstr[0] == '/' && (pTempstr[1] == 'w' || pTempstr[1] == 'W' /*|| pTempstr[1] == 'ㅈ'*/))AddWhisperID(pTempstr + 3);
				
				m_lev_chatting.EraseAll();

				if(m_bl_whisper_mode)
					m_whisper_index = GetWhisperSize() -1;
				else 
					m_whisper_index = -1;
				
				//					m_bl_spreadID = false;
				
				// message를 보내고 곧바로 확인한다. 왜냐하면 lack에 의해 늦어질 수 있기 때문이다.
				// 이것은 바로 반응해야 하는 것이다.
				RestoreHistoryTemp();
				ResetScroll();	// by larosel
				
				if(!g_pUserOption->UseEnterChat)
					TimerHide(true);
			}
			// 입력된 것이 없을때
			else
			{
				if(g_pUserOption->UseEnterChat && m_bl_input_mode)
					m_bl_input_mode = false;
			}
			break;
				
			case VK_UP:
				if(m_bl_whisper_mode && GetWhisperFocus())
				{
					if(m_whisper_index > 0)m_whisper_index--;
					else if(m_whisper_index == -1)m_whisper_index = GetWhisperSize() -1;
					
					std::string ID = GetWhisperID();
					if(ID.size())
					{
						//						if(m_bl_whisper_mode)m_sz_whisper_backup = ID;
						//						else
						{
							m_lev_chatting.EraseAll();
							m_lev_chatting.AddString( ID.c_str() );
						}
					}
				}
				else
				{
					if(m_history_line > 0)
					{
						m_lev_chatting.EraseAll();
						m_lev_chatting.AddString(m_history[--m_history_line].m_string.c_str());
					}
				}
				
				//				if (m_lev_chatting.Size() == 0)
				//				if(GetWhisperFocus())ChangeWhisperFocus();
				//				else
				//				{
				//					if(m_whisper_index > 0)m_whisper_index--;
				//					else if(m_whisper_index == -1)m_whisper_index = GetWhisperSize() -1;
				//
				//					std::string ID = GetWhisperID();
				//					if(ID.size())
				//					{
				//						if(m_bl_whisper_mode)m_sz_whisper_backup = ID;
				//						else
				//						{
				//							m_lev_chatting.EraseAll();
				//							m_lev_chatting.AddString( "/" );
				//							m_lev_chatting.AddString( ID.c_str() );
				//							m_lev_chatting.AddString( " " );
				//						}
				//					}
				//				}
				break;
				
			case VK_DOWN:
				if(m_bl_whisper_mode && GetWhisperFocus())
				{
					if(m_whisper_index < GetWhisperSize() -1 && m_whisper_index != -1)m_whisper_index++;
					else if(m_whisper_index == GetWhisperSize() -1 && !m_bl_whisper_mode || m_whisper_index == -1)
					{
						m_whisper_index = -1;
						m_lev_chatting.EraseAll();
						break;
					}
					
					std::string ID = GetWhisperID();
					if(ID.size())
					{
						//						if(m_bl_whisper_mode)m_sz_whisper_backup = ID;
						//						else
						{
							m_lev_chatting.EraseAll();
							m_lev_chatting.AddString( ID.c_str() );
							//							m_lev_chatting.AddString( " " );
						}
					}
				}
				else
				{
					if(m_history_line+1 < m_history.size())
					{
						m_lev_chatting.EraseAll();
						m_lev_chatting.AddString(m_history[++m_history_line].m_string.c_str());
					}
					else if(m_history_line+1 == m_history.size())
					{
						m_lev_chatting.EraseAll();
						m_history_line++;
					}
				}
				
				//				if(GetWhisperFocus())ChangeWhisperFocus();
				//				else
				//				if (m_lev_chatting.Size() == 0)
				//				{
				//					if(m_whisper_index < GetWhisperSize() -1 && m_whisper_index != -1)m_whisper_index++;
				//					else if(m_whisper_index == GetWhisperSize() -1 && !m_bl_whisper_mode || m_whisper_index == -1)
				//					{
				//						m_whisper_index = -1;
				//						m_lev_chatting.EraseAll();
				//						break;
				//					}
				//
				//					std::string ID = GetWhisperID();
				//					if(ID.size())
				//					{
				//						if(m_bl_whisper_mode)m_sz_whisper_backup = ID;
				//						else
				//						{
				//							m_lev_chatting.EraseAll();
				//							m_lev_chatting.AddString( "/" );
				//							m_lev_chatting.AddString( ID.c_str() );
				//							m_lev_chatting.AddString( " " );
				//						}
				//					}
				//				}
				break;
				
			case VK_LEFT:
				if(m_bl_whisper_mode && !m_bl_focus_whisper)
				{
					if(old_cursor == 0)ChangeWhisperFocus();
				}
				break;
				
			case VK_RIGHT:
				if(m_bl_whisper_mode && m_bl_focus_whisper)
				{
					if(old_cursor == m_lev_chatting.Size())ChangeWhisperFocus();
				}
				break;
		}
	}
	else if(message == WM_CHAR)
	{
		if(key == ' ')//스페이스 키
		{
			const int ChatCommandCnt = 6;

			char *szEnglishCommand[ChatCommandCnt] = {
				"C", "Z", "W", "P", "G", "U",
			};

			char *szKoreanCommand[ChatCommandCnt] = {
				"ㅊ", "ㅋ", "ㅈ", "ㅔ", "ㅎ", "ㅕ",
			};

			void (C_VS_UI::*pHotkeyFunction[ChatCommandCnt])() = {
				C_VS_UI::HotKey_NormalChat,
				C_VS_UI::HotKey_ZoneChat,
				C_VS_UI::HotKey_Whisper,
				C_VS_UI::HotKey_PartyChat,
				C_VS_UI::HotKey_GuildChat,
				C_VS_UI::HotKey_UnionChat,
			};

			char* sz_chat_str = NULL;
			g_Convert_DBCS_Ascii2SingleByte(m_lev_chatting.GetString(), m_lev_chatting.Size(), sz_chat_str);
			
			if(sz_chat_str)
			{
				strupr(sz_chat_str);
				
				for(int i = 0; i < ChatCommandCnt; ++i)
				{
					char szEnglishBuf[8];
					char szKoreanBuf[8];
					
					sprintf(szEnglishBuf, "/%s ", szEnglishCommand[i]);
					sprintf(szKoreanBuf, "/%s ", szKoreanCommand[i]);
					
					if(!strcmp(sz_chat_str, szEnglishBuf) ||
						!strcmp(sz_chat_str, szKoreanBuf))
					{
						//SetChatMode(i);
						(gC_vs_ui.*pHotkeyFunction[i])();
						m_lev_chatting.EraseAll();
						break;
					}
				}
			}

			delete [] sz_chat_str;
		}
	}
}

//-----------------------------------------------------------------------------
// 입력중인 string을 바로 설정한다. by sigi
//-----------------------------------------------------------------------------
void	
C_VS_UI_CHATTING::SetInputString(const char* pString)
{
	m_lev_chatting.EraseAll();		
	
	if (pString!=NULL)
	{
		m_lev_chatting.AddString( pString );
	}
}

//-----------------------------------------------------------------------------
// 입력중인 string을 바로 설정한다. by sigi
//-----------------------------------------------------------------------------
void	
C_VS_UI_CHATTING::AddInputString(const char* pString)
{
	if (pString!=NULL)
	{
		int orgStrLen	= g_GetByteLenth(m_lev_chatting.GetString(), m_lev_chatting.Size());
		int addStrLen	= strlen(pString);
		if(orgStrLen + addStrLen < CHAT_INPUT_LIMIT)
			m_lev_chatting.AddString(pString);
	}
}


/*-----------------------------------------------------------------------------
- Show
-
-----------------------------------------------------------------------------*/
void C_VS_UI_CHATTING::Show()
{
	int gap = 0;
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		if(!g_pUserOption->UseEnterChat || m_bl_input_mode == true) gap = m_pC_chatting_spk->GetHeight(INPUT_RIGHT);
		Rect rect(0, 0, w-10, h-gap);
		if(GetAttributes()->alpha)
		{
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				{
					RECT alpha_rect = { x+35, y+5, x+w-20, y+h-5 };
					DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
				}				
				break;

			case RACE_VAMPIRE:
				{
					RECT alpha_rect = { x+30, y+10, x+w-20, y+h-5 };
					DrawAlphaBox(&alpha_rect, 2, 0, 0, g_pUserOption->ALPHA_DEPTH);
				}				
				break;

			case RACE_OUSTERS:
				{
					RECT alpha_rect = { x+30, y+4, x+w-20, y+h-4 };
					DrawAlphaBox(&alpha_rect, 0, 4, 0, g_pUserOption->ALPHA_DEPTH);
				}				
				break;
			}			
			m_pC_chatting_spk->BltLockedClip(x, y, rect, MAIN_ALPHA);
		}
		else
			m_pC_chatting_spk->BltLockedClip(x, y, rect, MAIN);
		rect.w = m_pC_chatting_spk->GetWidth(MAIN_RIGHT);
		m_pC_chatting_spk->BltLockedClip(x+w-rect.w, y, rect, MAIN_RIGHT);
		
		if(gap)
		{
			if(g_eRaceInterface == RACE_SLAYER)
			{
				rect.w = w;
				rect.h = m_pC_chatting_spk->GetHeight(MAIN_BOTTOM)-5;
				m_pC_chatting_spk->BltLockedClip(x, y+h-gap-rect.h, rect, MAIN_BOTTOM);
			}
			rect.w = w-10;			
			rect.h = gap;
			if(GetAttributes()->alpha)
				m_pC_chatting_spk->BltLockedClip(x, y+h-gap, rect, INPUT_ALPHA);
			else
				m_pC_chatting_spk->BltLockedClip(x, y+h-gap, rect, INPUT);
			m_pC_chatting_spk->BltLocked(x+w-m_pC_chatting_spk->GetWidth(INPUT_RIGHT), y+h-gap, INPUT_RIGHT);
			
			m_pC_input_button_group->Show();
			m_pC_input_right_button_group->Show();
		}
		else
		{
			rect.w = w;
			rect.h = m_pC_chatting_spk->GetHeight(MAIN_BOTTOM);
			m_pC_chatting_spk->BltLockedClip(x, y+h-gap-rect.h, rect, MAIN_BOTTOM);
		}
		m_pC_button_group->Show();
		
		
		if(m_sub_window != 0)
		{
			int ousters_plus = 18;
			if(g_eRaceInterface != RACE_OUSTERS)
				ousters_plus = 0;

			m_sub_rect.x = x+w-m_sub_rect.w;
			if(y > m_sub_rect.h)
				m_sub_rect.y = y-m_sub_rect.h;
			else
				m_sub_rect.y = y+h;
			gpC_global_resource->DrawDialogLocked(m_sub_rect, GetAttributes()->alpha);
			
			if(m_sub_window == 1)	// mark
			{
				if(m_sub_selected.x != -1)
				{
//					RECT rect = {m_sub_rect.x+MARK_X+m_sub_selected.x*14-1, m_sub_rect.y+MARK_Y-2+(m_sub_selected.y+m_pC_sub_scroll_bar->GetScrollPos())*14, 0, 0};			// hyungony
					RECT rect = {m_sub_rect.x+MARK_X+ousters_plus+m_sub_selected.x*14-1, m_sub_rect.y+MARK_Y+ousters_plus-2+(m_sub_selected.y-m_pC_sub_scroll_bar->GetScrollPos())*14, 0, 0};
					rect.right = rect.left +15;
					rect.bottom = rect.top +16;
					
					if(m_sub_selected.y >= m_pC_sub_scroll_bar->GetScrollPos() && m_sub_selected.y < m_pC_sub_scroll_bar->GetScrollPos()+5)
						DrawAlphaBox(&rect, 0, 0, 255, g_pUserOption->ALPHA_DEPTH);
				}
				//				
				gpC_base->m_p_DDSurface_back->Unlock();
				int localLine = 1;
#if __CONTENTS(__JAPAN_UI)
				localLine = 0;
#endif //__JAPAN_UI
				
				g_FL2_GetDC();
				for(int i = 0; i < MARK_MAX - localLine; i++)
				{
					for(int j = 0; j < 9; j++)
					{
						int scrollPos = m_pC_sub_scroll_bar->GetScrollPos();
						if(scrollPos < 0)
							scrollPos = 0;
						g_PrintColorStr(m_sub_rect.x + j*14 +MARK_X+ousters_plus, m_sub_rect.y + i*14 +MARK_Y+ousters_plus, g_mark[i+scrollPos][j], gpC_base->m_chatting_pi, RGB_WHITE);
					}
				}
				g_FL2_ReleaseDC();
				m_pC_sub_scroll_bar->Show(m_sub_rect.x, m_sub_rect.y);
				
				//				if(MARK_MAX > 5)
				//					gpC_global_resource->m_pC_assemble_box_button_spk->Blt(SLAYER_SCROLLTAG_X, 439+18*m_mark_scroll/(MARK_MAX-5), C_GLOBAL_RESOURCE::AB_SLAYER_SCROLL_TAG);
			}
			else if(m_sub_window == 2)	// color
			{
				gpC_base->m_p_DDSurface_back->Unlock();
				RECT rect;
				for(int i = 0; i < 4; i++)
				{
					for(int j = 0; j < 4; j++)
					{
						rect.left = m_sub_rect.x + j*30+COLOR_X ;
						rect.top = m_sub_rect.y + i*17+COLOR_Y ;
						rect.right = rect.left +28;
						rect.bottom = rect.top +15;
						COLORREF color = g_color[i][j];
						BYTE b = (color&0xff0000)>>19;
						BYTE g = (color&0xff00)>>11;
						BYTE r = (color&0xff)>>3;
						WORD c = CDirectDraw::Color(r, g, b);
						gpC_base->m_p_DDSurface_back->FillRect(&rect, c);
					}
				}
				if(m_sub_selected.x != -1)
				{
					gpC_global_resource->m_pC_scroll_bar_spk->Blt(m_sub_rect.x+COLOR_X+m_sub_selected.x*30, m_sub_rect.y+COLOR_Y+m_sub_selected.y*17, C_GLOBAL_RESOURCE::SB_BUTTON);
				}
			}			
		}
		else
			gpC_base->m_p_DDSurface_back->Unlock();
	}
	m_pC_scroll_bar->Show(x, y);
	
	// 이곳이 도움말 파일 불러오게 했던 부분. process 로 옮김 by  sonee
	
	// 타이머로 입력 글씨를 GRAY,RED 설정했던부분. process 로 옮김 by sonee
	
	// 타이머에 맞게 헬프 메시지 추가해주는 부분. process 로 옮김  by sonee
	
	
	if(!g_pUserOption->UseEnterChat || m_bl_input_mode)
	{
		// 걸려있는 스킬중에 뮤트 스킬이 있으면 말할 수 없다
		bool bFoundMute = false;
		S_SLOT::UI_EFFECTSTATUS_TYPE::iterator itr = g_char_slot_ingame.STATUS.begin();
		S_SLOT::UI_EFFECTSTATUS_TYPE::iterator endItr = g_char_slot_ingame.STATUS.end();
		while(itr != endItr)
		{
			if(itr->actionInfo == SKILL_MUTE)
			{
				bFoundMute = true;
				break;
			}
			itr++;
		}
		bool isGMchat = g_pPlayer->HasEffectStatus(EFFECTSTATUS_GHOST);

		if(bFoundMute && !g_pUserInformation->attrOperator.GetValue())
		{
			if(m_bl_whisper_mode)
				g_PrintColorStr(CHAT_LINE_START_X+115, CHAT_LINE_START_Y, (*g_pGameStringTable)[UI_STRING_MESSAGE_MUTE].GetString(), gpC_base->m_chatting_pi, RGB_RED);
			else
				g_PrintColorStr(CHAT_LINE_START_X+15, CHAT_LINE_START_Y, (*g_pGameStringTable)[UI_STRING_MESSAGE_MUTE].GetString(), gpC_base->m_chatting_pi, RGB_RED);
		}
		else
		if((m_timer == TIMER_REP || m_timer == TIMER_PAPERING )  && !isGMchat)
		{
			if(m_bl_whisper_mode)
				g_PrintColorStr(CHAT_LINE_START_X+115, CHAT_LINE_START_Y, (*g_pGameStringTable)[UI_STRING_MESSAGE_LIMIT_STRING_COUNT].GetString(), gpC_base->m_chatting_pi, RGB_RED);
			else
				g_PrintColorStr(CHAT_LINE_START_X+15, CHAT_LINE_START_Y, (*g_pGameStringTable)[UI_STRING_MESSAGE_LIMIT_STRING_COUNT].GetString(), gpC_base->m_chatting_pi, RGB_RED);
		}
		else
		{
			if(g_pUserOption->ChatWhite)
				m_lev_chatting.SetInputStringColor(gpC_base->m_chatting_pi.text_color);
			else
				if(!IsCannotSendChatInput())				// Chating Color Setting. Timer....(도배 및 존 채팅시 제외)
					m_lev_chatting.SetInputStringColor(g_pUserOption->ChattingColor);
			m_lev_chatting.Show();
		}
	}	
	g_FL2_GetDC();
	
//////////////////////////////////////////////////////////////////////////
//by chaya & diesirace
//////////////////////////////////////////////////////////////////////////
	int line = 0;

	for(int i = 0, scroll = 0;
		i < m_pC_history_list.Size() && line < g_HISTORY_LINE; /*++line,*/ ++i)
	{
		C_VS_UI_CHAT_LINE * p_line;	
		p_line = m_pC_history_list.GetLine(i);
		const int _ID_GAP = 2;

		if(p_line)
		{
			if(m_chat_filter[p_line->GetCondition()] == false)
			{
				/*--line;*/
				continue;
			}
			
			if (p_line->GetMsgString())
			{
				char *p_temp = (char *)p_line->GetMsgString();
				int	cut_length = 0;
				
				if(p_line->GetCondition() == CLD_ZONECHAT)
				{
					// 으아악~~!!! 하드코딩이다아아아!!!!
					// BOLD를 먹여보리면 한글이랑 영문이랑 글씨크기가 제멋대로자나-ㅅ-					
					char sz_temp[130];
					int smart_size = CHAT_WINDOW_WIDTH  - g_GetStringWidth(p_line->GetIdString(), gpC_base->m_user_id_pi.hfont) -g_GetStringWidth(g_sz_chat_id_divisor[p_line->GetCondition()], gpC_base->m_chatting_pi.hfont) -_ID_GAP;
					cut_length = strlen(p_temp);
					if(g_GetStringWidth(p_temp, gpC_base->m_user_id_pi.hfont) > smart_size)
					{
						strcpy(sz_temp, p_temp);
						while(g_GetStringWidth(sz_temp, gpC_base->m_user_id_pi.hfont) > smart_size)
						{
							sz_temp[cut_length--] = '\0';
						}
					}
				}
				else
				{
					cut_length  = 
						(CHAT_WINDOW_WIDTH - 
						g_GetStringWidth(p_line->GetIdString(), gpC_base->m_user_id_pi.hfont) -
						g_GetStringWidth(g_sz_chat_id_divisor[p_line->GetCondition()], gpC_base->m_chatting_pi.hfont) -
						_ID_GAP)/(g_GetStringWidth("F", gpC_base->m_chatting_pi.hfont));
				}

				int vx = CHAT_LINE_START_X;
				vx += g_GetStringWidth(p_line->GetIdString(), gpC_base->m_user_id_pi.hfont);
				vx += g_GetStringWidth(g_sz_chat_id_divisor[p_line->GetCondition()], gpC_base->m_chatting_pi.hfont);
				vx += _ID_GAP;

				std::vector<int> CutLenghtVec;

				int str_length = strlen(p_temp);
				int loopSum = cut_length;
				
				if(cut_length < str_length)
				{					
					for(;;)
					{					
						int len = cut_length;
						
						if(!g_PossibleStringCut(p_temp, loopSum))
						{
							--loopSum;
							--len;
						}
						
						CutLenghtVec.push_back(len);
						
						if(cut_length >= str_length - loopSum)
							break;
						
						loopSum += cut_length;
					}
					CutLenghtVec.push_back(str_length - loopSum);
				}
				else
				{
					CutLenghtVec.push_back(str_length);
				}

				int	loopCnt	= CutLenghtVec.size() - 1;
									
				const char* pDrawStr	= p_temp + str_length;

				for(;
					line < g_HISTORY_LINE && line >= 0 && loopCnt >= 0;
					--loopCnt, ++line)
				{
					PrintInfo* pi;

					if (p_line->GetCondition() == CLD_ZONECHAT)
						pi = &gpC_base->m_user_id_pi;
					else
						pi = &gpC_base->m_chatting_pi;


					if(scroll < m_pC_scroll_bar->GetScrollPos())
					{
						++scroll;
						--line;
						if(scroll <= m_pC_scroll_bar->GetScrollPos())
							continue;
					}

					int curr_length = CutLenghtVec[loopCnt];

					pDrawStr -= curr_length;

					if (loopCnt == 0 && p_line->GetIdString())
					{
						int tabvalue=0;
						if(strstr(p_line->GetIdString(), (*g_pGameStringTable)[UI_STRING_MESSAGE_MASTER_NAME].GetString()) != NULL)
							tabvalue=CLD_MASTER;
						else
							tabvalue=p_line->GetCondition();
						
						vx = g_PrintColorStr(CHAT_LINE_START_X, CHAT_HISTORY_START_Y-(FONT_GAP*line), p_line->GetIdString(), gpC_base->m_user_id_pi, m_color_tab[tabvalue]);
						vx = g_PrintColorStr(vx, CHAT_HISTORY_START_Y-(FONT_GAP*line), g_sz_chat_id_divisor[p_line->GetCondition()], gpC_base->m_chatting_pi, m_color_tab[tabvalue]);
						vx += _ID_GAP;
					}

					g_PrintColorStrLen(vx, CHAT_HISTORY_START_Y - (FONT_GAP * line),
						pDrawStr, curr_length, *pi, p_line->GetColor());
				}
			}
		}
	}

	if(gap)
	{
		m_pC_input_button_group->ShowDescription();
		m_pC_input_right_button_group->ShowDescription();
	}
	m_pC_button_group->ShowDescription();
	
	g_FL2_ReleaseDC();
	
	if(m_bl_whisper_mode && (!g_pUserOption->UseEnterChat || m_bl_input_mode))
	{
		if(m_bl_spreadID)
		{
			
			RECT rect = { CHAT_LINE_START_X+15, CHAT_LINE_START_Y - GetWhisperSize()*FONT_GAP -3, CHAT_LINE_START_X+85, CHAT_LINE_START_Y -3 };			
			DrawAlphaBox(&rect, 50>>3, 50>>3, 150>>3, 25);
			g_FL2_GetDC();
			for(int i = 0; i<GetWhisperSize(); i++)
			{
				g_PrintColorStr(CHAT_LINE_START_X+15, CHAT_LINE_START_Y - GetWhisperSize()*FONT_GAP + i*FONT_GAP, GetWhisperID(i).c_str(), gpC_base->m_user_id_pi, gpC_base->m_user_id_pi.text_color);
			}
			g_FL2_ReleaseDC();
			
			//			g_PrintColorStr(CHAT_LINE_START_X +90, CHAT_LINE_START_Y, "v", gpC_base->m_user_id_pi, gpC_base->m_user_id_pi.text_color);
		}// else g_PrintColorStr(CHAT_LINE_START_X +90, CHAT_LINE_START_Y, "^", gpC_base->m_user_id_pi, gpC_base->m_user_id_pi.text_color);
		
		if(m_bl_focus_whisper)
		{
			//if(m_sz_whisper_backup.size() > 0)     ###@@@
			if(!m_sz_whisper_backup.empty())
			{
				
				int len = m_sz_whisper_backup.size();
				int len2 = m_lev_chatting.ReachSizeOfBox()+1;
				
				HDC hdc;
				gpC_fl2_surface->GetDC(&hdc);
				DeleteObject( SelectObject(hdc, gpC_base->m_chatting_pi.hfont) );
				
				
				//
				// set format
				//
				SetBkMode(hdc, gpC_base->m_chatting_pi.bk_mode);
				SetTextColor(hdc, m_color_tab[CLD_NORMAL]);
				SetBkColor(hdc, gpC_base->m_chatting_pi.back_color);
				
				TextOut(hdc, CHAT_LINE_START_X +115, CHAT_LINE_START_Y, m_sz_whisper_backup.c_str(), min(len, len2));
				
				gpC_fl2_surface->ReleaseDC(hdc);
				
				//				g_PrintColorStr(CHAT_LINE_START_X +100, CHAT_LINE_START_Y, m_sz_whisper_backup.c_str(), gpC_base->m_chatting_pi, m_color_tab[CLD_NORMAL]);
			}
		}
		else
		{
			//if(m_sz_whisper_backup.size() > 0) ###@@@
			if(!m_sz_whisper_backup.empty())
				g_PrintColorStr(CHAT_LINE_START_X+15, CHAT_LINE_START_Y, m_sz_whisper_backup.c_str(), gpC_base->m_user_id_pi, gpC_base->m_user_id_pi.text_color);
		}
	}	
	
	//*
#ifndef _LIB
	//	if (gpC_base->m_p_DDSurface_back->Lock())
	//	{
	//		S_SURFACEINFO	surfaceinfo;
	//		SetSurfaceInfo(&surfaceinfo, gpC_base->m_p_DDSurface_back->GetDDSD());
	
	//		Rect rect;
	
	//rect.Set(CHAT_LINE_START_X, CHAT_LINE_START_Y, 100, 15);
	//rectangle(&surfaceinfo, &rect, WHITE);
	
	// -- TEST
	// show scroll button rect.
	//
	//rectangle(&surfaceinfo, SCROLL_UP_X, SCROLL_UP_Y, SCROLL_UP_X+SCROLL_W-1, SCROLL_UP_Y+SCROLL_H-1, 0xFFFF);
	//rectangle(&surfaceinfo, SCROLL_DOWN_X, SCROLL_DOWN_Y, SCROLL_DOWN_X+SCROLL_W-1, SCROLL_DOWN_Y+SCROLL_H-1, 0xFFFF);
	
	//rectangle(&surfaceinfo, SCROLLTAG_X, SCROLLTAG_Y, SCROLLTAG_X+SCROLLTAG_W-1, SCROLLTAG_Y+SCROLLTAG_H-1, 0xFFFF);
	
	//rectangle(&surfaceinfo, SCROLLTRACK_X, SCROLLTRACK_Y, SCROLLTRACK_X+SCROLLTRACK_W-1, SCROLLTRACK_Y+SCROLLTRACK_H-1, 0xFFFF);
	
	//		gpC_base->m_p_DDSurface_back->Unlock();
	//	}
	extern bool gbl_info_show;
	
	if(gbl_info_show)
	{
		char sz_buf[100];
		
		sprintf(sz_buf, "m_pC_history_list = %d", m_pC_history_list.Size());
		g_Print(5, TEXT_LINE(16), sz_buf);
		sprintf(sz_buf, "m_pC_history_temp_list = %d", m_pC_history_temp_list.Size());
		g_Print(5, TEXT_LINE(17), sz_buf);
		
		sprintf(sz_buf, "GetWhisperSize() = %d", GetWhisperSize());
		g_Print(5, TEXT_LINE(20), sz_buf);
		sprintf(sz_buf, "m_whisper_index = %d", m_whisper_index);
		g_Print(5, TEXT_LINE(21), sz_buf);
		sprintf(sz_buf, "g_HISTORYLINE = %d", g_HISTORY_LINE);
		g_Print(5, TEXT_LINE(22), sz_buf);
		
		
	}
#endif
	//*/
}

//-----------------------------------------------------------------------------
// C_VS_UI_CHATTING::ShowButtonDescription
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_CHATTING::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	static const char scancode_name[256][20] = 
	{
		"",						// 0x00
		"ESCAPE",				// 0x01
		"1",					// 0x02
		"2",					// 0x03
		"3",					// 0x04
		"4",					// 0x05
		"5",					// 0x06
		"6",					// 0x07
		"7",					// 0x08
		"8",					// 0x09
		"9",					// 0x0A
		"0",					// 0x0B
		"MINUS",				// 0x0C
		"EQUALS",				// 0x0D
		"BACK",					// 0x0E
		"TAB",					// 0x0F
		"Q",					// 0x10
		"W",					// 0x11
		"E",					// 0x12
		"R",					// 0x13
		"T",					// 0x14
		"Y",					// 0x15
		"U",					// 0x16
		"I",					// 0x17
		"O",					// 0x18
		"P",					// 0x19
		"LBRACKET",				// 0x1A
		"RBRACKET",				// 0x1B
		"RETURN",				// 0x1C
		"LCONTROL",				// 0x1D
		"A",					// 0x1E
		"S",					// 0x1F
		"D",					// 0x20
		"F",					// 0x21
		"G",					// 0x22
		"H",					// 0x23
		"J",					// 0x24
		"K",					// 0x25
		"L",					// 0x26
		":",					// 0x27
		"'",					// 0x28
		"~",					// 0x29
		"LSHIFT",				// 0x2A
		"BACKSLASH",			// 0x2B
		"Z",					// 0x2C
		"X",					// 0x2D
		"C",					// 0x2E
		"V",					// 0x2F
		"B",					// 0x30
		"N",					// 0x31
		"M",					// 0x32
		"COMMA",				// 0x33
		"PERIOD",				// 0x34
		"SLASH",				// 0x35
		"RSHIFT",				// 0x36
		"MULTIPLY",				// 0x37
		"LMENU",				// 0x38
		"SPACE",				// 0x39
		"CAPITAL",				// 0x3A
		"F1",					// 0x3B
		"F2",					// 0x3C
		"F3",					// 0x3D
		"F4",					// 0x3E
		"F5",					// 0x3F
		"F6",					// 0x40
		"F7",					// 0x41
		"F8",					// 0x42
		"F9",					// 0x43
		"F10",					// 0x44
		"NUMLOCK",				// 0x45
		"SCROLL",				// 0x46
		"NUMPAD7",				// 0x47
		"NUMPAD8",				// 0x48
		"NUMPAD9",				// 0x49
		"SUBTRACT",				// 0x4A
		"NUMPAD4",				// 0x4B
		"NUMPAD5",				// 0x4C
		"NUMPAD6",				// 0x4D
		"ADD",					// 0x4E
		"NUMPAD1",				// 0x4F
		"NUMPAD2",				// 0x50
		"NUMPAD3",				// 0x51
		"NUMPAD0",				// 0x52
		"DECIMAL",				// 0x53
		"",						// 0x54
		"",						// 0x55
		"",						// 0x56
		"F11",					// 0x57
		"F12",					// 0x58
		"",						// 0x59
		"",						// 0x5A
		"",						// 0x5B
		"",						// 0x5C
		"",						// 0x5D
		"",						// 0x5E
		"",						// 0x5F
		"",						// 0x60
		"",						// 0x61
		"",						// 0x62
		"",						// 0x63
		"F13",					// 0x64
		"F14",					// 0x65
		"F15",					// 0x66
		"",						// 0x67
		"",						// 0x68
		"",						// 0x69
		"",						// 0x6A
		"",						// 0x6B
		"",						// 0x6C
		"",						// 0x6D
		"",						// 0x6E
		"",						// 0x6F
		"KANA",					// 0x70
		"",						// 0x71
		"",						// 0x72
		"",						// 0x73
		"",						// 0x74
		"",						// 0x75
		"",						// 0x76
		"",						// 0x77
		"",						// 0x78
		"CONVERT",				// 0x79
		"",						// 0x7A
		"NOCONVERT",			// 0x7B
		"",						// 0x7C
		"YEN",					// 0x7D
		"",						// 0x7E
		"",						// 0x7F
		"",						// 0x80
		"",						// 0x81
		"",						// 0x82
		"",						// 0x83
		"",						// 0x84
		"",						// 0x85
		"",						// 0x86
		"",						// 0x87
		"",						// 0x88
		"",						// 0x89
		"",						// 0x8A
		"",						// 0x8B
		"",						// 0x8C
		"NUMPADEQUALS",			// 0x8D
		"",						// 0x8E
		"",						// 0x8F
		"CIRCUMFLEX",			// 0x90
		"AT",					// 0x91
		"COLON",				// 0x92
		"UNDERLINE",			// 0x93
		"KANJI",				// 0x94
		"STOP",					// 0x95
		"AX",					// 0x96
		"UNLABELED",			// 0x97
		"",						// 0x98
		"",						// 0x99
		"",						// 0x9A
		"",						// 0x9B
		"NUMPADENTER",			// 0x9C
		"RCONTROL",				// 0x9D
		"",						// 0x9E
		"",						// 0x9F
		"",						// 0xA0
		"",						// 0xA1
		"",						// 0xA2
		"",						// 0xA3
		"",						// 0xA4
		"",						// 0xA5
		"",						// 0xA6
		"",						// 0xA7
		"",						// 0xA8
		"",						// 0xA9
		"",						// 0xAA
		"",						// 0xAB
		"",						// 0xAC
		"",						// 0xAD
		"",						// 0xAE
		"",						// 0xAF
		"",						// 0xB0
		"",						// 0xB1
		"",						// 0xB2
		"NUMPADCOMMA",			// 0xB3
		"",						// 0xB4
		"DIVIDE",				// 0xB5
		"",						// 0xB6
		"SYSRQ",				// 0xB7
		"RMENU",				// 0xB8
		"",						// 0xB9
		"",						// 0xBA
		"",						// 0xBB
		"",						// 0xBC
		"",						// 0xBD
		"",						// 0xBE
		"",						// 0xBF
		"",						// 0xC0
		"",						// 0xC1
		"",						// 0xC2
		"",						// 0xC3
		"",						// 0xC4
		"PAUSE",				// 0xC5
		"",						// 0xC6
		"HOME",					// 0xC7
		"UP",					// 0xC8
		"PRIOR",				// 0xC9
		"",						// 0xCA
		"LEFT",					// 0xCB
		"",						// 0xCC
		"RIGHT",				// 0xCD
		"",						// 0xCE
		"END",					// 0xCF
		"DOWN",					// 0xD0
		"NEXT",					// 0xD1
		"INSERT",				// 0xD2
		"DELETE",				// 0xD3
		"",						// 0xD4
		"",						// 0xD5
		"",						// 0xD6
		"",						// 0xD7
		"",						// 0xD8
		"",						// 0xD9
		"",						// 0xDA
		"LWIN",					// 0xDB
		"RWIN",					// 0xDC
		"APPS",					// 0xDD
		"POWER",				// 0xDE
		"SLEEP",				// 0xDF
		"",						// 0xE0
		"",						// 0xE1
		"",						// 0xE2
		"",						// 0xE3
		"",						// 0xE4
		"",						// 0xE5
		"",						// 0xE6
		"",						// 0xE7
		"",						// 0xE8
		"",						// 0xE9
		"",						// 0xEA
		"",						// 0xEB
		"",						// 0xEC
		"",						// 0xED
		"",						// 0xEE
		"",						// 0xEF
		"",						// 0xF0
		"",						// 0xF1
		"",						// 0xF2
		"",						// 0xF3
		"",						// 0xF4
		"",						// 0xF5
		"",						// 0xF6
		"",						// 0xF7
		"",						// 0xF8
		"",						// 0xF9
		"",						// 0xFA
		"",						// 0xFB
		"",						// 0xFC
		"",						// 0xFD
		"",						// 0xFE
		"",						// 0xFF
	};
	// 주의 : 쩌~어기 밑에 ALPHA_ID,PUSHPIN_ID는 하드 코딩이라..중간에 추가 될땐 주의하길..by sobeit
	const static char* m_chatting_button_string[26] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_ON].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SPECIAL_CHARACTER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SET_LETTER_COLOR].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CHANGE_INPUT_LANGUAGE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_WHISPER_ID].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NORMAL_CHATING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ZONE_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_WHISPER_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_PARTY_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_UNION_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NORMAL_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ZONE_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_WHISPER_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_PARTY_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_TEAM_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_UNION_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_OFF].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_NORMAL_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_ZONE_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_WHISPER_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_PARTY_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_TEAM_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_UNION_CHATTING].GetString(),

	};
	
	const static char* m_vampire_chatting_button_string[26] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_ON].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SPECIAL_CHARACTER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SET_LETTER_COLOR].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CHANGE_INPUT_LANGUAGE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_WHISPER_ID].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NORMAL_CHATING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ZONE_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_WHISPER_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_PARTY_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_UNION_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NORMAL_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ZONE_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_WHISPER_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_PARTY_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_CLAN_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_UNION_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_OFF].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_NORMAL_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_ZONE_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_WHISPER_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_PARTY_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_CLAN_CHATTING].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_UNION_CHATTING].GetString(),
	};

	const static char* m_ousters_chatting_button_string[26] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_ON].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SPECIAL_CHARACTER].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SET_LETTER_COLOR].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_CHANGE_INPUT_LANGUAGE].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_WHISPER_ID].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_NORMAL_CHATING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_ZONE_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_WHISPER_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_PARTY_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_UNION_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NORMAL_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ZONE_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_WHISPER_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_PARTY_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_GUILD_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_UNION_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_OFF].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_NORMAL_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_ZONE_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_WHISPER_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_PARTY_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_GUILD_CHATTING].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_SHOW_UNION_CHATTING].GetString(),
	};
	
	static char string[50];

	// 귓속말 아이디 대상 버튼.
	if(p_button->GetID() == 5)
	{
		if(!m_bl_whisper_mode) return;
	}
	
	if(p_button->GetID() == ALPHA_ID)
	{
		if(GetAttributes()->alpha)
			g_descriptor_manager.Set(DID_INFO, x+w-p_button->x-p_button->w, y+h-p_button->y-p_button->h, (void *)m_chatting_button_string[18],0,0);
		else
			g_descriptor_manager.Set(DID_INFO, x+w-p_button->x-p_button->w, y+h-p_button->y-p_button->h, (void *)m_chatting_button_string[p_button->GetID()],0,0);
	}
	else if(p_button->GetID() == PUSHPIN_ID)
	{
		if(GetAttributes()->autohide)
			g_descriptor_manager.Set(DID_INFO, x+w-p_button->x-p_button->w, y+h-p_button->y-p_button->h, (void *)m_chatting_button_string[19],0,0);
		else
			g_descriptor_manager.Set(DID_INFO, x+w-p_button->x-p_button->w, y+h-p_button->y-p_button->h, (void *)m_chatting_button_string[p_button->GetID()],0,0);
	}
	else if(p_button->GetID() >= FILTER_NORMAL_ID && p_button->GetID() <= FILTER_UNION_ID && m_chat_filter[p_button->GetID() -FILTER_NORMAL_ID] == true)
	{
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)m_chatting_button_string[p_button->GetID()+8],0,0);
			break;
			
		case RACE_VAMPIRE:
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)m_vampire_chatting_button_string[p_button->GetID()+8],0,0);
			break;
			
		case RACE_OUSTERS:
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)m_ousters_chatting_button_string[p_button->GetID()+8],0,0);
			break;
		}
	}
	else
	{
 //*단축키 변경함에 따라 단축키가 없어지고 토글이 생김 게임내  마우스 올렸을때 나오는  단축키 표시 없어짐 이하 뱀파 아우 동일
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			switch(p_button->GetID())
			{
			case CHAT_NORMAL_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_NORMALCHAT))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_GUILD_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_GUILD))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_ZONE_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_ZONECHAT))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_WHISPER_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_WHISPER))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_PARTY_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_PARTYCHAT))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
	/*		case MARK_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_MARK))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;*/
			case CHAT_UNION_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_UNION))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			default:
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)m_chatting_button_string[p_button->GetID()],0,0);
				break;
			}
			break;
			
		case RACE_VAMPIRE:
			switch(p_button->GetID())
			{
			case CHAT_NORMAL_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_vampire_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_NORMALCHAT))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_GUILD_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_vampire_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_GUILD))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_ZONE_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_vampire_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_ZONECHAT))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_WHISPER_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_vampire_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_WHISPER))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_PARTY_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_vampire_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_PARTYCHAT))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			/*case MARK_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_vampire_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_MARK))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;*/
			case CHAT_UNION_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_vampire_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_UNION))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			default:
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)m_vampire_chatting_button_string[p_button->GetID()],0,0);
				break;
			}
			break;
			
		case RACE_OUSTERS:
			switch(p_button->GetID())
			{
			case CHAT_NORMAL_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_ousters_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_NORMALCHAT))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_GUILD_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_ousters_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_GUILD))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_ZONE_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_ousters_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_ZONECHAT))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_WHISPER_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_ousters_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_WHISPER))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			case CHAT_PARTY_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_ousters_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_PARTYCHAT))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
//			case MARK_ID:
//				wsprintf(string,"%s(Ctrl+%s)",(void *)m_ousters_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_MARK))]);
//				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
//				break;
			case CHAT_UNION_ID:
				wsprintf(string,"%s(Ctrl+%s)",(void *)m_ousters_chatting_button_string[p_button->GetID()],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_UNION))]);
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)string,0,0);
				break;
			default:
				g_descriptor_manager.Set(DID_INFO, p_button->x+x, y+h-p_button->y-p_button->h, (void *)m_ousters_chatting_button_string[p_button->GetID()],0,0);
				break;
			}
			break;
		}//*/

	}	
}

//-----------------------------------------------------------------------------
// C_VS_UI_CHATTING::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_CHATTING::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(p_button->GetID() == ALPHA_ID)
	{
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+w-p_button->x-p_button->w, y+h-p_button->y-p_button->h, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+w-p_button->x-p_button->w, y+h-p_button->y-p_button->h, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED_OLD);
	#else
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+w-p_button->x-p_button->w, y+h-p_button->y-p_button->h, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+w-p_button->x-p_button->w, y+h-p_button->y-p_button->h, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED);
	#endif //__080405_FIREST_UI_UPDATE
	}
	else if(p_button->GetID() == PUSHPIN_ID)
	{
		if(GetAttributes()->autohide)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+w-p_button->x-p_button->w, y+h-p_button->y-p_button->h, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+w-p_button->x-p_button->w, y+h-p_button->y-p_button->h, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN_PUSHED);
	}
	else if(p_button->GetID() == LANGUAGE_ID)
	{
		int image = BUTTON_ENG;
		if (gC_ci->IsEngInput())
			image = BUTTON_ENG;
		else
		{
#if __CONTENTS(__LANGUAGE_CHANGE)
			image = BUTTON_HAN;
#endif //end __LANGUAGE_CHANGE
		}
#if __CONTENTS(__LANGUAGE_CHANGE)
		if(p_button->GetFocusState())
		{

			if(p_button->GetPressState())
				m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, image+2);
			else
				m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, image+1);
		}
		else
#endif //end __LANGUAGE_CHANGE
			m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, image);
	}
	else if(p_button->GetID() == MARK_ID || p_button->GetID() == COLOR_ID || p_button->GetID() == SPREAD_ID)
	{
		if(p_button->GetID() == SPREAD_ID && !m_bl_whisper_mode)
			return;
		
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index+2);
			else
				m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index+1);
		}
		else
			m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index);
	}
	else if(p_button->GetID() >= CHAT_NORMAL_ID && p_button->GetID() <= CHAT_UNION_ID)
	{
		if(p_button->GetID()-CHAT_NORMAL_ID == m_chat_mode || p_button->GetID() == CHAT_WHISPER_ID && m_bl_whisper_mode)
		{
			if(p_button->GetPressState())
				m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index+3);
			else
				m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index+3);
		}
		else
			if(p_button->GetFocusState())
			{
				if(p_button->GetPressState())
					m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index+2);
				else
					m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index+1);
			}
			else
				m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index);
	}
	else if(p_button->GetID() >= FILTER_NORMAL_ID && p_button->GetID() <= FILTER_UNION_ID)
	{
		if(m_chat_filter[p_button->GetID()-FILTER_NORMAL_ID])
		{
			if(p_button->GetPressState())
				m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h+1, p_button->m_image_index+2);
			else
				m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index+2);
		}
		else
			if(p_button->GetFocusState())
			{
				if(p_button->GetPressState())
					m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h+1, p_button->m_image_index+1);
				else
					m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index+1);
			}
			else
				m_pC_chatting_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index);
	}		
}

void C_VS_UI_CHATTING::Extend()
{
	Rect temp_rect(x, y, w, h);
	Set(m_backup_rect.x, m_backup_rect.y, m_backup_rect.w, m_backup_rect.h);
	m_backup_rect = temp_rect;
	WindowEventReceiver(EVENT_WINDOW_MOVE);

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		PlaySound(SOUND_SLAYER_BUTTON);
		break;
		
	case RACE_VAMPIRE:
		PlaySound(SOUND_VAMPIRE_BUTTON);
		break;
		
	case RACE_OUSTERS:
		PlaySound(SOUND_OUSTERS_INTERFACE);
		break;
	}
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_CHATTING::WindowEventReceiver(id_t event)
{
	int old_w = w, old_h = h;
	int w_max, h_max;
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		w_max = 576;
		h_max = 119;
		break;

	case RACE_VAMPIRE:
		w_max = 576;
		h_max = 125;
		break;
		
	case RACE_OUSTERS:
		w_max = 576;
		h_max = 125;
		break;
	}	

	switch(event)
	{
	case EVENT_WINDOW_MOVE: 
		if(Moving()) //&& (!m_bl_input_mode && m_lev_chatting.Size() == 0) && !GetAttributes()->autohide)
		{
			switch(m_resize)
			{
			case RESIZE_TOP:
				y = max(0, y);
				h += m_backup_window_point.y-y;
				h = max(h_max, min(h, g_pUserInformation->iResolution_y));
				//h = max(h_max, min(h, RESOLUTION_Y));
				if(h != old_h)
					m_backup_window_point.y += old_h-h;
				y = m_backup_window_point.y;
				x = m_backup_window_point.x;
				break;
				
			case RESIZE_BOTTOM:
				h += y - m_backup_window_point.y;
				x = m_backup_window_point.x;
				y = m_backup_window_point.y;
				//h = max(h_max, min(h, RESOLUTION_Y));
				h = max(h_max, min(h, g_pUserInformation->iResolution_y));
				if(old_h != h)
					SetOrigin(gpC_mouse_pointer->GetX()-x, gpC_mouse_pointer->GetY()-y);
				break;
				
			case RESIZE_LEFT:
				x = max(0, x);
				w += m_backup_window_point.x - x;
				//w = max(w_max, min(w, RESOLUTION_X));
				w = max(w_max, min(w, g_pUserInformation->iResolution_x));
				if(w != old_w)
					m_backup_window_point.x += old_w-w;
				y = m_backup_window_point.y;
				x = m_backup_window_point.x;
				break;
				
			case RESIZE_RIGHT:
				w += x - m_backup_window_point.x;
				x = m_backup_window_point.x;
				y = m_backup_window_point.y;
				//w = max(w_max, min(w, RESOLUTION_X));
				w = max(w_max, min(w, g_pUserInformation->iResolution_x));
				if(old_w != w)
					SetOrigin(gpC_mouse_pointer->GetX()-x, gpC_mouse_pointer->GetY()-y);
				break;
				
			case RESIZE_LEFTTOP:
				x = max(0, x);
				y = max(0, y);
				h += m_backup_window_point.y - y;
				//h = max(h_max, min(h, RESOLUTION_Y));
				h = max(h_max, min(h, g_pUserInformation->iResolution_y));
				if(h != old_h)
					m_backup_window_point.y += old_h-h;
				w += m_backup_window_point.x - x;
				//w = max(w_max, min(w, RESOLUTION_X));
				w = max(w_max, min(w, g_pUserInformation->iResolution_x));
				if(w != old_w)
					m_backup_window_point.x += old_w-w;
				y = m_backup_window_point.y;
				x = m_backup_window_point.x;
				break;
				
			case RESIZE_RIGHTTOP:
				w += x - m_backup_window_point.x;
				x = m_backup_window_point.x;
				//w = max(w_max, min(w, RESOLUTION_X));
				w = max(w_max, min(w, g_pUserInformation->iResolution_x));
				if(old_w != w)
					SetOrigin(gpC_mouse_pointer->GetX()-x, gpC_mouse_pointer->GetY()-y);
				y = max(0, y);
				h += m_backup_window_point.y - y;
				//h = max(h_max, min(h, RESOLUTION_Y));
				h = max(h_max, min(h, g_pUserInformation->iResolution_y));
				if(h != old_h)
					m_backup_window_point.y += old_h-h;
				y = m_backup_window_point.y;
				break;
				
			case RESIZE_LEFTBOTTOM:
				h += y - m_backup_window_point.y;
				y = m_backup_window_point.y;
				//h = max(h_max, min(h, RESOLUTION_Y));
				h = max(h_max, min(h, g_pUserInformation->iResolution_y));
				if(old_h != h)
					SetOrigin(gpC_mouse_pointer->GetX()-x, gpC_mouse_pointer->GetY()-y);
				x = max(0, x);
				w += m_backup_window_point.x - x;
				//w = max(w_max, min(w, RESOLUTION_X));
				w = max(w_max, min(w, g_pUserInformation->iResolution_x));
				if(w != old_w)
					m_backup_window_point.x += old_w-w;
				x = m_backup_window_point.x;
				break;
				
			case RESIZE_RIGHTBOTTOM:
				y = max(0, y);
				x = max(0, x);
				w += m_backup_window_point.x - x;
				//w = max(w_max, min(w, RESOLUTION_X));
				w = max(w_max, min(w, g_pUserInformation->iResolution_x));
				if(w != old_w)
					m_backup_window_point.x += old_w-w;
				h += m_backup_window_point.y - y;
				//h = max(h_max, min(h, RESOLUTION_Y));
				h = max(h_max, min(h, g_pUserInformation->iResolution_y));
				if(h != old_h)
					m_backup_window_point.y += old_h-h;
				y = m_backup_window_point.y;
				x = m_backup_window_point.x;
				break;
			}
		}

		CHAT_LINE_START_X = x+40;
		CHAT_LINE_START_Y = y+h-FONT_GAP-3;
		CHAT_WINDOW_WIDTH = w-70;
		CHAT_INPUT_WIDTH = w-110;
		CHAT_HISTORY_START_Y = y+h-FONT_GAP-4-20;

		switch(g_eRaceInterface) // chatting history line
		{
		case RACE_SLAYER:
			g_HISTORY_LINE = (h-14-20)/FONT_GAP;
			break;

		case RACE_VAMPIRE:
			g_HISTORY_LINE = (h-20-20)/FONT_GAP;
			break;

		case RACE_OUSTERS:
			g_HISTORY_LINE = (h-20-20)/FONT_GAP;
			break;			
		}		
		
		if(m_bl_whisper_mode)
		{
			if(m_bl_focus_whisper)
			{
				m_lev_chatting.SetPosition(CHAT_LINE_START_X+15, CHAT_LINE_START_Y);
				m_lev_chatting.SetByteLimit(10);
			}
			else
			{
				m_lev_chatting.SetPosition(CHAT_LINE_START_X +115, CHAT_LINE_START_Y);
				m_lev_chatting.SetAbsWidth(CHAT_INPUT_WIDTH-100);
			}
		}
		else
		{
			IWin32Edite* pWin32Edite = gC_vs_ui.GetWin32Edite();
			if ( pWin32Edite )
				pWin32Edite->SetPos(CHAT_LINE_START_X +15-9, CHAT_LINE_START_Y-5);

			m_lev_chatting.SetPosition(CHAT_LINE_START_X +15, CHAT_LINE_START_Y);
			m_lev_chatting.SetAbsWidth(CHAT_INPUT_WIDTH);
		}
		ResetScroll();
		//			SlayerWhisperMode(m_bl_whisper_mode);
		break;
	}
}


//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_CHATTING::Run(id_t id)
{
	IWin32Edite* pWin32Edite = NULL;

	switch (id)
	{
	case ALPHA_ID:
		AttrAlpha(!GetAttributes()->alpha);
		EMPTY_MOVE;
		break;
		
	case PUSHPIN_ID:
		if(GetAttributes()->autohide)
			AttrAutoHide(ATTRIBUTES_HIDE_NOT);
		else
			AttrAutoHide(ATTRIBUTES_HIDE_HEIGHT);
		EMPTY_MOVE;
		break;
		
	case SPREAD_ID:
		m_bl_spreadID = !m_bl_spreadID;
		break;
		
	case CHAT_WHISPER_ID:
		SlayerWhisperMode(!m_bl_whisper_mode);
		m_chat_mode = (CHAT_LINE_CONDITION)(id-CHAT_NORMAL_ID);

		if(!m_bl_whisper_mode)
		{
			m_chat_mode =  m_befor_chat_mode;
			pWin32Edite = gC_vs_ui.GetWin32Edite();
			if ( pWin32Edite )
				pWin32Edite->SetChatMode(m_chat_mode);
		}
		break;
		
	case CHAT_NORMAL_ID:
	case CHAT_ZONE_ID:
	case CHAT_PARTY_ID:
	case CHAT_GUILD_ID:
	case CHAT_UNION_ID:
		m_chat_mode = (CHAT_LINE_CONDITION)(id-CHAT_NORMAL_ID);

		pWin32Edite = gC_vs_ui.GetWin32Edite();
		if ( pWin32Edite )
			pWin32Edite->SetChatMode(m_chat_mode);
		SlayerWhisperMode(false);
		break;
		
	case FILTER_NORMAL_ID:
	case FILTER_WHISPER_ID:
	case FILTER_ZONE_ID:
	case FILTER_PARTY_ID:
	case FILTER_GUILD_ID:
	case FILTER_UNION_ID:
		m_chat_filter[id-FILTER_NORMAL_ID] = !m_chat_filter[id-FILTER_NORMAL_ID];
		ResetScroll();
		break;
		
	case MARK_ID:
		if(m_sub_window == 0)
			m_sub_window = 1;
		else
			m_sub_window = 0;
		break;
		
	case COLOR_ID:
		if(m_sub_window == 0)
			m_sub_window = 2;
		else
			m_sub_window = 0;
		break;
		
	case LANGUAGE_ID:
#if __CONTENTS(__LANGUAGE_CHANGE)
		gC_ci->SetEngInput(gC_ci->IsEngInput());
#endif	// end __LANGUAGE_CHANGE
		break;
	}
}

//-----------------------------------------------------------------------------
// Process
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_CHATTING::Process()
{
	if(m_v_help_check.empty())
	{
		// 도움말용 파일 읽기
#define dSTRING_LEN 2048 
		
		char szLine[dSTRING_LEN]; 
		
		CRarFile pack_file;
		pack_file.SetRAR(RPK_HELP, RPK_PASSWORD);
		
		bool re = pack_file.Open("commoningame.txt");
		//		assert(re);
		
		while(pack_file.GetString(szLine, dSTRING_LEN))
		{
			if(strlen(szLine) == 0)
				continue;
			
			m_v_help_string.push_back(szLine);
			m_v_help_check.push_back(false);
			//			ZeroMemory(szLine, dSTRING_LEN);
		}
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			re = pack_file.Open("slayeringame.txt");
			break;

		case RACE_VAMPIRE:
			re = pack_file.Open("vampireingame.txt");
			break;

		case RACE_OUSTERS:
			re = pack_file.Open("oustersingame.txt");
			break;			
		}
		
		while(pack_file.GetString(szLine, dSTRING_LEN))
		{
			if(strlen(szLine) == 0)
				continue;
			
			m_v_help_string.push_back(szLine);
			m_v_help_check.push_back(false);
			//			ZeroMemory(szLine, dSTRING_LEN);
		}		
		pack_file.Release();		
		srand(time(0));
	}
	
	if(IsCannotSendChatInput())
	{
		SetInputStringColor(RGB_RED);
	}
	else
	{
		SetInputStringColor(RGB_GRAY);
	}
	
	
	m_pC_button_group->Process();
	m_pC_input_button_group->Process();
	m_pC_input_right_button_group->Process();
	
	m_backup_window_point.x = x;
	m_backup_window_point.y = y;
	
	bool bl_hide = false;
	if(!(!m_bl_input_mode && m_lev_chatting.Size() == 0 && TimerHide() == false) && GetAttributes()->autohide)
	{
		AttrAutoHide(ATTRIBUTES_HIDE_NOT);
		bl_hide = true;
	}
	
	bool bl_alpha = GetAttributes()->alpha;
	if(bl_alpha)
	{
		AttrAlpha(false);
	}
	ProcessHide(0, bl_alpha);
	if(bl_alpha)
	{
		AttrAlpha(true);
	}
	
	if(bl_hide)
		AttrAutoHide(ATTRIBUTES_HIDE_HEIGHT);
	
	if(TimerHelp() && !m_v_help_check.empty() && g_pUserOption->ShowChoboHelp)
	{
		
		static int CheckNum = 0;
		if(CheckNum == 0)
		{
			for(int i = 0; i < m_v_help_check.size(); i++)
				m_v_help_check[i] = false;
			CheckNum = m_v_help_check.size();
		}
		int num = 0;
		if(CheckNum > 0) num = rand()%CheckNum;
		for(int i = 0; i <= num; i++)
		{
			if(m_v_help_check[i] == true)num++;//break;
		}
		//		m_v_help_check[i] = true;
		if(num < m_v_help_check.size())
		{
			
			m_v_help_check[num] = true;
			CheckNum--;
			
			AddChatToHistory(m_v_help_string[num].c_str(), (*g_pGameStringTable)[UI_STRING_MESSAGE_HELP_MESSAGE].GetString(), CLD_INFO, m_color_tab[CLD_INFO]);
		}
	}
}

/*-----------------------------------------------------------------------------
- C_VS_UI_CHATTING
- Constructor.

  chatting object start.
-----------------------------------------------------------------------------*/
C_VS_UI_CHATTING::C_VS_UI_CHATTING()
{
	
	AttrPin(true);
	
	g_RegisterWindow(this);

	m_pC_chatting_spk = NULL;
	
	m_pC_scroll_bar = new C_VS_UI_SCROLL_BAR;
	m_pC_scroll_bar->SetReverse(true);
	
	m_pC_sub_scroll_bar = new C_VS_UI_SCROLL_BAR(0, Rect(135, 35, -1, 30));
	int localLine = MARK_MAX - 4;
#if __CONTENTS(__JAPAN_UI)
	localLine = 0;
#endif //__JAPAN_UI
	m_pC_sub_scroll_bar->SetPosMax(localLine);
	m_pC_sub_scroll_bar->SetScrollPos(0);
	
	TribeChanged();
	
	m_pC_button_group = new ButtonGroup(this);
	m_pC_input_button_group = new ButtonGroup(this);
	m_pC_input_right_button_group = new ButtonGroup(this);
	
	m_sub_window = 0;
	m_sub_rect.Set(0, 0, 160, 100);
	m_sub_selected.x = -1;
	
	// alpha & pushpin button
	int alpha_button_offset_x, alpha_button_offset_y;
	int pushpin_button_offset_x, pushpin_button_offset_y;
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		alpha_button_offset_x = 8; alpha_button_offset_y = 7;
		pushpin_button_offset_x = 26; pushpin_button_offset_y = 7;
		break;

	case RACE_VAMPIRE:
		alpha_button_offset_x = 8; alpha_button_offset_y = 6;
		pushpin_button_offset_x = 24; pushpin_button_offset_y = 6;
		break;

	case RACE_OUSTERS:
		alpha_button_offset_x = 8; alpha_button_offset_y = 6;
		pushpin_button_offset_x = 24; pushpin_button_offset_y = 6;
		break;
	}	

#if __CONTENTS(__080405_FIREST_UI_UPDATE)
	m_pC_input_right_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_button_offset_x, alpha_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD));
#else
	m_pC_input_right_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_button_offset_x, alpha_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA));
#endif //__080405_FIREST_UI_UPDATE

	m_pC_input_right_button_group->Add(new C_VS_UI_EVENT_BUTTON(pushpin_button_offset_x, pushpin_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), PUSHPIN_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN));
	
	// chat buttons
	int chat_button_offset_x = 7, chat_button_offset_y = 30, chat_button_gap = 12;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_UNION), m_pC_chatting_spk->GetHeight(BUTTON_UNION), CHAT_UNION_ID, this, BUTTON_UNION));
	chat_button_offset_y += chat_button_gap;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_GUILD), m_pC_chatting_spk->GetHeight(BUTTON_GUILD), CHAT_GUILD_ID, this, BUTTON_GUILD));
	chat_button_offset_y += chat_button_gap;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_PARTY), m_pC_chatting_spk->GetHeight(BUTTON_PARTY), CHAT_PARTY_ID, this, BUTTON_PARTY));
	chat_button_offset_y += chat_button_gap;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_WHISPER), m_pC_chatting_spk->GetHeight(BUTTON_WHISPER), CHAT_WHISPER_ID, this, BUTTON_WHISPER));
	chat_button_offset_y += chat_button_gap;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_ZONE), m_pC_chatting_spk->GetHeight(BUTTON_ZONE), CHAT_ZONE_ID, this, BUTTON_ZONE));
	chat_button_offset_y += chat_button_gap;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_NORMAL), m_pC_chatting_spk->GetHeight(BUTTON_NORMAL), CHAT_NORMAL_ID, this, BUTTON_NORMAL));
	
	// filter buttons
	chat_button_offset_x += 13; chat_button_offset_y = 31;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_FILTER), m_pC_chatting_spk->GetHeight(BUTTON_FILTER), FILTER_UNION_ID, this, BUTTON_FILTER));
	chat_button_offset_y += chat_button_gap;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_FILTER), m_pC_chatting_spk->GetHeight(BUTTON_FILTER), FILTER_GUILD_ID, this, BUTTON_FILTER));
	chat_button_offset_y += chat_button_gap;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_FILTER), m_pC_chatting_spk->GetHeight(BUTTON_FILTER), FILTER_PARTY_ID, this, BUTTON_FILTER));
	chat_button_offset_y += chat_button_gap;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_FILTER), m_pC_chatting_spk->GetHeight(BUTTON_FILTER), FILTER_WHISPER_ID, this, BUTTON_FILTER));
	chat_button_offset_y += chat_button_gap;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_FILTER), m_pC_chatting_spk->GetHeight(BUTTON_FILTER), FILTER_ZONE_ID, this, BUTTON_FILTER));
	chat_button_offset_y += chat_button_gap;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(chat_button_offset_x, chat_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_FILTER), m_pC_chatting_spk->GetHeight(BUTTON_FILTER), FILTER_NORMAL_ID, this, BUTTON_FILTER));
	
	// input buttons
	int input_button_offset_x = 4, input_button_offset_y = 7, input_button_gap = 15;
	m_pC_input_button_group->Add(new C_VS_UI_EVENT_BUTTON(input_button_offset_x, input_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_MARK), m_pC_chatting_spk->GetHeight(BUTTON_MARK), MARK_ID, this, BUTTON_MARK));
	input_button_offset_x += input_button_gap;
	m_pC_input_button_group->Add(new C_VS_UI_EVENT_BUTTON(input_button_offset_x, input_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_COLOR), m_pC_chatting_spk->GetHeight(BUTTON_COLOR), COLOR_ID, this, BUTTON_COLOR));
	input_button_offset_x += input_button_gap;
	m_pC_input_button_group->Add(new C_VS_UI_EVENT_BUTTON(input_button_offset_x, input_button_offset_y, m_pC_chatting_spk->GetWidth(BUTTON_ENG), m_pC_chatting_spk->GetHeight(BUTTON_ENG), LANGUAGE_ID, this, BUTTON_HAN));

	// Spread button
	m_pC_input_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+131, 4, m_pC_chatting_spk->GetWidth(BUTTON_SPREAD), m_pC_chatting_spk->GetHeight(BUTTON_SPREAD), SPREAD_ID, this, BUTTON_SPREAD));
	
	CancelPushState();
	UnacquireMouseFocus();
	
	scroll_up_x = scroll_up_y = scroll_down_x = scroll_down_y = scrolltag_x = scrolltag_y = scrolltrack_x = scrolltrack_y = 0;
	
	//m_lev_chatting.SetInputCharCount(CHAT_INPUT_LIMIT);
	m_lev_chatting.SetPrintInfo(gpC_base->m_chatting_pi);
	m_lev_chatting.SetCursorColor(RGB_WHITE);//RGB(128, 128, 128));
	m_lev_chatting.SetAbsWidth(563);
	m_lev_chatting.SetByteLimit(100);
	
	if(g_pUserOption->ChatWhite)
		m_lev_chatting.SetInputStringColor(gpC_base->m_chatting_pi.text_color);
	else
		m_lev_chatting.SetInputStringColor(g_pUserOption->ChattingColor);
	
	m_bl_focus_whisper = false;	// by larosel
	m_bl_whisper_mode = false;	// by larosel
	m_whisper_index = -1;		// by larosel
	
	//	m_bl_guild = false;		// 길드 채팅 by larosel
	m_bl_spreadID = false;
	
	m_history_line = 0;
	
	//timer
	m_dw_zonechat_timer = 15000;
	m_dw_rep_timer = 20000;
	m_dw_papering_timer = 20000;
	m_dw_help_timer = 60000;
	m_dw_hide_timer = 5000;
	
	m_timer = TIMER_NONE;
	
	m_dw_help_prev_tickcount = GetTickCount()-m_dw_help_timer;
	
	m_resize = RESIZE_NOT;
	
	m_bl_input_mode = false;
	
	for(int i = 0; i < CLD_TOTAL; i++)
		m_chat_filter[i] = true;
	
	m_chat_mode = CLD_NORMAL;	
}

/*-----------------------------------------------------------------------------
- ~C_VS_UI_CHATTING
- Destructor.

  chatting object end.
-----------------------------------------------------------------------------*/
C_VS_UI_CHATTING::~C_VS_UI_CHATTING()
{
	
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::CHATTING, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::CHATTING, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::CHATTING, Rect(x, y, w, h));
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::CHATTING_OLD, m_backup_rect);
	
	
	g_UnregisterWindow(this);
	DeleteNew(m_pC_scroll_bar);
	DeleteNew(m_pC_sub_scroll_bar);
	DeleteNew(m_pC_chatting_spk);
	DeleteNew(m_pC_button_group);
	DeleteNew(m_pC_input_button_group);
	DeleteNew(m_pC_input_right_button_group);
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_CHATTING::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	
	bool re = false;
	if(IsSpreadID())
	{
		if(_x > CHAT_LINE_START_X && _y > CHAT_LINE_START_Y - GetWhisperSize()*FONT_GAP -3 && _x < CHAT_LINE_START_X+70 && _y < CHAT_LINE_START_Y -3 )
			re = true;
	}
	if(re == false && GetAttributes()->alpha)
	{
		RECT alpha_rect;
		int gap = 0;
		if(!g_pUserOption->UseEnterChat || m_bl_input_mode == true)
			gap = m_pC_chatting_spk->GetHeight(INPUT_RIGHT);
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			SetRect( &alpha_rect, x+35, y+5, x+w-26, y+h-5-gap );
			break;

		case RACE_VAMPIRE:
			SetRect( &alpha_rect, x+30, y+10, x+w-33, y+h-5-gap );
			break;
			
		case RACE_OUSTERS:
			SetRect( &alpha_rect, x+30, y+10, x+w-33, y+h-5-gap );
			break;			
		}		
		
		if( _x >= alpha_rect.left && _x <= alpha_rect.right &&
			_y >= alpha_rect.top && _y <= alpha_rect.bottom )
			return false;
	}
	
	if(re == false)
		re = IsInRect(_x, _y);
	if(re == false && m_sub_window != 0)
		re = m_sub_rect.IsInRect(_x, _y);
	
	return re;
}


//-----------------------------------------------------------------------------
// C_VS_UI_CHATTING::TribeChanged
//
// 종족이 바뀌었을 때 실행할것.
//-----------------------------------------------------------------------------
void	C_VS_UI_CHATTING::TribeChanged()
{
	if(m_pC_chatting_spk != NULL)
	{
		DeleteNew(m_pC_chatting_spk);
		m_pC_chatting_spk = NULL;
	}
	
	m_v_help_check.clear();
	m_v_help_string.clear();
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_pC_chatting_spk = new C_SPRITE_PACK(SPK_CHATTING_SLAYER);
		//Set(0, RESOLUTION_Y - 119, 623, 119);
		Set(0, g_pUserInformation->iResolution_y - 119, 623, 119);
		//m_backup_rect.Set(0, RESOLUTION_Y - 119-100, 623, 119+100);				
		m_backup_rect.Set(0, g_pUserInformation->iResolution_y - 119-100, 623, 119+100);				
		gpC_base->m_user_id_pi.text_color = SLAYER_FONT_COLOR;
		gpC_base->m_chatting_pi.text_color = SLAYER_FONT_COLOR;
		m_color_tab[CLD_NORMAL] = SLAYER_FONT_COLOR;
		m_color_tab[CLD_GUILD] = RGB(180, 230, 180);
		m_color_tab[CLD_UNION] = RGB(180, 230, 180);
		m_color_tab[CLD_PARTY] = RGB(230, 180, 230);
		m_color_tab[CLD_ZONECHAT] = SLAYER_FONT_COLOR;
		m_color_tab[CLD_WHISPER] = RGB(65, 206, 81);//RGB_BLUE;	// by larosel
		m_color_tab[CLD_INFO] = RGB(130, 230, 230);
		m_color_tab[CLD_GRADEDISPLAY] = RGB(255, 255 ,0);
		m_color_tab[CLD_MASTER] = RGB(255,180, 180);
		m_sub_window = 0;
		m_sub_rect.Set(0, 0, 160, 100);
		m_sub_selected.x = -1;
		m_pC_sub_scroll_bar->x = 135;
		m_pC_sub_scroll_bar->y = 35;
		break;

	case RACE_VAMPIRE:
		m_pC_chatting_spk = new C_SPRITE_PACK(SPK_CHATTING_VAMPIRE);
		//Set(0, RESOLUTION_Y - 125, 624, 125);
		Set(0, g_pUserInformation->iResolution_y - 125, 624, 125);
		//m_backup_rect.Set(0, RESOLUTION_Y - 125-100, 624, 125+100);
		m_backup_rect.Set(0, g_pUserInformation->iResolution_y - 125-100, 624, 125+100);
		gpC_base->m_user_id_pi.text_color = VAMPIRE_FONT_COLOR;
		gpC_base->m_chatting_pi.text_color = VAMPIRE_FONT_COLOR;
		m_color_tab[CLD_NORMAL] = VAMPIRE_FONT_COLOR;
		m_color_tab[CLD_GUILD] = RGB(180, 230, 230);
		m_color_tab[CLD_UNION] = RGB(180, 230, 230);
		m_color_tab[CLD_PARTY] = RGB(230, 180, 230);
		m_color_tab[CLD_ZONECHAT] = VAMPIRE_FONT_COLOR;
		m_color_tab[CLD_WHISPER] = RGB(65, 206, 81);//RGB_GREEN;
		m_color_tab[CLD_INFO] = RGB(130, 230, 230);
		m_color_tab[CLD_GRADEDISPLAY] = RGB(255, 255 ,0);
		m_color_tab[CLD_MASTER] = RGB(255,180, 180);
		m_sub_window = 0;
		m_sub_rect.Set(0, 0, 160, 100);
		m_sub_selected.x = -1;
		m_pC_sub_scroll_bar->x = 135;
		m_pC_sub_scroll_bar->y = 35;
		break;
		
	case RACE_OUSTERS:
		m_pC_chatting_spk = new C_SPRITE_PACK(SPK_CHATTING_OUSTERS);
		
		//Set(0, RESOLUTION_Y - 125, 624, 125);
		//m_backup_rect.Set(0, RESOLUTION_Y - 125-100, 624, 125+100);
		Set(0, g_pUserInformation->iResolution_y - 125, 624, 125);
		m_backup_rect.Set(0, g_pUserInformation->iResolution_y - 125-100, 624, 125+100);

		gpC_base->m_user_id_pi.text_color = VAMPIRE_FONT_COLOR;
		gpC_base->m_chatting_pi.text_color = VAMPIRE_FONT_COLOR;
		m_color_tab[CLD_NORMAL] = VAMPIRE_FONT_COLOR;
		m_color_tab[CLD_GUILD] = RGB(180, 230, 230);
		m_color_tab[CLD_UNION] = RGB(180, 230, 230);
		m_color_tab[CLD_PARTY] = RGB(230, 180, 230);
		m_color_tab[CLD_ZONECHAT] = VAMPIRE_FONT_COLOR;
		m_color_tab[CLD_WHISPER] = RGB(65, 206, 81);//RGB_GREEN;
		m_color_tab[CLD_INFO] = RGB(130, 230, 230);
		m_color_tab[CLD_GRADEDISPLAY] = RGB(255, 255 ,0);
		m_color_tab[CLD_MASTER] = RGB(255,180, 180);
		m_sub_window = 0;
		m_sub_rect.Set(0, 0, 200, 140);
		m_sub_selected.x = -1;
		m_pC_sub_scroll_bar->x = 155;
		m_pC_sub_scroll_bar->y = 55;
		break;
	}	
	
	m_lev_chatting.SetPrintInfo(gpC_base->m_chatting_pi);
}

//-----------------------------------------------------------------------------
// C_VS_UI_CHATTING::SlayerChatMode
//
// chatting mode를 바꾼다.
//-----------------------------------------------------------------------------
bool	C_VS_UI_CHATTING::SlayerWhisperMode(bool mode)
{
	
	m_bl_whisper_mode = mode;
	m_bl_focus_whisper = false;
	
	
	if(mode)
	{
		m_lev_chatting.SetPosition(CHAT_LINE_START_X +115, CHAT_LINE_START_Y);
		m_lev_chatting.EraseAll();
		m_lev_chatting.SetByteLimit(100);
		m_lev_chatting.SetAbsWidth(CHAT_INPUT_WIDTH-100);
		
		if(GetWhisperSize())
		{
			m_sz_whisper_backup = m_sz_whisper_id.back();
			m_whisper_index = GetWhisperSize() -1;
		}
		else ChangeWhisperFocus();

		m_befor_chat_mode =  m_chat_mode;
	}
	else
	{
		IWin32Edite* pWin32Edite = gC_vs_ui.GetWin32Edite();
		if ( pWin32Edite )
			pWin32Edite->SetPos(CHAT_LINE_START_X +15-9, CHAT_LINE_START_Y-5);

		m_lev_chatting.SetPosition(CHAT_LINE_START_X+15, CHAT_LINE_START_Y);
		m_lev_chatting.EraseAll();
		m_lev_chatting.SetByteLimit(100);
		m_lev_chatting.SetAbsWidth(CHAT_INPUT_WIDTH);
		m_whisper_index = -1;


	}
	
	m_lev_chatting.Acquire();
	
	return mode;
}

//-----------------------------------------------------------------------------
// Start
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_CHATTING::Start()
{
	PI_Processor::Start();
	
	gpC_window_manager->AppearWindow(this);
	
	m_pC_button_group->Init();
	m_pC_input_button_group->Init();
	m_pC_input_right_button_group->Init();
	
	SlayerWhisperMode(false);
	
	m_bl_spreadID = false;
	m_dw_hide_prev_tickcount = GetTickCount() - m_dw_hide_timer;
	
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::CHATTING));
	AttrAutoHide(gpC_vs_ui_window_manager->GetAutoHide(C_VS_UI_WINDOW_MANAGER::CHATTING));
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::CHATTING);

	if(rect.w != -1)	
		Set(rect.x, rect.y, rect.w, rect.h);
	
	Rect &rect2 = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::CHATTING_OLD);
	if(rect2.w != -1)
		m_backup_rect.Set(rect2.x, rect2.y, rect2.w, rect2.h);
	
	m_lev_chatting.Acquire();
	WindowEventReceiver(EVENT_WINDOW_MOVE);

	IWin32Edite* pWin32Edite = gC_vs_ui.GetWin32Edite();
	if ( pWin32Edite )
		pWin32Edite->Show(SW_NORMAL);
}

void C_VS_UI_CHATTING::Finish()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::CHATTING, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::CHATTING, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::CHATTING, Rect(x, y, w, h));
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::CHATTING_OLD, m_backup_rect);
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);

	IWin32Edite* pWin32Edite = gC_vs_ui.GetWin32Edite();
	if ( pWin32Edite )
		pWin32Edite->Show(SW_HIDE);
	
}


//-----------------------------------------------------------------------------
// GetWhisperID
// 귓속말 아이디를 리턴한다.
// 디폴트는 가장 최근의 아이디
//-----------------------------------------------------------------------------
std::string C_VS_UI_CHATTING::GetWhisperID(int num)
{
	if(!m_sz_whisper_id.size())
	{
		std::string temp="";
		return temp;
	}
	
	if(num == -1)
	{
		if(m_whisper_index == -1)return m_sz_whisper_id.back();
		return m_sz_whisper_id[m_whisper_index];
	}
	
	return m_sz_whisper_id[num];
	
}

//-----------------------------------------------------------------------------
// ChangeWhisperFocus
// 귓말에서 아이디<->내용 사이의 포커스 이동
// 
//-----------------------------------------------------------------------------
void C_VS_UI_CHATTING::ChangeWhisperFocus()
{
	char * sz_chat_str = NULL;
	
	std::string temp;
	
	//	strcpy(temp, m_sz_whisper_backup);
	g_Convert_DBCS_Ascii2SingleByte(m_lev_chatting.GetString(), m_lev_chatting.Size(), sz_chat_str);
	if(sz_chat_str)
	{
		temp = sz_chat_str;
		delete [] sz_chat_str;
	}
	else temp = "";
	
	m_lev_chatting.EraseAll();
	temp.swap(m_sz_whisper_backup);
	m_lev_chatting.AddString(temp.c_str());
	
	m_bl_focus_whisper = !m_bl_focus_whisper;
	
	if(m_bl_focus_whisper)
	{
		IWin32Edite* pWin32Edite = gC_vs_ui.GetWin32Edite();
		if ( pWin32Edite )
			pWin32Edite->SetPos(CHAT_LINE_START_X +15-9, CHAT_LINE_START_Y-5);

		m_lev_chatting.SetPosition(CHAT_LINE_START_X+15, CHAT_LINE_START_Y);
		m_lev_chatting.SetByteLimit(10);
		m_lev_chatting.EraseAll();
	}
	else
	{
		//		if(m_sz_whisper_backup == "")m_sz_whisper_backup = GetWhisperID();
		m_lev_chatting.SetPosition(CHAT_LINE_START_X +115, CHAT_LINE_START_Y);
		m_lev_chatting.SetByteLimit(100);
		m_lev_chatting.HomeCursor();
		m_lev_chatting.EndCursor();
	}
	
	
	m_lev_chatting.Acquire();
	
}

//-----------------------------------------------------------------------------
// AddWhisperID
// 귓속말 아이디를 등록한다.
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_CHATTING::AddWhisperID(const char *sz_ID)
{
	int i;
	
	if(sz_ID[0] == ' ' || sz_ID[0] == '\0' || sz_ID[0] == '[')return false;
	
	if(GetWhisperSize() == WHISPER_MAX)
		m_sz_whisper_id.erase(m_sz_whisper_id.begin());
	
	char szTemp[512];
	
	strcpy(szTemp, sz_ID);
	
	for(i = 0; i < 11 && szTemp[i] != ' ' && szTemp[i] != '\0'; i++);
	szTemp[i] = '\0';
	
	
	std::string temp = szTemp;
	
	for(i = 0; i < GetWhisperSize(); i++)
	{
		if(m_sz_whisper_id[i] == temp)
		{
			m_sz_whisper_id.erase(&m_sz_whisper_id[i]);
			break;
		}
	}
		
	m_sz_whisper_id.push_back(temp);
		
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_CHATTING::Timer
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_CHATTING::Timer(bool reset)
{
	if(reset)
	{
		m_dw_prev_tickcount = GetTickCount();
	}
	else 
	if(m_dw_prev_tickcount+m_dw_zonechat_timer >= GetTickCount() && m_timer == TIMER_ZONECHAT && m_chat_mode == CLD_ZONECHAT && !m_bl_whisper_mode ||
		m_dw_prev_tickcount+m_dw_rep_timer >= GetTickCount() && m_timer == TIMER_REP  ||
		m_dw_prev_tickcount+m_dw_papering_timer >= GetTickCount() && m_timer == TIMER_PAPERING)
	{
		return true;
	}
	
	if(!(m_dw_prev_tickcount+m_dw_zonechat_timer >= GetTickCount() && m_timer == TIMER_ZONECHAT))
		m_timer = TIMER_NONE;
	return false;
}

//-----------------------------------------------------------------------------
// C_VS_UI_CHATTING::Timer
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_CHATTING::IsCannotSendChatInput()
{
	bool bTimerReturn	= Timer();
	bool bSurvivalZone	= gC_vs_ui.GetZoneID() == 8001;
#ifdef _LIB
	bool bOperator		= g_pPlayer != NULL && g_pPlayer->IsOperator();
#else
	bool bOperator		= false;
#endif

	if ( g_pPlayer != NULL )
	{
		if (g_pPlayer->HasEffectStatus(EFFECTSTATUS_GHOST))
			return false;
	}

	return !bOperator && (bTimerReturn || bSurvivalZone) ;
}

//-----------------------------------------------------------------------------
// C_VS_UI_CHATTING::TimerHelp
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_CHATTING::TimerHelp()
{
	if(m_dw_help_prev_tickcount+m_dw_help_timer < GetTickCount())
	{
		m_dw_help_prev_tickcount = GetTickCount();
		return true;
	}
	
	return false;
}

//-----------------------------------------------------------------------------
// C_VS_UI_CHATTING::TimerHide
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_CHATTING::TimerHide(bool reset)
{
	if(reset)
	{
		m_dw_hide_prev_tickcount = GetTickCount();
	}
	else
	if(m_dw_hide_prev_tickcount+m_dw_hide_timer < GetTickCount())
	{
		//		m_dw_hide_prev_tickcount = GetTickCount();
		return false;
	}		
	return true;
}

int		C_VS_UI_CHATTING::SetChatMode(int chat_mode)
{
	if(chat_mode >= 0 && chat_mode < 6)
	m_chat_mode = static_cast<CHAT_LINE_CONDITION>(chat_mode);
	return true;
}



int	C_VS_UI_INVENTORY::m_mine_grid_x = -1, C_VS_UI_INVENTORY::m_mine_grid_y = -1;
C_SPRITE_PACK *	C_VS_UI_INVENTORY::m_pC_mine_progress_spk = NULL;
DWORD	C_VS_UI_INVENTORY::m_dw_millisec;

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::C_VS_UI_INVENTORY
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_INVENTORY::C_VS_UI_INVENTORY()
{
	m_dwWidth	= 0;
	m_dwHight	= 0;

	g_pTempItem = NULL;
	g_RegisterWindow(this);
// 20090317 테스트 코드
	int	desc_button_offset_x, desc_button_offset_y;
	int	close_button_offset_x, close_button_offset_y;
	int	help_button_offset_x, help_button_offset_y;
	int alpha_button_offset_x, alpha_button_offset_y;
	
	m_pC_dialog_drop_money = NULL;
	
	m_bl_shift = false;
	m_bl_set_load = false;
	
	m_pC_button_group = new ButtonGroup(this);
	m_pC_mine_progress_spk = NULL;
	m_pC_inventory_spk = NULL;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_pC_inventory_spk = new C_SPRITE_PACK(SPK_SLAYER_INVENTORY);
		m_pC_mine_progress_spk = new C_SPRITE_PACK(SPK_MINE_PROGRESS);
		
		m_grid_start_offset_x = 13;
		m_grid_start_offset_y = 25;
	
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		m_money_button_offset_x = 16;
		m_money_button_offset_y = 214;
		desc_button_offset_x = 292-26-26-26;
		desc_button_offset_y = 214;
		alpha_button_offset_x = 292-26-26;
		alpha_button_offset_y = 214;
		help_button_offset_x = 292-26;
		help_button_offset_y = 214;	
		close_button_offset_x = 292;
		close_button_offset_y = 214;
	#else
		m_money_button_offset_x = 90;
		m_money_button_offset_y = 204+10;
		desc_button_offset_x = 65;
		desc_button_offset_y = 204+10;
		close_button_offset_x = 294;
		close_button_offset_y = 204+10;
		help_button_offset_x = 40;
		help_button_offset_y = 204+10;
		alpha_button_offset_x = 20;
		alpha_button_offset_y = 204+10;
	#endif //__080405_FIREST_UI_UPDATE
		Set(10, 128, m_pC_inventory_spk->GetWidth(INVENTORY_WINDOW), m_pC_inventory_spk->GetHeight(INVENTORY_WINDOW));
		break;

	case RACE_VAMPIRE:
		m_pC_inventory_spk = new C_SPRITE_PACK(SPK_VAMPIRE_INVENTORY);
#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		m_grid_start_offset_x = 17;
		m_grid_start_offset_y = 19;
	
		close_button_offset_x = 294;
		close_button_offset_y = 204;
		
		m_money_button_offset_y = 204;
		m_money_button_offset_x = 18;
		
		desc_button_offset_x = 294-26-26-26;
		desc_button_offset_y = 204;	
		alpha_button_offset_x = 294-26-26;
		alpha_button_offset_y = 204;
		help_button_offset_x = 294-26;
		help_button_offset_y = 204;
#else
		m_grid_start_offset_x = 17;
		m_grid_start_offset_y = 19;
		m_money_button_offset_x = 90;
		m_money_button_offset_y = 204;
		desc_button_offset_x = 65;
		desc_button_offset_y = 204;
		close_button_offset_x = 294;
		close_button_offset_y = 204;
		help_button_offset_x = 40;

		help_button_offset_y = 204;
		alpha_button_offset_x = 20;
		alpha_button_offset_y = 204;
#endif //__080405_FIREST_UI_UPDATE

		Set(10, 128, m_pC_inventory_spk->GetWidth(INVENTORY_WINDOW), m_pC_inventory_spk->GetHeight(INVENTORY_WINDOW)+m_pC_inventory_spk->GetHeight(INVENTORY_WINDOW_BOTTOM)-25);
		break;

	case RACE_OUSTERS:
		m_pC_inventory_spk = new C_SPRITE_PACK(SPK_OUSTERS_INVENTORY);
		
		m_grid_start_offset_x = 25;
		m_grid_start_offset_y = 35;

	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		m_money_button_offset_x = 33;
		m_money_button_offset_y = 226;
		desc_button_offset_x = 302-26-26-26;
		desc_button_offset_y = 226;
		alpha_button_offset_x = 302-26-26;
		alpha_button_offset_y = 226;
		help_button_offset_x = 302-26;
		help_button_offset_y = 226;
		close_button_offset_x = 302;
		close_button_offset_y = 226;
	#else
		m_money_button_offset_x = 103;
		m_money_button_offset_y = 224;
		desc_button_offset_x = 78;
		desc_button_offset_y = 224;
		close_button_offset_x = 307;
		close_button_offset_y = 224;
		help_button_offset_x = 53;
		help_button_offset_y = 224;
		alpha_button_offset_x = 33;
		alpha_button_offset_y = 224;
	#endif //__080405_FIREST_UI_UPDATE
		
		Set(10, 128, m_pC_inventory_spk->GetWidth(INVENTORY_WINDOW), m_pC_inventory_spk->GetHeight(INVENTORY_WINDOW));
		break;		
	}

	if( m_pC_inventory_spk == NULL )
	{
		sprintf( g_szBugReportBuffer, "Inventory::InitError");
		gpC_base->SendMessage(UI_SEND_BUG_REPORT, __LINE__, 0, (void*)g_szBugReportBuffer);
	}
	
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(m_money_button_offset_x, m_money_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_MONEY), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_MONEY), MONEY_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_MONEY));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(desc_button_offset_x, desc_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_DESC), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_DESC), DESC_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_DESC));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(help_button_offset_x, help_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION), HELP_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(close_button_offset_x, close_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_X), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_X), CLOSE_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_X));
#if __CONTENTS(__080405_FIREST_UI_UPDATE)
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_button_offset_x, alpha_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW));
#else
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_button_offset_x, alpha_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA));
#endif //__080405_FIREST_UI_UPDATE

	m_focus_grid_x_Prev	= 0;
	m_focus_grid_y_Prev	= 0;

	m_dwWidth	= m_pC_inventory_spk->GetWidth(INVENTORY_WINDOW);
	m_dwHight	= m_pC_inventory_spk->GetHeight(INVENTORY_WINDOW);

	m_nGearItemQuickViewScroll = 0;
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::~C_VS_UI_INVENTORY
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_INVENTORY::~C_VS_UI_INVENTORY()
{
	DeleteNew(gpC_dialog_confirm_change_sex);

	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::INVENTORY, GetAttributes()->alpha);
	
	if(m_bl_set_load)
	{
		gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::INVENTORY, Rect(x, y, w, h));
	}
	
	g_UnregisterWindow(this);
	
	if(m_pC_mine_progress_spk != NULL)
		DeleteNew(m_pC_mine_progress_spk);
	if(m_pC_button_group != NULL)
		DeleteNew(m_pC_button_group);
	if(m_pC_inventory_spk != NULL)
		DeleteNew(m_pC_inventory_spk);
	//	DeleteNew(m_pC_backcolor_spk);
	//	DeleteNew(m_pC_etc_button_spk);
	
	if(m_pC_dialog_drop_money != NULL)
		DeleteNew(m_pC_dialog_drop_money);
}


void C_VS_UI_INVENTORY::AutoMove( int grid_x, int grid_y )
{
	MItem * p_item = g_pInventory->GetItem(grid_x, grid_y);
	if( p_item == NULL )
		return;

	if(gC_vs_ui.IsRunningStorage() && g_pStorage)
	{
		// 서브 인벤토리 아이템안에 아이템이 있으면 보관함에 넣을 수 없다.  GetEnchantLevel : 안에 들어 있는 아이템 갯수.
		if(p_item->GetItemClass() == ITEM_CLASS_SUB_INVENTORY && p_item->GetEnchantLevel()>0) 
		{
			gpC_base->SendMessage(UI_MESSAGE_BOX, 
					STRING_MESSAGE_CANNOT_STORAGE, 
					0, 
					NULL);
			return ;
		}
		int current_storage = g_pStorage->GetCurrent();
		const int storage_size = g_pStorage->GetSize();
		const int storage_max = STORAGE_SLOT;
		
		int i, j;
		
		if(current_storage >= storage_size)
			current_storage = 0;
		for(j = 0; j < storage_size; j++)
		{
			//	g_pStorage->SetCurrent(j);
			g_pStorage->SetCurrent(current_storage);
			
			if(p_item->IsPileItem())
			{
				for(i = 0; i < storage_max; i++)
				{
					const MItem *p_slot_item = g_pStorage->GetItem(i);
					
					// 슬롯에 머가 있는경우 아이템 종류가 같은지 보고, 쌓을수 있는가 보고 쌓는다.
					if(p_item->IsInsertToItem( p_slot_item ))
					{
						int total_number = p_slot_item->GetNumber()+p_item->GetNumber();
						int max_number = p_item->GetMaxNumber();
						if(total_number <= max_number)
						{
							g_pInventory->RemoveItem(grid_x, grid_y);
							
							// 이전에 있던 item에 추가될 수 있는 경우
							
							// 대상 Item과 들고 있는(추가할 Item)을 Client에서 알아야 한다.
							// 들고 있는 Item은 Client에서 access할 수 있으므로 대상 Item을 보낸다.
							// 클라이언트에서 픽업된 아이템을 참조하므로 먼저 픽업
							// 픽업할때의 인자는 아무거나 보내도 상관없다 바로 떨어뜨릴꺼니까
#ifdef _LIB
							gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
								grid_x, grid_y,
								(MItem *)p_item);
//#else
//							int item_x = x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X+(p_item->GetGridWidth()*GRID_UNIT_PIXEL_X)/2-gpC_item->GetWidth(p_item->GetInventoryFrameID())/2;
//							int item_y = y+grid_start_y+p_item->GetGridY()*GRID_UNIT_PIXEL_Y+(p_item->GetGridHeight()*GRID_UNIT_PIXEL_Y)/2-gpC_item->GetHeight(p_item->GetInventoryFrameID())/2;
//							
//							
//							gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
//								MAKEDWORD(grid_x, grid_y),
//								MAKEDWORD(item_x, item_y),
//								(MItem *)p_item);
#endif
							gpC_base->SendMessage(UI_SELECT_STORAGE_SLOT, current_storage, i);
							
							return;
						}
					}	
				}
			}
			current_storage ++;
			if(current_storage >= storage_size)
				current_storage = 0;
		}
		for(j = 0; j < storage_size; j++)
		{
			//g_pStorage->SetCurrent(j);
			g_pStorage->SetCurrent(current_storage);
			
			for(i = 0; i < storage_max; i++)
			{
				const MItem *p_slot_item = g_pStorage->GetItem(i);
				
				// 슬랏이 비었으면 걍~ 넣는다
				if(p_slot_item == NULL)
				{
					g_pInventory->RemoveItem(grid_x, grid_y);
					
#ifdef _LIB
					gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
						grid_x, grid_y,
						(MItem *)p_item);
//#else
//					int item_x = x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X+(p_item->GetGridWidth()*GRID_UNIT_PIXEL_X)/2-gpC_item->GetWidth(p_item->GetInventoryFrameID())/2;
//					int item_y = y+grid_start_y+p_item->GetGridY()*GRID_UNIT_PIXEL_Y+(p_item->GetGridHeight()*GRID_UNIT_PIXEL_Y)/2-gpC_item->GetHeight(p_item->GetInventoryFrameID())/2;
//					
//					
//					gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
//						MAKEDWORD(grid_x, grid_y),
//						MAKEDWORD(item_x, item_y),
//						(MItem *)p_item);
#endif
					
					gpC_base->SendMessage(UI_SELECT_STORAGE_SLOT, current_storage, i);
					
					return;
				}
			}
			current_storage ++;
			if(current_storage >= storage_size)
				current_storage = 0;
		}
		// Storage에 아이템을 넣을 공간이 없다면 여기까지 오게 되고, 그렇다면 원래의 스토리지를 선택
		g_pStorage->SetCurrent(current_storage);
	}	// 퀵슬랏에 들어갈 수 있는 아이템인가 보고 퀵슬랏이 있는가 본다.
	else if(p_item->IsQuickItem() == true && !p_item->IsGearItem() &&
		(
		(g_eRaceInterface == RACE_SLAYER && g_pQuickSlot != NULL) ||
		(g_eRaceInterface == RACE_OUSTERS && (g_pArmsBand1 != NULL || g_pArmsBand2 != NULL))
		)
		)
	{
		// 큇슬랏 개수만큼 넣을수 있는가 검사한다
		// 처음에 쌓을수 있는가를 알아보고 쌓을수 있는곳이 없으면 빈곳에 넣는다												
		int quick_slot_max=0;
		if( g_eRaceInterface == RACE_OUSTERS )
		{
			if( g_pArmsBand1 != NULL )
				quick_slot_max+=g_pArmsBand1->GetPocketNumber();
			if( g_pArmsBand2 != NULL )
				quick_slot_max+=g_pArmsBand2->GetPocketNumber();
		}
		else quick_slot_max = g_pQuickSlot->GetSize();
		
		if(p_item->IsPileItem())
		{
			for(int i = 0; i < quick_slot_max; i++)
			{
				MItem *p_slot_item = NULL;
				if( g_eRaceInterface == RACE_OUSTERS)
					p_slot_item = C_VS_UI_OUSTERS_QUICKITEM::GetItem( i );
				else
					p_slot_item = g_pQuickSlot->GetItem( i );
				//MItem *p_slot_item = g_pQuickSlot->GetItem(i);
				
				// 슬롯에 머가 있는경우 아이템 종류가 같은지 보고, 쌓을수 있는가 보고 쌓는다.
				if(p_item->IsInsertToItem( p_slot_item ))
				{
					int total_number = p_slot_item->GetNumber()+p_item->GetNumber();
					int max_number = p_item->GetMaxNumber();
					if(total_number <= max_number)
					{
						g_pInventory->RemoveItem(grid_x, grid_y);
						
						// 이전에 있던 item에 추가될 수 있는 경우
						
						// 대상 Item과 들고 있는(추가할 Item)을 Client에서 알아야 한다.
						// 들고 있는 Item은 Client에서 access할 수 있으므로 대상 Item을 보낸다.
						// 클라이언트에서 픽업된 아이템을 참조하므로 먼저 픽업
						// 픽업할때의 인자는 아무거나 보내도 상관없다 바로 떨어뜨릴꺼니까
#ifdef _LIB
						gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
							grid_x, grid_y,
							(MItem *)p_item);
//#else
//						int item_x = x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X+(p_item->GetGridWidth()*GRID_UNIT_PIXEL_X)/2-gpC_item->GetWidth(p_item->GetInventoryFrameID())/2;
//						int item_y = y+grid_start_y+p_item->GetGridY()*GRID_UNIT_PIXEL_Y+(p_item->GetGridHeight()*GRID_UNIT_PIXEL_Y)/2-gpC_item->GetHeight(p_item->GetInventoryFrameID())/2;
//						
//						
//						gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
//							MAKEDWORD(grid_x, grid_y),
//							MAKEDWORD(item_x, item_y),
//							(MItem *)p_item);
#endif
						gpC_base->SendMessage(UI_ITEM_INSERT_FROM_QUICKSLOT,
							i, 0, (void *)p_slot_item); // 대상 Item
						
						return;
					}
				}	
			}
		}
		for(int i = 0; i < quick_slot_max; i++)
		{
			MItem *p_slot_item = NULL; //g_pQuickSlot->GetItem(i);
			
			if( g_eRaceInterface == RACE_OUSTERS )
				p_slot_item = C_VS_UI_OUSTERS_QUICKITEM::GetItem( i );
			else
				p_slot_item = g_pQuickSlot->GetItem( i );
			
			// 슬랏이 비었으면 걍~ 넣는다
			if(p_slot_item == NULL)
			{
				g_pInventory->RemoveItem(grid_x, grid_y);
				
#ifdef _LIB
				gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
					grid_x, grid_y,
					(MItem *)p_item);
//#else
//				int item_x = x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X+(p_item->GetGridWidth()*GRID_UNIT_PIXEL_X)/2-gpC_item->GetWidth(p_item->GetInventoryFrameID())/2;
//				int item_y = y+grid_start_y+p_item->GetGridY()*GRID_UNIT_PIXEL_Y+(p_item->GetGridHeight()*GRID_UNIT_PIXEL_Y)/2-gpC_item->GetHeight(p_item->GetInventoryFrameID())/2;
//				
//				
//				gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
//					MAKEDWORD(grid_x, grid_y),
//					MAKEDWORD(item_x, item_y),
//					(MItem *)p_item);
#endif
				
				if( g_eRaceInterface == RACE_OUSTERS )
				{
					// 첫번째 암스밴드인거면
					if( g_pArmsBand1 != NULL && g_pArmsBand1->GetPocketNumber() > i )
					{
						if (g_pArmsBand1->CanReplaceItem(p_item, i, p_slot_item))
						{
							gpC_base->SendMessage(UI_ITEM_DROP_TO_QUICKSLOT,i); // 들고 있던 것을 보낸다.												
							return;
						}										
					} else
					{
						// 두번째 암스밴드인거면 
						if( g_pArmsBand1 != NULL )
						{
							if (g_pArmsBand2->CanReplaceItem(p_item, i - g_pArmsBand1->GetPocketNumber() , p_slot_item))
							{
								gpC_base->SendMessage(UI_ITEM_DROP_TO_QUICKSLOT,i); // 들고 있던 것을 보낸다.													
								return;
							}											
						} else
						{
							if (g_pArmsBand2->CanReplaceItem(p_item, i, p_slot_item))
							{
								gpC_base->SendMessage(UI_ITEM_DROP_TO_QUICKSLOT,i); // 들고 있던 것을 보낸다.													
								return;
							}											
						}
					}
					
				} else
				{
					if (g_pQuickSlot->CanReplaceItem(p_item, i, p_slot_item))
					{
						gpC_base->SendMessage(UI_ITEM_DROP_TO_QUICKSLOT,
							i); // 들고 있던 것을 보낸다.
						
						return;
					}
					else
					{
						return;
					}
				}
			}
		}
	}
	// 기어창에 들어갈 수 있는 아이템인가 보고 넣는다
	else if(p_item->IsGearItem() && gbl_gear_lock == false && gC_vs_ui.IsRunningGearWindow())
	{
		int slot_max = 0;
		
		// 슬롯개수 만큼 돌면서 아이템이 들어가나 본다.
		// 뱀파이어와 슬레이어의 슬롯 개수는 틀리므로 따로따로
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			slot_max = MSlayerGear::MAX_GEAR_SLAYER;
			break;
			
		case RACE_VAMPIRE:
			slot_max = MVampireGear::MAX_GEAR_VAMPIRE;
			break;
			
		case RACE_OUSTERS:
			slot_max = MOustersGear::MAX_GEAR_OUSTERS;
			break;							
		}						
		
		int add_slot = -1;
		MItem *pChangeItem = NULL;
		for(int i = 0; i < slot_max; i++)
		{
			MItem * p_slot_item = NULL;
			
			if (gC_vs_ui.CanReplaceItemInGear(p_item, i, p_slot_item))
			{
				add_slot = i;
				pChangeItem = p_slot_item;
				// 빈 곳이면 바로 넣어버리면 된다.
				// 빈 곳이 아니라면.. 다음걸 찾는다.
				if(p_slot_item == NULL)
				{
					break;
				}
			}
		}
		
		if(add_slot != -1)
		{
			// 딱걸렸다
			// 클라이언트에서 픽업된 아이템을 참조하므로 먼저 픽업
			// 픽업할때의 인자는 아무거나 보내도 상관없다 바로 떨어뜨릴꺼니까
			g_pInventory->RemoveItem(grid_x, grid_y);
#ifdef _LIB
			gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
				grid_x, grid_y,
				(MItem *)p_item);
//#else
//			int item_x = x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X+(p_item->GetGridWidth()*GRID_UNIT_PIXEL_X)/2-gpC_item->GetWidth(p_item->GetInventoryFrameID())/2;
//			int item_y = y+grid_start_y+p_item->GetGridY()*GRID_UNIT_PIXEL_Y+(p_item->GetGridHeight()*GRID_UNIT_PIXEL_Y)/2-gpC_item->GetHeight(p_item->GetInventoryFrameID())/2;
//			
//			
//			gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
//				MAKEDWORD(grid_x, grid_y),
//				MAKEDWORD(item_x, item_y),
//				(MItem *)p_item);
#endif
			
			// 기어에 넣는다
			gpC_base->SendMessage(UI_ITEM_DROP_TO_GEAR, 
				add_slot, 
				0, 
				NULL);
			
			// 기어에 넣은 아이템이 벨트라면 벨트를 연다.
			if(p_item->GetItemClass() == ITEM_CLASS_BELT)
				gC_vs_ui.RunQuickItemSlot();
			
			return;
		}
	}
	/*
	// sub inventory 로 이동 
	else if( //p_item->GetItemClass() != ITEM_CLASS_PET_ITEM && // 요건 담에 삭제
		!gC_vs_ui.IsRunningExchange() &&
		gC_vs_ui.IsRunningSubInventory() && p_item->GetItemClass() != ITEM_CLASS_SUB_INVENTORY)
	{

		// 추가될 수 없는 경우
		// 다음의 아이템은 멀티팩에 추가할 수 없다. by bezz
		ITEM_CLASS ItemClass = p_item->GetItemClass();
		TYPE_ITEMTYPE ItemType = p_item->GetItemType() ;
		if ( ( ItemClass == ITEM_CLASS_RELIC )								// 성물
			|| ( ItemClass == ITEM_CLASS_BLOOD_BIBLE )						// 피의 성서
			|| ( ItemClass == ITEM_CLASS_CASTLE_SYMBOL )					// 성 상징
			|| ( ItemClass == ITEM_CLASS_WAR_ITEM )							// 전쟁 아이템/ 드래곤 아이
			|| ( ItemClass == ITEM_CLASS_EVENT_ITEM && ItemType == 27 )		// 깃발
			
			//  20005.11.11 Sjheon Add
			|| ( ItemClass == ITEM_CLASS_BELT )								// 벨트
			|| ( ItemClass == ITEM_CLASS_OUSTERS_ARMSBAND )					// 암스벤드 
			//  20005.11.11 Sjheon End 

			// sjheon 2004.04.28 add
			|| ( ItemClass == ITEM_CLASS_EVENT_ETC && ItemType == 18 )		// 패밀리 코인
			|| ( ItemClass == ITEM_CLASS_EVENT_ITEM && (ItemType >= 32 && ItemType <= 36) )		// 풍선 머리띠 
			// sjheon 2004.04.28 add
			
			|| ( ItemClass == ITEM_CLASS_EVENT_ITEM && ItemType == 30 )		// Luck Charm
							
			|| ( ItemClass == ITEM_CLASS_SWEEPER )							// 스위퍼
			|| ( ItemClass == ITEM_CLASS_PET_ITEM))							// 펫 아이템
			
		{
			return ;
		}


		POINT point;
		MSubInventory* pSubInventoryItem = (MSubInventory*)gC_vs_ui.GetSubInventoryItem();
		if(NULL == pSubInventoryItem)
			return ;

		if(p_item != NULL && pSubInventoryItem->GetFitPosition(p_item, point))
		{
			g_pInventory->RemoveItem(grid_x, grid_y);

			gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
								grid_x, grid_y,
								(MItem *)p_item);

			const MItem* p_cur_item = pSubInventoryItem->GetItem(point.x, point.y);
			
			// 총에 탄창을 끼우는 것과 같은 것이 insert item이다.
			// 위치가 완전히 일치할경우에만 추가한다.
			if (p_item->IsInsertToItem( p_cur_item ) && p_cur_item->GetGridX() == point.x && p_cur_item->GetGridY() == point.y)
			{
				// 이전에 있던 item에 추가될 수 있는 경우
				
				// 대상 Item과 들고 있는(추가할 Item)을 Client에서 알아야 한다.
				// 들고 있는 Item은 Client에서 access할 수 있으므로 대상 Item을 보낸다.
				gpC_base->SendMessage(UI_ITEM_INSERT_FROM_INVENTORY,
					point.x, point.y,
					(void *)p_cur_item); // 대상 Item
			}
			else
			{	
				// 추가될 수 없는 경우
				MItem* p_old_item  = NULL;
				
				if (pSubInventoryItem->CanReplaceItem(p_item,		// 추가할 item
					point.x, point.y,	// 추가할 위치 
					p_old_item))								// 원래있던 item
				{
						
					gpC_base->SendMessage(UI_ITEM_DROP_TO_INVENTORY_SUB, 
						point.x, point.y,
						p_item);
					
				}
			}
			
		}
	}
	*/
	
	
}
//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INVENTORY::WindowEventReceiver(id_t event)
{
	switch (event)
	{
	case EVENT_WINDOW_MOVE:
		ResetRect();
		break;
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::Start
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INVENTORY::Start(bool bl_set_load)
{
	m_bl_set_load = bl_set_load;
	
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::INVENTORY));
	
	if(bl_set_load)	
	{
		Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::INVENTORY);
		if(rect.w != -1)
		{
			x = rect.x;
			y = rect.y;
		}
	}

	// 2004, 5, 6 sobeit add start - 착용 아이템 도움말 
	static bool FirstOpened = true;

	if(FirstOpened == true)
	{
		gC_vs_ui.AddHelpMail(HELP_EVENT_EQUIP_ITEM);
		FirstOpened = false;
	}
	// 2004, 5, 6 sobeit add end - 착용 아이템 도움말 
	
	PI_Processor::Start();
	
	AttrPin(true);
	gpC_window_manager->AppearWindow(this);
	
	// init
	ResetRect();
	m_focus_grid_x = NOT_SELECTED;
	m_focus_grid_y = NOT_SELECTED;

	
//	if(g_pStorage2 != NULL)
//	{
//		g_pStorage2->SetCurrent(0);
//		g_pInventory->SetBegin();
//		while (g_pInventory->IsNotEnd())
//		{
//			MItem * p_item = g_pInventory->Get();
//			MItem * p_newitem = g_pInventory->Get();
//			assert(p_item);
//			if(p_item)
//			{
//				for(int i = 0; i < 20 ; i++)
//				{
//					const MItem *persnal_item = g_pStorage2->GetItem(i);
//					if(persnal_item != NULL)
//					{
//						if(persnal_item->GetID() == p_item->GetID())
//						{
//							if(persnal_item->GetNumber() == p_item->GetNumber())
//							{
//								p_newitem->SetPersnal(true);
//								g_pInventory->ReplaceItem(p_newitem,p_item->GetGridX(),p_item->GetGridY(),p_item);
//							}
//						}
//					}
//				}
//			}
//
//			g_pInventory->Next();
//		}
//	}
}

void	C_VS_UI_INVENTORY::SetDebugStart()
{
	return;
	FILE *fp=fopen("IsnventoryLog.txt","wt");
	fprintf(fp,"InventoryLogStart");
	fclose(fp);
}

void	C_VS_UI_INVENTORY::WriteLogLine(int line)
{
	return;
	FILE *fp = fopen("InventoryLog.txt","at");
	fseek(fp,0,SEEK_END);
	fwrite(&line,sizeof(int),1,fp);
	fclose(fp);
}

void	C_VS_UI_INVENTORY::SetDebugEnd()
{
	return;
	FILE *fp = fopen("InventoryLog.txt","at");
	fseek(fp,0,SEEK_END);
	fprintf(fp,"InventoryLogEnd");
	fclose(fp);
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::Finish
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INVENTORY::Finish()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::INVENTORY, GetAttributes()->alpha);
	
	if(m_bl_set_load)
	{
		gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::INVENTORY, Rect(x, y, w, h));
	}
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
	if(gpC_mouse_pointer->IsCursorDescription())gpC_mouse_pointer->CursorDescriptionToggle();
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::IsPixel
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_INVENTORY::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	
	return AnyMatchWindowPixel(_x, _y);
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_INVENTORY::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	const static char* m_inventory_button_string[7] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_THROW_MONEY].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ITEM_DESCRIPTION].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP_INVENTORY_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_INVENTORY_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DEPOSIT_MONEY].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),		
	};

	if(gC_vs_ui.IsRunningStorage() && p_button->GetID() == MONEY_ID)
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_inventory_button_string[5],0,0);
	else if(GetAttributes()->alpha && p_button->GetID() == ALPHA_ID)
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_inventory_button_string[6],0,0);
	else
	{
		if( p_button->GetID() != MONEY_ID )	
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_inventory_button_string[p_button->GetID()],0,0);
	}
}


//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_INVENTORY::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{		
	if( p_button->GetID() == MONEY_ID )
	{
		if( !gC_vs_ui.IsRunningStorage() )
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLockedDarkness(p_button->x+x, p_button->y+y, p_button->m_image_index,1);
			return;
		}			
	}
		
	if(p_button->GetID() == ALPHA_ID)
	{
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED_NEW);
	#else
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED);
	#endif //__080405_FIREST_UI_UPDATE
	}
	else
	{
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_PUSHED_OFFSET);
			else
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_HILIGHTED_OFFSET);
		}
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index);
	}	
}

//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INVENTORY::Run(id_t id)
{
	switch (id)
	{
	case DESC_ID:
		gpC_mouse_pointer->CursorDescriptionToggle();
		break;
		
	case MONEY_ID:
		// money button이 눌렸다.
		// 돈을 버린다.
		if(m_pC_dialog_drop_money)
			DeleteNew(m_pC_dialog_drop_money);
		
		if (g_pMoneyManager->GetMoney() > 0)
		{
			if (gC_vs_ui.IsRunningStorage())
			{
				m_pC_dialog_drop_money = new C_VS_UI_MONEY_DIALOG(x+m_money_button_offset_x, y+m_money_button_offset_y+gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_MONEY), 2, 0, ExecF_DropMoney, DIALOG_OK|DIALOG_CANCEL, 10, 
					C_VS_UI_MONEY_DIALOG::MONEY_DEPOSIT);	// by sigi
				m_pC_dialog_drop_money->Start();
			}
			//else if (gC_vs_ui.IsRunningExchange())
			//{
			//	m_pC_dialog_drop_money = new C_VS_UI_MONEY_DIALOG(m_money_button_rect.x, m_money_button_rect.Down(), 1, 0, ExecF_DropMoney, DIALOG_OK|DIALOG_CANCEL, 10, 
			//																	C_VS_UI_MONEY_DIALOG::MONEY_EXCHANGE);
			//}
//			else
//			{
//				m_pC_dialog_drop_money = new C_VS_UI_MONEY_DIALOG(x+m_money_button_offset_x, y+m_money_button_offset_y+gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_MONEY), 1, 0, ExecF_DropMoney, DIALOG_OK|DIALOG_CANCEL, 10, 
//					C_VS_UI_MONEY_DIALOG::MONEY_DROP);	// by sigi
//			}
		}
		break;
		
	case CLOSE_ID:
		// close button이 눌렸다.
		
		if (gbl_sell_running)
		{
			gpC_base->SendMessage(UI_ITEM_SELL_FINISHED);
		}
		else if (gbl_buy_running)
		{
			gpC_base->SendMessage(UI_CLOSE_SHOP);
		}
		else if (gbl_repair_running)
		{
			gpC_base->SendMessage(UI_ITEM_REPAIR_FINISHED);
		}
		else if (gbl_silvering_running)
		{
			gpC_base->SendMessage(UI_ITEM_SILVERING_FINISHED);
		}
		else if (gC_vs_ui.IsRunningStorage())
		{
			gpC_base->SendMessage(UI_CLOSE_STORAGE);
		}
		else if (gC_vs_ui.IsRunningPetStorage())
		{
			gpC_base->SendMessage(UI_CLOSE_PETSTORAGE);
		}
		// 2005, 1, 3, sobeit add start
		else if(gbl_swap_advancement_item_running)
		{
			gpC_base->SendMessage(UI_CLOSE_SWAPADVANCEMENTITEM);
		}
		// 2005, 1, 3, sobeit add end
		//else if (gC_vs_ui.IsRunningExchange())
		//{
		//	gpC_base->SendMessage(UI_CLOSE_EXCHANGE);
		//}
		else
		{
			gC_vs_ui.HotKey_Inventory();
		}
		break;
		
	case HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::INVENTORY);
		break;
		
	case ALPHA_ID:
		AttrAlpha(!GetAttributes()->alpha);
		EMPTY_MOVE;
		break;
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::AnyMatchWindowPixel
//
// Window image의 pixel이 (x, y) 한 점이라도 일치하면 true를 아니면 false를 반환한다.
//
// Item을 들고 있을 때에는 'item 참조포인트'에 따라 진행한다.
//-----------------------------------------------------------------------------
bool C_VS_UI_INVENTORY::AnyMatchWindowPixel(int _x, int _y) const
{
	if (gpC_mouse_pointer->GetPickUpItem())
	{
		for (int i=0; i < ITEM_REF_POINT_COUNT; i++)
		{
			int px = g_item_ref_point[i].x+gpC_mouse_pointer->GetPointerX();
			int py = g_item_ref_point[i].y+gpC_mouse_pointer->GetPointerY();
			if (m_pC_inventory_spk->IsPixel(px-x, py-y))
				return true;
		}
		
		return false;
	}
	else
	{
		return m_pC_inventory_spk->IsPixel(_x-x, _y-y);
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::AllMatchWindowPixel
//
//
//-----------------------------------------------------------------------------
bool C_VS_UI_INVENTORY::AllMatchWindowPixel(int _x, int _y) const
{
	if (gpC_mouse_pointer->GetPickUpItem())
	{ 
		for (int i=0; i < ITEM_REF_POINT_COUNT; i++)
		{
			int px = g_item_ref_point[i].x+gpC_mouse_pointer->GetPointerX();
			int py = g_item_ref_point[i].y+gpC_mouse_pointer->GetPointerY();
			if (m_pC_inventory_spk->IsPixel(px-x, py-y) == false)
				return false;
		}
		
		return true;
	}
	else
	{
		return m_pC_inventory_spk->IsPixel(_x-x, _y-y);
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::TestGridRect
//
// Grid rect 위에 있으면 true, 아니면 false를 반환한다.
//-----------------------------------------------------------------------------
bool C_VS_UI_INVENTORY::TestGridRect(int _x, int _y) const
{
	return (m_grid_rect.IsInRect(_x, _y)// || 
		//			  m_money_button_rect.IsInRect(_x, _y) ||
		//			  m_desc_button_rect.IsInRect(_x, _y) ||
		//			  m_bike_button_rect.IsInRect(_x, _y) ||
		//			  m_close_button_rect.IsInRect(_x, _y) ||
		//			  m_help_button_rect.IsInRect(_x, _y)
		);
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::CancelPushState
//
// 
//-----------------------------------------------------------------------------
//void	C_VS_UI_INVENTORY::CancelPushState()
//{
//	m_bl_money_button_pushed = false;
//	m_bl_desc_button_pushed = false;
//	m_bl_bike_button_pushed = false;
//	m_bl_close_button_pushed = false;
//	m_bl_help_button_pushed = false;
//}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::AcquireMouseFocus
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_INVENTORY::AcquireMouseFocus()
{
	gpC_base->SendMessage(UI_REMOVE_BACKGROUND_MOUSE_FOCUS);
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::AcquireDisappear
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INVENTORY::AcquireDisappear()
{
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::UnacquireMouseFocus
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INVENTORY::UnacquireMouseFocus()
{
	m_pC_button_group->UnacquireMouseFocus();
	m_focus_grid_x = NOT_SELECTED;
	m_focus_grid_y = NOT_SELECTED;
	
	//	m_bl_money_button_focused = false;
	//	m_bl_desc_button_focused = false;
	//	m_bl_bike_button_focused = false;
	//	m_bl_close_button_focused = false;
	//	m_bl_help_button_focused = false;
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::GetFocusedItemGridX
//
// 
//-----------------------------------------------------------------------------
int C_VS_UI_INVENTORY::GetFocusedItemGridX(const MItem * p_item)
{
	assert(p_item);
	
	if (p_item == NULL)
		return 0;
	
	return m_grid_rect.x+GRID_UNIT_PIXEL_X*p_item->GetGridX();
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::GetFocusedItemGridY
//
// 
//-----------------------------------------------------------------------------
int C_VS_UI_INVENTORY::GetFocusedItemGridY(const MItem * p_item)
{
	assert(p_item);
	
	if (p_item == NULL)
		return 0;
	
	return m_grid_rect.y+GRID_UNIT_PIXEL_Y*p_item->GetGridY();
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::GetFocusedItemGridH
//
// 
//-----------------------------------------------------------------------------
int C_VS_UI_INVENTORY::GetFocusedItemGridH(const MItem * p_item)
{
	assert(p_item);
	
	if (p_item == NULL)
		return 0;
	
	return GRID_UNIT_PIXEL_Y*p_item->GetGridHeight();
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::Show
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INVENTORY::Show()
{	
	SetDebugStart();

		if (gpC_base->m_p_DDSurface_back->Lock())
	{				
		Rect rect;
		if( g_eRaceInterface == RACE_VAMPIRE )
			rect.Set(0, 0, w, h-m_pC_inventory_spk->GetHeight(INVENTORY_WINDOW_BOTTOM));
		
		if(GetAttributes()->alpha)
		{
			
			RECT alpha_rect;
			//슬레이어 인터페이스 알파는 창 구석부분 알파처리-_-;
			switch(g_eRaceInterface)
			{
				case RACE_SLAYER:
					// 위
					SetRect(&alpha_rect, x+10, y+12, x+315, y+21);
					DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					
					// 아래
					SetRect(&alpha_rect, x+5, y+209, x+321, y+245);
					DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					
					// 왼쪽
					SetRect(&alpha_rect, x+5, y+24, x+9, y+245);
					DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					
					// 오른쪽
					SetRect(&alpha_rect, x+317, y+24, x+321, y+245);
					DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					
				break;

				case RACE_OUSTERS:
					// 위
					SetRect(&alpha_rect, x+25, y+14, x+325, y+31);
					DrawAlphaBox(&alpha_rect, 0, 4, 0, g_pUserOption->ALPHA_DEPTH);
					
					// 아래
					SetRect(&alpha_rect, x+21, y+219, x+329, y+262);
					DrawAlphaBox(&alpha_rect, 0, 4, 0, g_pUserOption->ALPHA_DEPTH);
					
					// 왼쪽
					SetRect(&alpha_rect, x+16, y+24, x+21, y+245);
					DrawAlphaBox(&alpha_rect, 0, 4, 0, g_pUserOption->ALPHA_DEPTH);
					
					// 오른쪽
					SetRect(&alpha_rect, x+329, y+46, x+333, y+230);
					DrawAlphaBox(&alpha_rect, 0, 4, 0, g_pUserOption->ALPHA_DEPTH);
					
				break;
			}
			
			bool bl_alpha[10][6];	// 커헉-_- 하드코딩 아이템 놓인곳은 다르게 표현해야 하니까.. 남은부분은 따로 처리
			ZeroMemory(bl_alpha, 10*6*sizeof(bool));
			WriteLogLine(__LINE__);

			g_pInventory->SetBegin();
			while (g_pInventory->IsNotEnd())
			{
				
				MItem * p_item = g_pInventory->Get();
				
				
				// p_item은 NULL이 반드시 아니다. 왜냐하면 존재하는 것만 Get()하기 때문이다.
				assert(p_item);
				
				// frame id -> sprite id
				if(p_item)
				{
					TYPE_FRAMEID frame_id = p_item->GetInventoryFrameID();
					
					
					int item_x = x+GetFocusedItemGridX(p_item);
					
					int item_y = y+GetFocusedItemGridY(p_item);
					
					
					int alpha_r, alpha_g, alpha_b;
					switch(g_eRaceInterface)
					{
					case RACE_SLAYER:
						alpha_r = 5;
						alpha_g = 7;
						alpha_b = 7;
						break;
						
					case RACE_VAMPIRE:
						alpha_r = 7;
						alpha_g = 5;
						alpha_b = 5;
						break;
						
					case RACE_OUSTERS:
						alpha_r = 5;
						alpha_g = 7;
						alpha_b = 5;
						break;
					}				
					
					// Item이 놓여있는 영역 표시
					for (int j = 0; j < p_item->GetGridHeight(); j++)
					{
						for (int i = 0; i < p_item->GetGridWidth(); i++)
						{
							RECT alpha_rect;
							alpha_rect.left = item_x+GRID_UNIT_PIXEL_X*i+1;
							alpha_rect.top = item_y+GRID_UNIT_PIXEL_Y*j+1;
							alpha_rect.right = alpha_rect.left+28;
							alpha_rect.bottom = alpha_rect.top+28;
							//							gpC_base->m_p_DDSurface_back->Unlock();
							DrawAlphaBox(&alpha_rect, alpha_r, alpha_g, alpha_b, g_pUserOption->ALPHA_DEPTH);
							
							//							gpC_base->m_p_DDSurface_back->Lock();
							
							bl_alpha[p_item->GetGridX()+i][p_item->GetGridY()+j] = true;
						}
					}
				}

				g_pInventory->Next();
			}
				
			if(g_eRaceInterface == RACE_VAMPIRE)
				m_pC_inventory_spk->BltLockedClip(x, y, rect, INVENTORY_WINDOW_ALPHA);
			else
				m_pC_inventory_spk->BltLocked(x, y, INVENTORY_WINDOW_ALPHA);

			int alpha_r, alpha_g, alpha_b;
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				alpha_r = 0;
				alpha_g = 2;
				alpha_b = 2;
				break;

			case RACE_VAMPIRE:
				alpha_r = 2;
				alpha_g = 0;
				alpha_b = 0;
				break;

			case RACE_OUSTERS:
				alpha_r = 0;
				alpha_g = 2;
				alpha_b = 0;
				break;				
			}
			
			
			for(int alpha_x = 0; alpha_x < 10; alpha_x++)
			{
				for(int alpha_y = 0; alpha_y < 6; alpha_y++)
				{
					if(bl_alpha[alpha_x][alpha_y] == false)
					{
						RECT alpha_rect;
						alpha_rect.left = x+m_grid_rect.x+alpha_x*GRID_UNIT_PIXEL_X+1;
						alpha_rect.top = y+m_grid_rect.y+alpha_y*GRID_UNIT_PIXEL_Y+1;
						alpha_rect.right = alpha_rect.left+28;
						alpha_rect.bottom = alpha_rect.top+28;
						
						DrawAlphaBox(&alpha_rect, alpha_r, alpha_g, alpha_b, g_pUserOption->ALPHA_DEPTH);
					}
				}
			}

		}
		else
		{
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				m_pC_inventory_spk->BltLocked(x, y, INVENTORY_WINDOW);
				
				break;

			case RACE_VAMPIRE:
				m_pC_inventory_spk->BltLockedClip(x, y, rect, INVENTORY_WINDOW);
				break;

			case RACE_OUSTERS:
				m_pC_inventory_spk->BltLocked(x, y, INVENTORY_WINDOW);
				break;					
			}				
		}


		g_pInventory->SetBegin();
		while (g_pInventory->IsNotEnd())
		{
			
			MItem * p_item = g_pInventory->Get();
			
			
			// p_item은 NULL이 반드시 아니다. 왜냐하면 존재하는 것만 Get()하기 때문이다.
			assert(p_item);
			
			// frame id -> sprite id
			if(p_item)
			{
				TYPE_FRAMEID frame_id = p_item->GetInventoryFrameID();
				
				int item_x = x+GetFocusedItemGridX(p_item);
				int item_y = y+GetFocusedItemGridY(p_item);

				// Item이 놓여있는 영역 표시
				for (int j = 0; j < p_item->GetGridHeight(); j++)
				{
					for (int i = 0; i < p_item->GetGridWidth(); i++)
					{
						m_pC_inventory_spk->BltLocked(item_x+GRID_UNIT_PIXEL_X*i, 
							item_y+GRID_UNIT_PIXEL_Y*j,
							INVENTORY_ITEMBACK);
					}
				}
			}

			g_pInventory->Next();
		}

		//* 피의 계약 장착 슬롯을 출력한다.
		const int nSlotGap = 2;

		POINT ptContractOfBloodSlot = {
			m_grid_start_offset_x + nSlotGap + 240,
			m_grid_start_offset_y + nSlotGap,
		};

		SIZE sizeSlot = {
			m_pC_inventory_spk->GetWidth(INVENTORY_CONTRACT_OF_BLOOD_SLOT_1),
			m_pC_inventory_spk->GetHeight(INVENTORY_CONTRACT_OF_BLOOD_SLOT_1),
		};

		SIZE sizeSlotSet = {
			sizeSlot.cx*2 + nSlotGap*4,
			sizeSlot.cy*2 + nSlotGap*4,
		};
		
		for(int i = 0; i < 3; ++i)
		{
			int draw_y = ptContractOfBloodSlot.y;

			for(int iy = 0; iy < 2; ++iy)
			{
				int draw_x = ptContractOfBloodSlot.x;

				for(int ix = 0; ix < 2; ++ix)
				{
					m_pC_inventory_spk->BltLocked(
						x+draw_x, y+draw_y,
						INVENTORY_CONTRACT_OF_BLOOD_SLOT_1 + ix + iy*2);
					draw_x += sizeSlot.cx + nSlotGap*2;
				}
				
				draw_y += sizeSlot.cy + nSlotGap*2;
			}

			ptContractOfBloodSlot.y += sizeSlotSet.cy;
		}
		/**/

		if(g_eRaceInterface == RACE_VAMPIRE)
			// 뱀파이어 인터페이스는 하단 합체
			m_pC_inventory_spk->BltLocked(x, y+rect.h, INVENTORY_WINDOW_BOTTOM);
		
		
		gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+m_money_button_offset_x+25, y+m_money_button_offset_y, C_GLOBAL_RESOURCE::AB_MONEY_BAR);
		
		// show Item
		
		
		
		const MItem * p_selected_item = g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y);

		g_pInventory->SetBegin();
//		bool bl_alpha[10][6];	// 커헉-_- 하드코딩 아이템 놓인곳은 다르게 표현해야 하니까.. 남은부분은 따로 처리
//		ZeroMemory(bl_alpha, 10*6*sizeof(bool));
//		WriteLogLine(__LINE__);
		while (g_pInventory->IsNotEnd())
		{
			
			MItem * p_item = g_pInventory->Get();
			
			
			// p_item은 NULL이 반드시 아니다. 왜냐하면 존재하는 것만 Get()하기 때문이다.
			assert(p_item);

			// frame id -> sprite id
			if(p_item)
			{
				TYPE_FRAMEID frame_id = p_item->GetInventoryFrameID();

				if(p_item->GetItemClass() == ITEM_CLASS_SUB_INVENTORY &&
				   p_item->GetUseFrameID() != FRAMEID_NULL &&
				   gC_vs_ui.IsRunningSubInventory(p_item->GetID()))
				{
					frame_id = p_item->GetUseFrameID();
				}
				
				int item_x = x+GetFocusedItemGridX(p_item);
				int item_y = y+GetFocusedItemGridY(p_item);

				/*
				// Item이 놓여있는 영역 표시
				for (int j = 0; j < p_item->GetGridHeight(); j++)
				{
					for (int i = 0; i < p_item->GetGridWidth(); i++)
					{
						m_pC_inventory_spk->BltLocked(item_x+GRID_UNIT_PIXEL_X*i, 
							item_y+GRID_UNIT_PIXEL_Y*j,
							INVENTORY_ITEMBACK);
					}
				}
				*/
					
				
				item_x += (p_item->GetGridWidth()*GRID_UNIT_PIXEL_X)/2-gpC_item->GetWidth(frame_id)/2;
				item_y += (p_item->GetGridHeight()*GRID_UNIT_PIXEL_Y)/2-gpC_item->GetHeight(frame_id)/2;
//20081219 diesirace 크리스마스 트리의 끝까지 검색하도록 한다. 크리스마스 트리에서 검색대상이 되지 않는 아이템이 추가 되면 필히 아래 if문에 넣어주도록 한다.
//싸이즈가 다른 트리가 나올때 사용해 준다. 
				int endEventTree = (*g_pItemTable)[p_item->GetItemClass()].GetSize();
				int TreeSizeX = 3,TreeSizeY = 4;
				// 크리스마스 트리용 하드코딩
				if(p_item->GetItemClass() == ITEM_CLASS_EVENT_TREE 
					&& p_item->GetItemType() != 12
					&& p_item->GetItemType() != 25
					&& p_item->GetItemType() != 26
					&& p_item->GetItemType() != 27
					&& p_item->GetItemType() != 28
					&& p_item->GetItemType() != 41
					&& p_item->GetItemType() != 54	// 터프한 눈사람
#if __CONTENTS(__BLITZ_COUPON_EVENT)
					&& p_item->GetItemType() != 67	// 블리츠 문양
#endif //__BLITZ_COUPON_EVENT
#if __CONTENTS(__2008_AUTUMN_LEAVES_EVENT)
					&& p_item->GetItemType() != 80	// 낙엽 문양
#endif //__2008_AUTUMN_LEAVES_EVENT
					&& p_item->GetItemType() < endEventTree
					)
				{
					bool bTreeItem = false;
					int	 temp = 0;

					if(p_item->GetItemType() > 12 )
						temp = 13;

					if(p_item->GetItemType() >= 29 )
						temp = 29;

					if(p_item->GetItemType() >= 42 )
						temp = 42;

#if __CONTENTS(__BLITZ_COUPON_EVENT)
					if(p_item->GetItemType() >= 55 )
						temp = 55;
#endif //__BLITZ_COUPON_EVENT

#if __CONTENTS(__2008_AUTUMN_LEAVES_EVENT)
					if(p_item->GetItemType() >= 68 )
						temp = 68;
#endif //__2008_AUTUMN_LEAVES_EVENT
#if __CONTENTS(__CHRISTMAS_SOCKS_EVENT)
					if(p_item->GetItemType() >= 81 )
						temp = 81;
#endif //__CHRISTMAS_SOCKS_EVENT
					
					MItem *pTreeItem = NULL;
				
					// 위쪽
					pTreeItem = g_pInventory->GetItem(p_item->GetGridX(), p_item->GetGridY()-1);
					if(pTreeItem != NULL &&
						pTreeItem->GetItemClass() == ITEM_CLASS_EVENT_TREE &&
						pTreeItem->GetItemType() == p_item->GetItemType()-TreeSizeX
#if __CONTENTS(__EVENTTREE_PILE)
						&& pTreeItem->GetNumber() == 1
#endif //__EVENTTREE_PILE
						)
						bTreeItem = true;
					
					// 아래쪽
					pTreeItem = g_pInventory->GetItem(p_item->GetGridX(), p_item->GetGridY()+1);
					if(pTreeItem != NULL &&
						pTreeItem->GetItemClass() == ITEM_CLASS_EVENT_TREE &&
						pTreeItem->GetItemType() == p_item->GetItemType()+TreeSizeX
#if __CONTENTS(__EVENTTREE_PILE)
						&& pTreeItem->GetNumber() == 1
#endif //__EVENTTREE_PILE
						)
						bTreeItem = true;
					
					// 왼쪽
					pTreeItem = g_pInventory->GetItem(p_item->GetGridX()-1, p_item->GetGridY());
					if(pTreeItem != NULL &&
						pTreeItem->GetItemClass() == ITEM_CLASS_EVENT_TREE &&
						pTreeItem->GetItemType() == p_item->GetItemType()-1 &&
						(p_item->GetItemType()-temp)%TreeSizeX - 1 == (pTreeItem->GetItemType() -temp)%TreeSizeX
#if __CONTENTS(__EVENTTREE_PILE)
						&& pTreeItem->GetNumber() == 1
#endif //__EVENTTREE_PILE
						)
						bTreeItem = true;
					
					// 오른쪽
					pTreeItem = g_pInventory->GetItem(p_item->GetGridX()+1, p_item->GetGridY());
					if(pTreeItem != NULL &&
						pTreeItem->GetItemClass() == ITEM_CLASS_EVENT_TREE &&
						pTreeItem->GetItemType() == p_item->GetItemType()+1 &&
						(p_item->GetItemType()-temp)%TreeSizeX + 1 == (pTreeItem->GetItemType() -temp)%TreeSizeX
#if __CONTENTS(__EVENTTREE_PILE)
						&& pTreeItem->GetNumber() == 1
#endif //__EVENTTREE_PILE
						)
						bTreeItem = true;

#if __CONTENTS(__EVENTTREE_PILE)
					if(p_item->GetNumber() != 1)
						bTreeItem = false;
#endif //__EVENTTREE_PILE

					if (p_selected_item && (p_selected_item->GetID() == p_item->GetID()))
					{
						gpC_item->BltLockedOutlineOnly(item_x, item_y, WHITE, frame_id);
						
					}
					
					

					if(bTreeItem)
					{
						gpC_item->BltLocked(item_x, item_y, frame_id);
						
					}
					else
					{
						gpC_item->BltLockedDarkness(item_x, item_y, frame_id, 1);
						
					}
					
				}
				else
				if (p_selected_item && (p_selected_item->GetID() == p_item->GetID()))
				{
					if(p_item->IsSpecialColorItem() )
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetSpecialColorItemColorset(), 0);
					else if(const_cast<MItem *>(p_item)->GetItemOptionColorSet() >= OPTIONEXT_ITEM_COLOR)	 		
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetItemOptionExtColorSet(), 0);
					else			
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetItemOptionColorSet(), 0);
					gpC_item->BltLockedOutline(item_x, item_y, WHITE, frame_id);
					if(p_item->GetItemClass() == ITEM_CLASS_OUSTERS_WRISTLET && g_eRaceInterface == RACE_OUSTERS)
					{
						ITEMTABLE_INFO::ELEMENTAL_TYPE eType = (*g_pItemTable)[p_item->GetItemClass()][p_item->GetItemType()].ElementalType;
						if(eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_FIRE ||
							eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_WATER ||
							eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_EARTH
							)
						{
							gpC_global_resource->m_pC_info_spk->BltLockedOutline(x+GetFocusedItemGridX(p_item), y+GetFocusedItemGridY(p_item), RGB_WHITE, C_GLOBAL_RESOURCE::OUSTERS_ELEMENTAL_MARK_FIRE+eType);
							
						}
					}
					
				}
				else
				{
					if(p_item->GetPersnal() == true) 
						gpC_item->BltLockedOutlineOnly(item_x, item_y, DARKRED, frame_id);

//							gpC_item->BltLockedColorSet(item_x, item_y, frame_id, ITEM_DISABLE_COLOR_SET);
//						gpC_item->BltLockedOutlineOnly(item_x, item_y, DARKRED, frame_id);

						//gpC_item->BltLockedColor(item_x, item_y, frame_id, RGB(255,0,0));
					
						//gpC_item->BltLockedOutlineOnly(item_x, item_y, DARKRED, frame_id);
					if (p_item->IsSpecialColorItem() )
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetSpecialColorItemColorset(), 0);
#if __CONTENTS(__ONIBLA_ITEM)
					else if (p_item->IsSeniorItem())
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetSeniorItemColorSet(), 0);
#endif //__ONIBLA_ITEM					
					else if (const_cast<MItem *>(p_item)->GetItemOptionColorSet() >= OPTIONEXT_ITEM_COLOR)
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetItemOptionExtColorSet(), 0);
					else			
						CIndexSprite::SetUsingColorSet(const_cast<MItem *>(p_item)->GetItemOptionColorSet(), 0);
					
					
					if (p_item->IsAffectStatus() || p_item->IsQuestItem() )
					{
						// frame id -> sprite id
#if __CONTENTS(__TUNING_ITEM)
						if( p_item->IsTuningItem() )
						{
							gpC_item->BltLockedColorSet(item_x, item_y, frame_id,const_cast<MItem *>(p_item)->GetSpecialColorItemColorset());
						}
						else
#endif //__TUNING_ITEM
						{
							gpC_item->BltLocked(item_x, item_y, frame_id);
						}
					
						if(p_item->GetItemClass() == ITEM_CLASS_OUSTERS_WRISTLET && g_eRaceInterface == RACE_OUSTERS)
						{
							ITEMTABLE_INFO::ELEMENTAL_TYPE eType = (*g_pItemTable)[p_item->GetItemClass()][p_item->GetItemType()].ElementalType;
							if(eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_FIRE ||
								eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_WATER ||
								eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_EARTH
								)
							{
								gpC_global_resource->m_pC_info_spk->BltLocked(x+GetFocusedItemGridX(p_item), y+GetFocusedItemGridY(p_item), C_GLOBAL_RESOURCE::OUSTERS_ELEMENTAL_MARK_FIRE+eType);
								
							}
						}
					}
					else
					{
						gpC_item->BltLockedColorSet(item_x, item_y, frame_id, ITEM_DISABLE_COLOR_SET);
						if(p_item->GetItemClass() == ITEM_CLASS_OUSTERS_WRISTLET && g_eRaceInterface == RACE_OUSTERS)
						{
							ITEMTABLE_INFO::ELEMENTAL_TYPE eType = (*g_pItemTable)[p_item->GetItemClass()][p_item->GetItemType()].ElementalType;
							if(eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_FIRE ||
								eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_WATER ||
								eType == ITEMTABLE_INFO::ELEMENTAL_TYPE_EARTH
								)
							{
								gpC_global_resource->m_pC_info_spk->BltLockedColor(x+GetFocusedItemGridX(p_item), y+GetFocusedItemGridY(p_item), C_GLOBAL_RESOURCE::OUSTERS_ELEMENTAL_MARK_FIRE+eType, 0);
								
							}
						}
					}

					if(p_item->GetPersnal() == true) 
						gpC_item->BltLockedDarkness(item_x, item_y, frame_id, 1);

				}
			}
			g_pInventory->Next();
		}
		
		/*
		if(GetAttributes()->alpha)
		{
			
			int alpha_r, alpha_g, alpha_b;
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				alpha_r = 0;
				alpha_g = 2;
				alpha_b = 2;
				break;

			case RACE_VAMPIRE:
				alpha_r = 2;
				alpha_g = 0;
				alpha_b = 0;
				break;

			case RACE_OUSTERS:
				alpha_r = 0;
				alpha_g = 2;
				alpha_b = 0;
				break;				
			}
			
			
			for(int alpha_x = 0; alpha_x < 10; alpha_x++)
			{
				for(int alpha_y = 0; alpha_y < 6; alpha_y++)
				{
					if(bl_alpha[alpha_x][alpha_y] == false)
					{
						RECT alpha_rect;
						alpha_rect.left = x+m_grid_rect.x+alpha_x*GRID_UNIT_PIXEL_X+1;
						alpha_rect.top = y+m_grid_rect.y+alpha_y*GRID_UNIT_PIXEL_Y+1;
						alpha_rect.right = alpha_rect.left+28;
						alpha_rect.bottom = alpha_rect.top+28;
						
						DrawAlphaBox(&alpha_rect, alpha_r, alpha_g, alpha_b, g_pUserOption->ALPHA_DEPTH);
					}
				}
			}
			
		}
		/**/
		
		//
		// Item을 들고 있으면 grid 위치를 미리 알 수 있도록 한다.
		//
		if (gpC_mouse_pointer->GetPickUpItem() && 
			m_focus_grid_x != NOT_SELECTED && 
			m_focus_grid_y != NOT_SELECTED)
		{
			
			MItem * p_item = gpC_mouse_pointer->GetPickUpItem();
			
			TYPE_FRAMEID frame_id = p_item->GetInventoryFrameID();
			int item_x = x+m_grid_rect.x+GRID_UNIT_PIXEL_X*m_focus_grid_x+(p_item->GetGridWidth()*GRID_UNIT_PIXEL_X)/2-gpC_item->GetWidth(frame_id)/2;
			int item_y = y+m_grid_rect.y+GRID_UNIT_PIXEL_Y*m_focus_grid_y+(p_item->GetGridHeight()*GRID_UNIT_PIXEL_Y)/2-gpC_item->GetHeight(frame_id)/2;
			
			MItem * p_old_item;
			
			if (g_pInventory->CanReplaceItem(p_item, m_focus_grid_x, m_focus_grid_y, p_old_item))
			{
				if (p_old_item)
					gpC_item->BltLockedOutlineOnly(item_x, item_y, ga_item_blink_color_table[g_blink_value], frame_id);
				else
					
					gpC_item->BltLockedOutlineOnly(item_x, item_y, POSSIBLE_COLOR, frame_id);				
			}
			else
			{
				gpC_item->BltLockedOutlineOnly(item_x, item_y, IMPOSSIBLE_COLOR, frame_id);
				
			}
		}

		//지뢰 설치 Progress Bar
		if(gbl_mine_progress)
		{
			const MItem * p_item = g_pInventory->GetItem(m_mine_grid_x, m_mine_grid_y);
			
			if (p_item && (p_item->GetItemClass() == ITEM_CLASS_MINE || p_item->GetItemClass() == ITEM_CLASS_BOMB_MATERIAL)) // Item이 있다.
			{
				if(Timer())
				{
					gpC_base->SendMessage(UI_ITEM_USE, p_item->GetID(), 0, (MItem *)p_item);
					
					EndInstallMineProgress();
					
				}
				else
				{
					TYPE_FRAMEID frame_id = p_item->GetInventoryFrameID();
					int item_x = x+GetFocusedItemGridX(p_item)+(p_item->GetGridWidth()*GRID_UNIT_PIXEL_X)/2-m_pC_mine_progress_spk->GetWidth(INVENTORY_BAR_BACK)/2;
					int item_y = y+GetFocusedItemGridY(p_item)+1;
					
					m_pC_mine_progress_spk->BltLocked(item_x, item_y, INVENTORY_BAR_BACK);
					
					Rect rect;
					rect.Set(0, 0, m_pC_mine_progress_spk->GetWidth(INVENTORY_BAR)*(GetTickCount() - gi_mine_progress)/m_dw_millisec, m_pC_mine_progress_spk->GetHeight(INVENTORY_BAR));
					m_pC_mine_progress_spk->BltLockedClip(item_x, item_y, rect, INVENTORY_BAR);
					
				}
			}
		}
		
		m_pC_button_group->Show();
		
		gpC_base->m_p_DDSurface_back->Unlock();
	}
	//
	// 아이템 개수 표시
	//
	int len = 0;
	RECT rect[60];
	int num[60];
	
	g_pInventory->SetBegin();
	WriteLogLine(__LINE__);
	
	while (g_pInventory->IsNotEnd())
	{
		
		const MItem * p_item = g_pInventory->Get();
		
		// p_item은 NULL이 반드시 아니다. 왜냐하면 존재하는 것만 Get()하기 때문이다.
		
				// 아이템 개수표시

		if( p_item == NULL )
		{			
			sprintf(g_szBugReportBuffer,"Inventory::Show itemnum ItemNULL");
			gpC_base->SendMessage( UI_SEND_BUG_REPORT, __LINE__,0,g_szBugReportBuffer);
		}

		assert(p_item);
		
		
		if(p_item->IsPileItem() || (p_item->IsChargeItem() && p_item->GetItemClass() != ITEM_CLASS_VAMPIRE_PORTAL_ITEM))
		{
			RECT rt;
			
			rt.right = x+GetFocusedItemGridX(p_item) + p_item->GetGridWidth()*GRID_UNIT_PIXEL_X-1;
			
			for(int depth = 0, number = p_item->GetNumber(); number > 0; number/=10, depth++);
			
			if(depth == 0) depth = 1;
			rt.left = rt.right - 7*depth;
			
			rt.bottom = y+GetFocusedItemGridY(p_item) + p_item->GetGridHeight()*GRID_UNIT_PIXEL_Y;
			
			rt.top = rt.bottom - 12;
			
			rect[len] = rt;
			rt.left = max(0, rt.left);
			rt.top = max(0, rt.top);
			
			if(rt.left < rt.right && rt.top < rt.bottom)DrawAlphaBox(&rt, 0, 0, 0, g_pUserOption->ALPHA_DEPTH);
			num[len] = p_item->GetNumber();
			
			len++;
		}


		g_pInventory->Next();
	}
	WriteLogLine(__LINE__);
	
	char sz_temp[512];
	g_FL2_GetDC();	
	COLORREF markColor = RGB(220, 220, 220);//RGB(140, 140, 255);
	
	for(int i = 0; i < len; i++)
	{
		wsprintf(sz_temp, "%d", num[i]);
		g_PrintColorStr(rect[i].left, rect[i].top, sz_temp, gpC_base->m_item_desc_pi, markColor);	
	}
	WriteLogLine(__LINE__);
	// show money

	// 2004, 12, 14, sobeit modify start - 오른쪽 정렬 폰트 사용
	if(NULL != g_pMoneyManager)
	{
		if(gC_ci->IsKorean() && g_pUserOption->ShowGameMoneyWithHANGUL)
		{
			std::string sstr = g_GetStringByMoney(g_pMoneyManager->GetMoney());
			g_Print(x+m_money_button_offset_x+147, y+m_money_button_offset_y+4, sstr.c_str(), &gpC_base->m_money2_pi);
		}
		else
		{
			char money_buf[512] = {0,};
			if( g_pMoneyManager != NULL )
				wsprintf(money_buf, "%d", g_pMoneyManager->GetMoney());
			
			std::string sstr = money_buf;
			
			for(i = 3; i <= 13; i += 4)
				if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
			
			WriteLogLine(__LINE__);
			sprintf(money_buf, "%s", sstr.c_str());

			g_Print(x+m_money_button_offset_x+147, y+m_money_button_offset_y+4, money_buf, &gpC_base->m_money2_pi);
		}
	}
	
	// 2004, 12, 14, sobeit modify end



	//////////////////////////////////////////////////////////////////////////
	// 2009.09.14 chyaya
	// Gear Item Quick View



// 			g_FL2_GetDC();
// 			g_PrintColorStr(startX, startY-stringOffsetY-15, "착용중인 아이템",  gpC_base->m_info_pi, RGB_WHITE);
// 			g_FL2_ReleaseDC();
		
	
	//
	//////////////////////////////////////////////////////////////////////////
	



	WriteLogLine(__LINE__);
	
		
	WriteLogLine(__LINE__);
	m_pC_button_group->ShowDescription();
	g_FL2_ReleaseDC();
	WriteLogLine(__LINE__);
			
	DrawInventoryEffect();
	WriteLogLine(__LINE__);
		
	SHOW_WINDOW_ATTR;
		
		//
		// -- TEST
		//
#ifndef _LIB
		/*
		if (gpC_base->m_p_DDSurface_back->Lock())
		{
		S_SURFACEINFO	surface_info;
		S_RECT			rect;
		SetSurfaceInfo(&surface_info, gpC_base->m_p_DDSurface_back->GetDDSD());
		
		  // Grid 전체영역 표시 
		  rectangle(&surface_info, &m_grid_rect, GREEN);
		  
			//rectangle(&surface_info, &m_money_button_rect, WHITE);
			//rectangle(&surface_info, &m_close_button_rect, WHITE);
			
			  // 마우스 focus된 Grid 한 칸 표시
			  if (m_focus_grid_x != NOT_SELECTED && m_focus_grid_y != NOT_SELECTED)
			  {
			  SetRect(rect, m_grid_rect.x+(GRID_UNIT_PIXEL_X)*m_focus_grid_x,
			  m_grid_rect.y+(GRID_UNIT_PIXEL_Y)*m_focus_grid_y,
			  GRID_UNIT_PIXEL_X,
			  GRID_UNIT_PIXEL_Y);
			  
				filledRect(&surface_info, &rect, BLUE);
				}
				
				  for (int i=0; i < ITEM_REF_POINT_COUNT; i++)
				  {
				  //	putPixel(&surface_info, 
				  //		      g_item_ref_point[i].x+gpC_mouse_pointer->GetPointerX(),
				  //				g_item_ref_point[i].y+gpC_mouse_pointer->GetPointerY(),
				  //				RED);
				  }
				  
					gpC_base->m_p_DDSurface_back->Unlock();
					
					  char str[100];
					  
						sprintf(str, "focus grid (x, y) = %d, %d", m_focus_grid_x, m_focus_grid_y);
						g_Print(10, 420, str);
	}*/
#endif
	SetDebugEnd();
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::MouseControl
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_INVENTORY::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	
	bool re = m_pC_button_group->MouseControl(message, _x, _y);
	
	const MItem * p_selected_item;
	
	switch (message)
	{
	case M_MOVING:
		
		//
		int i;
		int loop;
		int px, py;
		
		if (gpC_mouse_pointer->GetPickUpItem())
			loop = ITEM_REF_POINT_COUNT;
		else
		{
			loop = 1;
		}
		
		for (i=0; i < loop; i++)
		{
			if (loop == ITEM_REF_POINT_COUNT)
			{
				px = g_item_ref_point[i].x+gpC_mouse_pointer->GetPointerX()-x;
				py = g_item_ref_point[i].y+gpC_mouse_pointer->GetPointerY()-y;
			}
			else
			{
				px = _x;
				py = _y;
			}
			
			// search grid
			int distance_x = px - m_grid_rect.x;
			int distance_y = py - m_grid_rect.y;
			
			if (distance_x >= 0 && distance_x < m_grid_rect.w && 
				distance_y >= 0 && distance_y < m_grid_rect.h)
			{
				if(gpC_Imm != NULL && (m_focus_grid_x != distance_x/GRID_UNIT_PIXEL_X || m_focus_grid_y != distance_y/GRID_UNIT_PIXEL_Y))
					gpC_Imm->ForceUI(CImm::FORCE_UI_GRID);
				m_focus_grid_x = distance_x/GRID_UNIT_PIXEL_X;
				m_focus_grid_y = distance_y/GRID_UNIT_PIXEL_Y;
				
				if (loop == ITEM_REF_POINT_COUNT)
				{
					// item이 grid 영역에 어느정도 들어오면 안으로 위치시킨다.
					const MItem * p_pickup_item = gpC_mouse_pointer->GetPickUpItem();
					int a, b;
					switch (i)
					{
					case 0: // left up - first!
						a = m_focus_grid_x+p_pickup_item->GetGridWidth()-GRID_X;
						b = m_focus_grid_y+p_pickup_item->GetGridHeight()-GRID_Y;
						if (a > 0)
							m_focus_grid_x -= a;
						if (b > 0)
							m_focus_grid_y -= b;
						break;
						
					case 1: // right up
						m_focus_grid_x = 0;
						b = m_focus_grid_y+p_pickup_item->GetGridHeight()-GRID_Y;
						if (b > 0)
							m_focus_grid_y -= b;
						break;
						
					case 2: // left down
						m_focus_grid_y = 0;
						a = m_focus_grid_x+p_pickup_item->GetGridWidth()-GRID_X;
						if (a > 0)
							m_focus_grid_x -= a;
						break;
						
					case 3: // right down
						m_focus_grid_y = 0;
						if (m_focus_grid_x+1 <= p_pickup_item->GetGridHeight())
							m_focus_grid_x = 0;
					}
				}
				 
				p_selected_item = g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y);
				
				if (p_selected_item != NULL)
				{
					MItem *pMouseItem = gpC_mouse_pointer->GetPickUpItem();
					g_descriptor_manager.Set(DID_ITEM, x+GetFocusedItemGridX(p_selected_item), y+GetFocusedItemGridY(p_selected_item), (void *)p_selected_item);


#if __CONTENTS(__REPAIRSYSTEM_RENEWAL)
					if(gbl_repair_running && 
						!g_pPriceManager->IsRepairPriceListHave(p_selected_item->GetID()) &&
						p_selected_item->GetID() != g_pPriceManager->GetOldRepairItemID() &&
						p_selected_item->IsRepairableItem()
						)
					{
						gpC_base->SendMessage(UI_REQUEST_REPAIRINFO, 0, 0, (void*)p_selected_item);
						g_pPriceManager->SetOldRepairItemID(p_selected_item->GetID());
					}
#endif //__REPAIRSYSTEM_RENEWAL
				}
				
				return true;
				//					break; // escape 'for'
			}
		}
		if(m_focus_grid_x != NOT_SELECTED || m_focus_grid_y != NOT_SELECTED)
			gpC_Imm->ForceUI(CImm::FORCE_UI_GRID);
		m_focus_grid_x = NOT_SELECTED;
		m_focus_grid_y = NOT_SELECTED;
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:

			if(gC_vs_ui.inventory_mode == 2) 
				return false;

			// by csm 개인상점에 있는 물건을 집을 수 없다. 
//			g_pInventory->SetBegin();
//			while (g_pInventory->IsNotEnd())
			{
				MItem * p_item = g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y);
				if(p_item)
				{
					if(p_item->GetPersnal() == true) 
					{
						return true;
						break; 
					}
					
				}
//				g_pInventory->Next();
			}


			if(gC_vs_ui.inventory_mode != 1)// 개인상점 오픈모드 
			{
				if (gC_vs_ui.inventory_mode == NULL && gpC_mouse_pointer->GetPickUpItem() == NULL && re && g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y) == NULL)
					//TestGridRect(_x, _y) == false && re)
				{
					MoveReady();
					SetOrigin(_x, _y);
					break;
				}
				
				//
				// Item을 집던가 놓는다.
				//
				{
					bool ret = Click(m_grid_rect.x, m_grid_rect.y);
					
					if (ret)
						EMPTY_MOVE;
				}
			}
			

		//
		// money button / close button
		//
		/*			if (m_bl_money_button_focused)
		m_bl_money_button_pushed = true;
		else if (m_bl_desc_button_focused)
		m_bl_desc_button_pushed = true;
		else if (m_bl_bike_button_focused)
		m_bl_bike_button_pushed = true;
		else if (m_bl_close_button_focused)
		m_bl_close_button_pushed = true;
		else if (m_bl_help_button_focused)
		m_bl_help_button_pushed = true;
		*/			break;
		
	case M_LEFTBUTTON_UP:
		CancelPushState();
		break;
		
	case M_RIGHTBUTTON_DOWN:
		//
		// Item을 사용한다.
		//
		if((!gC_vs_ui.IsRunningStorage()||gC_vs_ui.IsRunningPetStorage())
			&& (gC_vs_ui.IsRunningStorage()||!gC_vs_ui.IsRunningPetStorage())
			)
		{
			if(gC_vs_ui.inventory_mode == 1)
			{
				MItem * p_item = g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y);			
				m_p_persnal_item = p_item;
				if(g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y) != NULL)
				{
					
					MItem * p_item = g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y);
					if (p_item != NULL)
					{
						if( (p_item->GetItemClass() == ITEM_CLASS_EVENT_STAR &&	!g_pSystemAvailableManager->IsAvailableEnchantSystem())
							|| (p_item->GetItemClass() == ITEM_CLASS_SLAYER_PORTAL_ITEM && p_item->GetItemType() != 3)
							// sjheon 2006.03.08 
							|| ((p_item->GetItemClass() == ITEM_CLASS_COMMON_QUEST_ITEM) && p_item->GetItemType() >= 0 && p_item->GetItemType() < 6)
							|| ( p_item->GetItemClass() == ITEM_CLASS_EFFECT_ITEM && (p_item->GetItemType() >= 20 && p_item->GetItemType() <= 23)) //)		// 광폭의 향 ~ 철벽의 향
							
							
							|| ( p_item->GetItemClass() == ITEM_CLASS_OUSTERS_HARMONIC_PENDENT) //결속의 펜던트 
							|| ( p_item->GetItemClass() == ITEM_CLASS_CHECK_MONEY) //수표
							
							
							|| ( p_item->GetItemClass() == ITEM_CLASS_EVENT_GIFT_BOX && (p_item->GetItemType() == 27)) //감사의 선물 상자
							// sjheon 2005.05.02 봄나들이 아이템은 개인상점 , 이용을 할수 없다. Add
							|| ( p_item->GetItemClass() == ITEM_CLASS_EVENT_ITEM && (p_item->GetItemType() >= 32 && p_item->GetItemType() <= 36)))		// 풍선 머리띠 
							// sjheon 2005.05.02 봄나들이 아이템은 개인상점 , 이용을 할수 없다. end 
							break;
						
						m_pC_dialog_drop_money = new C_VS_UI_MONEY_DIALOG(x+m_money_button_offset_x, y+m_money_button_offset_y+gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_MONEY), 2, 0, 
							ExecF_SellConfirm2, DIALOG_OK|DIALOG_CANCEL, 10, 
							C_VS_UI_MONEY_DIALOG::MONEY_SELL_ITEM);	// by sigi
						m_pC_dialog_drop_money->Start();
						
					}
				}
				
			}
			else
			{
				if (gbl_sell_running == true)
				{
					int mx=x,my=y;
					if (gbl_item_trade_lock == false)
					{
						MItem * p_item = g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y);
						if(p_item && p_item->GetItemClass() == ITEM_CLASS_SKULL)
						{
							int price = 0;
							for(int y = 0; y < GRID_Y; y++)
							{
								for(int x = 0; x < GRID_X; x++)
								{
									MItem * p_sell_item = g_pInventory->GetItem(x, y);
									if(p_sell_item && p_sell_item->GetItemClass() == ITEM_CLASS_SKULL)
										price += g_pPriceManager->GetItemPrice(p_sell_item, MPriceManager::PC_TO_NPC)*p_sell_item->GetNumber();
								}
							}
							if(g_pMoneyManager->CanAddMoney(price))
								g_StartSellAllConfirmDialog(
									mx+p_item->GetGridX()*GRID_UNIT_PIXEL_X, 
									my+(1+p_item->GetGridY()+p_item->GetGridWidth())*GRID_UNIT_PIXEL_Y, price);
							else
								g_StartCannotSellConfirmDialog(mx+p_item->GetGridX()*GRID_UNIT_PIXEL_X, 
									my+(1+p_item->GetGridY()+p_item->GetGridWidth())*GRID_UNIT_PIXEL_Y);

						}
					}
				}
				else Use();
				
			}
			break;
		}	
	case M_RIGHTBUTTON_UP:
		EndInstallMineProgress();
		break;

	case M_WHEEL_UP:
		--m_nGearItemQuickViewScroll;
		break;
	case M_WHEEL_DOWN:
		++m_nGearItemQuickViewScroll;
		break;
	}
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::ResetRect
//
// 전체 Grid rect를 설정한다. 이것은 Inventory의 이동이 있을 때마다 해줘야 한다.
//-----------------------------------------------------------------------------
void C_VS_UI_INVENTORY::ResetRect()
{
	m_grid_rect.Set(m_grid_start_offset_x, 
								m_grid_start_offset_y, 
								GRID_UNIT_PIXEL_X*GRID_X, GRID_UNIT_PIXEL_Y*GRID_Y);
	
								/*	m_money_button_rect.Set(x+m_money_button_offset_x, y+m_money_button_offset_y,
								m_pC_etc_button_spk->GetWidth(MONEY_BUTTON_PUSHED),
								m_pC_etc_button_spk->GetHeight(MONEY_BUTTON_PUSHED));
								
								  m_desc_button_rect.Set(x+m_desc_button_offset_x, y+m_desc_button_offset_y,
								  m_pC_etc_button_spk->GetWidth(DESC_BUTTON_PUSHED),
								  m_pC_etc_button_spk->GetHeight(DESC_BUTTON_PUSHED));
								  
									m_bike_button_rect.Set(x+m_bike_button_offset_x, y+m_bike_button_offset_y,
									m_pC_etc_button_spk->GetWidth(BIKE_BUTTON_PUSHED),
									m_pC_etc_button_spk->GetHeight(BIKE_BUTTON_PUSHED));
									
									  m_close_button_rect.Set(x+m_close_button_offset_x, y+m_close_button_offset_y,
									  gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_CLOSE),
									  gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_CLOSE));
									  
										m_help_button_rect.Set(x+m_help_button_offset_x, y+m_help_button_offset_y,
										gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_HELP),
										gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_HELP));
	*/
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::Use
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INVENTORY::Use()
{
	if (m_focus_grid_x == NOT_SELECTED || m_focus_grid_y == NOT_SELECTED ||
		gbl_item_lock /*|| gbl_gear_lock*/)
		return;
	
	
	if (gpC_mouse_pointer->GetPickUpItem())
	{
		
	}
	else
	{
		const MItem * p_item = g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y);
		
		if (p_item) // Item이 있다.
		{
			m_mine_grid_x = m_focus_grid_x;
			m_mine_grid_y = m_focus_grid_y;

#ifdef _LIB
			BYTE PlayerAction = g_pPlayer->GetAction();
#else
			BYTE PlayerAction = ACTION_STAND;
#endif
	
			// 스킬 사용 중에 변신을 할 수 없다.
			if( ( ( p_item->GetItemClass() == ITEM_CLASS_VAMPIRE_ETC &&				// 박쥐랑 늑대
				    p_item->GetItemType() >= 0 && p_item->GetItemType() <= 1 ) ||
				  ( p_item->GetItemClass() == ITEM_CLASS_SKULL &&					// 던 울프아크
    				p_item->GetItemType() == 39 ) )
			   && ( PlayerAction != ACTION_STAND &&	// 가만히 있을때 혹은 걷고 있을 때는 아이템 사용 불가
				    PlayerAction != ACTION_MOVE ) )
			{
				return;
			}
			else
			if(p_item->GetItemClass() == ITEM_CLASS_PET_FOOD)
			{
				PETINFO *pPetInfo = gC_vs_ui.GetMyPetInfo();
				if( pPetInfo != NULL && pPetInfo->EXIST )
				{
					TYPE_ITEMTYPE itemType = pPetInfo->ITEM_TYPE;
					TYPE_ITEMTYPE foodType = p_item->GetItemType();
					if( (( foodType >=0 && foodType <= 5)
#if __CONTENTS(__PET_FOOD_ITEM_ADD)
						|| (foodType == 18 || foodType == 19)
#endif //__PET_FOOD_ITEM_ADD
#if __CONTENTS(__FUNCTION_PETFOOD)
						|| (foodType == 20 || foodType == 21)
#endif //__FUNCTION_PETFOOD
#if __CONTENTS(__FUNCTION_PETFOOD_SMART)
						|| (foodType == 22 || foodType == 23)
#endif //__FUNCTION_PETFOOD_SMART
#if __CONTENTS(__20091028_ADD_ITEM)
						|| foodType == 24
#endif //__20091028_ADD_ITEM
						&& (itemType == 1 || itemType == 2 || itemType == 6 || itemType == 7 || itemType == 8
#if __CONTENTS(__NEW_PET_FIRE_ELEMENTAL)
							|| itemType == 9
#endif //__NEW_PET_FIRE_ELEMENTAL
#if __CONTENTS(__2008_OCTOBER_MAKETITEM)
							|| itemType == 10
#endif //__2008_OCTOBER_MAKETITEM
#if __CONTENTS(__NEW_PET_INCUBUS)
							|| itemType == 11
#endif //__NEW_PET_INCUBUS
#if __CONTENTS(__PET_MASHIMARO)
							|| itemType == 12
#endif //__PET_MASHIMARO
#if __CONTENTS(__PET_CATS)
							|| itemType == 13
							|| itemType == 14
							|| itemType == 15
#endif //__PET_CATS
#if __CONTENTS(__PET_CATS_UPGRADED)
							|| (itemType >= 16 && itemType <= 27)
#endif //__PET_CATS_UPGRADED
#if __CONTENTS(__UPGRADE_MONSTER_PET)
							|| (itemType >= 28 && itemType <= 65)
#endif //__UPGRADE_MONSTER_PET
						) ) ||
						(foodType >= 6 && foodType <= 9 && itemType == 3) ||
						(foodType >= 10 && foodType <= 13 && itemType == 4)||
						(foodType >= 14 && foodType <= 17 && itemType == 5))
					{
						gC_vs_ui.RunUsePetFood();
					}
					return;
				}
			}
			else 
			if(p_item->GetItemClass() == ITEM_CLASS_PET_ITEM &&
				p_item->GetItemType() >= 3 && p_item->GetItemType() <= 5) // 2차 펫 소환아이템 이면
			{
				switch(g_eRaceInterface)
				{
					case RACE_SLAYER:
						if((*g_pSkillManager)[SKILLDOMAIN_BLADE].GetDomainLevel() < 40 &&
						(*g_pSkillManager)[SKILLDOMAIN_SWORD].GetDomainLevel() < 40 &&
						(*g_pSkillManager)[SKILLDOMAIN_GUN].GetDomainLevel() < 40 &&
						(*g_pSkillManager)[SKILLDOMAIN_HEAL].GetDomainLevel() < 40 &&
						(*g_pSkillManager)[SKILLDOMAIN_ENCHANT].GetDomainLevel() < 40)
//						if(g_char_slot_ingame.DOMAIN_BLADE		< 40 &&
//							g_char_slot_ingame.DOMAIN_ENCHANT	< 40 &&
//							g_char_slot_ingame.DOMAIN_GUN		< 40 &&
//							g_char_slot_ingame.DOMAIN_HEAL		< 40 &&
//							g_char_slot_ingame.DOMAIN_SWORD) // 렙 40 이하는 못 쓴다.
							{
								gpC_base->SendMessage(UI_MESSAGE_BOX, UI_STRING_MESSAGE_CANNOT_SUMMON_2ND_PET, 0, 	NULL);
								return;
							}
						break;

					case RACE_VAMPIRE:
					case RACE_OUSTERS:
						if(g_char_slot_ingame.level < 40)
						{
							gpC_base->SendMessage(UI_MESSAGE_BOX, UI_STRING_MESSAGE_CANNOT_SUMMON_2ND_PET, 0, 	NULL);
							return;
						}
						break;		
				}
			}
			else 
			if(p_item->GetItemClass() == ITEM_CLASS_SMS_ITEM)
			{
				gC_vs_ui.RunAskUseItemDialog(C_VS_UI_ASK_DIALOG::ASK_USE_SMSITEM);
				return;
			}
			else
			if(p_item->GetItemClass() == ITEM_CLASS_EVENT_GIFT_BOX &&
				p_item->GetItemType() > 21 && p_item->GetItemType() < 26)
			{
				gC_vs_ui.RunAskUseItemDialog(C_VS_UI_ASK_DIALOG::ASK_USE_NAMINGITEM);
				return;
			}
			else
			if(p_item->GetItemClass() == ITEM_CLASS_SKILL_BOOK )
			{
				bool bSlayer = p_item->IsSlayerItem() && g_eRaceInterface == RACE_SLAYER;
				bool bVampire = p_item->IsVampireItem() && g_eRaceInterface == RACE_VAMPIRE;
				bool bOusters = p_item->IsOustersItem() && g_eRaceInterface == RACE_OUSTERS;

				gC_vs_ui.RunAskUseItemDialog(C_VS_UI_ASK_DIALOG::ASK_USE_SKILL_BOOK);
				
				return;
			}

			
			if(IsPlayerInSafePosition() && (p_item->GetItemClass() == ITEM_CLASS_BOMB_MATERIAL || p_item->GetItemClass() == ITEM_CLASS_MINE))
				return;

			if(p_item->GetItemClass() == ITEM_CLASS_DYE_POTION && p_item->GetItemType() == 48)
			{
				// 재확인해야하는거면
				g_pTempItem = const_cast<MItem*>(p_item);
				g_StartConfirmChangeSex( -1, -1 );				
			} 
			else if(StartInstallMineProgress(m_focus_grid_x, m_focus_grid_y) == false &&
				StartCreateMineProgress(m_focus_grid_x, m_focus_grid_y) == false &&
				StartCreateBombProgress(m_focus_grid_x, m_focus_grid_y) == false				
				)
			{
							
				gpC_base->SendMessage(UI_ITEM_USE, p_item->GetID(), 0, (MItem *)p_item); 
			}

		}
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::StartInstallMineProgress
//-----------------------------------------------------------------------------
bool C_VS_UI_INVENTORY::StartInstallMineProgress(int focus_grid_x, int focus_grid_y)
{
	if(IsPlayerInSafePosition())
		return false;
	
	const MItem * p_item = g_pInventory->GetItem(focus_grid_x, focus_grid_y);
	if(p_item != NULL && g_eRaceInterface == RACE_SLAYER && p_item->GetItemClass() == ITEM_CLASS_MINE &&
		g_pSkillAvailable->IsEnableSkill( SKILL_INSTALL_MINE )
		&& (*g_pSkillInfoTable)[SKILL_INSTALL_MINE].IsEnable()
		&& (*g_pSkillInfoTable)[SKILL_INSTALL_MINE].IsAvailableTime()
		)	// 지뢰인경우 지뢰 progress바 보여줌
	{
		int mine_level = (*g_pSkillInfoTable)[SKILL_INSTALL_MINE].GetExpLevel();
//		m_dw_millisec = min(30, max(20, 30-mine_level/10))*100;
		m_dw_millisec = ( 10 - ( mine_level /25 ) ) * 1000;
		Timer(true);
		gbl_mine_progress = true;
		m_mine_grid_x = focus_grid_x;
		m_mine_grid_y = focus_grid_y;
	}
	else
		gbl_mine_progress = false;
	
	return gbl_mine_progress;
}

// 0~4 : BOMB MATERIAL 5~9 : MINE MATERIAL
//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::StartCreateMineProgress
//-----------------------------------------------------------------------------
bool C_VS_UI_INVENTORY::StartCreateMineProgress(int focus_grid_x, int focus_grid_y)
{
	if(IsPlayerInSafePosition())
		return false;
	
	const MItem * p_item = g_pInventory->GetItem(focus_grid_x, focus_grid_y);
	if(p_item != NULL && g_eRaceInterface == RACE_SLAYER && p_item->GetItemClass() == ITEM_CLASS_BOMB_MATERIAL && p_item->GetItemType() > 4 &&
		g_pSkillAvailable->IsEnableSkill( SKILL_MAKE_MINE )
		&& (*g_pSkillInfoTable)[SKILL_MAKE_MINE].IsEnable()
		&& (*g_pSkillInfoTable)[SKILL_MAKE_MINE].IsAvailableTime()
		)	// 지뢰인경우 지뢰 progress바 보여줌
	{
		int mine_level = (*g_pSkillInfoTable)[SKILL_MAKE_MINE].GetExpLevel();
		m_dw_millisec = min(30, max(20, 30-mine_level/10))*100;

//		m_dw_millisec = ( 10 - ( mine_level /25 ) ) * 1000;
		Timer(true);
		gbl_mine_progress = true;
		m_mine_grid_x = focus_grid_x;
		m_mine_grid_y = focus_grid_y;
	}
	else
		gbl_mine_progress = false;
	
	return gbl_mine_progress;
}

// 0~4 : BOMB MATERIAL 5~9 : MINE MATERIAL
//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::StartCreateBombProgress
//-----------------------------------------------------------------------------
bool C_VS_UI_INVENTORY::StartCreateBombProgress(int focus_grid_x, int focus_grid_y)
{
	if(IsPlayerInSafePosition())
		return false;
	
	const MItem * p_item = g_pInventory->GetItem(focus_grid_x, focus_grid_y);
	if(p_item != NULL && g_eRaceInterface == RACE_SLAYER && p_item->GetItemClass() == ITEM_CLASS_BOMB_MATERIAL && p_item->GetItemType() < 5 &&
		g_pSkillAvailable->IsEnableSkill( SKILL_MAKE_BOMB )
		&& (*g_pSkillInfoTable)[SKILL_MAKE_BOMB].IsEnable()
		&& (*g_pSkillInfoTable)[SKILL_MAKE_BOMB].IsAvailableTime()
		)	// 지뢰인경우 지뢰 progress바 보여줌
	{
		int mine_level = (*g_pSkillInfoTable)[SKILL_MAKE_BOMB].GetExpLevel();
		m_dw_millisec = min(30, max(20, 30-mine_level/10))*100;
		Timer(true);
		gbl_mine_progress = true;
		m_mine_grid_x = focus_grid_x;
		m_mine_grid_y = focus_grid_y;
	}
	else
		gbl_mine_progress = false;
	
	return gbl_mine_progress;
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::Click
//
// 현재 Item을 들고 있으면 놓던가 교체하고, 들고 있지 않으면 Inventory에 있는
// 것을 집는다.
//
// 뭔가 했다면 true를, 그렇지않으면 false를 반환한다.
//
// grid_start_x, grid_start_y는 inventory grid 시작점이다. 이것을 참조하여 item
// (x, y)를 구한다.
//-----------------------------------------------------------------------------
bool C_VS_UI_INVENTORY::Click(int grid_start_x, int grid_start_y)
{

//	g_pUserOption->DoNotShowItemBayMessageBox
	if (m_focus_grid_x == NOT_SELECTED || 
		m_focus_grid_y == NOT_SELECTED ||
		gbl_item_lock == true)
	{
		return false;
	}
		
	//	int item_x, item_y;

	m_bLimited_Item_Change	= FALSE;

#if __CONTENTS(__GEAR_SWAP_CHANGE)	//_CGAddMouseToGear.setGearSlotID(right);
		bool	bGearChange	= false;
		switch(g_pPlayer->GetRace())
		{
		case RACE_SLAYER:
			bGearChange		= g_pSlayerGear->GetProcessingGearChange();
			break;

		case RACE_VAMPIRE:
			bGearChange		= g_pVampireGear->GetProcessingGearChange();
			break;
		
		case RACE_OUSTERS:
			bGearChange		= g_pOustersGear->GetProcessingGearChange();
			break;
		}

		if(bGearChange)		//장착 창이 교체 중일때에는 아이템을 교체 할 수 없다.
		{
			return false;
		}
#endif	// __GEAR_SWAP_CHANGE

	const MItem* pMouseItem = gpC_mouse_pointer->GetPickUpItem();
	
	if (pMouseItem) // 들고 있는가?
	{
		const MItem* p_cur_item = g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y);

		if(p_cur_item && p_cur_item->GetItemClass() == ITEM_CLASS_SUB_INVENTORY)
			gpC_base->SendMessage(UI_CLOSE_INVENTORY_SUB, p_cur_item->GetID());

		// 펫 퓨리타스
		if(pMouseItem->GetItemClass() == ITEM_CLASS_MIXING_ITEM &&
			(pMouseItem->GetItemType() >= 9 && pMouseItem->GetItemType() <= 17)
			&& p_cur_item != NULL && p_cur_item->GetItemClass() == ITEM_CLASS_PET_ITEM && p_cur_item->GetItemOptionListCount() > 0	)
		{
			m_mine_grid_x = m_focus_grid_x;
			m_mine_grid_y = m_focus_grid_y;

			gC_vs_ui.RunEnchant(3);
			return false;
		}
#if __CONTENTS(__PET_MIXINGFORGE)
		if(pMouseItem->GetItemClass() == ITEM_CLASS_MIXING_ITEM &&
			pMouseItem->GetItemType() == 30 && 
			p_cur_item != NULL && p_cur_item->GetItemClass() == ITEM_CLASS_PET_ITEM && p_cur_item->GetPetMixingOptionListCount() > 0)
		{
			m_mine_grid_x = m_focus_grid_x;
			m_mine_grid_y = m_focus_grid_y;

			gC_vs_ui.RunEnchant(14);
			return false;
		}
#endif //__PET_MIXINGFORGE

		// 펫 인첸트
		if(pMouseItem->GetItemClass() == ITEM_CLASS_PET_ENCHANT_ITEM &&
			p_cur_item != NULL && p_cur_item->GetItemClass() == ITEM_CLASS_PET_ITEM)
		{
			int bCanUpgrade = 0;

			if((pMouseItem->GetItemType() < 13 || pMouseItem->GetItemType() >= 16 && pMouseItem->GetItemType() <= 19) &&	// 12까지는 레드 드롭
				p_cur_item->GetSilver() == 0 &&		// silver는 AttrLevel이 0인 경우는 속성이 없다고 보고 인첸트 가능
				p_cur_item->GetNumber() >= 10)		// 펫 레벨 10이상인경우
				bCanUpgrade = 1;

			if((pMouseItem->GetItemType() == 13 || pMouseItem->GetItemType() == 14)	&&	// 13, 14는 부활
				p_cur_item->GetCurrentDurability() == 0)		// 현재 HP가 0일때
				bCanUpgrade = 2;

#if __CONTENTS(__PET_VISION_AMPLE)
			if(pMouseItem->GetItemType() == 15 && p_cur_item->GetPet_RedBirdOptionNum() == 255	// 15는 레드 버드
#else
			if(pMouseItem->GetItemType() == 15 && p_cur_item->GetItemOptionListCount() == 0	// 15는 레드 버드
#endif //__PET_VISION_AMPLE
				|| pMouseItem->GetItemType() == 26											// 26은 레드 버드 2
				|| (pMouseItem->GetItemType() >= 27 && pMouseItem->GetItemType() <= 29)		// 27 ~ 29 스틱 (캡슐)
				)
				bCanUpgrade = 1;

#if __CONTENTS(__PET_VISION_AMPLE)
			if(pMouseItem->GetItemType() == 36||pMouseItem->GetItemType() == 49)// && p_cur_item->GetPet_AmpulOptionNum() == 255)	// 비젼앰플
				bCanUpgrade = 1;
#endif //__PET_VISION_AMPLE

			if(pMouseItem->GetItemType() == 20 && p_cur_item->GetItemType() > 1)
				bCanUpgrade = 5;
			

			if(pMouseItem->GetItemType() == 21 && p_cur_item->GetItemType() != 2 && pMouseItem->GetNumber() > 1) 
			{
				gpC_base->SendMessage(UI_ITEM_DROP_TO_INVENTORY, 
					m_focus_grid_x, m_focus_grid_y,
					(void *)pMouseItem);
				return false; 
			}

			if((pMouseItem->GetItemType() == 21 || pMouseItem->GetItemType() == 30) && p_cur_item->GetItemType() == 2)
			{
				C_VS_UI_POPUP_MESSAGE::PopupWindowStyle style;
				style.Style = C_VS_UI_POPUP_MESSAGE::STYLE_OK_BUTTON ; 
				style.WindowX = 400;
				style.WindowY = 150;
				style.Type = C_VS_UI_POPUP_MESSAGE::POPUP_NORMAL;
				style.str = (*g_pGameStringTable)[UI_STRING_MESSAGE_NOTUSE_ITEM].GetString();
				gC_vs_ui.RunPopupMessage( style );
				return false ; 
			}	
			
			if(pMouseItem->GetItemType() == 21 && pMouseItem->GetNumber() < 10 ) 
			{
				bCanUpgrade = 5;
			}
			
			if(pMouseItem->GetItemType() == 22 && pMouseItem->GetNumber() < 10) // && p_cur_item->GetSilver() > 0) 
			{
				if(p_cur_item->GetSilver() > 0)
					bCanUpgrade = 6;
				else if(p_cur_item->GetSilver() == 0)
				{
					C_VS_UI_POPUP_MESSAGE::PopupWindowStyle style;
					style.Style = C_VS_UI_POPUP_MESSAGE::STYLE_OK_BUTTON ; 
					style.WindowX = 400;
					style.WindowY = 200;
					style.Type = C_VS_UI_POPUP_MESSAGE::POPUP_NORMAL;
					style.str = (*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_PET_ATTRIBUTE_CLEANER_POTION].GetString();
					gC_vs_ui.RunPopupMessage( style );
					return false ; 
				}
			}

			if(pMouseItem->GetItemType() == 23) 
			{
				bCanUpgrade = 7 ;
			}

//			매지컬 펫 체인져 기능
 			if(pMouseItem->GetItemType() == 24) 
 			{
 				bCanUpgrade = 8 ;
 			}
			if(pMouseItem->GetItemType() == 25) 
			{
				bCanUpgrade = 8 ;
			}
			
			//20070813 괴도 루펭 인젝션 추가
			if(pMouseItem->GetItemType() == 30  && (p_cur_item->GetItemType() == 1 || p_cur_item->GetItemType() == 40))
			{
				bCanUpgrade = 5;
			}


			//20071114 밀리터리베어, 가고일 추가
			if(pMouseItem->GetItemType() == 31  && (p_cur_item->GetItemType() == 1 || p_cur_item->GetItemType() == 40))
			{
				bCanUpgrade = 5;
			}
			//20070813 괴도 루펭 인젝션 추가
			if(pMouseItem->GetItemType() == 32  && (p_cur_item->GetItemType() == 1 || p_cur_item->GetItemType() == 40))
			{
				bCanUpgrade = 5;
			}
#if __CONTENTS(__NEW_PET_FIRE_ELEMENTAL)
			if(pMouseItem->GetItemType() == 33  && (p_cur_item->GetItemType() == 1 || p_cur_item->GetItemType() == 40))
			{
				bCanUpgrade = 5;
			}
#endif __NEW_PET_FIRE_ELEMENTAL
#if __CONTENTS(__2008_OCTOBER_MAKETITEM)
			if(pMouseItem->GetItemType() == 34  && (p_cur_item->GetItemType() == 1 || p_cur_item->GetItemType() == 40))
			{
				bCanUpgrade = 5;
			}
#endif //__2008_OCTOBER_MAKETITEM
#if __CONTENTS(__NEW_PET_INCUBUS)
			if(pMouseItem->GetItemType() == 35  && (p_cur_item->GetItemType() == 1 || p_cur_item->GetItemType() == 40))
			{
				bCanUpgrade = 5;
			}
#endif //__NEW_PET_INCUBUS
#if __CONTENTS(__PET_MASHIMARO)
			if(pMouseItem->GetItemType() == 37  && (p_cur_item->GetItemType() == 1 || p_cur_item->GetItemType() == 40))
			{
				bCanUpgrade = 5;
			}
#endif //__PET_MASHIMARO
#if __CONTENTS(__PET_CATS)
			if(pMouseItem->GetItemType() >= 38 && pMouseItem->GetItemType() <= 40 && (p_cur_item->GetItemType() == 1 || p_cur_item->GetItemType() == 40))
			{
				bCanUpgrade = 5;
			}
#endif //__PET_CATS

#if __CONTENTS(__PET_CATS_UPGRADED)
			if (pMouseItem->GetItemType() >= 41 && pMouseItem->GetItemType() <= 52 && (p_cur_item->GetItemType() == 1 || p_cur_item->GetItemType() == 40))
			{
				bCanUpgrade = 5;
			}
#endif //__PET_CATS_UPGRADED

#if __CONTENTS(__UPGRADE_MONSTER_PET)
			if (pMouseItem->GetItemType() >= 53 && pMouseItem->GetItemType() <= 64 && (p_cur_item->GetItemType() == 1 || p_cur_item->GetItemType() == 40))
			{
				bCanUpgrade = 5;
			}
			if (pMouseItem->GetItemType() == 65 && (p_cur_item->GetItemType() != 0 && p_cur_item->GetItemType() != 40))
			{
				bCanUpgrade = 5;
			}
#endif //__UPGRADE_MONSTER_PET

			if(bCanUpgrade != 0)
			{
				m_mine_grid_x = m_focus_grid_x;
				m_mine_grid_y = m_focus_grid_y;
				
				gC_vs_ui.RunEnchant(bCanUpgrade);
			}

		}
		else
		// Enchant
		if(pMouseItem->GetItemClass() == ITEM_CLASS_EVENT_STAR && 
			pMouseItem->GetNumber() == 1 && p_cur_item != NULL && 
			p_cur_item->GetItemClass() != ITEM_CLASS_EVENT_STAR && p_cur_item->IsGearItem() 
			&& !p_cur_item->IsUniqueItem() && !p_cur_item->IsQuestItem() // && p_cur_item->IsItemOptionExt()  == 1
			&& p_cur_item->GetItemClass() != ITEM_CLASS_BLOOD_BIBLE &&
			p_cur_item->GetItemClass() != ITEM_CLASS_COUPLE_RING &&
			p_cur_item->GetItemClass() != ITEM_CLASS_VAMPIRE_COUPLE_RING &&
			p_cur_item->GetItemClass() != ITEM_CLASS_OUSTERS_HARMONIC_PENDENT
#if __CONTENTS(__IMI_NEW_ENCHANT_ITEM)
			&& (pMouseItem->GetItemType() < 73 || pMouseItem->GetItemType() > 77)	// 이벤트 스타 아이템이긴 한데...이건 인첸트 되지 않는 아이템이다..뭐 이런..!
#endif //__IMI_NEW_ENCHANT_ITEM
			)//p_cur_item->GetItemOptionListCount() <= 1)		// 레어 아이템일경우
		{	
#if __CONTENTS(__ENCHANT_REQUIRE_LEVE)
			if(!p_cur_item->IsAffectStatus() && !(pMouseItem->GetItemClass() == ITEM_CLASS_EVENT_STAR && pMouseItem->GetItemType() == 16))
			{
				char szBuf[128];
				sprintf(szBuf, (*g_pGameStringTable)[STRING_MESSAGE_CANNOT_ENCHANT_FROM_LEVEL].GetString(), 6);
				g_pUIDialog->PopupFreeMessageDlg(szBuf);
				return false;
			}
#endif	//__ENCHANT_REQUIRE_LEVE

			//p_item->IsUniqueItem()

			bool bCanUpgrade = false;
			bool ResultNoFail = false;

			if(pMouseItem->GetItemType() == 6)
			{
				bCanUpgrade = false;
			}

			// 송편일때
			else
			if(pMouseItem->GetItemType() == 16)
			{
				if(!p_cur_item->IsGenderForAll())
					bCanUpgrade = true;
				else
					bCanUpgrade = false;
			} else
			if(pMouseItem->GetItemType() == 12 || pMouseItem->GetItemType() == 82)			// 블루버드일때
			{
				if(p_cur_item->GetItemOptionListCount() == 2)
					bCanUpgrade = true;
				else
					bCanUpgrade = false;
			} else
			// 2005, 2, 21, sobeit add start 
			if(pMouseItem->GetItemType() == 22)			// 옐로우 드롭 // 급수를 올린다.
			{
				if(p_cur_item->GetGrade() > 0 &&  p_cur_item->GetGrade() < 6) // 1급 ~ 5급 까지만 사용 가능
				{
					ITEM_CLASS curitemclass = p_cur_item->GetItemClass();
					if( curitemclass == ITEM_CLASS_CORE_ZAP			||
						curitemclass == ITEM_CLASS_ETHEREAL_CHAIN	||
						curitemclass == ITEM_CLASS_CUE_OF_ADAM )
					{
						gpC_base->SendMessage(UI_MESSAGE_BOX, 
						STRING_MESSAGE_ITEM_TO_ITEM_IMPOSIBLE, 
						0, 
						NULL);
					}
					// 옵션이 2개 이상이면 실패
					else if(p_cur_item->GetItemOptionListCount()>1)
					{
						gpC_base->SendMessage(UI_MESSAGE_BOX, 
						UI_STRING_MESSAGE_CANNOT_USE_OVER_TWO_OPTION, 
						0, 
						NULL);
					}// 승직 아이템은 사용 불가
					else if( (*g_pItemTable)[p_cur_item->GetItemClass()][p_cur_item->GetItemType()].GetRequireAdvancementLevel() > 0 )
					{
						gpC_base->SendMessage(UI_MESSAGE_BOX, 
						UI_STRING_MESSAGE_CANNOT_USE_ADVANCEMENT_ITEM, 
						0, 
						NULL);
					}
					else
					{
						bCanUpgrade = true;
						ResultNoFail = true;
					}
				}
				else
				{
// 					gpC_base->SendMessage(UI_MESSAGE_BOX, 
// 						UI_STRING_MESSAGE_CANNOT_USE_HIGH_GRADE, 
// 						0, 
// 						NULL);

					char szBuf[128];
					sprintf(szBuf, (*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_USE_HIGH_GRADE].GetString(), 6);
					g_pUIDialog->PopupFreeMessageDlg(szBuf);
				}
			}
			else
			//옐로우 드롭2 급수를 올린다 8급 까지 가능 by diesirace 20070307 -> fixed by chyaya
			if(pMouseItem->GetItemType() == 48)
			{
				if(p_cur_item->GetGrade() > 0 &&  p_cur_item->GetGrade() < 8) // 1급 ~ 8급 까지만 사용 가능
				{
					ITEM_CLASS curitemclass = p_cur_item->GetItemClass();
					if( curitemclass == ITEM_CLASS_CORE_ZAP			||
						curitemclass == ITEM_CLASS_ETHEREAL_CHAIN	||
						curitemclass == ITEM_CLASS_CUE_OF_ADAM )
					{
						gpC_base->SendMessage(UI_MESSAGE_BOX, 
						STRING_MESSAGE_ITEM_TO_ITEM_IMPOSIBLE, 
						0, 
						NULL);
					}
					// 옵션이 2개 이상이면 실패
					else if(p_cur_item->GetItemOptionListCount()>1)
					{
						gpC_base->SendMessage(UI_MESSAGE_BOX, 
						UI_STRING_MESSAGE_CANNOT_USE_OVER_TWO_OPTION, 
						0, 
						NULL);
					}// 승직 아이템은 사용 불가
					else if( (*g_pItemTable)[p_cur_item->GetItemClass()][p_cur_item->GetItemType()].GetRequireAdvancementLevel() > 0 )
					{
						gpC_base->SendMessage(UI_MESSAGE_BOX, 
						UI_STRING_MESSAGE_CANNOT_USE_ADVANCEMENT_ITEM, 
						0, 
						NULL);
					}
					else
					{
						bCanUpgrade = true;
						ResultNoFail = true;
					}
				}
				else
				{
// 					gpC_base->SendMessage(UI_MESSAGE_BOX, 
// 						UI_STRING_MESSAGE_CANNOT_USE_HIGH_GRADE, 
// 						0, 
// 						NULL);


					char szBuf[128];
					sprintf(szBuf, (*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_USE_HIGH_GRADE].GetString(), 8);
					g_pUIDialog->PopupFreeMessageDlg(szBuf);

				}
			} 
			else if(pMouseItem->GetItemType() == 57 || pMouseItem->GetItemType() == 69)
			{
				if(p_cur_item->GetGrade() > 0 &&  p_cur_item->GetGrade() < 10) // 1급 ~ 9급 까지만 사용 가능
				{
					ITEM_CLASS curitemclass = p_cur_item->GetItemClass();
					if( curitemclass == ITEM_CLASS_CORE_ZAP			||
						curitemclass == ITEM_CLASS_ETHEREAL_CHAIN	||
						curitemclass == ITEM_CLASS_CUE_OF_ADAM )
					{
						gpC_base->SendMessage(UI_MESSAGE_BOX, 
						STRING_MESSAGE_ITEM_TO_ITEM_IMPOSIBLE, 
						0, 
						NULL);
					}
					// 옵션이 3개 이상이면 실패 - 기본적으로 레어까지만 인챈트가능.
					else if(p_cur_item->GetItemOptionListCount()>2)
					{
						gpC_base->SendMessage(UI_MESSAGE_BOX, 
						UI_STRING_MESSAGE_CANNOT_USE_OVER_TWO_OPTION, 
						0, 
						NULL);
					}// 승직 아이템은 사용 불가
//					else if( (*g_pItemTable)[p_cur_item->GetItemClass()][p_cur_item->GetItemType()].GetRequireAdvancementLevel() > 0 )
//					{
//						gpC_base->SendMessage(UI_MESSAGE_BOX, 
//						UI_STRING_MESSAGE_CANNOT_USE_ADVANCEMENT_ITEM, 
//						0, 
//						NULL);
//						 20071122 승직 아이템에 인첸트 가능하게 되면 주석을 풀고 위 매세지 박스 출력을 막는다. 
//						bCanUpgrade = true;
//						ResultNoFail = true;
//					}
					else
					{
						bCanUpgrade = true;
						ResultNoFail = true;
					}
				}
				else
				{
					char szBuf[128];
					sprintf(szBuf, (*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_USE_HIGH_GRADE].GetString(), 10);
					g_pUIDialog->PopupFreeMessageDlg(szBuf);
				}
			}
			else if(pMouseItem->GetItemType() == 23)
			{
				bCanUpgrade = true;
			}
			else if(pMouseItem->GetItemType() == 24)
			{
				bCanUpgrade = true;
			}
			else if(pMouseItem->GetItemType() == 25)
			{
				bCanUpgrade = true;
			}
			else if( ((pMouseItem->GetItemType() >= 26) && (pMouseItem->GetItemType() <= 31)) ||
					 ((pMouseItem->GetItemType() >= 38) && (pMouseItem->GetItemType() <= 46))	
				)
			{
				if(!p_cur_item->GetItemOptionListCount())
					bCanUpgrade = true;
			}
			else
			if(pMouseItem->GetItemType() == 47)
			{
				bCanUpgrade = false;
			}
			//2006.05.24 sjheon Add
			else if(pMouseItem->GetItemType() >= 32 && pMouseItem->GetItemType() <= 37)
			{	
				
				if((p_cur_item->GetItemOptionListCount() == 0) && 
					g_eRaceInterface == RACE_SLAYER && 
					p_cur_item->GetItemClass() == ITEM_CLASS_RING )
				{
					bCanUpgrade = true;
				}
			}
			//2006.05.24 sjheon End
			else
			if(pMouseItem->GetItemType() >= 54 && pMouseItem->GetItemType() <= 56 
#if __CONTENTS(__THIRD_ENCHANT_2)
			|| pMouseItem->GetItemType() >= 60 && pMouseItem->GetItemType() <= 62
#endif //__THIRD_ENCHANT_2
#if __CONTENTS(__IMI_NEW_ENCHANT_ITEM)
			|| pMouseItem->GetItemType() >= 70 && pMouseItem->GetItemType() <= 72
#endif //__IMI_NEW_ENCHANT_ITEM
				)
			{
	
				int itmeType = pMouseItem->GetItemType();
				switch(itmeType)
				{
				case 54:
				case 60:
				case 70:
					if (p_cur_item->IsCanAddThirdOptionItem() && p_cur_item->IsMeleeWeapon() && 
						(p_cur_item->GetItemOptionListCount() == 2))
						bCanUpgrade = true;
					else
						g_pUIDialog->PopupFreeMessageDlg((*g_pGameStringTable)[UI_STRING_MESSAGE_NOTUSE_ITEM].GetString());
					break;
				case 55:
				case 61:
				case 71:
					if (p_cur_item->IsCanAddThirdOptionItem() && p_cur_item->IsMagicWeapon() && 
						(p_cur_item->GetItemOptionListCount() == 2))
						bCanUpgrade = true;
					else
						g_pUIDialog->PopupFreeMessageDlg((*g_pGameStringTable)[UI_STRING_MESSAGE_NOTUSE_ITEM].GetString());
					break;
				case 56:
				case 62:
				case 72:
					if (p_cur_item->IsCanAddThirdOptionItem() && !p_cur_item->IsBasicWeapon() && 
						(p_cur_item->GetItemOptionListCount() == 2))
						bCanUpgrade = true;
					else
						g_pUIDialog->PopupFreeMessageDlg((*g_pGameStringTable)[UI_STRING_MESSAGE_NOTUSE_ITEM].GetString());
					break;
				}
			}
#if __CONTENTS(__JAPAN_REVERSE_DEVELOP || __EXPERT_PET_CHANGER)
			else
			if (pMouseItem->GetItemType() >= 49  && pMouseItem->GetItemType() <= 53 || pMouseItem->GetItemType() == 59) 
			{
				if(p_cur_item->GetItemOptionListCount() == 0)
				{
					bCanUpgrade = true;
				}
			}
#endif //__JAPAN_REVERSE_DEVELOP || __EXPERT_PET_CHANGER
#if __CONTENTS(__2008_FIRST_CHARGE_ITEM)					//크리스탈 아이템 & 저급 크리스탈 아이템
			else
			if(pMouseItem->GetItemType() == 58)
			{
				if(p_cur_item->GetItemOptionListCount() == 0 || p_cur_item->GetItemOptionListCount() == 1)	//옵션이 없거나 1붙은 아이템 까지 사용 가능
				{
					bCanUpgrade = true;
					ResultNoFail = true;
				}
			}
			else
				if(pMouseItem->GetItemType() == 81 || pMouseItem->GetItemType() == 68)
				{
					if(p_cur_item->GetItemOptionListCount() == 2)	//2橄昑옵鹿賈痰융彊쑨68뵀 81뵀
					{
						bCanUpgrade = true;
						ResultNoFail = true;
					}
				}
#endif	//__2008_FIRST_CHARGE_ITEM
			else
			// 2005, 2, 21, sobeit add end
			if(pMouseItem->GetItemType() > 7 && (pMouseItem->GetItemType() != 15 && pMouseItem->GetItemType() != 78 && pMouseItem->GetItemType() != 79))
			{
				if(p_cur_item->GetItemOptionListCount() == 0)
				{
					bCanUpgrade = true;
					ResultNoFail = true;
				}
			}

			else	// 송편이 아닌 일반 별일때
			{
				const std::list<TYPE_ITEM_OPTION> &optionList=p_cur_item->GetItemOptionList();
				std::list<TYPE_ITEM_OPTION>::const_iterator itr=optionList.begin();	
				
				while(itr!=optionList.end())
				{
					if((*g_pItemOptionTable)[*itr].UpgradeOptionType != 0)
					{
						bCanUpgrade=true;	
						break;
					}
					itr++;
				}	

				// 2009.11.25 by neclipse 블루드롭엣지와 샤인은 아이템이 파괴 되지 않는다.
				if (pMouseItem->GetItemType() == 78 || pMouseItem->GetItemType() == 79)
				{
					ResultNoFail = true;
				}
			}
			
			if(bCanUpgrade)
			{
				m_mine_grid_x = m_focus_grid_x;
				m_mine_grid_y = m_focus_grid_y;
				// gpC_base->SendMessage(UI_ITEM_TO_ITEM, m_focus_grid_x, m_focus_grid_y, (void *)p_cur_item);
				if( pMouseItem->GetItemType() == 16 )
					gC_vs_ui.RunTransItem();
				else if( pMouseItem->GetItemType() >= 23  && pMouseItem->GetItemType() <= 25) 
						gC_vs_ui.RunEnchant(7);

				else if(((pMouseItem->GetItemType() >= 26) && (pMouseItem->GetItemType() <= 31)) ||
					    ((pMouseItem->GetItemType() >= 38) && (pMouseItem->GetItemType() <= 46)))
						gC_vs_ui.RunEnchant(9);
				
				//else if( pMouseItem->GetItemType() >= 26  && pMouseItem->GetItemType() <= 31) 
				//		gC_vs_ui.RunEnchant(9);

				else if( pMouseItem->GetItemType() >= 32  && pMouseItem->GetItemType() <= 37) 
					gC_vs_ui.RunEnchant(1);
				else if( pMouseItem->GetItemType() >= 54  && pMouseItem->GetItemType() <= 56) 
					gC_vs_ui.RunThirdEnchant(pMouseItem->GetItemType() - 54);
#if __CONTENTS(__THIRD_ENCHANT_2)
				else if (pMouseItem->GetItemType() >= 60  && pMouseItem->GetItemType() <= 62)
					gC_vs_ui.RunThirdEnchant(pMouseItem->GetItemType() - 60);
#endif //__THIRD_ENCHANT_2
#if __CONTENTS(__IMI_NEW_ENCHANT_ITEM)
				else if( pMouseItem->GetItemType() >= 70 && pMouseItem->GetItemType() <= 72)
					gC_vs_ui.RunThirdEnchant(pMouseItem->GetItemType() - 70);
#endif //__IMI_NEW_ENCHANT_ITEM
				else
				{
					if(!ResultNoFail)
						gC_vs_ui.RunEnchant(0);
					else
						gC_vs_ui.RunEnchant(1);
				}
			}
		}
		else
		if(pMouseItem->GetItemClass() == ITEM_CLASS_MIXING_ITEM &&
			(pMouseItem->GetItemType() >= 9 && pMouseItem->GetItemType() <= 18 ||
			 pMouseItem->GetItemType() >= 22 && pMouseItem->GetItemType() <= 25 ||
			 pMouseItem->GetItemType() == 28)
			 && pMouseItem->GetNumber() == 1 &&
			p_cur_item != NULL)
		{
#if __CONTENTS(__ENCHANT_REQUIRE_LEVE)
			if(!p_cur_item->IsAffectStatus() && !(pMouseItem->GetItemClass() == ITEM_CLASS_EVENT_STAR && pMouseItem->GetItemType() == 16))
			{
				char szBuf[128];
				sprintf(szBuf, (*g_pGameStringTable)[STRING_MESSAGE_CANNOT_ENCHANT_FROM_LEVEL].GetString(), 6);
				g_pUIDialog->PopupFreeMessageDlg(szBuf);
				return false;
			}
#endif	//__ENCHANT_REQUIRE_LEVE
			if( p_cur_item->GetItemClass() == pMouseItem->GetItemClass() &&
				p_cur_item->GetItemType() == pMouseItem->GetItemType() &&
				pMouseItem->IsInsertToItem( p_cur_item ) &&
				p_cur_item->GetGridX() == m_focus_grid_x && 
				p_cur_item->GetGridY() == m_focus_grid_y
				&& (((g_pTimeItemManager->IsExist(pMouseItem->GetID()) == true)	&& (g_pTimeItemManager->IsExist(p_cur_item->GetID()) == true))
				|| ((g_pTimeItemManager->IsExist(pMouseItem->GetID()) == false)	&& (g_pTimeItemManager->IsExist(p_cur_item->GetID()) == false))))
				//시간제는 시간제 끼라만, 시간제 아닌건 아닌것 끼리만 인서트 된다.
			{
				gpC_base->SendMessage(UI_ITEM_INSERT_FROM_INVENTORY,
					m_focus_grid_x, m_focus_grid_y,
					(void *)p_cur_item); // 대상 Item
			}
			else
			if(p_cur_item->GetItemThirdOptionListCount() != 0)
			{
				g_pUIDialog->PopupFreeMessageDlg((*g_pGameStringTable)[UI_STRING_MESSAGE_NOTUSE_ITEM].GetString());
			}
			else
			if ( C_VS_UI_REMOVE_OPTION::IsCanRemoveOption_Puritas( pMouseItem, p_cur_item ) )
			{
				gC_vs_ui.RunRemoveOptionFromRareItem( pMouseItem, p_cur_item );
			}
		}
#if __CONTENTS(__TUNING_ITEM)
		else
		if( pMouseItem->IsTuningItem() && pMouseItem->GetNumber() == 1 && p_cur_item != NULL)
		{
			MString target_item;
			MString this_item;

			MString item_Grade;

			int itemTclass = pMouseItem->GetTargetClass();
			int itemTType = pMouseItem->GetTargetType();

			int thisitem = p_cur_item->GetItemClass();
			int thistype = p_cur_item->GetItemType();

			const int advance_level	= g_char_slot_ingame.m_AdvancementLevel;
			int AdvancementLevel = (*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].GetRequireAdvancementLevel();
#ifdef __DESIGNED_CHS
			int LevelGrade = (AdvancementLevel)/10;
			int LevelUnits = (AdvancementLevel)%10;
#else
			int LevelGrade = (AdvancementLevel-1)/10;
			int LevelUnits = (AdvancementLevel-1)%10;
#endif
			//////////////////////////////////////////////////////////////////////////
			// 비승직 요구조건
			bool b_item_NetCapacity = false;
			int reqSUM = 0;
			int reqLevel = 0;

			if(g_char_slot_ingame.Race==RACE_SLAYER)
			{
				int str_cur = g_char_slot_ingame.STR_CUR;
				int dex_cur = g_char_slot_ingame.DEX_CUR;
				int int_cur = g_char_slot_ingame.INT_CUR;
				
				int sum = str_cur+dex_cur+int_cur;
				reqSUM = (*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].GetRequireSUM();
				
				b_item_NetCapacity = (sum<reqSUM);
			}
			else if(g_char_slot_ingame.Race==RACE_VAMPIRE||g_char_slot_ingame.Race==RACE_OUSTERS)
			{
				reqLevel = (*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].GetRequireLevel();
				b_item_NetCapacity = (g_char_slot_ingame.level<reqLevel);
			}

			int _aALevel = 0; // 비승직아이템 성공&실패에 따른 스크립트 변경
			//////////////////////////////////////////////////////////////////////////

			if(itemTclass!=-1&&itemTType!=-1&&thisitem!=-1&&thistype!=-1)
			{
				bool bCanTuning = false;
				MString er_message = NULL;
				
				// Filtering
				if(g_pPlayer->GetRace()==RACE_SLAYER&&pMouseItem->GetItemClass()!=ITEM_CLASS_TUNING_SLAYER) // Slayer
				{
					if(pMouseItem->GetItemClass()==ITEM_CLASS_TUNING_VAMPIRE)
					{
						er_message.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetLength()+(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_VAMPIRE].GetLength());
						er_message.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_VAMPIRE].GetString());
					}
					else
					{
						er_message.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetLength()+(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_OUSTERS].GetLength());
						er_message.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_OUSTERS].GetString());
					}
				}
				else if(g_pPlayer->GetRace()==RACE_VAMPIRE&&pMouseItem->GetItemClass()!=ITEM_CLASS_TUNING_VAMPIRE) // Vampire
				{
					if(pMouseItem->GetItemClass()==ITEM_CLASS_TUNING_SLAYER)
					{
						er_message.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetLength()+(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_SLAYER].GetLength());
						er_message.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_SLAYER].GetString());
					}
					else
					{
						er_message.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetLength()+(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_OUSTERS].GetLength());
						er_message.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_OUSTERS].GetString());
					}
				}	
				else if(g_pPlayer->GetRace()==RACE_OUSTERS&&pMouseItem->GetItemClass()!=ITEM_CLASS_TUNING_OUSTERS) // Ousters
				{
					if(pMouseItem->GetItemClass()==ITEM_CLASS_TUNING_SLAYER)
					{
						er_message.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetLength()+(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_SLAYER].GetLength());
						er_message.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_SLAYER].GetString());
					}
					else
					{
						er_message.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetLength()+(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_VAMPIRE].GetLength());
						er_message.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_RACE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_ONLY_VAMPIRE].GetString());
					}
				}
				else if( itemTclass != thisitem || itemTType != thistype ) // Cannot Item
				{
					target_item.Init((*g_pItemTable)[itemTclass][itemTType].HName.GetLength()+
						(*g_pItemTable)[itemTclass][itemTType].EName.GetLength()+2);
					target_item.Format("%s(%s)",(*g_pItemTable)[itemTclass][itemTType].HName.GetString(),
						(*g_pItemTable)[itemTclass][itemTType].EName.GetString());
				
					item_Grade.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_00_NAME+LevelGrade].GetLength());
					item_Grade.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_00_NAME+LevelGrade].GetString());
				}
				else if(p_cur_item->IsUniqueItem()||p_cur_item->IsQuestItem()) // Unique & Quest
				{
					er_message.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_SPECIAL_ITEM].GetLength());
					er_message.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_SPECIAL_ITEM].GetString());
				}
				else if(AdvancementLevel==0 && b_item_NetCapacity) // Capacity Over
				{
					this_item.Init((*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].HName.GetLength()+
						(*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].EName.GetLength()+2);
					this_item.Format("%s(%s)",(*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].HName.GetString(),
						(*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].EName.GetString());

					if(g_char_slot_ingame.Race==RACE_SLAYER)
					{
						er_message.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_DOMAIN_OVER].GetLength()+this_item.GetLength());
						er_message.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_DOMAIN_OVER].GetString(),this_item.GetString(),reqSUM);
					}
					else if(g_char_slot_ingame.Race==RACE_VAMPIRE||g_char_slot_ingame.Race==RACE_OUSTERS)
					{
						er_message.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_LEVEL_OVER].GetLength()+this_item.GetLength());
						er_message.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_LEVEL_OVER].GetString(),this_item.GetString(),reqLevel);
					}
				}
				else if(AdvancementLevel!=0 && g_char_slot_ingame.m_AdvancementLevel < AdvancementLevel) // Advance Over
				{
					this_item.Init((*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].HName.GetLength()+
						(*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].EName.GetLength()+2);
					this_item.Format("%s(%s)",(*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].HName.GetString(),
						(*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].EName.GetString());

					item_Grade.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_00_NAME+LevelGrade].GetLength());
					item_Grade.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_00_NAME+LevelGrade].GetString());

					er_message.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_ADVANCE_OVER].GetLength()+this_item.GetLength()+item_Grade.GetLength());
					er_message.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_TUNING_ADVANCE_OVER].GetString(),this_item.GetString(),item_Grade.GetString());
				}
				else // Tuning Success
				{
					this_item.Init((*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].HName.GetLength()+
						(*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].EName.GetLength()+2);
					this_item.Format("%s(%s)",(*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].HName.GetString(),
						(*g_pItemTable)[pMouseItem->GetItemClass()][pMouseItem->GetItemType()].EName.GetString());
				
					item_Grade.Init((*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_00_NAME+LevelGrade].GetLength());
					item_Grade.Format((*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_00_NAME+LevelGrade].GetString());

					bCanTuning = true;
				}

				m_mine_grid_x = m_focus_grid_x;
				m_mine_grid_y = m_focus_grid_y;

				if(AdvancementLevel==0)
					_aALevel = 2;

				if(er_message.GetLength()!=NULL)
				{
					gC_vs_ui.RunConfirmError(er_message);
				}
				else if(bCanTuning)
					gC_vs_ui.RunTuningConfirm1(10+_aALevel,this_item,item_Grade);
				else
					gC_vs_ui.RunTuningConfirm2(11+_aALevel,target_item,item_Grade);
			}
		}
#endif	//__TUNING_ITEM
		// 총에 탄창을 끼우는 것과 같은 것이 insert item이다.
		// 위치가 완전히 일치할경우에만 추가한다.
		else
		if (pMouseItem->IsInsertToItem( p_cur_item )	&& p_cur_item->GetGridX() == m_focus_grid_x 
			&& p_cur_item->GetGridY() == m_focus_grid_y
			&& ((g_pTimeItemManager->IsExist(pMouseItem->GetID()) == false)	&& (g_pTimeItemManager->IsExist(p_cur_item->GetID()) == false)))
			// 2009.11.03 - 시간제 아이템은 이유 불문하고 무조건 합쳐지지 않도록 한다. ↓이하 두줄
			//&& (((g_pTimeItemManager->IsExist(pMouseItem->GetID()) == true)	&& (g_pTimeItemManager->IsExist(p_cur_item->GetID()) == true))
			//|| ((g_pTimeItemManager->IsExist(pMouseItem->GetID()) == false)	&& (g_pTimeItemManager->IsExist(p_cur_item->GetID()) == false))))
			// g_pTimeItemManager->IsExist(pMouseItem->GetID()) 리미티드 아이템인지 아닌지 체크 한다.	
		{
			// 이전에 있던 item에 추가될 수 있는 경우
			// 대상 Item과 들고 있는(추가할 Item)을 Client에서 알아야 한다.
			// 들고 있는 Item은 Client에서 access할 수 있으므로 대상 Item을 보낸다.
			gpC_base->SendMessage(UI_ITEM_INSERT_FROM_INVENTORY,
				m_focus_grid_x, m_focus_grid_y,
				(void *)p_cur_item); // 대상 Item
		}
#if __CONTENTS(__TREASURE_BOX)
		else
		if(pMouseItem->GetItemClass() == ITEM_CLASS_COMMON_QUEST_ITEM && p_cur_item != NULL
			&& p_cur_item->GetItemClass() == ITEM_CLASS_COMMON_QUEST_ITEM
			&& pMouseItem->GetItemType() == 35 && 1 == pMouseItem->GetNumber()
			)
		{
			int curItemType = p_cur_item->GetItemType();
			int mouseItemType = pMouseItem->GetItemType();

			if(curItemType >= 36 && curItemType <= 51)
			{
				m_mine_grid_x = m_focus_grid_x;
				m_mine_grid_y = m_focus_grid_y;
				gC_vs_ui.RunEnchant(5);
//				gpC_base->SendMessage(UI_ITEM_INSERT_FROM_INVENTORY, 
//					m_focus_grid_x, m_focus_grid_y,
//					(void *)p_cur_item);
			}
		}
#endif //__TREASURE_BOX
		else
		{	
			// 추가될 수 없는 경우
			MItem* p_old_item  = NULL;
				
			if (g_pInventory->CanReplaceItem(gpC_mouse_pointer->GetPickUpItem(),		// 추가할 item
				m_focus_grid_x, m_focus_grid_y,	// 추가할 위치 
				p_old_item))								// 원래있던 item
			{
				m_bLimited_Item_Change	= TRUE;
				
				gpC_base->SendMessage(UI_ITEM_DROP_TO_INVENTORY, 
					m_focus_grid_x, m_focus_grid_y,
					(void *)pMouseItem);
				
				m_focus_grid_x_Prev	= m_focus_grid_x;
				m_focus_grid_y_Prev	= m_focus_grid_y;
			}
			else
			{
				// failed.
				return false;
			}
		}
	}
	else
	{
		// 집는다.
		MItem * p_item = g_pInventory->GetItem(m_focus_grid_x, m_focus_grid_y);
		if (p_item != NULL) // Item이 있다.
		{
			int number = p_item->GetNumber();
			
			if(gpC_mouse_pointer->IsCursorDescription())
				gC_vs_ui.RunDescDialog(DID_ITEM, (void *)p_item);
			else if (gbl_sell_running == true)
			{ 
				if (gbl_item_trade_lock == false &&  p_item->GetItemClass() != ITEM_CLASS_CHECK_MONEY && p_item->GetItemClass() != ITEM_CLASS_CHECK_MONEY)// && p_item->GetItemClass() != ITEM_CLASS_EVENT_GIFT_BOX)// && p_item->GetItemClass() != ITEM_CLASS_EVENT_STAR)
				{
					m_p_sell_item = (MItem *)p_item;
					if(g_pMoneyManager->CanAddMoney(g_pPriceManager->GetItemPrice(p_item, MPriceManager::PC_TO_NPC)))
						g_StartSellConfirmDialog(x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X, 
							y+grid_start_y+(p_item->GetGridY()+p_item->GetGridWidth())*GRID_UNIT_PIXEL_Y);
					else
						g_StartCannotSellConfirmDialog(x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X, 
							y+grid_start_y+(p_item->GetGridY()+p_item->GetGridWidth())*GRID_UNIT_PIXEL_Y);
				}
			}
			else if (gbl_swap_advancement_item_running == true)
			{
				if (gbl_item_trade_lock == false)// && p_item->GetItemClass() != ITEM_CLASS_EVENT_GIFT_BOX)// && p_item->GetItemClass() != ITEM_CLASS_EVENT_STAR)
				{
					m_p_sell_item = (MItem *)p_item;
					g_StartSwapConfirmDialog(x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X, 
						y+grid_start_y+(p_item->GetGridY()+p_item->GetGridWidth())*GRID_UNIT_PIXEL_Y);
				}
			}
			else if (gbl_repair_running == true)
			{
				if (gbl_item_trade_lock == false && 
					//p_item->GetItemClass() != ITEM_CLASS_EVENT_GIFT_BOX && 
					//p_item->GetItemClass() != ITEM_CLASS_EVENT_TREE && 
					//p_item->GetItemClass() != ITEM_CLASS_EVENT_ETC && 
					//p_item->GetItemClass() != ITEM_CLASS_EVENT_STAR &&
					//p_item->GetItemClass() != ITEM_CLASS_VAMPIRE_AMULET &&
					//p_item->GetItemClass() != ITEM_CLASS_BLOOD_BIBLE &&					
					p_item->IsRepairableItem() &&
					!p_item->IsUniqueItem() &&
					!p_item->IsQuestItem() )
				{					
					// repair 가격이 0보다 클 때... by sigi
					DWORD repairPrice = g_pPriceManager->GetItemPrice((MItem*)p_item, MPriceManager::REPAIR) ;
#if __CONTENTS(__REPAIRSYSTEM_RENEWAL)
			MPriceManager::REPAIRPIRCEPAIR repairPricePair(g_pPriceManager->GetRepairPricePair(p_item->GetID())); 
			repairPrice = repairPricePair.first;
#endif //__REPAIRSYSTEM_RENEWAL
					if (
						repairPrice > 0
#if __CONTENTS(__REPAIRSYSTEM_RENEWAL)
						 && g_pPriceManager->IsRepairPriceListHave(p_item->GetID())
#endif //__REPAIRSYSTEM_RENEWAL
						)
					{
						m_p_repair_item = (MItem *)p_item;
						g_StartRepairConfirmDialog(x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X, y+grid_start_y+(p_item->GetGridY()+p_item->GetGridWidth())*GRID_UNIT_PIXEL_Y, p_item->IsChargeItem());
					}
				} else
				{
					gpC_base->SendMessage(UI_MESSAGE_BOX, 
						STRING_MESSAGE_CANNOT_REPAIR, 
						0, 
						NULL);
				}
			}
			else if (gbl_silvering_running == true)
			{
				if (gbl_item_trade_lock == false
					&& p_item->GetItemClass() != ITEM_CLASS_BLOOD_BIBLE
					&& p_item->GetItemClass() != ITEM_CLASS_EVENT_TREE
					&& p_item->GetItemClass() != ITEM_CLASS_EVENT_ETC
					&& p_item->GetItemClass() != ITEM_CLASS_EVENT_GIFT_BOX
					&& p_item->GetItemClass() != ITEM_CLASS_EVENT_STAR)
				{
					// silvering 가격이 0보다 클 때... by larosel
					if (g_pPriceManager->GetItemPrice((MItem*)p_item, MPriceManager::SILVERING) > 0)
					{
						m_p_silvering_item = (MItem *)p_item;
						g_StartSilveringConfirmDialog(x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X, y+grid_start_y+(p_item->GetGridY()+p_item->GetGridWidth())*GRID_UNIT_PIXEL_Y);
					}
				}
			}
			else if (gC_vs_ui.IsRunningPetStorage())
			{
				if (gbl_item_trade_lock == false)// && p_item->GetItemClass() != ITEM_CLASS_EVENT_GIFT_BOX)// && p_item->GetItemClass() != ITEM_CLASS_EVENT_STAR)
				{
					m_p_sell_item = (MItem *)p_item;
					if(ITEM_CLASS_PET_ITEM == m_p_sell_item->GetItemClass())
					{
						m_mine_grid_x = m_focus_grid_x;
						m_mine_grid_y = m_focus_grid_y;
						gC_vs_ui.RunKeepPetItemDialog();
					}
				}
			}
			else
			{
				//#ifdef _LIB
				// SHIFT누르고 클릭했을때 아이템 자동 이동 처리 -> 퀵아이템 -> 기어창 -> 보관함
				if(g_pDXInput->KeyDown(DIK_LSHIFT))
				{
#if __CONTENTS(__GEAR_SWAP_CHANGE)	//_CGAddMouseToGear.setGearSlotID(right);
					bool	bActive	= true;
					switch(g_pPlayer->GetRace())
					{
					case RACE_SLAYER:
						bActive			= g_pSlayerGear->GetActive();
						break;

					case RACE_VAMPIRE:
						bActive			= g_pVampireGear->GetActive();
						break;
		
					case RACE_OUSTERS:
						bActive			= g_pOustersGear->GetActive();
						break;
					}

					if(g_pPlayer->GetAction() != ACTION_STAND)
						bActive	= false;

					if(!bActive)
						return false;
#endif	// __GEAR_SWAP_CHANGE
	
					AutoMove( m_focus_grid_x, m_focus_grid_y );
				}
				//					gpC_base->SendMessage(UI_ITEM_TO_QUICKITEMSLOT, 
				//																	m_focus_grid_x, m_focus_grid_y,
				//																	(MItem *)p_item);
				else
				{
					//#endif
					
					// 서브 인벤이 열렸을때 인벤토리 아이템을 건드리면 서브 인벤이 닫히게..
//					if(gC_vs_ui.IsRunningSubInventory() && p_item->GetItemClass() == ITEM_CLASS_SUB_INVENTORY )
//						gpC_base->SendMessage(UI_CLOSE_INVENTORY_SUB);

					TYPE_OBJECTID itemID = p_item->GetID();

					if(p_item->GetItemClass() == ITEM_CLASS_SUB_INVENTORY )
						gpC_base->SendMessage(UI_CLOSE_INVENTORY_SUB, itemID);

					g_pInventory->RemoveItem(m_focus_grid_x, m_focus_grid_y);
					
#ifdef _LIB
					gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
						m_focus_grid_x, m_focus_grid_y,
						(MItem *)p_item);
#else
					int item_x = x+grid_start_x+p_item->GetGridX()*GRID_UNIT_PIXEL_X+(p_item->GetGridWidth()*GRID_UNIT_PIXEL_X)/2-gpC_item->GetWidth(p_item->GetInventoryFrameID())/2;
					int item_y = y+grid_start_y+p_item->GetGridY()*GRID_UNIT_PIXEL_Y+(p_item->GetGridHeight()*GRID_UNIT_PIXEL_Y)/2-gpC_item->GetHeight(p_item->GetInventoryFrameID())/2;
					
					
					gpC_base->SendMessage(UI_ITEM_PICKUP_FROM_INVENTORY,
						MAKEDWORD(m_focus_grid_x, m_focus_grid_y),
						MAKEDWORD(item_x, item_y),
						(MItem *)p_item);
#endif
				}
			}
		}
	}
	
	return true;
}

//2008.09.24 shootkj
//물약과 같은 영구 아이템을 시간제 아이템과 교체 할때 서버에서 cannotadd로 올 수 있는데 이때에는 
//교체가 되지 않도록 다시 원위치 시켜 줘야 한다.
void	C_VS_UI_INVENTORY::Prev_Item_Position_Remove()
{

	m_bLimited_Item_Change	= FALSE;		//주석을 풀면 아래 코드는 실행 되지 않는다.

	if(m_bLimited_Item_Change != TRUE)
		return;

	// 추가될 수 없는 경우
	MItem* p_old_item  = NULL;
				
	if (g_pInventory->CanReplaceItem(gpC_mouse_pointer->GetPickUpItem(),		// 추가할 item
		m_focus_grid_x, m_focus_grid_y,	// 추가할 위치 
		p_old_item))								// 원래있던 item
	{
		const MItem* pMouseItem = gpC_mouse_pointer->GetPickUpItem();

		if(pMouseItem	!= NULL)
			gpC_base->SendMessage(UI_ITEM_DROP_TO_INVENTORY, 
				m_focus_grid_x_Prev, m_focus_grid_y_Prev,
				(void *)pMouseItem);

		m_bLimited_Item_Change	= FALSE;
	}
}


void C_VS_UI_INVENTORY::KeyboardControl(UINT message, UINT key, long extra)
{
	Window::KeyboardControl(message, key, extra);
	
	//	if (message == WM_KEYDOWN)
	//	{
	//		switch (key)
	//		{
	//		case VK_SHIFT:
	//			m_bl_shift = true;
	//			break;
	//		}
	//	}
	//	else if(message == WM_KEYUP)
	//	{
	//		switch(key)
	//		{
	//		case VK_SHIFT:
	//			m_bl_shift = false;
	//			break;
	//		}
	//	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_INVENTORY::Timer
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_INVENTORY::Timer(bool reset)
{
	if(reset)
	{
		gi_mine_progress = GetTickCount();
	}
	else if(gi_mine_progress+m_dw_millisec <= GetTickCount())
	{
		gi_mine_progress = GetTickCount();
		return true;
	}
	
	return false;
}


/*-----------------------------------------------------------------------------
- C_VS_UI_SKILL
-
-----------------------------------------------------------------------------*/
C_VS_UI_SKILL::C_VS_UI_SKILL()
{
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_etc_spk.Open(SPK_SLAYER_SKILL_ETC);
		m_skill_guard_x = 42;
		m_skill_guard_y = 42;
		//m_skill_start_x = RESOLUTION_X-m_skill_guard_x-10;
		m_skill_start_x = g_pUserInformation->iResolution_x-m_skill_guard_x-10;
		m_skill_start_y = 455+14;
		m_skill_guard_extra_offset = 3;
		m_extra_icon_offset_x = 1;
		m_extra_icon_offset_y = 2;
		
		Set(m_skill_start_x, m_skill_start_y, m_skill_guard_x, m_skill_guard_y);
		break;

	case RACE_VAMPIRE:
		m_etc_spk.Open(SPK_VAMPIRE_SKILL_ETC);
		m_skill_guard_x = 42;
		m_skill_guard_y = 42;
		//m_skill_start_x = RESOLUTION_X-m_skill_guard_x-10;
		m_skill_start_x = g_pUserInformation->iResolution_x-m_skill_guard_x-10;
		m_skill_start_y = 455+14;
		m_skill_guard_extra_offset = 3;
		m_extra_icon_offset_x = 1;
		m_extra_icon_offset_y = 2;
		
		Set(m_skill_start_x, m_skill_start_y, m_skill_guard_x, m_skill_guard_y);
		break;

	case RACE_OUSTERS:
		m_etc_spk.Open(SPK_OUSTERS_SKILL_ETC);
		m_skill_guard_x = 42;
		m_skill_guard_y = 42;
		//m_skill_start_x = RESOLUTION_X-m_skill_guard_x-10;
		m_skill_start_x = g_pUserInformation->iResolution_x-m_skill_guard_x-10;
		m_skill_start_y = 455+14;
		m_skill_guard_extra_offset = 3;
		m_extra_icon_offset_x = 1;
		m_extra_icon_offset_y = 2;
		
		Set(m_skill_start_x, m_skill_start_y, m_skill_guard_x, m_skill_guard_y);
		break;		
	}

	m_quikItemPack.Open("data\\ui\\spk\\new\\hotkeysettingwindow\\00000.spk");
	
	if (m_C_spk.GetSize()==0)
	{
//		ifstream	file(SPK_SKILL_ICON, ios::binary|ios::nocreate);
//		if (!file)
//			_Error(FILE_OPEN);
//		
		m_C_spk.LoadFromFileRunning(SPK_SKILL_ICON);
// 		file.close();
		
//		ifstream	file2(SPK_SKILL_MINI, ios::binary|ios::nocreate);
//		if (!file)
//			_Error(FILE_OPEN);
//		
		m_C_spk_mini.LoadFromFileRunning(SPK_SKILL_MINI);
		m_C_spk_mini_new.LoadFromFileRunning("data\\ui\\spk\\skillminirenewal.spk");
		m_C_spk_comboCnt.LoadFromFileRunning(SPK_COMBO_CNT);
// 		file2.close();
	}
	
	g_RegisterWindow(this);
	
	AttrPin(true);
	
	m_current_skill_set = -1;
	m_current_skill_grade = -1;
	m_selected_skillid = NOT_SELECTED;
	
	for (int i=0; i < HOTKEY_MAX; i++)
	{
		for(int j=0; j < GRADE_MAX; j++)
		{
			m_skill_hotkey_buf[i][j] = NOT_SELECTED;
		}
	}
	
	// TIMER
	m_dw_prev_tickcount = GetTickCount();
	m_dw_millisec = 2000;
	m_comboCnt = 1 ; 
	m_selected_comboAttackskill = 0 ; 
	
	m_bl_show_progress		= false;
	m_progress_skill_id		= -1;
	m_pC_progress_item		= NULL;
	
#ifndef _LIB
	//	g_pSkillAvailable->AddSkill(SKILL_BLOOD_DRAIN);
	//	g_pSkillAvailable->AddSkill(MAGIC_PROTECTION_FROM_PARALYSIS);
	//	g_pSkillAvailable->AddSkill(MAGIC_RESTORE);
	//	g_pSkillAvailable->AddSkill(MAGIC_DETECT_HIDDEN);
	(*g_pSkillInfoTable)[MAGIC_CONTINUAL_LIGHT].SetPassive();
	
	g_pSkillAvailable->AddSkill(MAGIC_HIDE);
	for(i = 200; i< 270;i++)
		g_pSkillAvailable->AddSkill((ACTIONINFO) i );
	//	g_pSkillAvailable->DisableSkill(MAGIC_HIDE);
	//	g_pSkillAvailable->AddSkill(MAGIC_DARKNESS);
	//	g_pSkillAvailable->AddSkill(MAGIC_POISONOUS_HANDS);
	//	g_pSkillAvailable->AddSkill(MAGIC_ACID_TOUCH);
	//	g_pSkillAvailable->AddSkill(MAGIC_GREEN_POISON);
	//	g_pSkillAvailable->AddSkill(MAGIC_YELLOW_POISON);
	//	g_pSkillAvailable->AddSkill(MAGIC_PURPLE_WALL);
	//	g_pSkillAvailable->AddSkill(MAGIC_ACID_BOLT);
	//	g_pSkillAvailable->AddSkill(MAGIC_GREEN_STALKER);
	//	g_pSkillAvailable->AddSkill(MAGIC_INVISIBILITY);
	//	g_pSkillAvailable->AddSkill(MAGIC_DARKBLUE_POISON);
	//	g_pSkillAvailable->AddSkill(MAGIC_ACID_BALL);
	//	g_pSkillAvailable->AddSkill(MAGIC_ACID_SWAMP);
	//	g_pSkillAvailable->AddSkill(MAGIC_BLOODY_NAIL);
	//	g_pSkillAvailable->AddSkill(MAGIC_BLOODY_KNIFE);
	//	g_pSkillAvailable->AddSkill(MAGIC_BLOODY_BALL);
	//	g_pSkillAvailable->AddSkill(MAGIC_BLOODY_WALL);
	//	g_pSkillAvailable->AddSkill(MAGIC_BLOODY_SPEAR);
	//	g_pSkillAvailable->AddSkill(MAGIC_SUMMON);
#endif
}

/*-----------------------------------------------------------------------------
- ~C_VS_UI_SKILL
-
-----------------------------------------------------------------------------*/
C_VS_UI_SKILL::~C_VS_UI_SKILL()
{
	gpC_vs_ui_window_manager->SetHotKey((int **)m_skill_hotkey_buf);
	m_C_spk.Release();
	m_C_spk_mini.Release();
	m_C_spk_comboCnt.Release();
	
	g_UnregisterWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::ChangeSkillByHotkey
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_SKILL::ChangeSkillByHotkey(HOTKEY hotkey)
{
	if(m_current_skill_set != hotkey)
	{
		m_current_skill_set = hotkey;
		m_current_skill_grade = 0;
	}
	else
	{
		for(int i = 1; i < GRADE_MAX+1; i++)
		{
			if(m_skill_hotkey_buf[m_current_skill_set][(m_current_skill_grade+i)%GRADE_MAX] != NOT_SELECTED)
			{
				m_current_skill_grade = (m_current_skill_grade+i)%GRADE_MAX;
				break;
			}
		}
	}
	int id = m_skill_hotkey_buf[m_current_skill_set][m_current_skill_grade];
	
	if (id != NOT_SELECTED)
	{
		MSkillSet::SKILLID_MAP::iterator iNode = g_pSkillAvailable->begin();
		while (iNode != g_pSkillAvailable->end())
		{
			if(((*iNode).second).SkillID == id)break;
			iNode++;
		}
		
		if(iNode != g_pSkillAvailable->end())
		{
			m_selected_skillid = id;
			gpC_base->SendMessage(UI_SELECT_SKILL, m_selected_skillid);
		}
		
		EMPTY_MOVE;
		
		Timer(true);
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::ChangeSkillWheel
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_SKILL::ChangeSkillWheel(bool direct)
{
	int id = m_selected_skillid;
	
	if(g_pSkillAvailable->empty())return;
	
	MSkillSet::SKILLID_MAP::iterator iNode = g_pSkillAvailable->begin();
	
	//	if (id != NOT_SELECTED)
	{
		while (iNode != g_pSkillAvailable->end())
		{
			if(((*iNode).second).SkillID == id)break;
			iNode++;
		}
		
		if(iNode != g_pSkillAvailable->end())
		{
			if(direct)
			{
				do
				{
					iNode++;
					if(g_pSkillAvailable->end() == iNode)
						iNode = g_pSkillAvailable->begin();
				}while((*g_pSkillInfoTable)[(ACTIONINFO)((*iNode).second).SkillID].IsPassive() && id != ((*iNode).second).SkillID);
			}
			else 
			{
				do
				{
					if(g_pSkillAvailable->begin() == iNode)
						iNode = g_pSkillAvailable->end();
					iNode--;
				}while((*g_pSkillInfoTable)[(ACTIONINFO)((*iNode).second).SkillID].IsPassive() && id != ((*iNode).second).SkillID);
			}
		}
		else
		{
			if(direct)
			{
				iNode = g_pSkillAvailable->begin();
				while((*g_pSkillInfoTable)[(ACTIONINFO)((*iNode).second).SkillID].IsPassive())
				{
					iNode++;
					if(g_pSkillAvailable->end() == iNode)
						break;
				}
			}
			else 
			{
				do
				{
					if(g_pSkillAvailable->begin() == iNode)
					{
						iNode = g_pSkillAvailable->end();
						break;
					}
					iNode--;
				}while((*g_pSkillInfoTable)[(ACTIONINFO)((*iNode).second).SkillID].IsPassive());
			}
		}
		
		Timer(true);
	}
	
	if(iNode != g_pSkillAvailable->end())
		m_selected_skillid = ((*iNode).second).SkillID;
	else
		m_selected_skillid = NOT_SELECTED;
	
	gpC_base->SendMessage(UI_SELECT_SKILL, m_selected_skillid);
	
	EMPTY_MOVE;
	
	
}

void	C_VS_UI_SKILL::SelectSkill(int id)
{
	m_selected_skillid = id;
	gpC_base->SendMessage(UI_SELECT_SKILL, m_selected_skillid);
	EMPTY_MOVE;
}

//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::UnselectSkill
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_SKILL::UnselectSkill()
{
	m_selected_skillid = NOT_SELECTED;
	gpC_base->SendMessage(UI_SELECT_SKILL, NOT_SELECTED);
	EMPTY_MOVE;
}

//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::SetHotkey
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_SKILL::SetHotkey(HOTKEY hotkey, ACTIONINFO id)
{
	int i, j;
	
	for (i=0; i < HOTKEY_MAX; i++)
	{
		for(j=0; j < GRADE_MAX; j++)
		{
			if (m_skill_hotkey_buf[i][j] == id)
			{
				//				m_skill_hotkey_buf[i][j] = NOT_SELECTED;
				for(int k = j; k < GRADE_MAX-1; k++)
					m_skill_hotkey_buf[i][k] = m_skill_hotkey_buf[i][k+1];
				m_skill_hotkey_buf[i][k] = NOT_SELECTED;
				return;
			}
		}
	}
	
	for(j = 0; j < GRADE_MAX; j++)
	{
		if(m_skill_hotkey_buf[hotkey][j] == NOT_SELECTED)
		{
			m_skill_hotkey_buf[hotkey][j] = id;
			return;
		}
	}
	if(j == GRADE_MAX)
	{
		for(i = 0; i < GRADE_MAX-1; i++)
		{
			m_skill_hotkey_buf[hotkey][i] = m_skill_hotkey_buf[hotkey][i+1];
		}
		m_skill_hotkey_buf[hotkey][i] = id;
		return;
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::InitHotKey
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_SKILL::InitHotKey(HOTKEY hotkey)
{
	
	for(int j=0; j < GRADE_MAX; j++)
	{
		m_skill_hotkey_buf[hotkey][j] = NOT_SELECTED;
	}

}

//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::ToggleWindow
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_SKILL::ToggleWindow()
{
	ResetHotkey();
	if (m_bl_open == false)
	{
		// skill interface가 열린다.
		
		g_pSkillAvailable->SetAvailableSkills(); // 열릴 때 한 번만 해준다.
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			PlaySound(SOUND_SLAYER_SKILL);
			break;
			
		case RACE_VAMPIRE:
			PlaySound(SOUND_VAMPIRE_ICON);
			break;
			
		case RACE_OUSTERS:
			PlaySound(SOUND_SLAYER_SKILL);
			break;
		}
	}
	
	m_bl_open = !m_bl_open;
	
	if(g_pSkillAvailable->size() == 0) m_bl_open = false;
	
	ResetSize();
	
	// re-acquire
	EMPTY_MOVE;
}

//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::NoPassive
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_SKILL::NoPassive(int n)
{
	if (n != NOT_SELECTED)
	{
		int id = GetSkillID(n);
		if (id != NOT_SELECTED && (*g_pSkillInfoTable)[id].IsPassive())
			return false;
	}
	
	return true;
}

//-----------------------------------------------------------------------------
// CloseInterface
//
// 펼쳐져있다면.. 닫는다. 외부에서 닫기를 요청할 때 실행된다.
//-----------------------------------------------------------------------------
void	C_VS_UI_SKILL::CloseInterface()
{
	m_bl_pushed = false;
	m_bl_open = false;
	
	ResetSize();
}

//-----------------------------------------------------------------------------
// AbleToUse
//
// 사용가능한 마법인가?
//-----------------------------------------------------------------------------
bool C_VS_UI_SKILL::AbleToUse(int id) const
{
	return g_pSkillAvailable->IsEnableSkill((ACTIONINFO)id);
	//	{
	//		return (*g_pSkillInfoTable)[id].IsAvailableTime();
	//	}
	//	return false;
	
}

//-----------------------------------------------------------------------------
// IsEnableSkill
//
// 사용불가된 기술이 아닌가?(도메인등등의 이유)
//-----------------------------------------------------------------------------
bool C_VS_UI_SKILL::IsEnableSkill(int id) const
{
	return (*g_pSkillInfoTable)[id].IsEnable();
}

//-----------------------------------------------------------------------------
// GetDelay
//
// Delay가 얼마나 남았나 %
//-----------------------------------------------------------------------------
//int C_VS_UI_SKILL::GetDelay(int id) const
//{
//	if((*g_pSkillInfoTable)[id].GetDelayTime() == 0)return 0;	
//	
//	return (*g_pSkillInfoTable)[id].GetAvailableTimeLeft()*100/(*g_pSkillInfoTable)[id].GetDelayTime();
//}
/*
int C_VS_UI_SKILL::GetDelay(int id) const
{
	if((*g_pSkillInfoTable)[id].GetDelayTime() == 0)return 0;	
	
	int DelayTime = (*g_pSkillInfoTable)[id].GetDelayTime();

	
	if( id == SKILL_WILL_OF_LIFE )
		DelayTime = (3+ (g_char_slot_ingame.level/10))*2*1000;
		

	return (*g_pSkillInfoTable)[id].GetAvailableTimeLeft()*100/DelayTime;
}
*/

int C_VS_UI_SKILL::GetDelay(int id) const
{
	if((*g_pSkillInfoTable)[id].GetCurrentDelayTime() == 0)return 0;	
	
	int DelayTime = (*g_pSkillInfoTable)[id].GetCurrentDelayTime();
	
	if( id == SKILL_WILL_OF_LIFE )
		DelayTime = (3+ (g_char_slot_ingame.level/10))*2*1000;
		
	return (*g_pSkillInfoTable)[id].GetAvailableTimeLeft()*100/DelayTime;
}

//-----------------------------------------------------------------------------
// GetSkillID
//
// 실패하면 NOT_SELECTED을 반환하고 성공하면 n번째 skill id를 반환한다.
//-----------------------------------------------------------------------------
int C_VS_UI_SKILL::GetSkillID(int n)
{
	if (n > 0)
	{
		int i = 0;
		MSkillSet::SKILLID_MAP::iterator iNode = g_pSkillAvailable->begin();
		while (iNode != g_pSkillAvailable->end())
		{
			// skill의 id와 status
			ACTIONINFO id = ((*iNode).second).SkillID;
			
			// 다음
			iNode++;
			// 2004, 11, 26, sobeit add start - 사용 불가 스킬은 아예 표시하지 말아달라고 요청이 와서..^^
			if(IsEnableSkill(id))
			// 2004, 11, 26, sobeit add end
				i++;
			
			if (n == i)
			{
//				if(findSkillAvailable(id))
					return id;
//				else
//					return NOT_SELECTED;
			}
		}
	}
	
	return NOT_SELECTED;
}


int	C_VS_UI_SKILL::GetSelectedSkillID()
{
	return m_selected_skillid;
}

//-----------------------------------------------------------------------------
// GetFocusSlot
//
// 
//-----------------------------------------------------------------------------
int C_VS_UI_SKILL::GetFocusSlot(int _x, int _y) const
{
	if (m_bl_open == true)
	{
		for (int i=0; i < g_pSkillAvailable->size()+1; i++)
		{
			int px = m_skill_start_x-(m_skill_guard_x*(i%SPREAD_X_MAX));
			int py = m_skill_start_y-(m_skill_guard_y*(i/SPREAD_X_MAX));
			
			if (_x >= px && _x < px+m_skill_guard_x &&
				_y >= py && _y < py+m_skill_guard_y)
			{
				return i;
			}
		}
	}
	else
	{
		if (IsInRect(_x, _y) == true)
			return 0;
	}
	
	return NOT_SELECTED;
}

//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::GetIconPoint
//
// n번째 icon의 point를 반환한다.
//-----------------------------------------------------------------------------
Point	C_VS_UI_SKILL::GetIconPoint(int n) const
{
	Point point;
	
	point.x = m_skill_start_x-(m_skill_guard_x*(n%SPREAD_X_MAX));
	point.y = m_skill_start_y-(m_skill_guard_y*(n/SPREAD_X_MAX));
	
	return point;
}

//-----------------------------------------------------------------------------
// ResetSize
//
// !가능한 skill이 하나두 없을 때는 open되지 않는다.
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::ResetSize()
{
	if (m_bl_open == true)
	{
		if (g_pSkillAvailable->size() > (SPREAD_X_MAX-1))
		{
			x = m_skill_start_x-m_skill_guard_x*(SPREAD_X_MAX-1);
			w = m_skill_guard_x*SPREAD_X_MAX;
		}
		else
		{
			x = m_skill_start_x-m_skill_guard_x*g_pSkillAvailable->size();
			w = m_skill_guard_x*(g_pSkillAvailable->size()+1);
		}
		
		y = m_skill_start_y-m_skill_guard_y*(g_pSkillAvailable->size()/SPREAD_X_MAX);
		h = m_skill_guard_y+m_skill_guard_y*(g_pSkillAvailable->size()/SPREAD_X_MAX);
	}
	else
	{
		x = m_skill_start_x;
		y = m_skill_start_y;
		w = m_skill_guard_x;
		h = m_skill_guard_y;
	}
}

//-----------------------------------------------------------------------------
// UnacquireMouseFocus
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::UnacquireMouseFocus()
{
	m_focused_slot = NOT_SELECTED;
}

//-----------------------------------------------------------------------------
// CancelPushState
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::CancelPushState()
{
	m_bl_pushed = false;
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::WindowEventReceiver(id_t event)
{
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_SKILL::IsPixel2(int _x, int _y)
{
	return (GetFocusSlot(_x, _y) != NOT_SELECTED);
}

//-----------------------------------------------------------------------------
// Start
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::Start()
{
	PI_Processor::Start();
	
	memcpy(m_skill_hotkey_buf, gpC_vs_ui_window_manager->GetHotKey(), sizeof(int)*C_VS_UI_SKILL::HOTKEY_MAX*C_VS_UI_SKILL::GRADE_MAX);
	gpC_window_manager->AppearWindow(this);
	
	m_focused_slot = NOT_SELECTED;
	m_bl_open = false;
	m_bl_pushed = false;
	
}

//-----------------------------------------------------------------------------
// Process
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::Process()
{
	ProcessSkillCastingProgress();
}

//-----------------------------------------------------------------------------
// KeyboardControl
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::KeyboardControl(UINT message, UINT key, long extra)
{
}

/*-----------------------------------------------------------------------------
- MouseControl
- Skill Mouse Control.

  `Skill은 화면 어디에나 나올 수 있으므로 Skill 하나하나의 좌표를 검사해서
  UI 입력 여부를 결정해야 한다.
-----------------------------------------------------------------------------*/
bool C_VS_UI_SKILL::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	
	switch (message)
	{
	case M_MOVING:
		//
		// 사용불가능한 것은 0번 slot을 빼고 선택되지 않는다.
		// 여기서 결정해야 한다.
		//
		{
			int focused_slot = GetFocusSlot(_x, _y); // m_focused_slot은 중요하니까...
			
			int id;
			if (focused_slot == 0 && m_selected_skillid != NOT_SELECTED)
				id = m_selected_skillid;
			else
				id = GetSkillID(focused_slot);
			
			if (id != NOT_SELECTED)
			{
				Point point = GetIconPoint(focused_slot);
				g_descriptor_manager.Set(DID_SKILL, point.x, point.y, NULL, id, m_skill_guard_y);
			}
			
			if (!NoPassive(focused_slot))
				focused_slot = NOT_SELECTED;
			
			if(m_focused_slot != focused_slot)
			{
				gpC_Imm->ForceUI(CImm::FORCE_UI_WINDOW);
				m_focused_slot = focused_slot;
			}
			
			//				if(m_focused_slot != focused_slot)
			//				{
			//					if(gpC_Imm)
			//						gpC_Imm->ForceUI(CImm::FORCE_UI_WINDOW);
			//					m_focused_slot = focused_slot;
			//				}
			//				
			//				m_focused_slot = GetFocusSlot(_x, _y);
			//
			//			if (m_focused_slot != 0 && AbleToUse(GetSkillID(m_focused_slot)) == false)
			//				m_focused_slot = NOT_SELECTED;
			//
			//			if (!NoPassive(m_focused_slot))
			//				m_focused_slot = NOT_SELECTED;
			//
			//			// set description
			//
			//				int id;
			//				if (focused_slot == 0 && m_selected_skillid != NOT_SELECTED)
			//					id = m_selected_skillid;
			//				else
			//					id = GetSkillID(focused_slot);
			//
			//				if (id != NOT_SELECTED)
			//				{
			//					Point point = GetIconPoint(focused_slot);
			//					g_descriptor_manager.Set(DID_SKILL, point.x, point.y, NULL, id, m_skill_guard_y);
			//				}
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (gpC_base->EventOccured() == true)
			return true;
		
		if (m_focused_slot != NOT_SELECTED)
		{
			if (m_focused_slot == 0 || /*(AbleToUse(GetSkillID(m_focused_slot))*/(IsEnableSkill(GetSkillID(m_focused_slot)) && NoPassive(m_focused_slot)))
				m_bl_pushed = true;
		}
		break;
		
	case M_LEFTBUTTON_UP:
		if (m_bl_pushed == true && m_focused_slot != NOT_SELECTED)
		{
			// select skill
			if (m_bl_open == true && m_focused_slot != 0)
			{
				m_selected_skillid = GetSkillID(m_focused_slot);
				gpC_base->SendMessage(UI_SELECT_SKILL, m_selected_skillid);
			}
			
			ToggleWindow();
		}
		if(m_bl_pushed)
		{
			m_bl_pushed = false;
			m_focused_slot = GetFocusSlot(_x, _y);
		}
		EMPTY_MOVE;
		break;
		
	case M_RIGHTBUTTON_DOWN:
		break;
		
	case M_RIGHTBUTTON_UP:
		g_descriptor_manager.Unset();
		m_selected_skillid = NOT_SELECTED;
		gpC_base->SendMessage(UI_CANCEL_SELECT_SKILL);
		break;
		
	case M_WHEEL_UP:
		ChangeSkillWheel(true);
		break;
		
	case M_WHEEL_DOWN:
		ChangeSkillWheel(false);
		break;
		
	}
	
	return true;
}


//-----------------------------------------------------------------------------
// DrawSkillIcon()
// : 스킬 아이콘을 그린다.
//   선택된 놈과 스킬 리스트에서 출력하는 구문을 하나의 함수로 통합 by chyaya
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::DrawSkillIcon(CPoint ptPos, int nSkillID)
{
	SPRITE_ID	spr_id		= (*g_pSkillInfoTable)[nSkillID].GetSpriteID();
	CSprite*	p_sprite	= &m_C_spk[spr_id];
	
	if (p_sprite != NULL)
	{
		if (m_bl_pushed == true && m_focused_slot == 0)
		{
			ptPos.x += 1;
			ptPos.y += 1;
		}
		
		ptPos.x += m_extra_icon_offset_x;
		ptPos.y += m_extra_icon_offset_y;
		
		if (gpC_base->m_p_DDSurface_back->Lock())
		{
			// 사용할 수 없으면 빨간색으로..
			if(IsEnableSkill(nSkillID) == false)
			{
				CSpriteSurface::SetEffect(CSpriteSurface::EFFECT_GRAY_SCALE);
				gpC_base->m_p_DDSurface_back->BltSpriteEffect(&ptPos, p_sprite);
			}
			else if ((*g_pSkillInfoTable)[nSkillID].IsPassive())
			{
				gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&ptPos, p_sprite, 315-256);
			}
			else if (AbleToUse(nSkillID) == false)
				gpC_base->m_p_DDSurface_back->BltSpriteColor(&ptPos, p_sprite, rgb_RED);
			else
			{
				gpC_base->m_p_DDSurface_back->BltSprite(&ptPos, p_sprite); 
				
				int percent = max(0,min(100,GetDelay(nSkillID) ) );
				if(percent)
				{
					Rect rect;
					RECT rt;
					S_SURFACEINFO surface_info;
					SetSurfaceInfo(&surface_info, gpC_base->m_p_DDSurface_back->GetDDSD());
					
					SetRect((RECT *)&rect, 0, 0, p_sprite->GetWidth(), p_sprite->GetHeight()*(percent)/100);
					rt.left = rect.x;
					rt.top = rect.y;
					rt.right = rect.x+rect.w;
					rt.bottom = rect.y+rect.h;
					
					if(rt.left < rt.right && rt.top < rt.bottom)
					{
						WORD * p_dest = (WORD *)surface_info.p_surface+ptPos.x+rt.left;
						p_dest = (WORD *)((BYTE *)p_dest+(ptPos.y+rt.top)*surface_info.pitch);
						//슬레 gm캐릭터들 스킬 모두 배우면 튕겨서 안그려주게 해주자.
						if(ptPos.y >= 0)
						p_sprite->BltColorClipHeight(p_dest, surface_info.pitch, &rt, rgb_RED);
					}
				}
				else if(m_progress_skill_id != -1 && m_progress_skill_id == nSkillID &&
						m_bl_show_progress && m_progress_timer.IsEnable())	// Casting Time
				{
					DWORD dwCastingTime	= m_progress_timer.GetTickSize();
					DWORD dwRemainTime	= m_progress_timer.GetTimeLimit() - GetTickCount();
					float fProgressRate = dwRemainTime / static_cast<float>(dwCastingTime);
					
					if(fProgressRate >= 0.0f && fProgressRate <= 1.0f)
					{
						S_SURFACEINFO surface_info;
						SetSurfaceInfo(&surface_info, gpC_base->m_p_DDSurface_back->GetDDSD());

						CRect rcDraw(CPoint(0, 0),
							CSize(p_sprite->GetWidth(), p_sprite->GetHeight() * fProgressRate));
						
						if(!rcDraw.IsRectEmpty())
						{
							//char szBuf[256];
							//sprintf(szBuf, "dwRemainTime / dwCastingTime = %d / %d\n", dwRemainTime, dwCastingTime);
							//OutputDebugString(szBuf);
							//sprintf(szBuf, "rcDraw: (%d, %d, %d, %d)\n", rt.left, rt.top, rt.right, rt.bottom);
							//OutputDebugString(szBuf);
							
							WORD * p_dest = (WORD *)surface_info.p_surface+ptPos.x+rcDraw.left;
							p_dest = (WORD *)((BYTE *)p_dest+(ptPos.y+rcDraw.top)*surface_info.pitch);
							
							p_sprite->BltColorClipHeight(p_dest, surface_info.pitch, &rcDraw, rgb_GREEN);
						}
					}
				}
			}
			
			if(m_selected_comboAttackskill)
			{	
				POINT	  point_num;
				CSprite * p_Combosprite;
				p_Combosprite = &m_C_spk_comboCnt[m_comboCnt -1 ];
				point_num.x = p_sprite->GetWidth() - p_Combosprite->GetWidth() ; 
				point_num.y = ptPos.y ; 
				point_num.x += ptPos.x ; 
				
				gpC_base->m_p_DDSurface_back->BltSprite(&point_num, p_Combosprite); 
			}

			gpC_base->m_p_DDSurface_back->Unlock();
		}
	}
	
}

/*-----------------------------------------------------------------------------
- Show
- Skill Show.
-----------------------------------------------------------------------------*/
void C_VS_UI_SKILL::Show2()
{
	//
	// Show Skill icon
	//
	// skill guard 위에 push/unpush button이 놓인다.
	// skill을 선택하면 그것이 button으로 대체된다.
	//
	// 선택된 skill이 제일 처음 출력된다. 그 line은 그것을 포함해서 SPREAD_X_MAX이다.
	//
	int i = 0;
	CSprite * p_sprite;
	SPRITE_ID spr_id;

	// 선택된 skill을 출력한다.
	if (m_selected_skillid != NOT_SELECTED && g_pSkillAvailable->find( (ACTIONINFO) m_selected_skillid ) != g_pSkillAvailable->end())
	{
		DrawSkillIcon(CPoint(m_skill_start_x + 2, m_skill_start_y + 1), m_selected_skillid);

		/*
		spr_id = (*g_pSkillInfoTable)[(ACTIONINFO)m_selected_skillid].GetSpriteID();
		
		p_sprite = &m_C_spk[spr_id];
		
		if (p_sprite != NULL)
		{
			POINT point;
			point.x = m_skill_start_x+2; // 고정된 위치이다.
			point.y = m_skill_start_y+1;
			
			if (m_bl_pushed == true && m_focused_slot == 0)
			{
				point.x += 1;
				point.y += 1;
			}
			
			point.x += m_extra_icon_offset_x;
			point.y += m_extra_icon_offset_y;
			
			if (gpC_base->m_p_DDSurface_back->Lock())
			{
				// 사용할 수 없으면 빨간색으로..
				if(IsEnableSkill(m_selected_skillid) == false)
				{
					CSpriteSurface::SetEffect(CSpriteSurface::EFFECT_GRAY_SCALE);
					gpC_base->m_p_DDSurface_back->BltSpriteEffect(&point, p_sprite);
				}
				else if (AbleToUse(m_selected_skillid) == false)
					gpC_base->m_p_DDSurface_back->BltSpriteColor(&point, p_sprite, rgb_RED);
				else
				{
					gpC_base->m_p_DDSurface_back->BltSprite(&point, p_sprite); 
					
					int percent = max(0,min(100,GetDelay(m_selected_skillid) ) );
					if(percent)
					{
						Rect rect;
						RECT rt;
						S_SURFACEINFO surface_info;
						SetSurfaceInfo(&surface_info, gpC_base->m_p_DDSurface_back->GetDDSD());
						
						SetRect((RECT *)&rect, 0, 0, p_sprite->GetWidth(), p_sprite->GetHeight()*(percent)/100);
						rt.left = rect.x;
						rt.top = rect.y;
						rt.right = rect.x+rect.w;
						rt.bottom = rect.y+rect.h;
						
						if(rt.left < rt.right && rt.top < rt.bottom)
						{
							WORD * p_dest = (WORD *)surface_info.p_surface+point.x+rt.left;
							p_dest = (WORD *)((BYTE *)p_dest+(point.y+rt.top)*surface_info.pitch);
							
							p_sprite->BltColorClipHeight(p_dest, surface_info.pitch, &rt, rgb_RED);
						}
					}
					else if(m_bl_show_progress && m_progress_skill_id != -1 &&
							m_progress_timer.IsEnable())	// Casting Time
					{
						DWORD dwCastingTime	= m_progress_timer.GetTickSize();
						DWORD dwRemainTime	= m_progress_timer.GetTimeLimit() - GetTickCount();
						float fProgressRate = static_cast<float>(dwRemainTime) / dwCastingTime;

						S_SURFACEINFO surface_info;
						SetSurfaceInfo(&surface_info, gpC_base->m_p_DDSurface_back->GetDDSD());
						
						CRect rcDraw(CPoint(0, 0),
							CSize(p_sprite->GetWidth(), p_sprite->GetHeight() * fProgressRate));
						
						if(!rcDraw.IsRectEmpty())
						{
							char szBuf[256];
							sprintf(szBuf, "dwRemainTime / dwCastingTime = %d / %d\n", dwRemainTime, dwCastingTime);
							OutputDebugString(szBuf);
							//sprintf(szBuf, "rcDraw: (%d, %d, %d, %d)\n", rt.left, rt.top, rt.right, rt.bottom);
							//OutputDebugString(szBuf);

							WORD * p_dest = (WORD *)surface_info.p_surface+point.x+rcDraw.left;
							p_dest = (WORD *)((BYTE *)p_dest+(point.y+rcDraw.top)*surface_info.pitch);
							
							p_sprite->BltColorClipHeight(p_dest, surface_info.pitch, &rcDraw, rgb_GREEN);
						}
					}
				}
				
				if(m_selected_comboAttackskill)
				{	
					POINT	  point_num;
					CSprite * p_Combosprite;
					p_Combosprite = &m_C_spk_comboCnt[m_comboCnt -1 ];
					point_num.x = p_sprite->GetWidth() - p_Combosprite->GetWidth() ; 
					point_num.y = point.y ; 
					point_num.x += point.x ; 
						 					
					gpC_base->m_p_DDSurface_back->BltSprite(&point_num, p_Combosprite); 
				}
				gpC_base->m_p_DDSurface_back->Unlock();
			}
		}
		*/
	}
	else
	{
		if (m_bl_pushed == true && m_focused_slot == 0)
			m_etc_spk.Blt(m_skill_start_x+m_skill_guard_extra_offset, m_skill_start_y+m_skill_guard_extra_offset, SKILL_PUSHED_BUTTON);
		else
			m_etc_spk.Blt(m_skill_start_x+m_skill_guard_extra_offset, m_skill_start_y+m_skill_guard_extra_offset, SKILL_EMPTY_BUTTON);
	}
	
	//	if (m_selected_skillid != NOT_SELECTED && m_bl_pushed == true && m_focused_slot == 0)
	//		m_etc_spk.BltColor(m_skill_start_x+1, m_skill_start_y+1, SKILL_GUARD, rgb_GREEN);
	//	else
	//		m_etc_spk.Blt(m_skill_start_x, m_skill_start_y, SKILL_GUARD);
	
	if (m_bl_open == true)
	{
		// 선택된 skill을 제외하고 가능한 skill을 모두 출력한다.
		MSkillSet::SKILLID_MAP::iterator iNode = g_pSkillAvailable->begin();
		while (iNode != g_pSkillAvailable->end())
		{
			// skill의 id와 status
			SKILLID_NODE node = ((*iNode).second);
			ACTIONINFO id		= node.SkillID;
			
			// 2004, 11, 26, sobeit add start - 사용 불가 스킬은 아예 표시하지 말아달라고 요청이 와서..^^
			if(IsEnableSkill(id) == false)
			{
				iNode ++;
				continue;
			}

			// 2004, 11, 26, sobeit add end
			spr_id = (*g_pSkillInfoTable)[id].GetSpriteID();
			
			//---------------------------------------
			// id를 알면 (*g_pSkillInfoTable)에서 
			// 그 id의 skill에 대한 정보를 얻을 수 있다.
			//---------------------------------------
			//logFile << "[" << id << "] " << (*g_pSkillInfoTable)[id].GetName()
			//		<< " = " << (int)status << endl;
			
			p_sprite = &m_C_spk[spr_id];
			
			if (p_sprite != NULL)
			{
				CPoint point;
				point.x = m_skill_start_x-(m_skill_guard_x*((i+1)%SPREAD_X_MAX))+2;
				point.y = m_skill_start_y-(m_skill_guard_y*((i+1)/SPREAD_X_MAX))+1;
				
				DrawSkillIcon(point, id);

				/*
				if (m_bl_pushed == true && m_focused_slot == (i+1))
				{
					point.x += 1;
					point.y += 1;
				}
				
				POINT backup_pt = point;
				point.x += m_extra_icon_offset_x;
				point.y += m_extra_icon_offset_y;
				
				if (gpC_base->m_p_DDSurface_back->Lock())
				{
					// 사용할 수 없으면 빨간색으로..
					if(IsEnableSkill(id) == false)
					{
						CSpriteSurface::SetEffect(CSpriteSurface::EFFECT_GRAY_SCALE);
						gpC_base->m_p_DDSurface_back->BltSpriteEffect(&point, p_sprite);
					}
					else if ((*g_pSkillInfoTable)[id].IsPassive())
					{
						gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&point, p_sprite, 315-256);
					}
					else if (AbleToUse(id) == false)
						gpC_base->m_p_DDSurface_back->BltSpriteColor(&point, p_sprite, rgb_RED);
					else
					{
						gpC_base->m_p_DDSurface_back->BltSprite(&point, p_sprite);
						int percent = min(100,GetDelay(id));
						if(percent)
						{
							Rect rect;
							RECT rt;
							S_SURFACEINFO surface_info;
							SetSurfaceInfo(&surface_info, gpC_base->m_p_DDSurface_back->GetDDSD());
							
							SetRect((RECT *)&rect, 0, 0, p_sprite->GetWidth(), p_sprite->GetHeight()*(percent)/100);
							rt.left = rect.x;
							rt.top = rect.y;
							rt.right = rect.x+rect.w;
							rt.bottom = rect.y+rect.h;
							
							if(rt.left < rt.right && rt.top < rt.bottom)
							{
								if( point.y < 0 )
								{
									rt.top = -point.y;
									point.y=0;
								}								
								WORD * p_dest = (WORD *)surface_info.p_surface+point.x+rt.left;
								p_dest = (WORD *)((BYTE *)p_dest+(point.y+rt.top)*surface_info.pitch);

								if( rt.top < rt.bottom )
									p_sprite->BltColorClipHeight(p_dest, surface_info.pitch, &rt, rgb_RED);
							}
						}
					}
					
					gpC_base->m_p_DDSurface_back->Unlock();
				}
				*/
				
				//point = backup_pt;
				
				if (m_bl_pushed == true && m_focused_slot == (i+1))
					m_etc_spk.BltColor(point.x-2, point.y-1, SKILL_GUARD, rgb_GREEN);
				//else if (m_selected_skillid != NOT_SELECTED && GetSkillID(i) == m_selected_skillid) // 그들 중 현재 선택된 거...
				//	m_etc_spk.BltColor(point.x-2, point.y-1, SKILL_GUARD, rgb_BLUE);
				else
					m_etc_spk.Blt(point.x-2, point.y-1, SKILL_GUARD);
				
				// print hotkey mark
				// 글자색이 많이 튄다는 이유로 고치랍니다.. by sigi
				const char hotkey_mark[12][4][10] = 
				{
					{"F1:1", "F1:2", "F1:3", "F1:4"},
					{"F2:1", "F2:2", "F2:3", "F2:4"},
					{"F3:1", "F3:2", "F3:3", "F3:4"},
					{"F4:1", "F4:2", "F4:3", "F4:4"},
					{"F5:1", "F5:2", "F5:3", "F5:4"},
					{"F6:1", "F6:2", "F6:3", "F6:4"},
					{"F7:1", "F7:2", "F7:3", "F7:4"},
					{"F8:1", "F8:2", "F8:3", "F8:4"},
					{"F9:1", "F9:2", "F9:3", "F9:4"},
					{"F10:1", "F10:2", "F10:3", "F10:4"}, 
					{"F11:1", "F11:2", "F11:3", "F11:4"}, 
					{"F12:1", "F12:2", "F12:3", "F12:4"},

					/*{"F9:1", "F9:2", "F9:3", "F9:4"},
					{"F10:1", "F10:2", "F10:3", "F10:4"}, 
					{"F11:1", "F11:2", "F11:3", "F11:4"}, 
					{"F12:1", "F12:2", "F12:3", "F12:4"},
					{"F5:1", "F5:2", "F5:3", "F5:4"},
					{"F6:1", "F6:2", "F6:3", "F6:4"},
					{"F7:1", "F7:2", "F7:3", "F7:4"},
					{"F8:1", "F8:2", "F8:3", "F8:4"},*/
				};
				
				int widthMark[12][4] =
				{
				26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					/*26,
					26,
					26,
					26,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					32,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,
					26,*/
				};
				
				const int heightMark = 14;//g_GetStringHeight(hotkey_mark[0], gpC_base->m_item_desc_pi.hfont);
				
				// 검은색 박스 출력..
				if (gpC_base->m_p_DDSurface_back->Lock())
				{
					RECT rect;
					
					for (int hk=0; hk < HOTKEY_MAX; hk++)
					{
						for (int hl=0; hl < GRADE_MAX; hl++)
						{
							if (m_skill_hotkey_buf[hk][hl] == id)
							{
								rect.left = point.x;
								rect.top = point.y+24;
								rect.right = rect.left + widthMark[hk][hl];
								rect.bottom = rect.top+heightMark;
								
								DrawAlphaBox(&rect, 0, 0, 0, g_pUserOption->ALPHA_DEPTH);
							}
						}
					}
					
					gpC_base->m_p_DDSurface_back->Unlock();
				}
				
				g_FL2_GetDC();
				for (int hk=0; hk < HOTKEY_MAX; hk++)
				{
					for(int hl=0; hl < GRADE_MAX; hl++)
					{
						if (m_skill_hotkey_buf[hk][hl] == id)
						{
							//g_Print(point.x, point.y+24, hotkey_mark[hk]);
							COLORREF markColor = RGB(140, 140, 255);
							
							g_PrintColorStr(point.x+1, point.y+25, hotkey_mark[hk][hl], gpC_base->m_item_desc_pi, markColor);	
							
						}
					}
				}
				g_FL2_ReleaseDC();
			}
			
			// 다음
			iNode++;
			i++;
		}
	}
	if(Timer() && GetSelectedSkillID() != NOT_SELECTED)
	{
		Point point = GetIconPoint(0);
		g_descriptor_manager.Set(DID_SKILL, point.x, point.y, NULL, GetSelectedSkillID(), m_skill_guard_y);
	}
//	else
//	{
//		g_descriptor_manager.Unset();
//	}
	
	//지뢰 설치 Progress Bar
	if(gbl_mine_progress)
	{
		const MItem * p_item = g_pInventory->GetItem(C_VS_UI_INVENTORY::m_mine_grid_x, C_VS_UI_INVENTORY::m_mine_grid_y);
		bool pickUpItem = gpC_mouse_pointer->IsPickUpItem();
		
		if (p_item != NULL && pickUpItem == 0 ) // Item이 있다.
		{
			bool bMineItem = p_item->GetItemClass() == ITEM_CLASS_MINE && 
					(GetSelectedSkillID() == SKILL_INSTALL_MINE || 
					GetSelectedSkillID() == MINE_ANKLE_KILLER || 
					GetSelectedSkillID() == MINE_POMZ || 
					GetSelectedSkillID() == MINE_AP_C1 || 
					GetSelectedSkillID() == MINE_DIAMONDBACK || 
					GetSelectedSkillID() == MINE_SWIFT_EX || 
					GetSelectedSkillID() == MINE_SIDEWINDER || 
					GetSelectedSkillID() == MINE_COBRA);
			bool bBombItem = 
				( 
					p_item->GetItemClass() == ITEM_CLASS_BOMB_MATERIAL && 
					p_item->GetItemType() > 4 && 
					GetSelectedSkillID() == SKILL_MAKE_MINE 
				) ||
				(
					p_item->GetItemClass() == ITEM_CLASS_BOMB_MATERIAL && 
					p_item->GetItemType() < 5 && 
					GetSelectedSkillID() == SKILL_MAKE_BOMB
				);

			if( bMineItem || bBombItem )
			{
				if(!gpC_mouse_pointer->RightMousePushed())
					gC_vs_ui.EndInstallMineProgress();
				
				if(C_VS_UI_INVENTORY::Timer())
				{
					gpC_base->SendMessage(UI_ITEM_USE, p_item->GetID(), 0, (MItem *)p_item);
					gC_vs_ui.EndInstallMineProgress();
				}
				else
				{
					TYPE_FRAMEID frame_id = p_item->GetInventoryFrameID();
					
					int item_x = m_skill_start_x+4;
					int item_y = m_skill_start_y+36-1;
					
					if(gpC_base->m_p_DDSurface_back->Lock())
					{
						C_VS_UI_INVENTORY::m_pC_mine_progress_spk->BltLocked(item_x, item_y, C_VS_UI_INVENTORY::INVENTORY_BAR_BACK);
						
						Rect rect;
						rect.Set(0, 0, C_VS_UI_INVENTORY::m_pC_mine_progress_spk->GetWidth(C_VS_UI_INVENTORY::INVENTORY_BAR)*(GetTickCount() - gi_mine_progress)/C_VS_UI_INVENTORY::m_dw_millisec, C_VS_UI_INVENTORY::m_pC_mine_progress_spk->GetHeight(C_VS_UI_INVENTORY::INVENTORY_BAR));
						
						C_VS_UI_INVENTORY::m_pC_mine_progress_spk->BltLockedClip(item_x, item_y, rect, C_VS_UI_INVENTORY::INVENTORY_BAR);
						gpC_base->m_p_DDSurface_back->Unlock();
					}
				}
			}
		}
	}
//	else
//	gC_vs_ui.EndInstallMineProgress();
	
	/*
	// 일반적인 스킬 Progress Bar
	if(m_bl_show_progress)
	{
		TYPE_FRAMEID frame_id = m_pC_progress_item->GetInventoryFrameID();
		
		int item_x = m_skill_start_x + 4;
		int item_y = m_skill_start_y + 36 - 1;
		
		if(gpC_base->m_p_DDSurface_back->Lock())
		{					
			C_VS_UI_INVENTORY::m_pC_mine_progress_spk->BltLocked(item_x, item_y, C_VS_UI_INVENTORY::INVENTORY_BAR_BACK);
			
			CSize sizeInventoryBar(
				C_VS_UI_INVENTORY::m_pC_mine_progress_spk->GetWidth(C_VS_UI_INVENTORY::INVENTORY_BAR),	
				C_VS_UI_INVENTORY::m_pC_mine_progress_spk->GetHeight(C_VS_UI_INVENTORY::INVENTORY_BAR));

			float fRate = (GetTickCount() - gi_mine_progress) / C_VS_UI_INVENTORY::m_dw_millisec;

			Rect rect;
			rect.Set(0, 0, sizeInventoryBar.cx * fRate, sizeInventoryBar.cy);
			
			C_VS_UI_INVENTORY::m_pC_mine_progress_spk->BltLockedClip(
				item_x, item_y, rect, C_VS_UI_INVENTORY::INVENTORY_BAR);
			
			gpC_base->m_p_DDSurface_back->Unlock();
		}
	}
	*/


#ifndef _LIB
	extern bool gbl_info_show;
	
	if(gbl_info_show)
	{
		char skill_size_buf[100];
		sprintf(skill_size_buf, "available skill count = %d", g_pSkillAvailable->size());
		g_Print(5, TEXT_LINE(3), skill_size_buf);
		
		sprintf(skill_size_buf, "skill focused slot = %d", m_focused_slot);
		g_Print(5, TEXT_LINE(4), skill_size_buf);
		
		sprintf(skill_size_buf, "selected skill = %d", m_selected_skillid);
		g_Print(5, TEXT_LINE(5), skill_size_buf);
		
		if (gpC_base->m_p_DDSurface_back->Lock())
		{
			S_SURFACEINFO	surface_info;
			SetSurfaceInfo(&surface_info, gpC_base->m_p_DDSurface_back->GetDDSD());
			
			//		rectangle(&surface_info, x, y, x+w-1, y+h-1, GREEN);
			
			gpC_base->m_p_DDSurface_back->Unlock();
		}
	}
#endif
			

	if ( !m_bl_open )
	{
		//DrawSkillIconInQuickBar(CPoint(m_skill_start_x+m_skill_guard_extra_offset,  m_skill_start_y+m_skill_guard_extra_offset));
	}
}

void C_VS_UI_SKILL::DrawSkillIconInQuickBar(CPoint ptPos)
{
	int i = 0;
	CSprite * p_sprite;
	SPRITE_ID spr_id;


		// 선택된 skill을 제외하고 가능한 skill을 모두 출력한다.
		MSkillSet::SKILLID_MAP::iterator iNode = g_pSkillAvailable->begin();
		while (iNode != g_pSkillAvailable->end())
		{
			// skill의 id와 status
			SKILLID_NODE node = ((*iNode).second);
			ACTIONINFO id		= node.SkillID;
			
			// 2004, 11, 26, sobeit add start - 사용 불가 스킬은 아예 표시하지 말아달라고 요청이 와서..^^
			if(IsEnableSkill(id) == false)
			{
				iNode ++;
				continue;
			}

			// 2004, 11, 26, sobeit add end
			spr_id = (*g_pSkillInfoTable)[id].GetSpriteID();
			
			//---------------------------------------
			// id를 알면 (*g_pSkillInfoTable)에서 
			// 그 id의 skill에 대한 정보를 얻을 수 있다.
			//---------------------------------------
			//logFile << "[" << id << "] " << (*g_pSkillInfoTable)[id].GetName()
			//		<< " = " << (int)status << endl;
			
			p_sprite = &m_C_spk[spr_id];
			
			if (p_sprite != NULL)
			{
				CPoint point;
				point.x = ptPos.x;
				point.y = ptPos.y;
				//point.x = ptPos.x+(m_skill_guard_x*((i+1)%SPREAD_X_MAX))+2;
				//point.y = ptPos.y+(m_skill_guard_y*((i+1)/SPREAD_X_MAX))+1;
				
				

				
				//if (m_bl_pushed == true && m_focused_slot == (i+1))
				//	m_etc_spk.BltColor(point.x-2, point.y-1, SKILL_GUARD, rgb_GREEN);
				////else if (m_selected_skillid != NOT_SELECTED && GetSkillID(i) == m_selected_skillid) // 그들 중 현재 선택된 거...
				////	m_etc_spk.BltColor(point.x-2, point.y-1, SKILL_GUARD, rgb_BLUE);
				//else
				//	m_etc_spk.Blt(point.x-2, point.y-1, SKILL_GUARD);
				
				// print hotkey mark
				// 글자색이 많이 튄다는 이유로 고치랍니다.. by sigi
				const char hotkey_mark[12][4][10] = 
				{
					{"F1:1", "F1:2", "F1:3", "F1:4"},
					{"F2:1", "F2:2", "F2:3", "F2:4"},
					{"F3:1", "F3:2", "F3:3", "F3:4"},
					{"F4:1", "F4:2", "F4:3", "F4:4"},
					{"F5:1", "F5:2", "F5:3", "F5:4"},
					{"F6:1", "F6:2", "F6:3", "F6:4"},
					{"F7:1", "F7:2", "F7:3", "F7:4"},
					{"F8:1", "F8:2", "F8:3", "F8:4"},
					{"F9:1", "F9:2", "F9:3", "F9:4"},
					{"F10:1", "F10:2", "F10:3", "F10:4"}, 
					{"F11:1", "F11:2", "F11:3", "F11:4"}, 
					{"F12:1", "F12:2", "F12:3", "F12:4"},
				};
				
				int widthMark[12][4] =
				{
					26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,32,32,32,32,32,32,32,32,32,32,32,32,
				};

				int hotkey_width = m_skill_guard_x * HOTKEY_MAX;

				int hotkey_start_x = m_skill_start_x - hotkey_width - m_skill_guard_x * 3;

				for (int hk=0; hk < HOTKEY_MAX; hk++)
				{
					for (int hl=0; hl < GRADE_MAX; hl++)
					{
						if (m_skill_hotkey_buf[hk][hl] == id)
						{

							
							int x = hotkey_start_x + m_skill_guard_x * hk;
							int y = point.y;

							m_etc_spk.Blt(x, y, 0);

							x = x + 2;
							y = y + 1; 
							DrawSkillIcon(CPoint(x, y), id);

							//rect.left = point.x;
							//rect.top = point.y+24;
							//rect.right = rect.left + widthMark[hk][hl];
							//rect.bottom = rect.top+heightMark;

							//DrawAlphaBox(&rect, 0, 0, 0, g_pUserOption->ALPHA_DEPTH);
						}
					}
				}
				
				const int heightMark = 14;//g_GetStringHeight(hotkey_mark[0], gpC_base->m_item_desc_pi.hfont);
				
				// 검은색 박스 출력..
				if (gpC_base->m_p_DDSurface_back->Lock())
				{
					RECT rect;
					
					for (int hk=0; hk < HOTKEY_MAX; hk++)
					{
						for (int hl=0; hl < GRADE_MAX; hl++)
						{
							if (m_skill_hotkey_buf[hk][hl] == id)
							{
								rect.left = hotkey_start_x + m_skill_guard_x * hk;
								rect.top = point.y+24;
								rect.right = rect.left + widthMark[hk][hl];
								rect.bottom = rect.top+heightMark;

								DrawAlphaBox(&rect, 0, 0, 0, g_pUserOption->ALPHA_DEPTH);
							}
						}
					}
					
					gpC_base->m_p_DDSurface_back->Unlock();
				}
				
				g_FL2_GetDC();
				for (int hk=0; hk < HOTKEY_MAX; hk++)
				{
					for(int hl=0; hl < GRADE_MAX; hl++)
					{
						if (m_skill_hotkey_buf[hk][hl] == id)
						{
							//g_Print(point.x, point.y+24, hotkey_mark[hk]);
							COLORREF markColor = RGB(140, 140, 255);
							int x = hotkey_start_x + m_skill_guard_x * hk;
							
							g_PrintColorStr(x+3, point.y+25, hotkey_mark[hk][hl], gpC_base->m_item_desc_pi, markColor);	
							
						}
					}
				}
				g_FL2_ReleaseDC();
			}
			
			// 다음
			iNode++;
			i++;
		}

}

//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::Timer
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_SKILL::Timer(bool reset)
{
	if(reset)
	{
		//		m_timer = false;
		m_dw_prev_tickcount = GetTickCount();
	}
	else if(m_dw_prev_tickcount+m_dw_millisec >= GetTickCount())
	{
		return true;
		//		m_timer = true;
		//		m_dw_prev_tickcount = GetTickCount();
	}
	//	else m_timer = false;
	
	return false;
}


//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::StartSkillCastingProgress
//
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::StartSkillCastingProgress(int skillID, DWORD time, CPoint inventoryGrid)
{
	//char szBuf[256];
	//sprintf(szBuf, "StartSkillCastingProgress()\n");
	//OutputDebugString(szBuf);

	m_progress_skill_id			= skillID;

	m_progress_inventory_grid	= inventoryGrid;

	m_bl_show_progress			= true;

	m_pC_progress_item			= NULL;

	m_progress_timer.StartTimer(time);
}


//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::ProcessSkillCastingProgress
//
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::ProcessSkillCastingProgress()
{
	if(!m_bl_show_progress || m_progress_skill_id == -1)
		return;

	if(!gpC_mouse_pointer->RightMousePushed() ||
	   m_selected_skillid != m_progress_skill_id)
	{
		EndSkillCastingProgress();
		return;
	}

	if(m_progress_inventory_grid.x != -1 && m_progress_inventory_grid.y != -1)
	{
		m_pC_progress_item = g_pInventory->GetItem(
			m_progress_inventory_grid.x, m_progress_inventory_grid.y);
		if(!m_pC_progress_item) return;
	}
	
	if(m_progress_timer.IsTimeLimit())
	{
		//OutputDebugString("ProcessSkillCastingProgress() : IsTimeLimit()\n");

		//if(m_pC_progress_item)
		//	gpC_base->SendMessage(UI_ITEM_USE, m_pC_progress_item->GetID(), 0, m_pC_progress_item);
		//else
		gpC_base->SendMessage(UI_PLAYER_ACTION_TO_SEND_PACKET);

		EndSkillCastingProgress();
	}
}


//-----------------------------------------------------------------------------
// C_VS_UI_SKILL::EndSkillCastingProgress
//
//-----------------------------------------------------------------------------
void C_VS_UI_SKILL::EndSkillCastingProgress()
{
//	char szBuf[256];
//	sprintf(szBuf, "EndSkillCastingProgress()\n");
//	OutputDebugString(szBuf);

	m_progress_skill_id			= -1;

	m_progress_inventory_grid	= CPoint(-1, -1);

	m_bl_show_progress			= false;

	m_pC_progress_item			= NULL;

	m_progress_timer.SetEnable(false);
}


bool C_VS_UI_SKILL::findSkillAvailable(ACTIONINFO id)
{
	MSkillSet::SKILLID_MAP::iterator iNode = g_pSkillAvailable->begin();	
	
	while( iNode != g_pSkillAvailable->end() )
	{
		if( ((*iNode).second).SkillID == id)
			return true;
		iNode++;
	}
	return false;
}

void	C_VS_UI_SKILL::ResetSkillSet()
{
	// 아아.. 여기서 자꾸 버그가 난다..
	// 결국... Love Chain 만 막을까낭-_-;
	ACTIONINFO id = (ACTIONINFO) m_selected_skillid;

	switch( id )
	{
	case SKILL_LOVE_CHAIN :
		if( !findSkillAvailable ( id ) )
		{
			m_selected_skillid = NOT_SELECTED;
		}
		break;
	}

//	if(! findSkillAvailable( (ACTIONINFO) GetSkillID(m_focused_slot) ))
//		m_focused_slot = 0;
//
//	if(! findSkillAvailable( (ACTIONINFO) m_selected_skillid ) && m_selected_skillid != NOT_SELECTED )
//		m_selected_skillid = NOT_SELECTED;
}

void	C_VS_UI_SKILL::ResetHotkey()
{
	// 5개 이하는 단축키 리셋 안한다.
//	if( g_pSkillAvailable->size() < 5 )
		return;

	for (int hk=0; hk < HOTKEY_MAX; hk++)
	{
		for(int hl=0; hl < GRADE_MAX; hl++)
		{
			ACTIONINFO id = (ACTIONINFO)m_skill_hotkey_buf[hk][hl];
			if(! findSkillAvailable ( id ) )
			{
				// disable 된 skill 이면 단축키를 지워준다.
				if( m_selected_skillid == m_skill_hotkey_buf[hk][hl])
					m_selected_skillid  = NOT_SELECTED;			
				
				m_skill_hotkey_buf[hk][hl] = NOT_SELECTED;
			}			
		}
	}
}

void	C_VS_UI_SKILL::SetComboCnt(int ComboCnt)
{
	m_comboCnt =  ComboCnt  ; 
}

void	C_VS_UI_SKILL::SetSelectedAttackComboSkill(bool	bAttackSkill)
{
	m_selected_comboAttackskill = bAttackSkill ; 
}

//-----------------------------------------------------------------------------
// C_VS_UI_LEVELUP::C_VS_UI_LEVELUP
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_LEVELUP::C_VS_UI_LEVELUP()
{
	g_RegisterWindow(this);
	
	AttrPin(true);
	
	int _y;
	
	m_image_spk.Open(SPK_LEVELUP);
	_y = 425;
	if(g_eRaceInterface == RACE_OUSTERS || g_eRaceInterface == RACE_SLAYER )
		_y = 382;

	_y += g_pUserInformation->iResolution_y - 600;

//#ifdef CONVERT_1024_768
//	_y += 168;
//#endif
	
	Set(2, _y, m_image_spk.GetWidth(LVU_GUARD_SLAYER), m_image_spk.GetHeight(LVU_GUARD_SLAYER));
}

//-----------------------------------------------------------------------------
// C_VS_UI_LEVELUP::~C_VS_UI_LEVELUP
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_LEVELUP::~C_VS_UI_LEVELUP()
{
	g_UnregisterWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_LEVELUP::Show
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_LEVELUP::Show()
{
	RECT rect = { x+9, y+9, x+9+36, y+9+36 };
	gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		int buttonSpriteID = LVU_BUTTON;
		int guardSpriteID = LVU_GUARD_VAMPIRE;

		if(g_eRaceInterface == RACE_OUSTERS)
		{
			buttonSpriteID = LVU_BUTTON_OUSTERS;
			guardSpriteID = LVU_GUARD_OUSTERS;
		}
		else if(g_eRaceInterface == RACE_SLAYER)
		{
			guardSpriteID = LVU_GUARD_SLAYER;
		}

		if (m_bl_pushed && m_bl_focused)
		{
			m_image_spk.BltLocked(x+10, y+10, buttonSpriteID);
		}
		else
		{
			m_image_spk.BltLocked(x+9, y+9, buttonSpriteID);
		}
		
		m_image_spk.BltLocked(x, y, guardSpriteID);
		gpC_base->m_p_DDSurface_back->Unlock();
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_LEVELUP::IsPixel
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_LEVELUP::IsPixel(int _x, int _y)
{
	return IsInRect(_x, _y);
}

//-----------------------------------------------------------------------------
// C_VS_UI_LEVELUP::Start
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_LEVELUP::Start()
{
	PI_Processor::Start();
	
	gpC_window_manager->AppearWindow(this);
	
	m_bl_pushed = false;
	m_bl_focused = false;
}

//-----------------------------------------------------------------------------
// C_VS_UI_LEVELUP::Finish
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_LEVELUP::Finish()
{
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_LEVELUP::MouseControl
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_LEVELUP::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	
	switch (message)
	{
	case M_MOVING:
		m_bl_focused = true;
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (m_bl_focused)
			m_bl_pushed = true;
		break;
		
	case M_LEFTBUTTON_UP:
		if (m_bl_pushed)
		{
			// run
			if(!gC_vs_ui.IsRunningCharInfo())
				gC_vs_ui.RunInfo(C_VS_UI_INFO::CHARACTER_INFO_MODE);
			
			if (g_eRaceInterface == RACE_SLAYER)
				gpC_base->SendMessage(UI_FINISH_LEVELUP_BUTTON);				
		}
		
		m_bl_pushed = false;
		break;
	}
	
	return true;
}

#if __CONTENTS(__PREMIUM_GIVE_ITEM_UI)
//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM
//-----------------------------------------------------------------------------
C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM()
{
	m_pC_Premium_Give_Item = NULL;

	g_RegisterWindow(this);
	
	AttrPin(true);
	
	int _y;
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		_y = g_pUserInformation->iResolution_y - 218;
		break;

	case RACE_VAMPIRE:
		_y = g_pUserInformation->iResolution_y - 175;
		break;

	case RACE_OUSTERS:
		_y = g_pUserInformation->iResolution_y - 218;
		break;
	}	
	
	m_image_spk.Open(SPK_LEVELUP);
		
	Set(2+m_image_spk.GetWidth(REQUEST_GUARD_SLAYER)+15, _y, m_image_spk.GetWidth(REQUEST_GUARD_SLAYER), m_image_spk.GetHeight(REQUEST_GUARD_SLAYER));
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::~C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM
//-----------------------------------------------------------------------------
C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::~C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM()
{
	g_UnregisterWindow(this);

	DeleteNew(m_pC_Premium_Give_Item);
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::Show
//-----------------------------------------------------------------------------
void	C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::Show()
{
	RECT rect = { x+9, y+9, x+9+36, y+9+36 };
	POINT eff_pt;
	gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);

	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		if (m_bl_pushed && m_bl_focused)
		{
			m_image_spk.BltLocked(x+10, y+10, GIVE_ITEM01);
		}
		else
		{
			m_image_spk.BltLocked(x+9, y+9, GIVE_ITEM01);
				
			int src_color = g_CurrentFrame%64;
			
			if(src_color > 32)
			{ src_color = 64-src_color; }

			m_image_spk.BltLockedAlpha(x+9, y+9, GIVE_ITEM02, src_color);
		}
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			eff_pt.x = 72;
			eff_pt.y = g_pUserInformation->iResolution_y - (768 - 618);
			
			m_image_spk.BltLocked(x, y, GIVE_ITEM_CASE01); //REQUEST_GUARD_SLAYER);
			break;

		case RACE_VAMPIRE:
			eff_pt.x = 75;
			eff_pt.y = g_pUserInformation->iResolution_y - (768 - 665);
			
			m_image_spk.BltLocked(x, y, GIVE_ITEM_CASE01); //REQUEST_GUARD_VAMPIRE);
			break;

		case RACE_OUSTERS:
			eff_pt.x = 76;
			eff_pt.y = g_pUserInformation->iResolution_y - (768 - 620);
			
			m_image_spk.BltLocked(x, y, GIVE_ITEM_CASE01); //REQUEST_GUARD_OUSTERS);
			break;
		}

		int src_alpha = g_CurrentFrame % 2;
		if(g_CurrentFrame % 10 >= 5) { src_alpha = 32; } else { src_alpha = 0; }

		if(m_pC_Premium_Give_Item==NULL)
		{
			DrawUIEffect(&eff_pt,(int)EFFECTSPRITETYPE_GRAND_MASTER_ALPHA_SLAYER_150,0,3,true);
			m_image_spk.BltLockedAlpha(x, y, GIVE_ITEM_CASE02, src_alpha);
		}

		CSpriteSurface::s_Value1 = 32;
		CSpriteSurface::s_Value2 = 0;

		gpC_base->m_p_DDSurface_back->Unlock();
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::Process
//-----------------------------------------------------------------------------
void	C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::Process()
{
	// m_pC_Premium_Give_Item UI 닫기
	if(m_pC_Premium_Give_Item!=NULL&&!m_pC_Premium_Give_Item->Is_ActiveDlg())
	{
		if(m_pC_Premium_Give_Item->Give_Item_List_Size()<=0)
		{
			gpC_base->SendMessage(UI_FINISH_PREMIUM_GIVEITEM_BUTTON);
		}

		DeleteNew(m_pC_Premium_Give_Item);
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::IsPixel
//-----------------------------------------------------------------------------
bool	C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::IsPixel(int _x, int _y)
{
	return IsInRect(_x, _y);
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::Start
//-----------------------------------------------------------------------------
void	C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::Start()
{
	PI_Processor::Start();
	
	gpC_window_manager->AppearWindow(this);
	
	m_bl_pushed = false;
	m_bl_focused = false;
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::Finish
//-----------------------------------------------------------------------------
void C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::Finish()
{
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::MouseControl
//-----------------------------------------------------------------------------
bool	C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	
	switch (message)
	{
	case M_MOVING:
		if(_x > x && _y > y && _x < x+m_image_spk.GetWidth(REQUEST_GUARD_SLAYER) && _y < y+m_image_spk.GetHeight(REQUEST_GUARD_SLAYER))
		{
			m_bl_focused = true;
			g_descriptor_manager.Set(DID_INFO, x, y, (*g_pGameStringTable)[UI_STRING_MESSAGE_REQUEST_PREMIUM_GIVE_ITEM].GetString(),0,0);
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (m_bl_focused)
			m_bl_pushed = true;
		break;
		
	case M_LEFTBUTTON_UP:
		if (m_bl_pushed)
		{
			RunPremiumGiveItemDialog();
		}

		m_bl_pushed = false;
		break;

	case M_RIGHTBUTTON_UP:
		break;
	}
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::RunPremiumGiveItemDialog
//-----------------------------------------------------------------------------
void	C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::RunPremiumGiveItemDialog()
{
	if(m_pC_Premium_Give_Item != NULL)
	{
		if(m_pC_Premium_Give_Item->Is_ActiveDlg())
		{
			return;
		}
		else
		{
			DeleteNew(m_pC_Premium_Give_Item);
		}
	}

	if(m_pC_Premium_Give_Item == NULL)
	{ m_pC_Premium_Give_Item = new C_VS_UI_PREMIUM_GIVE_ITEM(); }
	
	assert(m_pC_Premium_Give_Item != NULL);
	
	m_pC_Premium_Give_Item->Start();
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::ClosePremiumGiveItemDialog
//-----------------------------------------------------------------------------
bool	C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::ClosePremiumGiveItemDialog()
{
	if(m_pC_Premium_Give_Item != NULL)
	{
		if(m_pC_Premium_Give_Item->Is_ActiveDlg())
		{
			m_pC_Premium_Give_Item->CloseDialog();
			return true;
		}
	}
	return false;
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::Update_Item_List
//-----------------------------------------------------------------------------
void	C_VS_UI_REQUEST_PREMIUM_GIVE_ITEM::Update_Item_List()
{
	if(m_pC_Premium_Give_Item != NULL)
	{
		m_pC_Premium_Give_Item->Update_Item_List();
	}
}
#endif //__PREMIUM_GIVE_ITEM_UI

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PARTY::C_VS_UI_REQUEST_PARTY
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_REQUEST_PARTY::C_VS_UI_REQUEST_PARTY(const char *name, DWORD timer)
{
	g_RegisterWindow(this);
	
	AttrPin(true);
	
	int _y;
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		_y = g_pUserInformation->iResolution_y - 218; //382;
		break;

	case RACE_VAMPIRE:
		_y = g_pUserInformation->iResolution_y - 175; //425;
		break;

	case RACE_OUSTERS:
		_y = g_pUserInformation->iResolution_y - 218; //382;
		break;
	}	
	
	m_image_spk.Open(SPK_LEVELUP);

	Set(2, _y, m_image_spk.GetWidth(REQUEST_GUARD_SLAYER), m_image_spk.GetHeight(REQUEST_GUARD_SLAYER));
	
	m_name = name;

	if(g_pParty)
		m_type = (g_pParty->GetSize()>0)?REQUEST:INVITE;
	else
		m_type = REQUEST;
	
	//timer
	m_dw_timer_tickcount = timer;
	Timer(true);
	
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PARTY::~C_VS_UI_REQUEST_PARTY
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_REQUEST_PARTY::~C_VS_UI_REQUEST_PARTY()
{
	g_UnregisterWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PARTY::Show
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_REQUEST_PARTY::Show()
{
	if(!Timer())
		gpC_base->SendMessage(UI_FINISH_REQUEST_PARTY_BUTTON, TRUE);
	
	RECT rect = { x+9, y+9, x+9+36, y+9+36 };
	gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		if (m_bl_pushed && m_bl_focused)
		{
			m_image_spk.BltLocked(x+10, y+10, PARTY_REQUEST+m_type);
		}
		else
		{
			m_image_spk.BltLocked(x+9, y+9, PARTY_REQUEST+m_type);
		}
		
		switch(g_eRaceInterface) // request_guard
		{
		case RACE_SLAYER:
			m_image_spk.BltLocked(x, y, REQUEST_GUARD_SLAYER);
			break;

		case RACE_VAMPIRE:
			m_image_spk.BltLocked(x, y, REQUEST_GUARD_VAMPIRE);
			break;

		case RACE_OUSTERS:
			m_image_spk.BltLocked(x, y, REQUEST_GUARD_OUSTERS);
			break;
		}		
		
		gpC_base->m_p_DDSurface_back->Unlock();
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PARTY::IsPixel
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_REQUEST_PARTY::IsPixel(int _x, int _y)
{
	return IsInRect(_x, _y);
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PARTY::Start
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_REQUEST_PARTY::Start()
{
	PI_Processor::Start();
	
	gpC_window_manager->AppearWindow(this);
	
	m_bl_pushed = false;
	m_bl_focused = false;
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PARTY::Finish
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_REQUEST_PARTY::Finish()
{
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PARTY::MouseControl
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_REQUEST_PARTY::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	
	switch (message)
	{
	case M_MOVING:
		if(_x > x && _y > y && _x < x+m_image_spk.GetWidth(REQUEST_GUARD_SLAYER) && _y < y+m_image_spk.GetHeight(REQUEST_GUARD_SLAYER))
		{
			m_bl_focused = true;
			if(g_pParty->GetSize() > 0)
				g_descriptor_manager.Set(DID_INFO, x, y, (*g_pGameStringTable)[UI_STRING_MESSAGE_REQUEST_PARTY].GetString(),0,0);
			else
				g_descriptor_manager.Set(DID_INFO, x, y, (*g_pGameStringTable)[UI_STRING_MESSAGE_INVITE_PARTY].GetString(),0,0);
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (m_bl_focused)
			m_bl_pushed = true;
		break;
		
	case M_LEFTBUTTON_UP:
		if (m_bl_pushed)
		{
			// run
			//				gC_vs_ui.RunCharacterInfo();
			
			//				if (!gbl_vampire_interface)
			gC_vs_ui.RunPartyAsk(m_name.c_str(), m_type);

			gpC_base->SendMessage(UI_FINISH_REQUEST_PARTY_BUTTON, FALSE);

		}
		
		m_bl_pushed = false;
		break;
	}
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_PARTY::Timer
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_REQUEST_PARTY::Timer(bool reset)
{
	if(reset)
	{
		m_dw_prev_tickcount = GetTickCount();
	}
	else if(m_dw_prev_tickcount+m_dw_timer_tickcount >= GetTickCount())
	{
		return true;
	}
	
	return false;
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_DIE::C_VS_UI_REQUEST_DIE
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_REQUEST_DIE::C_VS_UI_REQUEST_DIE(DWORD timer, bool enforceResurrect, DWORD level_timer)
{
	g_RegisterWindow(this);
	
	AttrPin(true);

	m_bl_enforce_resurrect = enforceResurrect;
	
	int _y;
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		_y = g_pUserInformation->iResolution_y - 218; //382;
		break;

	case RACE_VAMPIRE:
		_y = g_pUserInformation->iResolution_y - 175; //425;
		break;

	case RACE_OUSTERS:
		_y = g_pUserInformation->iResolution_y - 218; //382;
		break;
	}	
	
	m_image_spk.Open(SPK_LEVELUP);

	Set(2, _y, m_image_spk.GetWidth(RESURRECT_GUARD_SLAYER), m_image_spk.GetHeight(RESURRECT_GUARD_SLAYER));
	
	//timer
	m_dw_timer_tickcount = timer;
	m_levelwar_timer_tickcount = level_timer;

	m_levelwar_timer_tickcount = 30000;

	Timer(true);
	levelWarTimer(true);

 
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_DIE::~C_VS_UI_REQUEST_DIE
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_REQUEST_DIE::~C_VS_UI_REQUEST_DIE()
{
	g_UnregisterWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_DIE::Show
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_REQUEST_DIE::Show()
{
	if(!Timer()) {
		gpC_base->SendMessage(UI_FINISH_REQUEST_DIE_BUTTON, TRUE);
		return;
	}

	// 강제 부활이면 무의미하다.
	if(m_bl_enforce_resurrect) return;
	
	RECT rect = { x+9, y+9, x+9+36, y+9+36 };
	gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
	
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		if (m_bl_pushed && m_bl_focused)
		{
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				m_image_spk.BltLocked(x+10, y+10, RESURRECT_SLAYER);
				break;

			case RACE_VAMPIRE:
				m_image_spk.BltLocked(x+10, y+10, RESURRECT_VAMPIRE);
				break;

			case RACE_OUSTERS:
				{
					m_image_spk.BltLocked(x+10, y+10, RESURRECT_OUSTERS);
#if __CONTENTS(__LEVEL_WAR_RENEWAL)
//					if(levelWarTimer(false))
//					{
//						char ptempstr[128];
//						DWORD countTime = m_levelwar_timer_tickcount - (GetTickCount() - m_levelwar_prev_tickcount);
//						
//						sprintf(ptempstr,"%d", countTime/1000);
//						gpC_base->m_p_DDSurface_back->Unlock();
//						g_PrintColorStr(x+30, y+15,ptempstr, gpC_base->m_char_name_pi, RGB(255,255,255));
//						gpC_base->m_p_DDSurface_back->Lock();
//					}
#endif //__LEVEL_WAR_RENEWAL
				}
				break;
			}			
		}
		else
		{
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				m_image_spk.BltLocked(x+9, y+9, RESURRECT_SLAYER);
				break;

			case RACE_VAMPIRE:
				m_image_spk.BltLocked(x+9, y+9, RESURRECT_VAMPIRE);
				break;

			case RACE_OUSTERS:
				{
					m_image_spk.BltLocked(x+9, y+9, RESURRECT_OUSTERS);
#if __CONTENTS(__LEVEL_WAR_RENEWAL)
//					if(levelWarTimer(false))
//					{
//						char ptempstr[128];
//						DWORD countTime = m_levelwar_timer_tickcount - (GetTickCount() - m_levelwar_prev_tickcount);
//						
//						gpC_base->m_p_DDSurface_back->Unlock();
//						sprintf(ptempstr,"%d", countTime/1000);
//						g_PrintColorStr(x+30, y+20,ptempstr, gpC_base->m_char_name_pi, RGB(255,255,255));
//						gpC_base->m_p_DDSurface_back->Lock();
//						
//					}
#endif //__LEVEL_WAR_RENEWAL
				}
				break;
			}
		}
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			m_image_spk.BltLocked(x, y, RESURRECT_GUARD_SLAYER);
			break;

		case RACE_VAMPIRE:
			m_image_spk.BltLocked(x, y, RESURRECT_GUARD_VAMPIRE);
			break;

		case RACE_OUSTERS:
			m_image_spk.BltLocked(x, y, RESURRECT_GUARD_OUSTERS);
			break;		
		}		
		gpC_base->m_p_DDSurface_back->Unlock();
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_DIE::IsPixel
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_REQUEST_DIE::IsPixel(int _x, int _y)
{
	return IsInRect(_x, _y);
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_DIE::Start
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_REQUEST_DIE::Start()
{
	PI_Processor::Start();
	
	gpC_window_manager->AppearWindow(this);
	
	m_bl_pushed = false;
	m_bl_focused = false;

	EMPTY_MOVE;
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_DIE::Finish
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_REQUEST_DIE::Finish()
{
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_DIE::MouseControl
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_REQUEST_DIE::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);

	// 강제 부활이면 무의미하다.
	if(m_bl_enforce_resurrect) return true;
	
	switch (message)
	{
	case M_MOVING:
		if(_x > x && _y > y && _x < x+m_image_spk.GetWidth(RESURRECT_GUARD_SLAYER) && _y < y+m_image_spk.GetHeight(RESURRECT_GUARD_SLAYER))
		{
			m_bl_focused = true;
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				g_descriptor_manager.Set(DID_INFO, x, y, (*g_pGameStringTable)[UI_STRING_MESSAGE_EVACUATION].GetString(),0,0);
				break;

			case RACE_VAMPIRE:
				g_descriptor_manager.Set(DID_INFO, x, y, (*g_pGameStringTable)[UI_STRING_MESSAGE_RESURRECTION].GetString(),0,0);
				break;

			case RACE_OUSTERS:
				g_descriptor_manager.Set(DID_INFO, x, y, (*g_pGameStringTable)[UI_STRING_MESSAGE_RESURRECTION].GetString(),0,0);
				break;
			}
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (m_bl_focused)
			m_bl_pushed = true;
		break;
		
	case M_LEFTBUTTON_UP:
		if (m_bl_pushed)
		{
			gpC_base->SendMessage(UI_FINISH_REQUEST_DIE_BUTTON, FALSE);
		}
		m_bl_pushed = false;
		break;
	}
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_REQUEST_DIE::Timer
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_REQUEST_DIE::Timer(bool reset)
{
	if(reset)
	{
		m_dw_prev_tickcount = GetTickCount();
	}
	else if(m_dw_prev_tickcount+m_dw_timer_tickcount >= GetTickCount())
	{
		return true;
	}
	
	return false;
}

bool	C_VS_UI_REQUEST_DIE::levelWarTimer(bool reset)
{
#if __CONTENTS(__LEVEL_WAR_RENEWAL)
	if(reset)
	{
		m_levelwar_prev_tickcount = GetTickCount();
	}
	else if(m_levelwar_prev_tickcount + m_levelwar_timer_tickcount > GetTickCount())
	{
		return true;
	}
#endif //__LEVEL_WAR_RENEWAL
	return false;
}


//-----------------------------------------------------------------------------
// C_VS_UI_PARTY_MANAGER::C_VS_UI_PARTY_MANAGER
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_PARTY_MANAGER::C_VS_UI_PARTY_MANAGER()
{
	g_RegisterWindow(this);
	AttrPin(true);

#if __CONTENTS(!__080405_FIREST_UI_UPDATE)
	m_pC_button_group = new ButtonGroup(this);
#endif //__080405_FIREST_UI_UPDATE

	m_pC_bottom_button_group = new ButtonGroup(this);
	
#if __CONTENTS(__080405_FIREST_UI_UPDATE)
	int deny_button_x, alpha_button_x, help_button_x, close_button_x;
	int button_x = 8, button_y = 6;

	deny_button_x = button_x;
	alpha_button_x = deny_button_x+26;
	help_button_x = alpha_button_x+26;
	close_button_x = help_button_x+26;

	int away_x = 82, away_y = 4;
#else
	int deny_button_x = 12, help_button_x = 48, close_button_x = 82, button_y = 4;
	
	int away_x = 77, away_y = 100, away_gap = 79;
#endif //__080405_FIREST_UI_UPDATE

	m_p_image_spk = new C_SPRITE_PACK;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_p_image_spk->Open(SPK_SLAYER_PARTY);
		break;

	case RACE_VAMPIRE:
		m_p_image_spk->Open(SPK_VAMPIRE_PARTY);
		break;

	case RACE_OUSTERS:
		m_p_image_spk->Open(SPK_OUSTERS_PARTY);
	#if __CONTENTS(!__080405_FIREST_UI_UPDATE)
		button_y+=3;
	#endif //__080405_FIREST_UI_UPDATE
		break;
	}	

	m_p_face_spk = NULL;
	m_p_large_face_spk = NULL;
	
	//Set(RESOLUTION_X-m_p_image_spk->GetWidth(PARTY_WINDOW), 130, m_p_image_spk->GetWidth(PARTY_WINDOW), m_p_image_spk->GetHeight(PARTY_WINDOW));
	Set(g_pUserInformation->iResolution_x-m_p_image_spk->GetWidth(PARTY_WINDOW), 130, m_p_image_spk->GetWidth(PARTY_WINDOW), m_p_image_spk->GetHeight(PARTY_WINDOW));

#if __CONTENTS(!__080405_FIREST_UI_UPDATE)
	m_pC_bottom_button_group->Add(new C_VS_UI_EVENT_BUTTON(deny_button_x, button_y, m_p_image_spk->GetWidth(DENY_BUTTON), m_p_image_spk->GetHeight(DENY_BUTTON), DENY_ID, this, DENY_BUTTON));
	m_pC_bottom_button_group->Add(new C_VS_UI_EVENT_BUTTON(help_button_x, button_y, m_p_image_spk->GetWidth(HELP_BUTTON), m_p_image_spk->GetHeight(HELP_BUTTON), HELP_ID, this, HELP_BUTTON));
	m_pC_bottom_button_group->Add(new C_VS_UI_EVENT_BUTTON(close_button_x, button_y, m_p_image_spk->GetWidth(CLOSE_BUTTON), m_p_image_spk->GetHeight(CLOSE_BUTTON), CLOSE_ID, this, CLOSE_BUTTON));
	
	int alpha_button_offset_x, alpha_button_offset_y;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:		
		alpha_button_offset_x = 98; alpha_button_offset_y = 2;
		break;

	case RACE_VAMPIRE:
		alpha_button_offset_x = 98; alpha_button_offset_y = 2;
		break;
		
	case RACE_OUSTERS:
		alpha_button_offset_x = 98; alpha_button_offset_y = 3;
		break;
	}
	
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_button_offset_x, alpha_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA));
#else
	m_pC_bottom_button_group->Add(new C_VS_UI_EVENT_BUTTON(deny_button_x, button_y, m_p_image_spk->GetWidth(DENY_BUTTON), m_p_image_spk->GetHeight(DENY_BUTTON), DENY_ID, this, DENY_BUTTON));
	m_pC_bottom_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_button_x, button_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW));
	m_pC_bottom_button_group->Add(new C_VS_UI_EVENT_BUTTON(help_button_x, button_y, m_p_image_spk->GetWidth(HELP_BUTTON), m_p_image_spk->GetHeight(HELP_BUTTON), HELP_ID, this, HELP_BUTTON));
	m_pC_bottom_button_group->Add(new C_VS_UI_EVENT_BUTTON(close_button_x, button_y, m_p_image_spk->GetWidth(CLOSE_BUTTON), m_p_image_spk->GetHeight(CLOSE_BUTTON), CLOSE_ID, this, CLOSE_BUTTON));	
#endif //__080405_FIREST_UI_UPDATE
	
	m_bl_show_face_large = false;
	m_away_pushed = false;
	m_away_button_focused = false;
	m_away_focused = -1;
	m_old_away_focused = -1;
	m_dw_show_face_large_time = 3000;
	
#ifndef _LIB
	if(g_pParty != NULL)
		delete g_pParty;
	
	g_pParty = new MParty;
	PARTY_INFO *temp_party;
	
	temp_party = new PARTY_INFO;
	temp_party->bMale = false;
	temp_party->hairStyle = M_HAIR1;
	temp_party->HP = 0;
	temp_party->Name = "TestName";
	temp_party->zoneID = 2024;
	temp_party->zoneX = 150;
	temp_party->zoneY = 150;
	temp_party->guildID = 101;
	g_pParty->AddMember(temp_party);
#endif	
}

//-----------------------------------------------------------------------------
// C_VS_UI_PARTY_MANAGER::~C_VS_UI_PARTY_MANAGER
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_PARTY_MANAGER::~C_VS_UI_PARTY_MANAGER()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::PARTY, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::PARTY, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::PARTY, Rect(x, y, w, h));
	
	g_UnregisterWindow(this);
	
#if __CONTENTS(!__080405_FIREST_UI_UPDATE)
	DeleteNew(m_pC_button_group);
#endif //__080405_FIREST_UI_UPDATE
	
	DeleteNew(m_pC_bottom_button_group);
	DeleteNew(m_p_image_spk);
	DeleteNew(m_p_face_spk);
	DeleteNew(m_p_large_face_spk);
	
	for(int i = 0; i < m_vp_face.size(); i++)
	{
		if(m_vp_face[i] != NULL)
			DeleteNew(m_vp_face[i]);
	}

	m_vp_face.clear();
	m_v_face_name.clear();
	
}

//-----------------------------------------------------------------------------
// C_VS_UI_PARTY_MANAGER::Timer
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_PARTY_MANAGER::Timer(bool reset)
{
	static DWORD prev_time = GetTickCount();

	if(reset)
	{
		prev_time = GetTickCount();
	}
	else
	{
		if(prev_time + m_dw_show_face_large_time < GetTickCount())
			return true;
	}
	return false;
	
}

//-----------------------------------------------------------------------------
// Process
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_PARTY_MANAGER::Process()
{
#if __CONTENTS(!__080405_FIREST_UI_UPDATE)
	m_pC_button_group->Process();
#endif //__080405_FIREST_UI_UPDATE
}


void	C_VS_UI_PARTY_MANAGER::RefreshFaceImage()
{
	for(int i = 0; i < m_vp_face.size(); i++)
	{
		if(m_vp_face[i] != NULL)
			DeleteNew(m_vp_face[i]);
	}
	m_vp_face.clear();
	m_v_face_name.clear();
}

//-----------------------------------------------------------------------------
// C_VS_UI_PARTY_MANAGER::Show
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_PARTY_MANAGER::Show()
{
	Rect window_rect;
	// Ousters 픽셀크기 높이가 3차이가 나서 window_default_height 에 모두 inc_y를 더함
	int inc_y = 0;
	if( g_eRaceInterface == RACE_OUSTERS )
		inc_y = 3;
	h = window_default_height + inc_y + window_gap*(g_pParty->GetSize()+1);
	
	SetRect((RECT *)&window_rect, 0, 0, m_p_image_spk->GetWidth(), h+window_bottom_gap);
	h += m_p_image_spk->GetHeight(PARTY_WINDOW_BOTTOM);
	
	int name_x = 75, name_y = window_default_height + inc_y + 27;
	
	COLORREF name_color;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
	case RACE_VAMPIRE:
	case RACE_OUSTERS:
		name_color = RGB(255, 255, 255);
		break;		
	}
	
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		if(GetAttributes()->alpha)
		{
			RECT alpha_rect = {x+4, y+8, x+111, y+window_rect.h};
			
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
				break;

			case RACE_VAMPIRE:
				DrawAlphaBox(&alpha_rect, 0, 0, 2, g_pUserOption->ALPHA_DEPTH);
				break;

			case RACE_OUSTERS:
				DrawAlphaBox(&alpha_rect, 0, 2, 0, g_pUserOption->ALPHA_DEPTH);
				break;				
			}			
			
			m_p_image_spk->BltLockedClip(x, y, window_rect, PARTY_WINDOW_ALPHA);
		}
		else
		{
			m_p_image_spk->BltLockedClip(x, y, window_rect, PARTY_WINDOW);
		}
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
		case RACE_VAMPIRE:
			m_p_image_spk->BltLocked(x, y+window_rect.h - window_bottom_gap, PARTY_WINDOW_BOTTOM);		
			break;
			
		case RACE_OUSTERS:
			m_p_image_spk->BltLocked(x+1, y+window_rect.h - window_bottom_gap, PARTY_WINDOW_BOTTOM);
			break;
		}
		
		POINT point;
		std::string name;
		bool bl_female;
		int spriteID = 0;
		
		
		for(int i = 0; i < 1+g_pParty->GetSize(); i++)
		{
			CSprite *p_guild_mark = NULL;
			
			if(i == 0)
			{
				name = g_char_slot_ingame.sz_name;
				bl_female = g_char_slot_ingame.bl_female;

				switch(g_eRaceInterface) // party face image
				{
				case RACE_SLAYER:
					if (bl_female)
						spriteID = g_char_slot_ingame.man_info.face-M_FACE1+3;
					else
						spriteID = g_char_slot_ingame.man_info.face-M_FACE1;
					break;

				case RACE_VAMPIRE:
					if (bl_female)
						spriteID = 6+1;
					else
						spriteID = 6+0;
					break;

				case RACE_OUSTERS:
					spriteID = 8;
					break;
				}
				
				//길드 마크 로딩
				// 작은거
				p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(g_char_slot_ingame.GUILD_ID);
				
				if (p_guild_mark==NULL)
				{		
					//-------------------------------------------------
					// file에 있는지 본다.
					//-------------------------------------------------
					g_pGuildMarkManager->LoadGuildMark(g_char_slot_ingame.GUILD_ID);
					
					//-------------------------------------------------
					// file에서 load되었는지 다시 체크
					//-------------------------------------------------
					p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(g_char_slot_ingame.GUILD_ID);
				}
			}
			else if(g_pParty->GetMemberInfo(i-1) != NULL)
			{
				name = g_pParty->GetMemberInfo(i-1)->Name;
				bl_female = !g_pParty->GetMemberInfo(i-1)->bMale;

				switch(g_eRaceInterface) // party face image
				{
				case RACE_SLAYER:
					if (bl_female)
						spriteID = g_pParty->GetMemberInfo(i-1)->hairStyle-M_FACE1+3; 
					else
						spriteID = g_pParty->GetMemberInfo(i-1)->hairStyle-M_FACE1;
					break;

				case RACE_VAMPIRE:
					if (bl_female)
						spriteID = 6+1;
					else
						spriteID = 6+0;
					break;

				case RACE_OUSTERS:
					break;					
				}
				
				//길드 마크 로딩
				// 작은거
				p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(g_pParty->GetMemberInfo(i-1)->guildID);
				
				if (p_guild_mark==NULL)
				{		
					//-------------------------------------------------
					// file에 있는지 본다.
					//-------------------------------------------------
					g_pGuildMarkManager->LoadGuildMark(g_pParty->GetMemberInfo(i-1)->guildID);
					
					//-------------------------------------------------
					// file에서 load되었는지 다시 체크
					//-------------------------------------------------
					p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(g_pParty->GetMemberInfo(i-1)->guildID);
				}
			}
			
			
			for(int find = 0; find < m_v_face_name.size(); find++)
			{
				if(strcmp(m_v_face_name[find].c_str(), name.c_str()) == 0)break;
			}
			
			if(find == m_v_face_name.size())	// 이름 자체가 등록이 안되있으면 search&load
			{
				C_SPRITE_PACK *temp_spk = NULL;
				if(g_pProfileManager->HasProfile(name.c_str()))
				{
					const char *filename = g_pProfileManager->GetFilename(name.c_str());
					temp_spk = new C_SPRITE_PACK(filename);
					
					m_vp_face.push_back(temp_spk);
					m_v_face_name.push_back(name);
				}
				
				if(g_pProfileManager->HasProfileNULL(name.c_str()))
				{
					if(temp_spk)
					{
						DeleteNew(temp_spk);
						temp_spk = NULL;
					}
					m_vp_face.push_back(temp_spk);
					m_v_face_name.push_back(name);
				}
			}
			
			point.x = x + 9;
			point.y = y + window_default_height + inc_y + i*window_gap +1;
			
			m_p_image_spk->BltLocked(point.x -1, point.y -1, FACE_GRID);
			m_p_image_spk->BltLocked(point.x +33, point.y +24, NAME_GRID);
			if(i == 0)
			{
				Rect rect;
				rect.Set(0, 0, (m_p_image_spk->GetWidth(HPBAR))*g_char_slot_ingame.HP/g_char_slot_ingame.HP_MAX, m_p_image_spk->GetHeight(HPBAR));
				m_p_image_spk->BltLockedClip(point.x +34, point.y +25, rect, HPBAR);
			}
			else
			{
				PARTY_INFO *info = g_pParty->GetMemberInfo(i-1);
				if(info)
				{
					Rect rect;
					rect.Set(0, 0, (m_p_image_spk->GetWidth(HPBAR))*info->HP/info->MaxHP, m_p_image_spk->GetHeight(HPBAR));
					m_p_image_spk->BltLockedClip(point.x +34, point.y +25, rect, HPBAR);
				}
			}
			
			if(g_pParty->GetSize() > 0 && (i == 0 || i != 0 && g_pParty->IsKickAvailableTime()))
			{
			#if __CONTENTS(__080405_FIREST_UI_UPDATE)
				if(m_away_focused == i && m_away_button_focused)
				{
					if(m_away_pushed)
						m_p_image_spk->BltLocked(x+away_x, y +away_y +window_default_height + inc_y + i*window_gap, AWAY_BUTTON_HILIGHTED_PUSHED);
					else
						m_p_image_spk->BltLocked(x+away_x, y +away_y +window_default_height + inc_y + i*window_gap, AWAY_BUTTON_HILIGHTED);
				}
				else
					m_p_image_spk->BltLocked(x+away_x, y +away_y +window_default_height + inc_y + i*window_gap, AWAY_BUTTON);
			#else
				if(m_away_focused == i && m_away_button_focused)
				{
					if(m_away_pushed)
						m_p_image_spk->BltLocked(x +away_x, y +away_y +window_default_height + inc_y + i*window_gap, AWAY_BUTTON_HILIGHTED_PUSHED);
					else
						m_p_image_spk->BltLocked(x +away_x, y +away_y +window_default_height + inc_y + i*window_gap, AWAY_BUTTON_HILIGHTED);
				}
				else
					m_p_image_spk->BltLocked(x +away_x, y +away_y +window_default_height + inc_y + i*window_gap, AWAY_BUTTON);
			#endif //__080405_FIREST_UI_UPDATE

			}
			

			bool	bUseDieFace			= false;
			bool	bUseOmissionFace	= false;


			if(i == 0)
			{
				bUseDieFace = (g_char_slot_ingame.HP == 0);
			}
			else
			{
				PARTY_INFO *pPartyInfo = g_pParty->GetMemberInfo(i-1);

				if(pPartyInfo)
					bUseDieFace = (pPartyInfo->HP == 0);
				else
				{
					switch(g_eRaceInterface)	
					{
					case RACE_SLAYER:	spriteID = i % 6;		break;
					case RACE_VAMPIRE:	spriteID = 6 + i % 2;	break;
					case RACE_OUSTERS:	spriteID = 8;			break;
					}
					
					bUseOmissionFace = true;
				}
			}

			
			if(m_v_face_name.empty() || find == m_v_face_name.size() ||
			   (find < m_v_face_name.size() && m_vp_face[find] == NULL))
			{	
				// default face
				if(spriteID < 0 || spriteID >= m_p_face_spk->GetSize()) spriteID = 0;
				
				if(bUseOmissionFace)
					m_p_face_spk->BltLockedDarkness(point.x, point.y, spriteID, 2);
				else if(bUseDieFace)
					m_p_face_spk->BltLockedColor(point.x, point.y, spriteID, rgb_RED);
				else
					m_p_face_spk->BltLocked(point.x, point.y, spriteID);
			}
			else
			{
				//user face

				if(bUseOmissionFace)
					m_vp_face[find]->BltLockedDarkness(point.x, point.y, 0, 2);
				else if(bUseDieFace)
					m_vp_face[find]->BltLockedColor(point.x, point.y, 0, rgb_RED);
				else
					m_vp_face[find]->BltLocked(point.x, point.y, 0);
			}

			
			//길드 마크 찍기
			if (p_guild_mark!=NULL)
			{			
				POINT guild_point = { point.x+33, point.y+2 };
				gpC_base->m_p_DDSurface_back->BltSprite(&guild_point, p_guild_mark);
			}
			
			if(Timer() && i == m_away_focused)
			{
				if(m_v_face_name.empty() || find == m_v_face_name.size() || (find < m_v_face_name.size() && m_vp_face[find] == NULL))
				{	// default face
					if(spriteID < 0 || spriteID >= m_p_face_spk->GetSize())spriteID = 0;
					
					m_p_large_face_spk->BltLocked(point.x-65, point.y, spriteID);
					
				}
				else
				{
					//user face
					m_vp_face[find]->BltLocked(point.x-65, point.y, 1);
				}
				
			}
		}
		
#if __CONTENTS(!__080405_FIREST_UI_UPDATE)
		m_pC_button_group->Show();
#endif //__080405_FIREST_UI_UPDATE

		m_pC_bottom_button_group->Show();
		
		gpC_base->m_p_DDSurface_back->Unlock();
		if(Timer() && m_away_focused != -1)
		{
			RECT rect;
			point.x = x + 9-65;
			point.y = y + window_default_height + inc_y + m_away_focused*window_gap +1;
			SetRect(&rect, point.x-2, point.y-2, point.x+55+1, point.y+70+1);
			gpC_base->m_p_DDSurface_back->DrawRect(&rect, 0);
			gpC_base->m_p_DDSurface_back->HLine(point.x-1, point.y-1, 57, GRAY);
			gpC_base->m_p_DDSurface_back->VLine(point.x-1, point.y-1, 72, GRAY);
			gpC_base->m_p_DDSurface_back->HLine(point.x-1, point.y+70, 57, DARKGRAY);
			gpC_base->m_p_DDSurface_back->VLine(point.x+55, point.y-1, 72, DARKGRAY);
			//			gpC_base->m_p_DDSurface_back->HLine(point.x-1, point.y+139, 1, GRAY);
			//			gpC_base->m_p_DDSurface_back->VLine(point.x+110, point.y-1, 1, GRAY);
		}
	}
	
	g_FL2_GetDC();
	g_PrintColorStr(x+name_x-g_GetStringWidth(g_char_slot_ingame.sz_name.c_str(), gpC_base->m_party_name_pi.hfont)/2, y+name_y, g_char_slot_ingame.sz_name.c_str(), gpC_base->m_party_name_pi, name_color);
	
	for(int i = 0; i < g_pParty->GetSize(); i++)
	{
		if(g_pParty->GetMemberInfo(i) != NULL)
			g_PrintColorStr(x+name_x-g_GetStringWidth(g_pParty->GetMemberInfo(i)->Name.GetString(), gpC_base->m_party_name_pi.hfont)/2, y+name_y+window_gap*(i+1), g_pParty->GetMemberInfo(i)->Name.GetString(), gpC_base->m_party_name_pi, name_color);
	}
#if __CONTENTS(!__080405_FIREST_UI_UPDATE)
	m_pC_button_group->ShowDescription();
#endif //__080405_FIREST_UI_UPDATE
	
	m_pC_bottom_button_group->ShowDescription();
	g_FL2_ReleaseDC();
}

//-----------------------------------------------------------------------------
// C_VS_UI_PARTY_MANAGER::IsPixel
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_PARTY_MANAGER::IsPixel(int _x, int _y)
{
	if(m_p_image_spk == NULL)return false;
	int size;
	if(g_pParty == NULL)
		size = window_gap;
	else
		size = (g_pParty->GetSize() +1)*window_gap;
	
	bool re = (_x >= x && _x < x +m_p_image_spk->GetWidth() && _y >= y && _y < y + window_default_height + size + m_p_image_spk->GetHeight(PARTY_WINDOW_BOTTOM));
	if(re == false)
		m_away_focused = -1;
	
	return re;
}

//-----------------------------------------------------------------------------
// C_VS_UI_PARTY_MANAGER::Start
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_PARTY_MANAGER::Start()
{
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::PARTY));
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::PARTY);
	if(rect.w != -1)
	{
		x = rect.x;
		y = rect.y;
	}
	
	PI_Processor::Start();
	
	gpC_window_manager->AppearWindow(this);
	
	for(int i = 0; i < m_vp_face.size(); i++)
	{
		if(m_vp_face[i] != NULL)
			DeleteNew(m_vp_face[i]);
	}
	m_vp_face.clear();
	m_v_face_name.clear();
	
	DeleteNew(m_p_image_spk);
	m_p_image_spk = new C_SPRITE_PACK;
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_p_image_spk->Open(SPK_SLAYER_PARTY);
		break;

	case RACE_VAMPIRE:
		m_p_image_spk->Open(SPK_VAMPIRE_PARTY);
		break;

	case RACE_OUSTERS:
		m_p_image_spk->Open(SPK_OUSTERS_PARTY);
		break;
	}	
	
	DeleteNew(m_p_face_spk);
	DeleteNew(m_p_large_face_spk);
	m_p_face_spk = new C_SPRITE_PACK(SPK_PARTY_FACE);
	m_p_large_face_spk = new C_SPRITE_PACK(SPK_FACE);	
	
	//	if(temp_surface.InitFromBMP(profile_filename.c_str()) == true)
	//	{
	//		CDirectDrawSurface *p_temp_surface = new CDirectDrawSurface;
	//		p_temp_surface->InitOffsurface(73, 89);
	//		RECT dest_rect = {0, 0, p_temp_surface->GetWidth(), p_temp_surface->GetHeight()};
	//		RECT src_rect = {0, 0, temp_surface.GetWidth(), temp_surface.GetHeight()};
	//		p_temp_surface->Blt(&dest_rect, &temp_surface, &src_rect);
	//		m_vp_face_surface.push_back(p_temp_surface);
	//		m_v_face_name.push_back(g_char_slot_ingame.sz_name);
	//	}
	
	//	temp_surface.ReleaseSurface();
	//	CSpritePack temp_spk;
	//
	//	if(gbl_vampire_interface)
	//	{
	//		temp_spk.Init(2, CDirectDraw::Is565());
	//		for(int k = 0; k < 2; k++)
	//		{
	//			temp_spk.LoadFromFileData(k, 6+k, SPK_FACE, SPKI_FACE);
	//		}
	//	}
	//	else
	//	{
	//		temp_spk.Init(6, CDirectDraw::Is565());
	//		for(int k = 0; k < 6; k++)
	//		{
	//			temp_spk.LoadFromFileData(k, k, SPK_FACE, SPKI_FACE);
	//		}
	//	}
	
	EMPTY_MOVE;
}

//-----------------------------------------------------------------------------
// C_VS_UI_PARTY_MANAGER::Finish
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_PARTY_MANAGER::Finish()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::PARTY, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::PARTY, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::PARTY, Rect(x, y, w, h));
	
	DeleteNew(m_p_image_spk);
	DeleteNew(m_p_face_spk);
	DeleteNew(m_p_large_face_spk);

	for(int i = 0; i < m_vp_face.size(); i++)
	{
		if(m_vp_face[i] != NULL)
			DeleteNew(m_vp_face[i]);
	}
	m_vp_face.clear();
	m_v_face_name.clear();
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_PARTY_MANAGER::MouseControl
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_PARTY_MANAGER::MouseControl(UINT message, int _x, int _y)
{
	const static char*	m_buttoninfo_string[2] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EXPEL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SECEDE].GetString(),
	};
	
	Window::MouseControl(message, _x, _y);
	
	_x-=x;_y-=y;//창이동 가능하게 하기 위한
	
	bool re = true;
	
	if(g_pParty)
		re = m_pC_bottom_button_group->MouseControl(message, _x, _y-(window_default_height + window_gap*(g_pParty->GetSize()+1)));
#if __CONTENTS(!__080405_FIREST_UI_UPDATE)
	re &= m_pC_button_group->MouseControl(message, _x, _y);
#endif //__080405_FIREST_UI_UPDATE
	
	if(g_pParty != NULL)// && g_pParty->GetSize() > 0)
		switch (message)
	{
		case M_MOVING:
			m_away_focused = (_y-window_default_height)/window_gap;
			if(m_away_focused > g_pParty->GetSize() || m_away_focused < 0)
				m_away_focused = -1;
			
			if(m_away_focused != m_old_away_focused)
				Timer(true);
			if(!m_away_pushed)
				m_old_away_focused = m_away_focused;
			if(m_away_focused != -1 && 
				m_p_image_spk && _x >= away_x && 
				_x <= away_x + m_p_image_spk->GetWidth(AWAY_BUTTON) && 
				(_y-window_default_height)%window_gap >= away_y && 
				(_y-window_default_height)%window_gap <= away_y +m_p_image_spk->GetHeight(AWAY_BUTTON))
				m_away_button_focused = true;
			else
				m_away_button_focused = false;
			
			// 캐릭터 얼굴 디스크립션 (zoneid, x, y)
			if(m_p_face_spk && _x >= 9 && _x <= 9 +m_p_face_spk->GetWidth() && (_y-window_default_height)%window_gap >= 1 && (_y-window_default_height)%window_gap <= 1 +m_p_face_spk->GetHeight())
			{
				if(m_away_focused > 0 && m_away_focused < g_pParty->GetSize()+1)
				{
					PARTY_INFO *info = g_pParty->GetMemberInfo(m_away_focused-1);
					if(info != NULL)
					{
						static char zonename[20];
						static char zonexy[10];
						static S_DEFAULT_HELP_STRING party_string;
						wsprintf(zonename, "%s", g_pZoneTable->Get(info->zoneID)->Name.GetString());
						wsprintf(zonexy, (*g_pGameStringTable)[UI_STRING_MESSAGE_ZONEINFO_XY].GetString(), info->zoneX, info->zoneY);
						party_string.sz_main_str = zonename;
						party_string.sz_sub_str = zonexy;
						g_descriptor_manager.Set(DID_HELP, x+9, y+1+window_gap*m_away_focused+window_default_height, (void *)&party_string,0,0);
					}
				}
			}
			// 탈퇴 추방 디스크립션
			else if(m_p_image_spk && _x >= away_x && _x <= away_x + m_p_image_spk->GetWidth(AWAY_BUTTON) && (_y-window_default_height)%window_gap >= away_y && (_y-window_default_height)%window_gap <= away_y +m_p_image_spk->GetHeight(AWAY_BUTTON))
			{
				if(!g_pParty->IsKickAvailableTime() && m_away_focused != 0 || g_pParty->GetSize() == 0)
					m_away_focused = -1;
				//				if(m_away_focused != -1 && m_away_focused == m_old_away_focused)m_away_pushed = true;
				if(m_away_focused != -1)
				{
					g_descriptor_manager.Set(DID_INFO, x+away_x, y+away_y+window_gap*m_away_focused+window_default_height, (void *)m_buttoninfo_string[(m_away_focused==0)?0:1],0,0);
				}
			}
			// 길드 마크 디스크립션
			else if(_x >= 42 && _x <= 42+20 && (_y-window_default_height)%window_gap >= 2 && (_y-window_default_height)%window_gap <= 2+20)
			{
				if(m_away_focused > 0 && m_away_focused < g_pParty->GetSize()+1)
				{
					PARTY_INFO *info = g_pParty->GetMemberInfo(m_away_focused-1);
					if(info != NULL)
					{
						if( g_pGuildInfoMapper->IsExistGuildName( info->guildID ) )
						{
							const char *guild_name = g_pGuildInfoMapper->GetGuildName( info->guildID );
							if(guild_name != NULL)
								g_descriptor_manager.Set(DID_INFO, x+33, y+2+window_gap*m_away_focused+window_default_height, (void *)guild_name,0,0);
//							GUILD_INFO *p_guild_info = g_pGuildInfoMapper->Get(info->guildID);
//							if(p_guild_info != NULL)
//							{
//								const char *guild_name = p_guild_info->GetGuildName();
//								if(guild_name != NULL)
//									g_descriptor_manager.Set(DID_INFO, x+33, y+2+window_gap*m_away_focused+window_default_height, (void *)guild_name,0,0);
//								guild_name = NULL;
//							}
//							p_guild_info = NULL;
						}
					}
				}
			}
			else
			{
				//				m_away_focused = -1;
				m_away_pushed = false;
			}
			break;
			
		case M_LEFTBUTTON_DOWN:
		case M_LB_DOUBLECLICK:
			if(m_away_focused != -1 && m_p_image_spk && _x >= away_x && _x <= away_x + m_p_image_spk->GetWidth(AWAY_BUTTON) && (_y-window_default_height)%window_gap >= away_y && (_y-window_default_height)%window_gap <= away_y +m_p_image_spk->GetHeight(AWAY_BUTTON))
			{
				m_old_away_focused = m_away_focused;
				m_away_pushed = true;
			}
			else
			if (gpC_mouse_pointer->GetPickUpItem() == false && re)
			{
				MoveReady();
				SetOrigin(_x, _y);
				break;
			}
			break;
			
		case M_LEFTBUTTON_UP:
			if(m_away_focused != -1 && m_away_pushed == true && m_p_image_spk && _x >= away_x && _x <= away_x + m_p_image_spk->GetWidth(AWAY_BUTTON) && (_y-window_default_height)%window_gap >= away_y && (_y-window_default_height)%window_gap <= away_y +m_p_image_spk->GetHeight(AWAY_BUTTON))
				Run(AWAY_I+m_away_focused);
			m_old_away_focused = -1;
			m_away_pushed = false;
			break;
	}
	
	if(message == M_RIGHTBUTTON_DOWN || message == M_RIGHTBUTTON_UP)
		return false;
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_PARTY_MANAGER::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_PARTY_MANAGER::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	const static char*	m_buttoninfo_string[8] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SET_INVITE_DENY_MODE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CANCEL_INVITE_DENY_MODE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SET_JOIN_DENY_MODE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CANCEL_JOIN_DENY_MODE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP_PARTY_MANAGER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_PARTY_MANAGER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),
	};
	
	int desc_select = 0;
	if(p_button->GetID() == ALPHA_ID)
	{
		if(GetAttributes()->alpha)
			desc_select = 6;
		else
			desc_select = 7;
		#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y+(window_default_height + window_gap*(g_pParty->GetSize()+1)), (void *)m_buttoninfo_string[desc_select],0,0);
		#else
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_buttoninfo_string[desc_select],0,0);
		#endif //__080405_FIREST_UI_UPDATE
		
	}
	else if (m_p_image_spk->IsPixel(gpC_mouse_pointer->GetX()-x-p_button->x, gpC_mouse_pointer->GetY()-y-p_button->y-(window_default_height + window_gap*(g_pParty->GetSize()+1)), p_button->m_image_index))
	{
		if(p_button->GetID() == DENY_ID)
		{
			if(g_pParty->GetSize() > 0)
				desc_select += 2;
			if(g_pParty->IsAcceptInvite() == false)
				desc_select++;
		}
		else
			desc_select = 4+p_button->GetID()-HELP_ID;
		
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y+(window_default_height + window_gap*(g_pParty->GetSize()+1)), (void *)m_buttoninfo_string[desc_select],0,0);
	}	
}

//-----------------------------------------------------------------------------
// C_VS_UI_PARTY_MANAGER::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_PARTY_MANAGER::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(m_p_image_spk == NULL)return;
	
	
	if(p_button->GetID() == ALPHA_ID)
	{
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y+(window_default_height + window_gap*(g_pParty->GetSize()+1)), C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y+(window_default_height + window_gap*(g_pParty->GetSize()+1)), C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED_NEW);
	#else
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED);
	#endif //__080405_FIREST_UI_UPDATE	

	}
	else if(p_button->GetFocusState() && p_button->GetPressState() && m_p_image_spk->IsPixel(gpC_mouse_pointer->GetX()-x-p_button->x, gpC_mouse_pointer->GetY()-y-p_button->y-(window_default_height + window_gap*(g_pParty->GetSize()+1)), p_button->m_image_index))
	{
		if(p_button->GetID() == DENY_ID && g_pParty->IsAcceptInvite() == false)
			m_p_image_spk->BltLocked(p_button->x+x, p_button->y+y+(window_default_height + window_gap*(g_pParty->GetSize()+1)), DENY_BUTTON_HILIGHTED_PUSHED);
		else
			m_p_image_spk->BltLocked(p_button->x+x, p_button->y+y+(window_default_height + window_gap*(g_pParty->GetSize()+1)), p_button->m_image_index+1);
	}
	else
	{
		if(p_button->GetID() == DENY_ID && g_pParty->IsAcceptInvite() == false)
			m_p_image_spk->BltLocked(p_button->x+x, p_button->y+y+(window_default_height + window_gap*(g_pParty->GetSize()+1)), DENY_BUTTON_HILIGHTED);
		else
			m_p_image_spk->BltLocked(p_button->x+x, p_button->y+y+(window_default_height + window_gap*(g_pParty->GetSize()+1)), p_button->m_image_index);
	}
	
	/*
	if (gpC_base->m_p_DDSurface_back->Lock())
	{
	S_SURFACEINFO	surfaceinfo;
	SetSurfaceInfo(&surfaceinfo, gpC_base->m_p_DDSurface_back->GetDDSD());
	
	  rectangle(&surfaceinfo, p_button, WHITE);
	  
		gpC_base->m_p_DDSurface_back->Unlock();
}*/
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_PARTY_MANAGER::WindowEventReceiver(id_t event)
{
}

//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_PARTY_MANAGER::Run(id_t id)
{
	switch (id)
	{
	case DENY_ID:
		if(g_pParty->IsAcceptInvite())
			g_pParty->RefuseInvite();
		else
			g_pParty->AcceptInvite();
		EMPTY_MOVE;
		break;
		break;
	case CLOSE_ID:
		gpC_base->SendMessage(UI_CLOSE_PARTY_MANAGER);
		break;
		
	case HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::PARTY_MANAGER);
		m_pC_bottom_button_group->UnacquireMouseFocus();
		#if __CONTENTS(!__080405_FIREST_UI_UPDATE)
		m_pC_button_group->UnacquireMouseFocus();
		#endif //__080405_FIREST_UI_UPDATE
		break;
		
	case AWAY_I:
		gpC_base->SendMessage(UI_AWAY_PARTY, -1);
		break;
		
	case AWAY_0:
	case AWAY_1:
	case AWAY_2:
	case AWAY_3:
	case AWAY_4:
		if(id-AWAY_0 < g_pParty->GetSize())
			gpC_base->SendMessage(UI_AWAY_PARTY, id-AWAY_0);
		break;
		
	case ALPHA_ID:
		AttrAlpha(!GetAttributes()->alpha);
		EMPTY_MOVE;
		break;
		
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_INFO
//
//-----------------------------------------------------------------------------
C_VS_UI_INFO::C_VS_UI_INFO()
{
	m_pC_learn_grade_skill_confirm = NULL;
#ifndef _LIB
	(*g_pSkillManager)[SKILLDOMAIN_SWORD].SetDomainLevel(0);
	(*g_pSkillManager)[SKILLDOMAIN_SWORD].SetDomainExpRemain(990);
	(*g_pSkillManager)[SKILLDOMAIN_BLADE].SetDomainLevel(30);
	(*g_pSkillManager)[SKILLDOMAIN_BLADE].SetDomainExpRemain(400000);
	(*g_pSkillManager)[SKILLDOMAIN_GUN].SetDomainLevel(60);
	(*g_pSkillManager)[SKILLDOMAIN_HEAL].SetDomainLevel(150);
	(*g_pSkillManager)[SKILLDOMAIN_HEAL].SetDomainExpRemain(3129);
	(*g_pSkillManager)[SKILLDOMAIN_ENCHANT].SetDomainLevel(20);
	(*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].SetDomainLevel(21);
	(*g_pSkillManager)[SKILLDOMAIN_OUSTERS].SetDomainLevel(21);
	
	MSkillDomain& swordDomain = (*g_pSkillManager)[SKILLDOMAIN_SWORD];
	
	swordDomain.SetNewSkill();
	swordDomain.LearnSkill( SKILL_DOUBLE_IMPACT );
	swordDomain.SetNewSkill();
	swordDomain.LearnSkill( SKILL_TRIPLE_SLASHER );
	swordDomain.SetNewSkill();
	swordDomain.LearnSkill( SKILL_THUNDER_SPARK );
	swordDomain.SetNewSkill();
	swordDomain.LearnSkill( SKILL_RAINBOW_SLASHER );
	swordDomain.SetNewSkill();
	swordDomain.LearnSkill( SKILL_SNAKE_COMBO );
	swordDomain.SetNewSkill();
	swordDomain.LearnSkill( SKILL_CROSS_COUNTER );
	swordDomain.SetNewSkill();
	swordDomain.LearnSkill( SKILL_SOUL_CHAIN );
	swordDomain.SetNewSkill();

	MSkillDomain& oustersDomain = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS];
	
	oustersDomain.SetNewSkill();
	oustersDomain.LearnSkill( SKILL_FLOURISH );
	oustersDomain.SetNewSkill();
	oustersDomain.LearnSkill( SKILL_EVADE );
	oustersDomain.SetNewSkill();
	oustersDomain.LearnSkill( SKILL_SHARP_ROUND );
	oustersDomain.SetNewSkill();
	oustersDomain.LearnSkill( SKILL_PROMINENCE );
	oustersDomain.SetNewSkill();
	oustersDomain.LearnSkill( SKILL_RING_OF_FLARE );
	oustersDomain.SetNewSkill();
	oustersDomain.LearnSkill( SKILL_BLAZE_BOLT );
	oustersDomain.SetNewSkill();
	oustersDomain.LearnSkill( SKILL_DIVINE_SPIRITS );
	oustersDomain.SetNewSkill();

	MSkillDomain& etcDomain = (*g_pSkillManager)[SKILLDOMAIN_ETC];

	etcDomain.SetNewSkill();
	etcDomain.LearnSkill( SKILL_SOUL_CHAIN );
	
	//swordDomain.LearnSkill ( SKILL_

	(*g_pSkillInfoTable)[SKILL_DOUBLE_IMPACT].SetExpLevel( 00 );
	(*g_pSkillInfoTable)[SKILL_TRIPLE_SLASHER].SetExpLevel( 20 );
	(*g_pSkillInfoTable)[SKILL_THUNDER_SPARK].SetExpLevel( 40 );
	(*g_pSkillInfoTable)[SKILL_RAINBOW_SLASHER].SetExpLevel( 60 );
	(*g_pSkillInfoTable)[SKILL_SNAKE_COMBO].SetExpLevel( 80 );
	(*g_pSkillInfoTable)[SKILL_CROSS_COUNTER].SetExpLevel( 100 );
	(*g_pSkillInfoTable)[SKILL_SOUL_CHAIN].SetExpLevel( 100 );
	
	(*g_pSkillInfoTable)[SKILL_DOUBLE_IMPACT].SetSkillExp( 149 );
	(*g_pSkillInfoTable)[SKILL_TRIPLE_SLASHER].SetSkillExp( 19999 );
	(*g_pSkillInfoTable)[SKILL_THUNDER_SPARK].SetSkillExp( 40 );
	(*g_pSkillInfoTable)[SKILL_RAINBOW_SLASHER].SetSkillExp( 60 );
	(*g_pSkillInfoTable)[SKILL_SNAKE_COMBO].SetSkillExp( 80 );
	(*g_pSkillInfoTable)[SKILL_CROSS_COUNTER].SetSkillExp( 100 );
	(*g_pSkillInfoTable)[SKILL_SOUL_CHAIN].SetSkillExp( 1 );
	
	(*g_pSkillManager)[SKILLDOMAIN_GUN].SetNewSkill();
	(*g_pSkillManager)[SKILLDOMAIN_GUN].LearnSkill(SKILL_FAST_RELOAD);
	
	(*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].SetNewSkill();
	(*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].LearnSkill(MAGIC_ACID_TOUCH);
#endif
	m_focused_skill_id = -1;
	m_CenterPos.x = -1;

	m_selected_ACSkillID = -1;
	
	static PETINFO petInfo;
	m_pPetInfo = &petInfo;
	m_pPetInfo->EXIST = false;

	g_RegisterWindow(this);

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_petButtonSpk.Open(SPK_PET_BUTTON_SLAYER);
		m_rt_char_box.Set(20, 22, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::CHAR_BOX), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::CHAR_BOX));
		m_rt_tab.x = 20;
		m_rt_tab.y = -6;
		m_rt_tab.w = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::TAB_CHAR) - 4;
		m_rt_tab.h = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::TAB_CHAR);
		SetRect(&m_rcSkillDesciption, 35, 127+4, 289, 279+4);
		//Set(RESOLUTION_X/2 - 321/2, RESOLUTION_Y/2 - 330/2, 321, 330);
		#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		Set(g_pUserInformation->iResolution_x/2 - 321/2, g_pUserInformation->iResolution_y/2 - 330/2, 321, 374);
		#else
		Set(g_pUserInformation->iResolution_x/2 - 321/2, g_pUserInformation->iResolution_y/2 - 330/2, 321, 350);
		#endif //__080405_FIREST_UI_UPDATE
		break;

	case RACE_VAMPIRE:
		m_petButtonSpk.Open(SPK_PET_BUTTON_VAMPIRE);
		m_rt_char_box.Set(20, 15, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::CHAR_BOX), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::CHAR_BOX));
		m_rt_tab.x = 20;
		m_rt_tab.y = -8;
		m_rt_tab.w = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::TAB_CHAR) - 4;
		m_rt_tab.h = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::TAB_CHAR);
		SetRect(&m_rcSkillDesciption, 43, 82+4, 297, 234+4);
		//Set(RESOLUTION_X/2 - 336/2, RESOLUTION_Y/2 - 335/2, 336, 335);
		#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		Set(g_pUserInformation->iResolution_x/2 - 330/2, g_pUserInformation->iResolution_y/2 - 335/2, 330, 379);
		#else
		Set(g_pUserInformation->iResolution_x/2 - 330/2, g_pUserInformation->iResolution_y/2 - 335/2, 330, 355);
		#endif //__080405_FIREST_UI_UPDATE		
		break;

	case RACE_OUSTERS:
		m_petButtonSpk.Open(SPK_PET_BUTTON_OUSTERS);
		m_rt_char_box.Set(20, 15, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::CHAR_BOX), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::CHAR_BOX));
		m_rt_tab.x = 20;
		m_rt_tab.y = -5;
		m_rt_tab.w = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::TAB_CHAR) - 4;
		m_rt_tab.h = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::TAB_CHAR);
		SetRect(&m_rcSkillDesciption, 26, 74, 263, 206+4);
		//Set(RESOLUTION_X/2 - 336/2, RESOLUTION_Y/2 - 335/2, 336, 335);
		#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		Set(g_pUserInformation->iResolution_x/2 - 336/2, g_pUserInformation->iResolution_y/2 - 335/2, 336, 379);
		#else
		Set(g_pUserInformation->iResolution_x/2 - 336/2, g_pUserInformation->iResolution_y/2 - 335/2, 336, 355);
		#endif //__080405_FIREST_UI_UPDATE
		break;
	}	
	
	g_RegisterWindow(this);
		
	
	AttrTopmost(false);
	AttrPin(true);
	
	g_RegisterWindow(this);
	
	//스크롤바
	m_pC_char_scroll_bar = NULL;
	m_pC_skill_scroll_bar = NULL;
	m_pC_skill_scroll_bar_width = NULL;
	m_pC_grade1_scroll_bar = NULL;
	m_pC_grade3_scroll_bar = NULL;
	m_pC_rare_skill_scroll_bar = NULL;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_pC_char_scroll_bar = new C_VS_UI_SCROLL_BAR(0, Rect(295, 155, -1, 155));
		m_pC_skill_scroll_bar = new C_VS_UI_SCROLL_BAR(0, Rect(291, 125+4, -1, 141));
		
		break;

	case RACE_VAMPIRE:
		m_pC_char_scroll_bar = new C_VS_UI_SCROLL_BAR(0, Rect(300, 155, -1, 152));
		m_pC_skill_scroll_bar = new C_VS_UI_SCROLL_BAR(0, Rect(298, 80+4, -1, 141));
		break;

	case RACE_OUSTERS:
		m_pC_char_scroll_bar = new C_VS_UI_SCROLL_BAR(0, Rect(300, 155, -1, 152));
		m_pC_skill_scroll_bar = new C_VS_UI_SCROLL_BAR(0, Rect(298, 100+4, -1, 141));
		m_pC_skill_scroll_bar_width = new C_VS_UI_SCROLL_BAR(0, Rect(60, 290, 201, -1), false, NULL, 6, 6, 0, false);
		break;
	}	
	m_pC_grade3_scroll_bar = new C_VS_UI_SCROLL_BAR(0, Rect(298, 100+4+25, -1, 152));
	m_pC_grade3_scroll_bar->SetPosMax(4);

	m_pC_rare_skill_scroll_bar = new C_VS_UI_SCROLL_BAR(0, Rect(298, 69, -1, 212));
	m_pC_rare_skill_scroll_bar->SetPosMax(4);

#if __CONTENTS(__080405_FIREST_UI_UPDATE)
	// close버튼 좌표 세팅
	int alpha_x = w-26-26-26, alpha_y = h-39;
	int help_x = w-26-26, help_y = h-39;
	int close_x = w-26, close_y = h-39;

	if(g_eRaceInterface == RACE_OUSTERS)
	{
		close_x -= 19;
		close_y -= 7;
		help_x -= 19;
		help_y -= 7;
		alpha_x -= 19;
		alpha_y -= 7;
	}	
	
	//공통버튼
	m_pC_common_button_group = new ButtonGroup(this);
	m_pC_common_button_group->Add(new C_VS_UI_EVENT_BUTTON(close_x, close_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_X), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_X), CLOSE_ID, this,C_GLOBAL_RESOURCE:: AB_BUTTON_X));
	m_pC_common_button_group->Add(new C_VS_UI_EVENT_BUTTON(help_x, help_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION), HELP_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION));
	m_pC_common_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_x, alpha_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW));
#else
	//close버튼 좌표 세팅
	int close_x = w-24, close_y = h-19;
	int help_x = w-24-20, help_y = h-19;
	int alpha_x = 6, alpha_y = h-21;
	
	if(g_eRaceInterface == RACE_VAMPIRE)
	{
		close_x -= 5;
		close_y -= 7;
		help_x -=5;
		help_y -= 7;
		alpha_x += 5;
		alpha_y -= 5;
	}	
	
	//공통버튼
	m_pC_common_button_group = new ButtonGroup(this);
	m_pC_common_button_group->Add(new C_VS_UI_EVENT_BUTTON(close_x, close_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::BUTTON_CLOSE), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::BUTTON_CLOSE), CLOSE_ID, this,C_GLOBAL_RESOURCE:: BUTTON_CLOSE));
	m_pC_common_button_group->Add(new C_VS_UI_EVENT_BUTTON(help_x, help_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::BUTTON_HELP), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::BUTTON_HELP), HELP_ID, this, C_GLOBAL_RESOURCE::BUTTON_HELP));
	m_pC_common_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_x, alpha_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA));
#endif //__080405_FIREST_UI_UPDATE

	m_pC_common_button_group->Add(new C_VS_UI_EVENT_BUTTON(0, 0, 0, 0, PET_INFO_ID, this, 0));
	
	// 이미지 변경
	POINT point = {m_rt_char_box.x, m_rt_char_box.Down()};
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_pC_common_button_group->Add(new C_VS_UI_EVENT_BUTTON(point.x, point.y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SLAYER_CHANGE_IMAGE), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SLAYER_CHANGE_IMAGE), CHANGE_IMAGE_ID, this, C_GLOBAL_RESOURCE::SLAYER_CHANGE_IMAGE));
		break;

	case RACE_VAMPIRE:
		m_pC_common_button_group->Add(new C_VS_UI_EVENT_BUTTON(point.x, point.y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::VAMPIRE_CHANGE_IMAGE), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::VAMPIRE_CHANGE_IMAGE), CHANGE_IMAGE_ID, this, C_GLOBAL_RESOURCE::VAMPIRE_CHANGE_IMAGE));
		break;

	case RACE_OUSTERS:
		int fix_face_x = 2, fix_face_y = 10;
		point.x += fix_face_x;
		point.y += fix_face_y;
		m_pC_common_button_group->Add(new C_VS_UI_EVENT_BUTTON(point.x, point.y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_CHANGE_IMAGE), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_CHANGE_IMAGE), CHANGE_IMAGE_ID, this, C_GLOBAL_RESOURCE::OUSTERS_CHANGE_IMAGE));
		break;
	}
	
	//charinfo 버튼
	int plus_x = 60, plus_gap = 20;

#if __CONTENTS(__CONTRIBUTE_SYSTEM)
	int plus_y = 124;
#else
	int plus_y = 104;
#endif

	m_pC_char_button_group = new ButtonGroup(this);
	if(g_eRaceInterface == RACE_SLAYER)
	{
		m_pC_char_button_group->Add(new C_VS_UI_EVENT_BUTTON(plus_x, plus_y+7+plus_gap*1, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::PLUS_BUTTON), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::PLUS_BUTTON), STR_PLUS_ID, this, C_GLOBAL_RESOURCE::PLUS_BUTTON));
		m_pC_char_button_group->Add(new C_VS_UI_EVENT_BUTTON(plus_x, plus_y+7+plus_gap*2, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::PLUS_BUTTON), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::PLUS_BUTTON), DEX_PLUS_ID, this, C_GLOBAL_RESOURCE::PLUS_BUTTON));
		m_pC_char_button_group->Add(new C_VS_UI_EVENT_BUTTON(plus_x, plus_y+7+plus_gap*3, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::PLUS_BUTTON), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::PLUS_BUTTON), INT_PLUS_ID, this, C_GLOBAL_RESOURCE::PLUS_BUTTON));
	}
	else
	{
		m_pC_char_button_group->Add(new C_VS_UI_EVENT_BUTTON(plus_x, plus_y+plus_gap*1, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::BONUS_BUTTON), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::BONUS_BUTTON), STR_PLUS_ID, this, C_GLOBAL_RESOURCE::BONUS_BUTTON));
		m_pC_char_button_group->Add(new C_VS_UI_EVENT_BUTTON(plus_x, plus_y+plus_gap*2, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::BONUS_BUTTON), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::BONUS_BUTTON), DEX_PLUS_ID, this, C_GLOBAL_RESOURCE::BONUS_BUTTON));
		m_pC_char_button_group->Add(new C_VS_UI_EVENT_BUTTON(plus_x, plus_y+plus_gap*3, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::BONUS_BUTTON), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::BONUS_BUTTON), INT_PLUS_ID, this, C_GLOBAL_RESOURCE::BONUS_BUTTON));

	}
	//skillinfo 버튼
	m_pC_skill_button_group = new ButtonGroup(this);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			const int domain_x1 = 12, domain_x2 = 61, domain_x3 = 109, domain_x4 = 156, domain_x5 = 203, domain_x6 = 256, domain_y = 26;
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x1, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_BLADE), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_BLADE), BLADE_ID, this, C_GLOBAL_RESOURCE::DM_BLADE));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x2, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_SWORD), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_SWORD), SWORD_ID, this, C_GLOBAL_RESOURCE::DM_SWORD));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x3, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_GUN), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_GUN), GUN_ID, this, C_GLOBAL_RESOURCE::DM_GUN));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x4, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_HEAL), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_HEAL), HEAL_ID, this, C_GLOBAL_RESOURCE::DM_HEAL));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x5, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_ENCHANT), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_ENCHANT), ENCHANT_ID, this, C_GLOBAL_RESOURCE::DM_ENCHANT));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x6, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_TOTAL), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_TOTAL), TOTAL_ID, this, C_GLOBAL_RESOURCE::DM_TOTAL));
		}
		break;

	case RACE_VAMPIRE:
		{
			const int domain_x1 = 20, domain_x2 = 69, domain_x3 = 117, domain_x4 = 164, domain_x5 = 217, domain_x6 = 264, domain_y = 22;
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x1, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_POISON), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_POISON), POISON_ID, this, C_GLOBAL_RESOURCE::DM_POISON));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x2, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_ACID), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_ACID), ACID_ID, this, C_GLOBAL_RESOURCE::DM_ACID));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x3, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_CURSE), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_CURSE), CURSE_ID, this, C_GLOBAL_RESOURCE::DM_CURSE));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x4, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_SUMMON), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_SUMMON), SUMMON_ID, this, C_GLOBAL_RESOURCE::DM_SUMMON));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x5, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_BLOOD), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_BLOOD), BLOOD_ID, this, C_GLOBAL_RESOURCE::DM_BLOOD));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x6, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_INNATE), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_INNATE), INNATE_ID, this, C_GLOBAL_RESOURCE::DM_INNATE));
		}		
		break;

	case RACE_OUSTERS:
		{
			const int domain_x1 = 30, domain_x2 = 108, domain_y = 52;
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x1, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_DM_COMBAT), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_DM_COMBAT), COMBAT_ID, this, C_GLOBAL_RESOURCE::OUSTERS_DM_COMBAT));
			m_pC_skill_button_group->Add(new C_VS_UI_EVENT_BUTTON(domain_x2, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_DM_ELEMENTAL), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_DM_ELEMENTAL), ELEMENTAL_ID, this, C_GLOBAL_RESOURCE::OUSTERS_DM_ELEMENTAL));
		}		
		break;		
	}
	
	// gradeskillinfo 버튼
	m_pC_grade1_button_group = new ButtonGroup(this);
	m_pC_grade2_button_group = new ButtonGroup(this);
	// by csm 2004.12.31 전직인포 버튼 
	m_pC_grade3_button_group = new ButtonGroup(this);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			int domain_y=99;
			int startX=47;
			//m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_PIVATE), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_PIVATE), PIVATE_ID, this, GRADE_PIVATE));
			//startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_PIVATE);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_SERENT), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_SERENT), SERENT_ID, this, C_GLOBAL_RESOURCE::GRADE_SERENT));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_SERENT);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_FEACEL), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_FEACEL), FEACEL_ID, this, C_GLOBAL_RESOURCE::GRADE_FEACEL));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_FEACEL);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_LITENA), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_LITENA), LITENA_ID, this, C_GLOBAL_RESOURCE::GRADE_LITENA));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_LITENA);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_KAINEL), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_KAINEL), KAINEL_ID, this, C_GLOBAL_RESOURCE::GRADE_KAINEL));
			
			int button_x=39,button_y=146,gap_x=33,gap_y=48;
			int Button_ID = GRADE1_BUTTON1_ID;
			
			
			if(C_VS_UI_SKILL::m_C_spk[0].IsInit())
			{
				for(int i=0;i<8;i++)
				{
					m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i&0x3))+gap_x*(i&0x3),
						button_y+(C_VS_UI_SKILL::m_C_spk[0].GetHeight()*(i/4))+gap_y*(i/4),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth(),C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						Button_ID+i, this, i));			
				}
			}
			// grade 2
			domain_y=99;
			startX=38;
			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_GENEAL), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_GENEAL), GENEAL_ID, this, C_GLOBAL_RESOURCE::GRADE_GENEAL));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_GENEAL);
			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_FORE_GENEAL), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_FORE_GENEAL), FORE_GENEAL_ID, this, C_GLOBAL_RESOURCE::GRADE_FORE_GENEAL));

//			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_FORE_GENEAL);
//			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_MAJORIS_GENEAL), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_MAJORIS_GENEAL), MAJORIS_GENEAL_ID, this, C_GLOBAL_RESOURCE::GRADE_MAJORIS_GENEAL));
//			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_MAJORIS_GENEAL);
//			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_CLOEL_GENEAL), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_CLOEL_GENEAL), CLOEL_GENEAL_ID, this, C_GLOBAL_RESOURCE::GRADE_CLOEL_GENEAL));
//			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_CLOEL_GENEAL);
//			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_MARSHAL), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_MARSHAL), MARSHAL_ID, this, C_GLOBAL_RESOURCE::GRADE_MARSHAL));
//			
			button_x=39,button_y=146,gap_x=33,gap_y=48;
			Button_ID = GRADE2_BUTTON1_ID;
			
			
			if(C_VS_UI_SKILL::m_C_spk[0].IsInit())
			{
				for(int i=0;i<5;i++)
				{
					m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i&0x3))+gap_x*(i&0x3),
						button_y+(C_VS_UI_SKILL::m_C_spk[0].GetHeight()*(i/4))+gap_y*(i/4),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth(),C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						Button_ID+i, this, i));			
				}
			}
			Button_ID = GRADE3_BUTTON1_ID;
			
			if(C_VS_UI_SKILL::m_C_spk[0].IsInit())
			{
				for(int i=0;i<3;i++)
				{
					int aaa = button_x+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i/4))+gap_x*(i/4);
					m_pC_grade3_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i/4))+gap_x*(i/4),
						button_y-20+((C_VS_UI_SKILL::m_C_spk[0].GetHeight()+27)*i),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth(),C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						Button_ID+i, this, i));
				}

				for(i=0 ;i<3;i++)
				{
					int eeg = button_x+10+C_VS_UI_SKILL::m_C_spk[0].GetWidth()+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i/4))+gap_x*(i/4);
					m_pC_grade3_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+10+C_VS_UI_SKILL::m_C_spk[0].GetWidth()+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i/4))+gap_x*(i/4),
						button_y-20+((C_VS_UI_SKILL::m_C_spk[0].GetHeight()+27)*i),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth()+170,C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						GRADE3_BUTTON4_ID+i, this, GRADE3_BUTTON4_ID+i));

				}

//				for(i=0 ;i<10;i++)
//				{
//						m_pC_grade3_button_group->Add(new C_VS_UI_EVENT_BUTTON(
//						button_x+(i*25),
//						button_y+128,
//						25,25, 
//						GRADE3_BUTTON_TAB_ID1+i, this, GRADE3_BUTTON_TAB_ID1+i));
//				}
			}
		}
		break;

	case RACE_VAMPIRE:
		{
			int domain_y=98;
			int startX=53;
			//m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, m_pC_info_spk->GetWidth(GRADE_RITTER), m_pC_info_spk->GetHeight(GRADE_RITTER), RITTER_ID, this, GRADE_RITTER));
			//startX+=m_pC_info_spk->GetWidth(GRADE_RITTER);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_REICHSRITTER), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_REICHSRITTER), REICHSRITTER_ID, this, C_GLOBAL_RESOURCE::GRADE_REICHSRITTER));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_REICHSRITTER);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_BARONET), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_BARONET), BARONET_ID, this, C_GLOBAL_RESOURCE::GRADE_BARONET));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_BARONET);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_PREYHER), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_PREYHER), PREYHER_ID, this, C_GLOBAL_RESOURCE::GRADE_PREYHER));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_PREYHER);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_GRAF), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_GRAF), GRAF_ID, this, C_GLOBAL_RESOURCE::GRADE_GRAF));
			
			int button_x=43,button_y=151,gap_x=34,gap_y=50;
			
			int Button_ID = (int)GRADE1_BUTTON1_ID;
			
			if(C_VS_UI_SKILL::m_C_spk[0].IsInit())
			{
				for(int i=0;i<8;i++)
				{
					m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i&0x3))+gap_x*(i&0x3),
						button_y+(C_VS_UI_SKILL::m_C_spk[0].GetHeight()*(i/4))+gap_y*(i/4),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth(),C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						Button_ID+i, this, i));
				}
			}

			// grade 2
			domain_y=98;
			startX=20;
			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_MARKGRAF), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_MARKGRAF), MARKGRAF_ID, this, C_GLOBAL_RESOURCE::GRADE_MARKGRAF));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_MARKGRAF);
			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_PFALZGRAF), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_PFALZGRAF), PFALZGRAF_ID, this, C_GLOBAL_RESOURCE::GRADE_PFALZGRAF));
//			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_PFALZGRAF);
//			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_FURST), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_FURST), FURST_ID, this, C_GLOBAL_RESOURCE::GRADE_FURST));
//			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_FURST);
//			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_HERZOG), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_HERZOG), HERZOG_ID, this, C_GLOBAL_RESOURCE::GRADE_HERZOG));
//			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_HERZOG);
//			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_LANDESHER), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_LANDESHER), LANDESHER_ID, this, C_GLOBAL_RESOURCE::GRADE_LANDESHER));
//			
			button_x=43,button_y=151,gap_x=34,gap_y=50;
			
			Button_ID = (int)GRADE2_BUTTON1_ID;
			
			
			if(C_VS_UI_SKILL::m_C_spk[0].IsInit())
			{
				for(int i=0;i<8;i++)
				{

					m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i&0x3))+gap_x*(i&0x3),
						button_y+(C_VS_UI_SKILL::m_C_spk[0].GetHeight()*(i/4))+gap_y*(i/4),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth(),C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						Button_ID+i, this, i));			
				}
			}
			Button_ID = (int)GRADE3_BUTTON1_ID;

			if(C_VS_UI_SKILL::m_C_spk[0].IsInit())
			{
				for(int i=0;i<3;i++)
				{
					
					m_pC_grade3_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i/4))+gap_x*(i/4),
						//button_y-20+(C_VS_UI_SKILL::m_C_spk[0].GetHeight()*(i&0x3))+(gap_y-30)*(i&0x3),
						button_y-20+((C_VS_UI_SKILL::m_C_spk[0].GetHeight()+27)*i),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth(),C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						Button_ID+i, this, i));			
				}
				
				for(i=0 ;i<3;i++)
				{
					m_pC_grade3_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+10+C_VS_UI_SKILL::m_C_spk[0].GetWidth()+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i/4))+gap_x*(i/4),
						button_y-20+((C_VS_UI_SKILL::m_C_spk[0].GetHeight()+27)*i),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth()+170,C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						GRADE3_BUTTON4_ID+i, this, GRADE3_BUTTON4_ID+i));
					
				}
			}
		}		
		break;

	case RACE_OUSTERS:
		{
			int domain_y=98;
			int startX=53;
			//m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, m_pC_info_spk->GetWidth(GRADE_RITTER), m_pC_info_spk->GetHeight(GRADE_RITTER), RITTER_ID, this, GRADE_RITTER));
			//startX+=m_pC_info_spk->GetWidth(GRADE_RITTER);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_YESOD), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_GRADE_YESOD), YESOD_ID, this, C_GLOBAL_RESOURCE::OUSTERS_GRADE_YESOD));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_YESOD);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_HOD), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_GRADE_HOD), HOD_ID, this, C_GLOBAL_RESOURCE::OUSTERS_GRADE_HOD));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_HOD);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_NETRETH), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_GRADE_NETRETH), NETRETH_ID, this, C_GLOBAL_RESOURCE::OUSTERS_GRADE_NETRETH));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_NETRETH);
			m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_TIPHRETH), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_GRADE_TIPHRETH), TIPHRETH_ID, this, C_GLOBAL_RESOURCE::OUSTERS_GRADE_TIPHRETH));
			
			int button_x=43,button_y=151,gap_x=34,gap_y=50;
			
			int Button_ID = (int)GRADE1_BUTTON1_ID;
			
			if(C_VS_UI_SKILL::m_C_spk[0].IsInit())
			{
				for(int i=0;i<8;i++)
				{
					m_pC_grade1_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i&0x3))+gap_x*(i&0x3),
						button_y+(C_VS_UI_SKILL::m_C_spk[0].GetHeight()*(i/4))+gap_y*(i/4),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth(),C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						Button_ID+i, this, i));
				}

				for(i=0 ;i<3;i++)
				{
					m_pC_grade3_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+10+C_VS_UI_SKILL::m_C_spk[0].GetWidth()+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i/4))+gap_x*(i/4),
						button_y-20+((C_VS_UI_SKILL::m_C_spk[0].GetHeight()+27)*i),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth()+170,C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						GRADE3_BUTTON4_ID+i, this, GRADE3_BUTTON4_ID+i));
					
				}
			}

			// grade 2
			domain_y=98;
			startX=48;
			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_GEBURAH), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_GEBURAH), GEBURAH_ID, this, C_GLOBAL_RESOURCE::GRADE_GEBURAH));
			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_GEBURAH);
			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_CHESED), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_CHESED), CHESED_ID, this, C_GLOBAL_RESOURCE::GRADE_CHESED));
//			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_CHESED);
//			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_BINSH), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_BINSH), BINSH_ID, this, C_GLOBAL_RESOURCE::GRADE_BINSH));
//			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_BINSH);
//			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_CHOKMA), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_CHOKMA), CHOKMA_ID, this, C_GLOBAL_RESOURCE::GRADE_CHOKMA));
//			startX+=gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_CHOKMA);
//			m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(startX, domain_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_KEATHER), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_KEATHER), KEATHER_ID, this, C_GLOBAL_RESOURCE::GRADE_KEATHER));
//			
			button_x=43,button_y=151,gap_x=34,gap_y=50;
			
			Button_ID = (int)GRADE2_BUTTON1_ID;
			
			
			if(C_VS_UI_SKILL::m_C_spk[0].IsInit())
			{
				for(int i=0;i<8;i++)
				{
					m_pC_grade2_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i&0x3))+gap_x*(i&0x3),
						button_y+(C_VS_UI_SKILL::m_C_spk[0].GetHeight()*(i/4))+gap_y*(i/4),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth(),C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						Button_ID+i, this, i));			
				}
			}

			Button_ID = (int)GRADE3_BUTTON1_ID;
			if(C_VS_UI_SKILL::m_C_spk[0].IsInit())
			{
				for(int i=0;i<8;i++)
				{
					m_pC_grade3_button_group->Add(new C_VS_UI_EVENT_BUTTON(
						button_x+(C_VS_UI_SKILL::m_C_spk[0].GetWidth()*(i/4))+gap_x*(i/4),
						//button_y-20+(C_VS_UI_SKILL::m_C_spk[0].GetHeight()*(i&0x3))+(gap_y-30)*(i&0x3),
						button_y-20+((C_VS_UI_SKILL::m_C_spk[0].GetHeight()+27)*i),
						C_VS_UI_SKILL::m_C_spk[0].GetWidth(),C_VS_UI_SKILL::m_C_spk[0].GetWidth(), 
						Button_ID+i, this, i));			
				}
			}
		}		
		break;		
	}	
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			int level = -1;
			for(int i = 0; i < 5; i++)
			{
				int level_temp = (*g_pSkillManager)[(SKILLDOMAIN)i].GetDomainLevel();
				if(level_temp > level)
				{
					level = level_temp;
					m_skill_domain = (SKILLDOMAIN)i;
					m_iDomain = BLADE_ID+i;
					m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[m_skill_domain].GetSkillStepList((SKILL_STEP)(SKILL_STEP_APPRENTICE)))->size()-7);
					//				m_pC_skill_scroll_bar->SetPosMax((*g_pSkillManager)[(SKILLDOMAIN)i].GetSize()-7);
				}
			}
			//m_iGrade = PIVATE_ID;
			m_iGrade = (g_char_slot_ingame.GRADE-1)/5+PIVATE_ID;
		}
		break;

	case RACE_VAMPIRE:
		{
			m_skill_domain = SKILLDOMAIN_VAMPIRE;
			m_iDomain = POISON_ID;
			m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList((SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON)))->size()-7);

			//m_iGrade = RITTER_ID;
			m_iGrade = ((g_char_slot_ingame.GRADE-1)/5)+RITTER_ID;
		}
		break;
		
	case RACE_OUSTERS:
		{
			Run(COMBAT_ID);
// 			m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList((SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON)))->size()-7);
			
			//m_iGrade = RITTER_ID;
			m_iGrade = ((g_char_slot_ingame.GRADE-1)/5)+MALCHUT_ID;
		}
		break;
	}	
	
	

	//Run(m_iGrade);	
	// profile
	m_p_face = NULL;
	RefreshImage();
	m_modify_wide = 10;

	m_bOustersDownSkill = false;

	m_rare_skill_max = 0;
}

//-----------------------------------------------------------------------------
// C_VS_UI_INFO
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_INFO::~C_VS_UI_INFO()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::INFO, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::INFO, Rect(x, y, w, h));
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
	
	g_UnregisterWindow(this);
	
	DeleteNew(m_pC_grade1_button_group);
	DeleteNew(m_pC_grade2_button_group);
	DeleteNew(m_pC_grade3_button_group);
	DeleteNew(m_pC_char_scroll_bar);
	DeleteNew(m_pC_skill_scroll_bar);	
	DeleteNew(m_pC_skill_scroll_bar_width);	
	DeleteNew(m_pC_grade3_scroll_bar);
	DeleteNew(m_pC_rare_skill_scroll_bar);
	DeleteNew(m_pC_common_button_group);
	DeleteNew(m_pC_char_button_group);
	DeleteNew(m_pC_skill_button_group);
	DeleteNew(m_pC_learn_grade_skill_confirm);
	DeleteNew(m_p_face);
}
void C_VS_UI_INFO::SetCorrectGrade()
{
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			
			if(m_info_mode == GRADE1_INFO_MODE)
			{
				m_iGrade=max(SERENT_ID,m_iGrade);
				m_iGrade=min(m_iGrade,KAINEL_ID);
			}
			else if(m_info_mode == GRADE2_INFO_MODE)
			{
				m_iGrade=max(GENEAL_ID,m_iGrade);
				m_iGrade=min(m_iGrade,FORE_GENEAL_ID);
			}

		}
		break;
	case RACE_VAMPIRE:
		{
			
			if(m_info_mode == GRADE1_INFO_MODE)
			{
				m_iGrade=max(REICHSRITTER_ID,m_iGrade);
				m_iGrade=min(m_iGrade,GRAF_ID);
			}
			else if(m_info_mode == GRADE2_INFO_MODE)
			{
				m_iGrade=max(MARKGRAF_ID,m_iGrade);
				m_iGrade=min(m_iGrade,PFALZGRAF_ID);
			}
		}
		break;
		
	case RACE_OUSTERS:
		{
			
			if(m_info_mode == GRADE1_INFO_MODE)
			{
				m_iGrade=max(YESOD_ID,m_iGrade);
				m_iGrade=min(m_iGrade,TIPHRETH_ID);
			}
			else if(m_info_mode == GRADE2_INFO_MODE)
			{
				m_iGrade=max(GEBURAH_ID,m_iGrade);
				m_iGrade=min(m_iGrade,CHESED_ID);
			}
		}
		break;
	}
}

void	C_VS_UI_INFO::SetPetInfo(PETINFO *pPetInfo)
{
	if(pPetInfo == NULL)
	{
		m_pPetInfo->EXIST = false;
		return;
	}

	*m_pPetInfo = *pPetInfo;
	m_pPetInfo->EXIST = true;
	
	C_VS_UI_EVENT_BUTTON *pButton = m_pC_common_button_group->GetButton(PET_INFO_ID);
	if(pButton != NULL)
	{
		int pet_x = 0, pet_y = 0;

		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			pet_x = w + 6;
			pet_y = 29;
			break;

		case RACE_VAMPIRE:
			pet_x = w + 6;
			pet_y = 30;
			break;

		case RACE_OUSTERS:
			pet_x = w - 6;
			pet_y = 45;
			break;
		}
		int petButtonIndex = 0;
		switch(m_pPetInfo->ITEM_TYPE) 
		{
		case 1:
		case 2:
			petButtonIndex = 0;
			break;

		case 3:
			petButtonIndex = 1;
			break;

		case 4:
			petButtonIndex = 2;
			break;

		case 5:
			petButtonIndex = 3;
			break;
		
		case 6:
			petButtonIndex = 4;
			pet_x += 5;
			break;
		case 7:
			petButtonIndex = 5;	//밀리터리베어
			pet_x -= 1;
			break;
		case 8:
			petButtonIndex = 6;	//가고일
			pet_x -= 3;
			break;

#if __CONTENTS(__NEW_PET_FIRE_ELEMENTAL)
		case 9:
			petButtonIndex = 7;	//파이어 엘레멘탈
			pet_x -= 3;
			break;
#endif //__NEW_PET_FIRE_ELEMENTAL
#if __CONTENTS(__2008_OCTOBER_MAKETITEM)
		case 10:
			petButtonIndex = 8;	//파이어 엘레멘탈
			pet_x -= 3;
			break;
#endif //__2008_OCTOBER_MAKETITEM
#if __CONTENTS(__NEW_PET_INCUBUS)
		case 11:
			petButtonIndex = 9;	//인큐버스
			pet_x -= 3;
			break;
#endif //__NEW_PET_INCUBUS
#if __CONTENTS(__PET_MASHIMARO)
		case 12:
			petButtonIndex = 10;	//마시마로
			pet_x -= 3;
			break;
#endif //__PET_MASHIMARO
#if __CONTENTS(__PET_CATS)
		case 13:
			petButtonIndex = 11;	//태비 캣
			pet_x -= 3;
			break;
		case 14:
			petButtonIndex = 12;	//웰시 캣
			pet_x -= 3;
			break;
		case 15:
			petButtonIndex = 13;	//샤밍 캣
			pet_x -= 3;
			break;
#endif //__PET_CATS
#if __CONTENTS(__PET_CATS_UPGRADED)
		case 16:
			petButtonIndex = 14;	//카라, 델라 태비 캣 얼굴
			pet_x -= 3;
			break;
		case 17:
			petButtonIndex = 15;	//카라, 델라 웰시 캣 얼굴
			pet_x -= 3;
			break;
		case 18:
		case 19:
		case 20:
		case 21:
		case 22:
		case 23:
			petButtonIndex = 16;	//카라, 델라 샤밍 캣 얼굴
			pet_x -= 3;
			break;
#endif //__PET_CATS_UPGRADED
/*ONTENTS(__UPGRADE_MONSTER_PET)
		case 28:	case 29:	case 34:	case 35:
			petButtonIndex = 9;	//카라, 델라 인큐버스 얼굴
			pet_x -= 3;
			break;
		case 30:	case 31:	case 36:	case 37:
			petButtonIndex = 8;	//카라, 델라 서큐버스 얼굴
			pet_x -= 3;
			break;
		case 32:	case 33:	case 38:	case 39:
			petButtonIndex = 6;	//카라, 델라 가고일 얼굴
			pet_x -= 3;
			break;
#endif	//__UPGRADE_MONSTER_PET*/

		}
		pButton->Set(pet_x, pet_y, m_petButtonSpk.GetWidth(petButtonIndex*2), m_petButtonSpk.GetHeight(petButtonIndex*2));
		pButton->m_image_index = petButtonIndex*2;
		
	}

}

PETINFO*
C_VS_UI_INFO::GetPetInfo()
{
	return m_pPetInfo;
}

//-----------------------------------------------------------------------------
// C_VS_UI_INFO::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_INFO::CheckGradeSkillIDList()
{
	SetCorrectGrade();
	
	m_grade_skill_id.clear();
	int total=g_pRankBonusTable->GetSize();
	
	int gradeID;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		gradeID = m_iGrade - PIVATE_ID;
		break;

	case RACE_VAMPIRE:
		gradeID = m_iGrade - RITTER_ID;
		break;

	case RACE_OUSTERS:
		gradeID = m_iGrade - MALCHUT_ID;
		break;		
	}
	
	for(int i=0;i<total;i++)
	{
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			if((*g_pRankBonusTable)[i].IsSlayerSkill())
			{
				int skillLevel=(*g_pRankBonusTable)[i].GetLevel();
				if(skillLevel >= gradeID*5 && skillLevel < (gradeID+1)*5)
					m_grade_skill_id.push_back(i);
			}
			break;
			
		case RACE_VAMPIRE:
			if((*g_pRankBonusTable)[i].IsVampireSkill())
			{
				int skillLevel=(*g_pRankBonusTable)[i].GetLevel();
				if(skillLevel >= gradeID*5 && skillLevel < (gradeID+1)*5)
					m_grade_skill_id.push_back(i);
			}
			break;
			
		case RACE_OUSTERS:
			if((*g_pRankBonusTable)[i].IsOustersSkill())
			{
				int skillLevel=(*g_pRankBonusTable)[i].GetLevel();
				if(skillLevel >= gradeID*5 && skillLevel < (gradeID+1)*5)
					m_grade_skill_id.push_back(i);
			}
			break;
		}
	}
	m_draw_grade_skill_mark = m_grade_skill_id.size();
}

//-----------------------------------------------------------------------------
// C_VS_UI_INFO::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------

void	C_VS_UI_INFO::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	const static char* m_info_button_string[27] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_CHARACTER_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP_CHARACTER_INFO_WINDOW].GetString(),			
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_BLADE_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_SWORD_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_GUN_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HEAL_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ENCHANT_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALL_INFO].GetString(),			
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_POISON_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ACID_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_CURSE_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_SUMMON_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_BLOOD_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ESSENCE_INFO].GetString(),		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_UP_STR].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_UP_STR].GetString(),		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_UP_STR].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_UP_DEX].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_UP_INT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_MAGIC_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_SKILL_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP_MAGIC_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP_SKILL_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TIP_CHANGE_PICTURE_CLICK_HERE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_PET_INFO_WINDOW].GetString(),
	};

	char* m_grade_skill_description_string[RANK_BONUS_MAX] =
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_CRITICAL_10].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_DEFENSE_5].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_TOHIT_5].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_HP_10].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_MP_15].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_DAMAGE_3].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_ATTACKSPEED_15].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_ENCHANT_DAMAGE_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_HEAL_DAMAGE_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_RESISTANCE_ACID_15_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_RESISTANCE_BLOODY_15_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_RESISTANCE_CURSE_15_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_RESISTANCE_POISON_15_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DECREASE_MP_EXHAUSTION_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_HP_STEAL_2_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_MP_STEAL_2_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_LUCKY_2].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_HP_20].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_DEFENSE_10].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_PROTECTION_10].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_ATTACKSPEED_15].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DECREASE_HP_EXHAUSTION_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_NEAR_ATTACK_DAMAGE_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_HP_RESTORE_SPEED_15_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_DAMAGE_STORM_20_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_RANGE_STORM_5_BY_5].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_SUCCESS_RATIO_POISON_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_SUCCESS_RATIO_ACID_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_SUCCESS_RATIO_CURSE_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_SUCCESS_RATIO_BLOODY_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_SUCCESS_RATIO_INNATE_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_SUCCESS_RATIO_SUMMON_10_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_KEEP_TIME_ACID_SWAMP_20_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_KEEP_TIME_PARALYZE_20_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_KEEP_TIME_DARKNESS_30_PERCENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INCREASE_RANGE_DARKNESS_5_BY_5].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_WOOD_SKIN].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_WIND_SENSE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_HOMING_EYE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_LIFE_ENERGY].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_SOUL_ENERGY].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_STONE_MAUL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_SWIFT_ARM].GetString(),

		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_FIRE_ENDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_WATER_ENDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_EARTH_ENDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_ANTI_ACID_SKIN].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_ANTI_BLOODY_SKIN].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_ANTI_CURSE_SKIN].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_ANTI_POISON_SKIN].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_ANTI_SILVER_DAMAGE_SKIN].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_BLESS_OF_NATURE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_LIFE_ABSORB].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_SOUL_ABSORB].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_MYSTIC_RULE].GetString(),

	(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_PERCEPTION].GetString(),//] = "모능 +2";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_STONE_OF_SAGE].GetString(),//] = "지식(INT) +5";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_FOOT_OF_RANGER].GetString(),//] = "민첩성(DEX) +5";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_WARRIORS_FIST].GetString(),//] = "힘(STR) +5";

    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_ACID_INQUIRY].GetString(),//] = "애시드(Acid) 저항 +10%";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_BLOODY_INQUIRY].GetString(),//] = "블러드(Blood) 저항 +10%";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_CURSE_INQUIRY].GetString(),//] = "커스(Curse) 저항+10%";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_POISON_INQUIRY].GetString(),//] = "포이즌(Poison) 저항 +10%";
	(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_INQUIRY_MASTERY].GetString(),//] = "모든 저항 +3%";

    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_POWER_OF_SPIRIT].GetString(),//] = "방어율(Protection) 5%증가";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_WIND_OF_SPIRIT].GetString(),//] = "회피율(Defense) 5%증가";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_PIXIES_EYES].GetString(),//] = "명중률(To hit) 5%증가";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_GROUND_OF_SPIRIT].GetString(),//] = "마법력(MP) 5%증가";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_FIRE_OF_SPIRIT].GetString(),//] = "크리티컬(Critical) 공격력 5%증가";

    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_EVOLUTION_IMMORTAL_HEART].GetString(),//] = "생명력(HP) 5% 증가";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_BEHEMOTH_ARMOR_2].GetString(),//] = "회피율(Defense) 5%증가 ";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_DRAGON_EYE_2].GetString(),//] = "명중률(To hit) 5%증가";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_EVOLUTION_RELIANCE_BRAIN].GetString(),//] = "마법력(MP) 5%증가";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_HEAT_CONTROL].GetString(),//] = "크리티컬(Critical) 공격력 5%증가";

	(*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_ACID_MASTERY].GetString(),//] = "상대방 애시드(Acid) 저항 10% 감소";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_BLOODY_MASTERY].GetString(),//] = "상대방 블러드(Blood) 저항 10% 감소";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_CURSE_MASTERY].GetString(),//] = "상대방 커스(Curse) 저항 10%감소";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_POISON_MASTERY].GetString(),//] = "상대방 포이즌(Poison) 저항 10%감소";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_SKILL_MASTERY].GetString(),//] = "상대방 모든 저항 3% 감소";

    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_SALAMANDERS_KNOWLEDGE].GetString(),//] = "불계열 정령 +1";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_UNDINES_KNOWLEDGE].GetString(),//] = "물계열 정령 +1";
    (*g_pGameStringTable)[UI_STRING_MESSAGE_RANK_BONUS_GNOMES_KNOWLEDGE].GetString(),//] = "대지계열 정령 +1";
	};

	if( p_button->GetID() == CHANGE_IMAGE_ID && m_info_mode != CHARACTER_INFO_MODE )
		return;
	
	// 툴팁
	if(p_button->GetID() == PET_INFO_ID)
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_info_button_string[26],0,0);
	else
	if(p_button->GetID() == CHANGE_IMAGE_ID)
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_info_button_string[25],0,0);
	else
	if(GetAttributes()->alpha && p_button->GetID() == ALPHA_ID)
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_info_button_string[20],0,0);
	else	
	if(p_button->GetID() == CLOSE_ID && m_info_mode == SKILL_INFO_MODE)//m_skill_info_mode)
	{
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_info_button_string[22],0,0);
			break;
			
		case RACE_VAMPIRE:
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_info_button_string[21],0,0);
			break;
			
		case RACE_OUSTERS:
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_info_button_string[22],0,0);
			break;
		}
	}
	else if(p_button->GetID() == HELP_ID && m_info_mode == SKILL_INFO_MODE) //m_skill_info_mode)
	{
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_info_button_string[24],0,0);
			break;
			
		case RACE_VAMPIRE:
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_info_button_string[23],0,0);
			break;
			
		case RACE_OUSTERS:
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_info_button_string[24],0,0);
			break;
		}
	}
	else if(p_button->GetID() >= PIVATE_ID && p_button->GetID() <= GRADE2_BUTTON8_ID)
	{
		const static char *grade_desc[3] = 
		{
			NULL,
			NULL,
			NULL,
		};
		grade_desc[1]=NULL;
		int TempVal = 0;
		if(m_info_mode == GRADE1_INFO_MODE)
			 TempVal = GRADE1_BUTTON1_ID;
		else if(m_info_mode == GRADE2_INFO_MODE)
			TempVal = GRADE2_BUTTON1_ID;

		int id = p_button->GetID() - TempVal;
		int MyGrade;
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			MyGrade = m_iGrade - PIVATE_ID;
			break;
			
		case RACE_VAMPIRE:
			MyGrade = m_iGrade - RITTER_ID;
			break;
			
		case RACE_OUSTERS:
			MyGrade = m_iGrade - MALCHUT_ID;
			break;
		}
		if( id < 0 || id >= m_draw_grade_skill_mark || g_pRankBonusTable == NULL || 
			g_pRankBonusTable->GetSize() <= m_grade_skill_id[id] ) 
			return;

		int Skill_Id = m_grade_skill_id[id];
		int Skill_Type = (*g_pRankBonusTable)[Skill_Id].GetType();
		grade_desc[1] = m_grade_skill_description_string[Skill_Type];
		if(grade_desc[1] != NULL)
		{
			grade_desc[0] = (*g_pRankBonusTable)[m_grade_skill_id[id]].GetName();			
			switch((*g_pRankBonusTable)[m_grade_skill_id[id]].GetStatus())
			{
			case RankBonusInfo::STATUS_NULL :
				if((g_char_slot_ingame.GRADE-1)/5 >= MyGrade)
				{
					// 지금 배울 수 있습니다.
					grade_desc[2] = (*g_pGameStringTable)[UI_STRING_MESSAGE_CAN_LEARN_SKILL_NOW].GetString();
				} else
				{
					// 아직 배울 수 없습니다.
					grade_desc[2] = (*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_LEARN_SKILL_YET].GetString();
				}
				break;
			case RankBonusInfo::STATUS_CANNOT_LEARN :
				grade_desc[2] = (*g_pGameStringTable)[UI_STRING_MESSAGE_NEVER_CANNOT_LEARN_SKILL].GetString();
				//      배울 수 없습니다.
				break;
			case RankBonusInfo::STATUS_LEARNED :
				//     이미 배운 스킬입니다.
				grade_desc[2] = (*g_pGameStringTable)[UI_STRING_MESSAGE_ALREADY_LEARNED_SKILL].GetString();
				break;
			}
			g_descriptor_manager.Set(DID_HELP, p_button->x+x, p_button->y+y, (void *)grade_desc,0,0);			
		}			
	}
	else if(p_button->GetID() >= GRADE2_BUTTON1_ID && p_button->GetID() <= GRADE3_BUTTON6_ID)
	{
			//bycsm skill info 에서 출력해준다 --.
	}
	else 
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_info_button_string[p_button->GetID()],0,0);
}


//-----------------------------------------------------------------------------
// C_VS_UI_INFO::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_INFO::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	CSpriteSurface::SetEffect(CSpriteSurface::EFFECT_GRAY_SCALE);
	POINT pt={p_button->x+x,p_button->y+y};
//	int i;
	
	if( p_button->GetID() == CHANGE_IMAGE_ID && m_info_mode != CHARACTER_INFO_MODE )
		return;

//	if( p_button->GetID() == GRADE2_BUTTON5_ID && m_iGrade != FORE_GENEAL_ID)
//		return;
	

	if(p_button->GetID() == PET_INFO_ID)
	{
		if(m_pPetInfo->EXIST == true)
		{
			int iPushedPlus = 0, iFocusedPlus = 0;
			
			if(p_button->GetFocusState())
				iFocusedPlus = 1;

			if(p_button->GetPressState())
				iPushedPlus = 1;

			int petButtonIndex = p_button->m_image_index;

			m_petButtonSpk.BltLocked(p_button->x+x, p_button->y+y+iPushedPlus, petButtonIndex+iFocusedPlus);
		}
	}
	else if(p_button->GetID() == ALPHA_ID)
	{
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED_NEW);
	#else
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED);
	#endif //__080405_FIREST_UI_UPDATE
	}
	//Close버튼
	else if(p_button->GetID() == CLOSE_ID || p_button->GetID() == HELP_ID)
	{
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_PUSHED_OFFSET);
			else
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_HILIGHTED_OFFSET);
		}
		else
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
		}
	#else
		gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x-5, y+p_button->y-5, C_GLOBAL_RESOURCE::BUTTON_CLOSE_BACK);
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+3);
			else
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+2);
		}
		else
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+1);
			else
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
		}
	#endif //__080405_FIREST_UI_UPDATE
	}
	else if(
		(p_button->GetID() >= BLADE_ID && p_button->GetID() <= TOTAL_ID && m_iDomain != p_button->GetID()) || 
		(p_button->GetID() >= POISON_ID && p_button->GetID() <= INNATE_ID && m_iDomain != p_button->GetID()) ||
		(p_button->GetID() >= COMBAT_ID && p_button->GetID() <= ELEMENTAL_ID && m_iDomain != p_button->GetID()) ||
		(p_button->GetID() >= RITTER_ID && p_button->GetID() <= LANDESHER_ID && m_iGrade != p_button->GetID()) ||
		(p_button->GetID() >= PIVATE_ID && p_button->GetID() <= MARSHAL_ID && m_iGrade != p_button->GetID()) ||
		(p_button->GetID() >= MALCHUT_ID && p_button->GetID() <= KEATHER_ID && m_iGrade != p_button->GetID())
		)
	{
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y-1, p_button->m_image_index+1);
			else
			{
				Rect rect;
				rect.Set(0, 0, gpC_global_resource->m_pC_info_spk->GetWidth(p_button->m_image_index+1), 
					gpC_global_resource->m_pC_info_spk->GetHeight(p_button->m_image_index+1)-2);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+p_button->x, y+p_button->y+1, rect,p_button->m_image_index+1);
			}
		}
		else
		{
			gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y+1, p_button->m_image_index);
		}
	}
	else if(p_button->GetID() == STR_PLUS_ID || p_button->GetID() == DEX_PLUS_ID ||	p_button->GetID() == INT_PLUS_ID || p_button->GetID() == CHANGE_IMAGE_ID)
	{
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+2);
			else
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+1);
		}
		else
			gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
	} 
	else if(p_button->GetID() >= GRADE1_BUTTON1_ID && p_button->GetID() <= GRADE2_BUTTON8_ID)
	{
		// 계급 스킬 버튼들
		int TempVal = 0;
		if(m_info_mode == GRADE1_INFO_MODE)
			 TempVal = GRADE1_BUTTON1_ID;
		else if(m_info_mode == GRADE2_INFO_MODE)
			TempVal = GRADE2_BUTTON1_ID;

		int now_id=p_button->GetID() - TempVal;

		if(now_id >= 0 && now_id<m_draw_grade_skill_mark)
		{
			POINT pt={p_button->x+x,p_button->y+y};
			const RankBonusInfo& RankBonus = (*g_pRankBonusTable)[m_grade_skill_id[now_id]];
			int MyGrade;
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				MyGrade = m_iGrade - PIVATE_ID;
				break;
				
			case RACE_VAMPIRE:
				MyGrade = m_iGrade - RITTER_ID;
				break;
				
			case RACE_OUSTERS:
				MyGrade = m_iGrade - MALCHUT_ID;
				break;
			}

			if(p_button->GetFocusState())
			{	
				switch(g_eRaceInterface)
				{
				case RACE_SLAYER:
					gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x-15,y+p_button->y-15,C_GLOBAL_RESOURCE::SLAYER_GRADE_MARK_EDGE);
					break;
					
				case RACE_VAMPIRE:
					gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x-15,y+p_button->y-15,C_GLOBAL_RESOURCE::VAMPIRE_GRADE_MARK_EDGE);
					break;
					
				case RACE_OUSTERS:
					gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x-15,y+p_button->y-15,C_GLOBAL_RESOURCE::OUSTERS_GRADE_MARK_EDGE);
					break;
				}


				// 클릭 하였을때					
				switch(RankBonus.GetStatus())
				{
				case RankBonusInfo::STATUS_NULL :
					if((g_char_slot_ingame.GRADE-1)/5 >= MyGrade)		// 초록색 						
					{
						if(p_button->GetPressState())
						{
							pt.y++;
							pt.x++;	
						}
						gpC_base->m_p_DDSurface_back->BltSpriteColor(&pt,&C_VS_UI_SKILL::m_C_spk[RankBonus.GetSkillIconID()],rgb_GREEN);
					}
					else
						gpC_base->m_p_DDSurface_back->BltSpriteEffect(&pt,&C_VS_UI_SKILL::m_C_spk[RankBonus.GetSkillIconID()]);
					break;
				case RankBonusInfo::STATUS_CANNOT_LEARN :
					gpC_base->m_p_DDSurface_back->BltSpriteDarkness(&pt,&C_VS_UI_SKILL::m_C_spk[RankBonus.GetSkillIconID()],1);
					break;
				case RankBonusInfo::STATUS_LEARNED :					
					gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&pt,&C_VS_UI_SKILL::m_C_spk[RankBonus.GetSkillIconID()],315-256);
					break;
				default :
					gpC_base->m_p_DDSurface_back->BltSpriteDarkness(&pt,&C_VS_UI_SKILL::m_C_spk[RankBonus.GetSkillIconID()],1);
					break;
				}

			}
			else
			{
				// 일반 출력
				switch(g_eRaceInterface)
				{
				case RACE_SLAYER:
					gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x-15,y+p_button->y-15,C_GLOBAL_RESOURCE::SLAYER_GRADE_MARK_EDGE);
					break;
					
				case RACE_VAMPIRE:
					gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x-15,y+p_button->y-15,C_GLOBAL_RESOURCE::VAMPIRE_GRADE_MARK_EDGE);
					break;
					
				case RACE_OUSTERS:
					gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x-15,y+p_button->y-15,C_GLOBAL_RESOURCE::OUSTERS_GRADE_MARK_EDGE);
					break;
				}

				switch(RankBonus.GetStatus())
				{
				case RankBonusInfo::STATUS_NULL :
					if((g_char_slot_ingame.GRADE-1)/5 >= MyGrade)		// 초록색 						
						gpC_base->m_p_DDSurface_back->BltSpriteColor(&pt,&C_VS_UI_SKILL::m_C_spk[RankBonus.GetSkillIconID()],rgb_GREEN);
					else
						gpC_base->m_p_DDSurface_back->BltSpriteEffect(&pt,&C_VS_UI_SKILL::m_C_spk[RankBonus.GetSkillIconID()]);
					break;
				case RankBonusInfo::STATUS_CANNOT_LEARN :
					gpC_base->m_p_DDSurface_back->BltSpriteDarkness(&pt,&C_VS_UI_SKILL::m_C_spk[RankBonus.GetSkillIconID()],1);
					break;
				case RankBonusInfo::STATUS_LEARNED :					
					gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&pt,&C_VS_UI_SKILL::m_C_spk[RankBonus.GetSkillIconID()],315-256);
					break;
				default :
					gpC_base->m_p_DDSurface_back->BltSpriteDarkness(&pt,&C_VS_UI_SKILL::m_C_spk[RankBonus.GetSkillIconID()],1);
					break;
				}				
			}			
		}
	}
//	else if(p_button->GetID()>=GRADE3_BUTTON_TAB_ID1 && p_button->GetID()<=GRADE3_BUTTON_TAB_ID10)
//	{
//		MSkillDomain::SKILL_STEP_LIST list; 
//		if(g_eRaceInterface == RACE_SLAYER)
//		{
//			list = *((*g_pSkillManager)[m_skill_domain].GetSkillStepList((SKILL_STEP)(SKILL_STEP_SLAYER_BLADE_ADVANCEMENT + m_skill_domain)));
//			
//			if(list.size() >= p_button->m_image_index -GRADE3_BUTTON_TAB_ID1+1)
//				gpC_global_resource->m_pC_info_spk->BltLocked(pt.x,pt.y,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_NUM1 + p_button->m_image_index -GRADE3_BUTTON_TAB_ID1);
//			else
//				gpC_global_resource->m_pC_info_spk->BltLocked(pt.x,pt.y,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_NUM_1 + p_button->m_image_index -GRADE3_BUTTON_TAB_ID1);
//		}
//
//		if(g_eRaceInterface == RACE_VAMPIRE)
//		{
//			list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList((SKILL_STEP)(SKILL_STEP_VAMPIRE_ADVANCEMENT)));
//			
//			if(list.size()/2 >= p_button->m_image_index -GRADE3_BUTTON_TAB_ID1+1)
//				gpC_global_resource->m_pC_info_spk->BltLocked(pt.x,pt.y,C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_NUM1 + p_button->m_image_index -GRADE3_BUTTON_TAB_ID1);
//			else
//				gpC_global_resource->m_pC_info_spk->BltLocked(pt.x,pt.y,C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_NUM_1 + p_button->m_image_index -GRADE3_BUTTON_TAB_ID1);
//		}
//		
//		if(g_eRaceInterface == RACE_OUSTERS)
//		{
//		
//			if(m_ousters_Magic!= -1)
//				step= (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT +m_ousters_Magic);
//			else
//				step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT +  p_button->GetID()-GRADE3_BUTTON1_ID + m_pC_grade3_scroll_bar->GetScrollPos());
//			list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList((SKILL_STEP)(step)));
//			if(m_ousters_Magic!= -1)
//			{
//				if(1 >= p_button->m_image_index -GRADE3_BUTTON_TAB_ID1+1)
//					gpC_global_resource->m_pC_info_spk->BltLocked(pt.x,pt.y,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_OUTSTERS_NUM1 + p_button->m_image_index -GRADE3_BUTTON_TAB_ID1);
//				else
//					gpC_global_resource->m_pC_info_spk->BltLocked(pt.x,pt.y,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_OUTSTERS_NUM_1 + p_button->m_image_index -GRADE3_BUTTON_TAB_ID1);
//				
//			}
//			else
//			{
//				if(list.size() >= p_button->m_image_index -GRADE3_BUTTON_TAB_ID1+1)
//					gpC_global_resource->m_pC_info_spk->BltLocked(pt.x,pt.y,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_NUM1 + p_button->m_image_index -GRADE3_BUTTON_TAB_ID1);
//				else
//					gpC_global_resource->m_pC_info_spk->BltLocked(pt.x,pt.y,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_NUM_1 + p_button->m_image_index -GRADE3_BUTTON_TAB_ID1);
//			}
//		}
//
//			
//		
//	}
	else if(p_button->GetID() >= GRADE2_BUTTON8_ID && p_button->GetID() <= GRADE3_BUTTON6_ID)
	{
		MSkillDomain::SKILL_STEP_LIST::iterator ss;
		MSkillDomain::SKILLSTATUS status = MSkillDomain::SKILLSTATUS_NULL ;
		int sprID;
		if(p_button->GetFocusState())
		{	
			if(m_advance_skill_id_vec.size() >= p_button->GetID()-GRADE3_BUTTON1_ID)
			{
				ss= m_advance_skill_id_vec.begin()+p_button->GetID()-GRADE3_BUTTON1_ID;
				if((ACTIONINFO)*ss > 0 && (ACTIONINFO)*ss< MAX_ACTIONINFO)
				{
					status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus((ACTIONINFO)*ss);
					sprID = (*g_pSkillInfoTable)[(ACTIONINFO)*ss].GetSpriteID();
				}
			}



			/*
			if(g_eRaceInterface == RACE_SLAYER)
			{
				list = *((*g_pSkillManager)[m_skill_domain].GetSkillStepList((SKILL_STEP)(SKILL_STEP_SLAYER_BLADE_ADVANCEMENT + m_skill_domain)));
				
				if(list.size() >= p_button->GetID()-GRADE3_BUTTON1_ID)
				{
					ss= list.begin()+p_button->GetID()-GRADE3_BUTTON1_ID;
					if((ACTIONINFO)*ss > 0 && (ACTIONINFO)*ss< MAX_ACTIONINFO)
					{
						status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus((ACTIONINFO)*ss);
						sprID = (*g_pSkillInfoTable)[(ACTIONINFO)*ss].GetSpriteID();
					}
				}
				
			}
			else if(g_eRaceInterface == RACE_VAMPIRE)
			{
				SKILL_STEP step;
				if(m_vampire_ACType!= -1)
					step= (SKILL_STEP)(SKILL_STEP_VAMPIRE_WARRIOR_ADVANCEMENT + m_vampire_ACType);
				else
					step = (SKILL_STEP)(SKILL_STEP_VAMPIRE_WARRIOR_ADVANCEMENT +  p_button->GetID()-GRADE3_BUTTON1_ID + m_pC_grade3_scroll_bar->GetScrollPos());

				list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList((SKILL_STEP)(step)));
				ss= ss = list.begin()+p_button->GetID()-GRADE3_BUTTON1_ID;
				if((ACTIONINFO)*ss > 0 && (ACTIONINFO)*ss< MAX_ACTIONINFO)
				{
					status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus((ACTIONINFO)*ss);
					sprID = (*g_pSkillInfoTable)[(ACTIONINFO)*ss].GetSpriteID();
				}

				// 예전꺼 지워도됨
				list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList((SKILL_STEP)(SKILL_STEP_VAMPIRE_ADVANCEMENT)));
				ss= ss = list.begin()+p_button->GetID()-GRADE3_BUTTON1_ID;
				if((ACTIONINFO)*ss > 0 && (ACTIONINFO)*ss< MAX_ACTIONINFO)
				{
					status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus((ACTIONINFO)*ss);
					sprID = (*g_pSkillInfoTable)[(ACTIONINFO)*ss].GetSpriteID();
				}
				//

			}
			else if(g_eRaceInterface == RACE_OUSTERS)
			{

				SKILL_STEP step;
				if(m_ousters_Magic!= -1)
					step= (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT +m_ousters_Magic);
				else
					step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT +  p_button->GetID()-GRADE3_BUTTON1_ID + m_pC_grade3_scroll_bar->GetScrollPos());

				list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList((SKILL_STEP)(step)));
				ss= ss = list.begin()+p_button->GetID()-GRADE3_BUTTON1_ID;
				if((ACTIONINFO)*ss > 0 && (ACTIONINFO)*ss< MAX_ACTIONINFO)
				{
					status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus((ACTIONINFO)*ss);
					sprID = (*g_pSkillInfoTable)[(ACTIONINFO)*ss].GetSpriteID();
				}
			}
//			gpC_base->m_p_DDSurface_back->BltSpriteColor(&pt,&C_VS_UI_SKILL::m_C_spk[sprID],rgb_GREEN);
			*/
		}
		
		
		switch(status)
		{
		case MSkillDomain::SKILLSTATUS::SKILLSTATUS_OTHER :
			if(p_button->GetPressState())
			{
				pt.y+=2;
				pt.x+=2;	
				gpC_base->m_p_DDSurface_back->BltSpriteColor(&pt,&C_VS_UI_SKILL::m_C_spk[sprID],rgb_GREEN);
			}
			
			break;
//		case MSkillDomain::SKILLSTATUS::SKILLSTATUS_NEXT:
//			gpC_base->m_p_DDSurface_back->BltSpriteDarkness(&pt,&C_VS_UI_SKILL::m_C_spk[sprID],1);
//			break;
//		case MSkillDomain::SKILLSTATUS::SKILLSTATUS_LEARNED:					
//			gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&pt,&C_VS_UI_SKILL::m_C_spk[sprID],315-256);
//			break;
//		default :
//			gpC_base->m_p_DDSurface_back->BltSpriteDarkness(&pt,&C_VS_UI_SKILL::m_C_spk[sprID],1);
//			break;
		}
	
	}
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::WindowEventReceiver(id_t event)
{
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_INFO::IsPixel(int _x, int _y)
{
	//	bool re = C_VS_UI_DIALOG::IsPixel(_x, _y);
	bool re = IsInRect(_x, _y);
	
	if(re == false)
	{
		const int TAB_IMAGE_BASIS = C_GLOBAL_RESOURCE::TAB_CHAR;

		for(int i = INFO_MODE_MAX - 1; i >= 0 ; --i)
		{
			re = gpC_global_resource->m_pC_info_spk->IsPixel(
				_x - x - m_rt_tab.x - m_rt_tab.w * i,
				_y - y - m_rt_tab.y,
				TAB_IMAGE_BASIS + i * 2);

			if(re) break;
		}
	}

	if(re == false)
	{
		if(m_pPetInfo->EXIST == true)
		{
			C_VS_UI_EVENT_BUTTON *pButton = m_pC_common_button_group->GetButton(PET_INFO_ID);
			if(pButton != NULL)
			{
				int petButtonIndex = pButton->m_image_index;
				re = m_petButtonSpk.IsPixel(_x-x-pButton->x, _y-y-pButton->y, petButtonIndex);
			}
		}
	}
	
	return re;
	//	return m_pC_charinfo->IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y), CHARINFO_WINDOW);
}

//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::Run(id_t id)
{
	// Process Grade Skill Button
	if(id>=GRADE1_BUTTON1_ID && id<=GRADE2_BUTTON8_ID)
	{
		int TempVal = 0;
		if(m_info_mode == GRADE1_INFO_MODE)
			 TempVal = GRADE1_BUTTON1_ID;
		else if(m_info_mode == GRADE2_INFO_MODE)
			TempVal = GRADE2_BUTTON1_ID;

		int nowID=id-TempVal;

		if(m_draw_grade_skill_mark > nowID)
		{
			RankBonusInfo& RankBonus = (*g_pRankBonusTable)[m_grade_skill_id[nowID]];
			int MyGrade;
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				MyGrade = m_iGrade - PIVATE_ID;
				break;
				
			case RACE_VAMPIRE:
				MyGrade = m_iGrade - RITTER_ID;
				break;
				
			case RACE_OUSTERS:
				MyGrade = m_iGrade - MALCHUT_ID;
				break;
			}
			
			// 스킬 상태가 NULL 이어야 하고, 현재 선택한 계급이 자기 계급과 같거나 낮아야 한다.
			if(RankBonusInfo::STATUS_NULL==RankBonus.GetStatus() && ((g_char_slot_ingame.GRADE-1)/5)>=MyGrade)
			{
			//	gpC_base->SendMessage(UI_SELECT_GRADE_SKILL,(int)RankBonus.GetType(),0,NULL);
				int dx = 0;
				int dy = 0;
				if(m_info_mode == GRADE1_INFO_MODE)
				{
					dx = m_pC_grade1_button_group->GetButton(id)->x+x;
					dy = m_pC_grade1_button_group->GetButton(id)->y+y+40;
				}
				else if(m_info_mode == GRADE2_INFO_MODE)
				{
					dx = m_pC_grade2_button_group->GetButton(id)->x+x;
					dy = m_pC_grade2_button_group->GetButton(id)->y+y+40;
				}

				m_selected_grade_skill = (int)RankBonus.GetType();
				DeleteNew(m_pC_learn_grade_skill_confirm);
				m_pC_learn_grade_skill_confirm = new C_VS_UI_DIALOG(dx,dy,3,0,ExecF_LearnGradeSkillConfirm,DIALOG_OK|DIALOG_CANCEL);
				
				static const char *ppmsg[] = {
					(*g_pGameStringTable)[UI_STRING_MESSAGE_LEARN_GRADE_SKILL_CONFIRM].GetString(),
				};
				m_pC_learn_grade_skill_confirm->SetMessage((char**)ppmsg,1,SMO_NOFIT);
				m_pC_learn_grade_skill_confirm->Start();				
			} else
				m_selected_grade_skill = -1;						
		} else
			m_selected_grade_skill = -1;
		return;
	}
	// 승직 스킬 설명 띄우기 버튼
	else if(id>=GRADE3_BUTTON4_ID && id<=GRADE3_BUTTON6_ID)
	{
		if(!m_advance_skill_id_vec.empty())
		{
			MSkillDomain::SKILL_STEP_LIST::iterator ss = m_advance_skill_id_vec.begin()+id-GRADE3_BUTTON4_ID+max(0,m_pC_grade3_scroll_bar->GetScrollPos());
			const ACTIONINFO SkillID = (ACTIONINFO)*ss;
			if(m_advance_skill_id_vec.size() > id-GRADE3_BUTTON4_ID)
				gC_vs_ui.RunDescDialog(DID_SKILL, (void *)SkillID);
		}
	}
	// 승직 스킬 배우기 버튼
	else if(id>=GRADE2_BUTTON8_ID && id<=GRADE3_BUTTON3_ID)
	{
		if(!m_advance_skill_id_vec.empty())
		{
			MSkillDomain::SKILL_STEP_LIST::iterator ss = m_advance_skill_id_vec.begin() + id - GRADE3_BUTTON1_ID + max(0, m_pC_grade3_scroll_bar->GetScrollPos());

			const ACTIONINFO SkillID = (ACTIONINFO)*ss;

			m_selected_ACSkillID		= SkillID;	// Dialog에서 필요하기 땜시

			const int domain_level		= (*g_pSkillManager)[m_skill_domain].GetDomainLevel();
			const int advance_level		= g_char_slot_ingame.m_AdvancementLevel;
			const int sum_level			= domain_level + advance_level;

			const int skill_learn_level = (*g_pSkillInfoTable)[SkillID].GetLearnLevel();

			MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus(SkillID);
			
			if(m_advance_skill_id_vec.size() > id - GRADE3_BUTTON1_ID)
			{
				if(MSkillDomain::SKILLSTATUS::SKILLSTATUS_LEARNED != status &&
				   skill_learn_level >= 0 && domain_level >= 150 && advance_level > 0 &&
				   skill_learn_level <= sum_level)
				{
					int dx = 0;
					int dy = 0;
					dx = m_pC_grade3_button_group->GetButton(id)->x+x;
					dy = m_pC_grade3_button_group->GetButton(id)->y+y+40;
					m_selected_grade_skill = SkillID;
					m_selected_skill_domain = m_skill_domain;
					DeleteNew(m_pC_learn_grade_skill_confirm);

					m_pC_learn_grade_skill_confirm = new C_VS_UI_DIALOG(-1, -1, 3, 0, ExecF_LearnAdvenceSkillConfirm, DIALOG_OK | DIALOG_CANCEL);

					// 뱀파이어는 승직 스킬을 선택할때 계열이 결정되기 때문에
					// 경고문구를 살벌하게 띄워준다.
					if(g_eRaceInterface == RACE_VAMPIRE && C_VS_UI_INFO::m_vampire_ACType == -1)
					{
						bool bWarrior	= (*g_pSkillInfoTable)[SkillID].GetSkillStep() == SKILL_STEP_VAMPIRE_WARRIOR_ADVANCEMENT;
						LPCSTR pACType	= bWarrior ?
							(*g_pGameStringTable)[UI_STRING_MESSAGE_ACVAMPIRE_WARRIOR_TYPE].GetString() :
							(*g_pGameStringTable)[UI_STRING_MESSAGE_ACVAMPIRE_MAGICIAN_TYPE].GetString();
							
						static char szBuf[128];
						sprintf(szBuf, (*g_pGameStringTable)[UI_STRING_MESSAGE_LEARN_SKILL_ACVAMPIRE].GetString(), pACType, pACType);	

						static char *ppmsg[] = { szBuf };

						m_pC_learn_grade_skill_confirm->SetMessage((char**)ppmsg, 1, SMO_FIT, 2);
						m_pC_learn_grade_skill_confirm->WH(400, 140);
						m_pC_learn_grade_skill_confirm->Start();	
					}
					else
					{
						static char * ppmsg[] = { (*g_pGameStringTable)[UI_STRING_MESSAGE_LEARN_SKILL].GetString() };
						m_pC_learn_grade_skill_confirm->SetMessage((char**)ppmsg,1,SMO_NOFIT);
						m_pC_learn_grade_skill_confirm->Start();
					}
				}
			}
		}
	}
	
	
	switch (id)
	{
	case CLOSE_ID:
		gpC_base->SendMessage(UI_INFO_CLOSE);
		break;
		
	case HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::INFO);
		EMPTY_MOVE;
		break;
		
	case ALPHA_ID:
		AttrAlpha(!GetAttributes()->alpha);
		gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::INFO, GetAttributes()->alpha);
		EMPTY_MOVE;
		break;
		
		//domain
	case BLADE_ID:
		m_skill_domain = SKILLDOMAIN_BLADE;
		m_iDomain = BLADE_ID;
		//			m_pC_skill_scroll_bar->SetPosMax((*g_pSkillManager)[SKILLDOMAIN_BLADE].GetSize()-7);
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[SKILLDOMAIN_BLADE].GetSkillStepList((SKILL_STEP)(SKILL_STEP_APPRENTICE)))->size()-7);
		break;
		
	case SWORD_ID:
		m_skill_domain = SKILLDOMAIN_SWORD;
		m_iDomain = SWORD_ID;
		//			m_pC_skill_scroll_bar->SetPosMax((*g_pSkillManager)[SKILLDOMAIN_SWORD].GetSize()-7);
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[m_skill_domain].GetSkillStepList((SKILL_STEP)(SKILL_STEP_APPRENTICE)))->size()-7);
		break;
		
	case GUN_ID:
		m_skill_domain = SKILLDOMAIN_GUN;
		m_iDomain = GUN_ID;
		//			m_pC_skill_scroll_bar->SetPosMax((*g_pSkillManager)[SKILLDOMAIN_GUN].GetSize()-7);
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[m_skill_domain].GetSkillStepList((SKILL_STEP)(SKILL_STEP_APPRENTICE)))->size()-7);
		break;
		
	case HEAL_ID:
		m_skill_domain = SKILLDOMAIN_HEAL;
		m_iDomain = HEAL_ID;
		//			m_pC_skill_scroll_bar->SetPosMax((*g_pSkillManager)[SKILLDOMAIN_HEAL].GetSize()-7);
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[m_skill_domain].GetSkillStepList((SKILL_STEP)(SKILL_STEP_APPRENTICE)))->size()-7);
		break;
		
	case ENCHANT_ID:
		m_skill_domain = SKILLDOMAIN_ENCHANT;
		m_iDomain = ENCHANT_ID;
		//			m_pC_skill_scroll_bar->SetPosMax((*g_pSkillManager)[SKILLDOMAIN_ENCHANT].GetSize()-7);
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[m_skill_domain].GetSkillStepList((SKILL_STEP)(SKILL_STEP_APPRENTICE)))->size()-7);
		break;
		
	case TOTAL_ID:
		m_iDomain = TOTAL_ID;
		break;
		
	case POISON_ID:
		m_skill_domain = SKILLDOMAIN_VAMPIRE;
		m_iDomain = POISON_ID;
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList((SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON)))->size()-7);
		break;
		
	case ACID_ID:
		m_skill_domain = SKILLDOMAIN_VAMPIRE;
		m_iDomain = ACID_ID;
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList((SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON)))->size()-7);
		break;
		
	case CURSE_ID:
		m_skill_domain = SKILLDOMAIN_VAMPIRE;
		m_iDomain = CURSE_ID;
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList((SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON)))->size()-7);
		break;
		
	case SUMMON_ID:
		m_skill_domain = SKILLDOMAIN_VAMPIRE;
		m_iDomain = SUMMON_ID;
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList((SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON)))->size()-7);
		break;
		
	case BLOOD_ID:
		m_skill_domain = SKILLDOMAIN_VAMPIRE;
		m_iDomain = BLOOD_ID;
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList((SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON)))->size()-7);
		break;
		
	case INNATE_ID:
		m_skill_domain = SKILLDOMAIN_VAMPIRE;
		m_iDomain = INNATE_ID;
		// etc 땜빵
		m_pC_skill_scroll_bar->SetPosMax(((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList((SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON)))->size()-7);
		break;
		
	case COMBAT_ID:
	case ELEMENTAL_ID:
		m_skill_domain = SKILLDOMAIN_OUSTERS;
		m_iDomain = id;

		if(m_iDomain >= COMBAT_ID && m_iDomain <= ELEMENTAL_ID && m_skill_domain == SKILLDOMAIN_OUSTERS)
		{
			int xMax = 0, yMax = 0;

			const int domain_level = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetDomainLevel();
			SKILL_STEP step = (SKILL_STEP)(m_iDomain-COMBAT_ID+SKILL_STEP_OUSTERS_COMBAT);
			if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
			{
				MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
				MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
				while(ss != list.end())
				{
					const ACTIONINFO SkillID = (ACTIONINFO)*ss;
					MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus(SkillID);
					const int sprID = (*g_pSkillInfoTable)[SkillID].GetSpriteID();
					const int sprX = (*g_pSkillInfoTable)[SkillID].GetX();
					const int sprY = (*g_pSkillInfoTable)[SkillID].GetY();

					xMax = max(sprX+60, xMax);
					yMax = max(sprY+60, yMax);

					ss++;
				}
			}
			m_pC_skill_scroll_bar->SetPosMax((yMax-206));
			m_pC_skill_scroll_bar_width->SetPosMax((xMax-263));
		}
		break;
		
		// Vampire Bonus Buttons
	case STR_PLUS_ID:
		gpC_base->SendMessage(UI_CLICK_BONUS_POINT, 0);
		break;
		
	case DEX_PLUS_ID:
		gpC_base->SendMessage(UI_CLICK_BONUS_POINT, 1);
		break;
		
	case INT_PLUS_ID:
		gpC_base->SendMessage(UI_CLICK_BONUS_POINT, 2);
		break;

		//Slayer GradeSkill
	case PIVATE_ID :
		//m_iGrade = PIVATE_ID;
		CheckGradeSkillIDList();
		break;
	case SERENT_ID :
		m_iGrade = SERENT_ID;
		CheckGradeSkillIDList();
		break;
	case FEACEL_ID :
		m_iGrade = FEACEL_ID;
		CheckGradeSkillIDList();
		break;
	case LITENA_ID :
		m_iGrade = LITENA_ID;
		CheckGradeSkillIDList();
		break;
	case KAINEL_ID :
		m_iGrade = KAINEL_ID;
		CheckGradeSkillIDList();
		break;

	case GENEAL_ID :
		m_iGrade = GENEAL_ID;
		CheckGradeSkillIDList();
		break;
	case FORE_GENEAL_ID :
		m_iGrade = FORE_GENEAL_ID;
		CheckGradeSkillIDList();
		break;
	case MAJORIS_GENEAL_ID :
		m_iGrade = MAJORIS_GENEAL_ID;
		CheckGradeSkillIDList();
		break;
	case CLOEL_GENEAL_ID :
		m_iGrade = CLOEL_GENEAL_ID;
		CheckGradeSkillIDList();
		break;
	case MARSHAL_ID :
		m_iGrade = MARSHAL_ID;
		CheckGradeSkillIDList();
		break;
		
		//Vampire GradeSkill
	case RITTER_ID :
		//m_iGrade = RITTER_ID;
		CheckGradeSkillIDList();
		break;
	case REICHSRITTER_ID :
		m_iGrade = REICHSRITTER_ID;
		CheckGradeSkillIDList();
		break;
	case BARONET_ID :
		m_iGrade = BARONET_ID;
		CheckGradeSkillIDList();
		break;
	case PREYHER_ID :
		m_iGrade = PREYHER_ID;
		CheckGradeSkillIDList();
		break;
	case GRAF_ID :
		m_iGrade = GRAF_ID;
		CheckGradeSkillIDList();
		break;
	case MARKGRAF_ID :
		m_iGrade = MARKGRAF_ID;
		CheckGradeSkillIDList();
		break;
	case PFALZGRAF_ID :
		m_iGrade = PFALZGRAF_ID;
		CheckGradeSkillIDList();
		break;
	case FURST_ID :
		m_iGrade = FURST_ID;
		CheckGradeSkillIDList();
		break;
	case HERZOG_ID :
		m_iGrade = HERZOG_ID;
		CheckGradeSkillIDList();
		break;
	case LANDESHER_ID :
		m_iGrade = LANDESHER_ID;
		CheckGradeSkillIDList();
		break;
		
		//Ousters GradeSkill
	case MALCHUT_ID :
		//m_iGrade = RITTER_ID;
		CheckGradeSkillIDList();
		break;
	case YESOD_ID :
		m_iGrade = YESOD_ID;
		CheckGradeSkillIDList();
		break;
	case HOD_ID :
		m_iGrade = HOD_ID;
		CheckGradeSkillIDList();
		break;
	case NETRETH_ID :
		m_iGrade = NETRETH_ID;
		CheckGradeSkillIDList();
		break;
	case TIPHRETH_ID :
		m_iGrade = TIPHRETH_ID;
		CheckGradeSkillIDList();
		break;
	case GEBURAH_ID :
		m_iGrade = GEBURAH_ID;
		CheckGradeSkillIDList();
		break;
	case CHESED_ID :
		m_iGrade = CHESED_ID;
		CheckGradeSkillIDList();
		break;
	case BINSH_ID :
		m_iGrade = BINSH_ID;
		CheckGradeSkillIDList();
		break;
	case CHOKMA_ID :
		m_iGrade = CHOKMA_ID;
		CheckGradeSkillIDList();
		break;
	case KEATHER_ID :
		m_iGrade = KEATHER_ID;
		CheckGradeSkillIDList();
		break;

	case CHANGE_IMAGE_ID:
		if( m_info_mode == CHARACTER_INFO_MODE )
			gC_vs_ui.RunFileDialog(C_VS_UI_FILE_DIALOG::MODE_PROFILE_SELECT, ".bmp;.jpg");
		break;

	case PET_INFO_ID:
		gC_vs_ui.RunPetInfo(m_pPetInfo);
		break;
	}
	EMPTY_MOVE;
}

bool	C_VS_UI_INFO::CharacterInfoMouseControl(UINT message, int _x, int _y)
{
	static char temp_str[3][100];
	static LPSTR str[3] = { 
		temp_str[0],
		temp_str[1],
		temp_str[2],
	};
	str[0] = temp_str[0];
	str[1] = temp_str[1];
	str[2] = temp_str[2];


	const char* info_vampire_title_string[8] =
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_STR].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DEX].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ACCURACY].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DAMAGE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AVOID].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DEFENCE].GetString(),
	};
	
	const char* info_slayer_title_string[8] =
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ACCURACY].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DAMAGE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AVOID].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DEFENCE].GetString(),
	};

	const char* info_ousters_title_string[9] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_STR].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DEX].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_INT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_EP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ACCURACY].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DAMAGE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AVOID].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DEFENCE].GetString(),
	};


	
				// GRADE
	const static char* slayer_grade[20] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PIVATE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_SERENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FEACEL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LITENA].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KAINEL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GENEAL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FORE_GENEAL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MAJORIS_GENEAL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CLOEL_GENEAL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARSHAL].GetString(),
		"의裂제좆",
		"괭裂제좆",
		"襟裂제좆",
		"빪裂제좆",
		"斤嵐裂제",
		"覩제寧뿐바",
		"累逃",
		"댕낵",
		"累낀",
		"悧잿",
	};
	
	
	const static char* vampire_grade[20] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_RITTER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_REICHSRITTER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BARONET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PREYHER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GRAF].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARKGRAF].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PFALZGRAF].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FURST].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HERZOG].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LANDESHER].GetString(),
		"랗된븜얽",
		"寧된븜얽",
		"쥴寮",
		"朞뒨븜",
		"무얽",
		"댕무얽",
		"항珙",
		"뇨엌",
		"沂뽈",
		"열힁",
	};

	const static char* ousters_grade[20] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MALCHUT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_YESOD].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HOD].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NETRETH].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_TIPHRETH].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GEBURAH].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHESED].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BINAH].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHOKMA].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KEATHER].GetString(),
		"첨景윗",
		"속겟죗",
		"윗爾랑",
		"벗쳄랑",
		"쵠瀁잇",
		"엥찝랑",
		"힉샘랑",
		"른샘랑",
		"윗폡랑",
		"첨檢景징",
	};
	

//	const static char* exp_bar_string[3]= 
//	{
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_CURRENT_EXP].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_NEXT_LEVEL].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_LEFT_EXP].GetString(),
//	};

	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
//		if(m_rt_char_box.x < _x && m_rt_char_box.x+55 > _x &&
//			m_rt_char_box.y < _y && m_rt_char_box.y+70 > _y)
//		{
//			wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_TIP_CHANGE_PICTURE_CLICK_HERE].GetString());
//			str[1]=NULL;
//			str[2]=NULL;
//			g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void *)str,1);						 
//		}
//		else
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
		if(_x > m_rt_char_box.x && _x < m_rt_char_box.x+125 && _y > 128+20*1 && _y < 128+20*4)	// exp
#else
		if(_x > m_rt_char_box.x && _x < m_rt_char_box.x+125 && _y > 128+20*0 && _y < 128+20*3)
#endif //__CONTRIBUTE_SYSTEM
		{
			bool bMax = false;
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
			int select = (_y-148)/20;
			bool bExp=(148+20*(select+1)-6)<_y;
#else
			int select = (_y-128)/20;
			bool bExp=(128+20*(select+1)-6)<_y;
#endif //__CONTRIBUTE_SYSTEM
			
			if(!bExp)
			{
				switch(select)
				{
				case 0 :
					wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_STR].GetString());
					wsprintf(temp_str[1],"%d/%d",g_char_slot_ingame.STR_CUR,g_char_slot_ingame.STR_MAX);
					break;
				case 1 :
					wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_DEX].GetString());
					wsprintf(temp_str[1],"%d/%d",g_char_slot_ingame.DEX_CUR,g_char_slot_ingame.DEX_MAX);
					break;
				case 2 :
					wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_INT].GetString());
					wsprintf(temp_str[1],"%d/%d",g_char_slot_ingame.INT_CUR,g_char_slot_ingame.INT_MAXX);
					break;
				}
				
				str[0]=temp_str[0];
				str[1]=NULL;
				str[2]=temp_str[1];
				
				g_descriptor_manager.Set(DID_HELP,x+_x,y+_y,(void*)str,0,0);
			} else
			{
//					strcpy(temp_str[j], exp_bar_string[j]);
				
				char temp[30];
				int num1, num2;

				num1 = *(&g_char_slot_ingame.STR_EXP_REMAIN + select);
					
				__int64 goal_exp = 0;
				switch(select)
				{
				case 0:	//STR
					goal_exp = g_pExperienceTable->GetSTRInfo(g_char_slot_ingame.STR_PURE).GoalExp;
					break;
				case 1:	//DEX
					goal_exp = g_pExperienceTable->GetDEXInfo(g_char_slot_ingame.DEX_PURE).GoalExp;
					break;
				case 2:	//INT
					goal_exp = g_pExperienceTable->GetINTInfo(g_char_slot_ingame.INT_PURE).GoalExp;
					break;
				}
				num2 = (goal_exp - *(&g_char_slot_ingame.STR_EXP_REMAIN + select))*100/max(1, (goal_exp));

				// 숫자사이에 ,넣기
				wsprintf(temp, "%d", num1);
				std::string sstr1 = temp;
				for(int i = 3; i <= 13; i += 4)
				{
					if(sstr1.size() > i)sstr1.insert(sstr1.size()-i, ",");
				}

				// 숫자사이에 ,넣기
				wsprintf(temp, "%d", num2);
				std::string sstr2 = temp;
				for(i = 3; i <= 13; i += 4)
				{
					if(sstr2.size() > i)sstr2.insert(sstr2.size()-i, ",");
				}

				sprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), sstr1.c_str(), sstr2.c_str());
//					strcat(temp_str[j], sstr.c_str());
					
				if(num1 < 0)bMax = true;	// 레벨업맥스
				
				if(bMax)
				{
					strcpy(temp_str[1], (*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_STAT].GetString());
					g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str, 2);
				}
				else
					g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str, 1);
			}
			
		}
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
		else if(_x > m_rt_char_box.x && _x < m_rt_char_box.x+120 && _y > 125+20*4 && _y < 125+20*10)
		{
			int num=(_y-145)/20-3;
#else
	
		else if(_x > m_rt_char_box.x && _x < m_rt_char_box.x+120 && _y > 125+20*3 && _y < 125+20*9)
		{
			int num=(_y-125)/20-3;
#endif //__CONTRIBUTE_SYSTEM
		
			
			switch(num)
			{
			case 0 : // 생명력
				wsprintf(temp_str[0],"%s",info_slayer_title_string[num]);
				wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.HP,g_char_slot_ingame.HP_MAX);
				break;
			case 1 : // 마법력
				wsprintf(temp_str[0],"%s",info_slayer_title_string[num]);
				wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.MP,g_char_slot_ingame.MP_MAX);
				break;
			case 2 : // 명중률
				wsprintf(temp_str[0],"%s",info_slayer_title_string[num]);
				wsprintf(temp_str[2],"%d",g_char_slot_ingame.TOHIT);
				break;
			case 3 : // 데미지
				{
					int dam1, dam2;
					dam1 = g_char_slot_ingame.DAM + g_char_slot_ingame.SILVER_DAM;
					dam2 = g_char_slot_ingame.DAM2 + g_char_slot_ingame.SILVER_DAM2;								
					wsprintf(temp_str[0],"%s",info_slayer_title_string[num]);								
					
					if(dam1==dam2)
						wsprintf(temp_str[2],"%d",dam1);
					else
						wsprintf(temp_str[2],"%d~%d",dam2,dam1);								
				}
				break;
			case 4 : //회피율
				wsprintf(temp_str[0],"%s",info_slayer_title_string[num]);
				wsprintf(temp_str[2],"%d",g_char_slot_ingame.DEFENSE);
				break;
			case 5 : // 방어율 
				wsprintf(temp_str[0],"%s",info_slayer_title_string[num]);
				wsprintf(temp_str[2],"%d",g_char_slot_ingame.PROTECTION);
				break;
			}
			str[0]=temp_str[0];
			str[1]=NULL;
			
			g_descriptor_manager.Set(DID_HELP,x+_x, y+_y, (void *)str,0);
		}
		else if(_y>23&&_y<83&&_x>190&&_x<250 && g_char_slot_ingame.m_AdvancementLevel>0)
		{
			int num = (_y-23)/20;
			
			str[0]=temp_str[0];
			str[1]=NULL;
			str[2]=temp_str[2];
			
			switch(num)
			{
			case 0 :
				sprintf(temp_str[0],"%s : %s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHINGHO].GetString(),GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel));
				str[2]=NULL;
				break;
			case 1 :
				{
					sprintf(temp_str[2],"%d",g_char_slot_ingame.FAME);
					std::string sstr;
					sstr=temp_str[2];
					for(int i = 3; i <= 13; i += 4)
						if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
						strcpy(temp_str[0],(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_FAME].GetString());
						strcpy(temp_str[2],sstr.c_str());
				}									
				break;
			case 2 :
				wsprintf(temp_str[0], "%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGNMENT].GetString());
				if(g_char_slot_ingame.alignment_num > 0)
				{
					wsprintf(temp_str[2], "(+%d)", g_char_slot_ingame.alignment_num);
				}
				else
				{
					wsprintf(temp_str[2], "(%d)", g_char_slot_ingame.alignment_num);
				}
				break;
			}
			if(str[0]!=NULL)
			{
				if(str[1]!=NULL)
					g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,2);
				else
				{
					if(str[2]!=NULL)
						g_descriptor_manager.Set(DID_HELP,x+_x,y+_y,(void*)str,0.0);
					else
						g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,1);
				}
			}
		}
		else if(_y>23&&_y<83&&_x>80&&_x<190)
		{
			int num = (_y-23)/20;
			
			str[0]=temp_str[0];
			str[1]=NULL;
			str[2]=temp_str[2];
			
			switch(num)
			{
			case 0 :
				sprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_NAME].GetString(),g_char_slot_ingame.sz_name.c_str());
				str[2]=NULL;
				break;
			case 1 :
				{
					sprintf(temp_str[2],"%d",g_char_slot_ingame.FAME);
					std::string sstr;
					sstr=temp_str[2];
					for(int i = 3; i <= 13; i += 4)
						if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
						strcpy(temp_str[0],(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_FAME].GetString());
						strcpy(temp_str[2],sstr.c_str());
				}									
				break;
			case 2 :
				wsprintf(temp_str[0], "%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGNMENT].GetString());
				if(g_char_slot_ingame.alignment_num > 0)
				{
					wsprintf(temp_str[2], "(+%d)", g_char_slot_ingame.alignment_num);
				}
				else
				{
					wsprintf(temp_str[2], "(%d)", g_char_slot_ingame.alignment_num);
				}
				break;
			}
			if(str[0]!=NULL)
			{
				if(str[1]!=NULL)
					g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,2);
				else
				{
					if(str[2]!=NULL)
						g_descriptor_manager.Set(DID_HELP,x+_x,y+_y,(void*)str,0.0);
					else
						g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,1);
				}
			}
		} 
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
		else if(_y>83&&_y<143&&_x>80&&_x<278)
#else
		else if(_y>83&&_y<123&&_x>80&&_x<278)

#endif //__CONTRIBUTE_SYSTEM
		{
			int num=(_y-83)/20;
			
			str[0]=temp_str[0];
			str[1]=NULL;
			str[2]=temp_str[2];

			if(!(g_char_slot_ingame.sz_guild_name.size()>0))
				num++;
		
			
			switch(num)
			{
			case 0 ://team
				if(	g_char_slot_ingame.sz_guild_name.size()>0)
				{
					wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_TEAM_NAME].GetString());
					strcat(temp_str[0],g_char_slot_ingame.sz_guild_name.c_str());
				}				
				str[2]=NULL;								
				break;
			case 1 ://grade
				if(g_char_slot_ingame.GRADE > 0 &&g_char_slot_ingame.GRADE <= GRADE_MARK_MAX)
				{
					// 계급 Description                   계급 이름, 계급 레벨 
					wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NAME].GetString(),slayer_grade[(g_char_slot_ingame.GRADE-1)/5]);
					wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LEVEL].GetString(),g_char_slot_ingame.GRADE);
					__int64 goal_exp = g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface).GoalExp;
					wsprintf(temp_str[2], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), g_GetNumberString(g_char_slot_ingame.GRADE_EXP_REMAIN).c_str(), g_GetNumberString((goal_exp - g_char_slot_ingame.GRADE_EXP_REMAIN)*100/max(1, (goal_exp))).c_str());
//					wsprintf(temp_str[2],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_GRADE_EXP].GetString(),g_char_slot_ingame.GRADE_EXP);
					str[1]=temp_str[1];											
					str[2]=temp_str[2];
				}
				else
					str[0]=NULL;
				break;
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
			case 2://기여도
				{
					str[2]=NULL;
					int contributeGrade = 7 - countContributeGrade(g_char_slot_ingame.ContributePoint);
					if (contributeGrade >= 0 || contributeGrade < 8)
					{
						wsprintf(temp_str[0],"%s : %d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CONTRIBUTE].GetString(),g_char_slot_ingame.ContributePoint);
						wsprintf(temp_str[1],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_SLAYER_CONTRIBUTENAME_7+contributeGrade].GetString());
						str[1]=temp_str[1];
					}
				}
				break;
#endif //__CONTRIBUTE_SYSTEM
			default :
				str[0]=NULL;
				break;
			}
			if(str[0]!=NULL)
			{
				if(str[1]!=NULL)
				{
					if(str[2]!=NULL)
						g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,3);
					else
						g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,2);
				}
				else
				{
					if(str[2]!=NULL)
						g_descriptor_manager.Set(DID_HELP,x+_x,y+_y,(void*)str,0.0);
					else
						g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,1);
				}
			}
		}
		break;

	case RACE_VAMPIRE:
//		if(m_rt_char_box.x < _x && m_rt_char_box.x+55 > _x &&
//			m_rt_char_box.y < _y && m_rt_char_box.y+70 > _y)
//		{
//			wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_TIP_CHANGE_PICTURE_CLICK_HERE].GetString());
//			str[1]=NULL;
//			str[2]=NULL;
//			g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void *)str,1);						 
//		} 
//		else
		if(_x > 74 && _x < 181 && _y > 15 && _y < 55)	// alignment
		{
			int num=(_y-20)/20;
			
			switch(num)
			{
			case 0 :			//name
				wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_NAME].GetString(),g_char_slot_ingame.sz_name.c_str());
				str[1]=NULL;
				str[2]=NULL;
				break;
			case 1 :			//ali
				wsprintf(temp_str[0], "%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGNMENT].GetString());
				if(g_char_slot_ingame.alignment_num > 0)
				{
					wsprintf(temp_str[2], "(+%d)", g_char_slot_ingame.alignment_num);
				}
				else
				{
					wsprintf(temp_str[2], "(%d)", g_char_slot_ingame.alignment_num);
				}
				str[1] = NULL;
				str[2]=temp_str[2];
				break;
			}						
			g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)str,0,0);
		}
		else if(_x > 187 && _x < 321 && _y > 36 && _y < 58)	// exp
		{
			int LeftExp = g_char_slot_ingame.EXP_REMAIN;//g_pExperienceTable->GetVampireInfo(g_char_slot_ingame.level).AccumExp - g_char_slot_ingame.EXP_CUR;
			
			if(LeftExp < 0)
			{
				wsprintf(temp_str[0], "%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL].GetString());
			}
			else
			{
				char szTemp[256] = {0,};
				std::string temp[2];

				wsprintf(szTemp,"%d", g_char_slot_ingame.EXP_REMAIN);
				temp[0] = szTemp;
				for(int i = 3; i <= 13; i += 4)
				{
					if(temp[0].size() > i)temp[0].insert(temp[0].size()-i, ",");
				}
				const __int64 goal_exp = g_pExperienceTable->GetVampireInfo(g_char_slot_ingame.level).GoalExp;
				wsprintf(szTemp,"%d", (goal_exp - g_char_slot_ingame.EXP_REMAIN)*100/max(1, (goal_exp)));
				temp[1] = szTemp;
				for(i = 3; i <= 13; i += 4)
					if(temp[1].size() > i)temp[1].insert(temp[1].size()-i, ",");
				wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), temp[0].c_str(), temp[1].c_str());
				int fame = g_pFameInfoTable->GetFameForLevel( SKILLDOMAIN_VAMPIRE, g_char_slot_ingame.level );

				if(g_char_slot_ingame.FAME < fame )
					wsprintf(temp_str[0], "%s(%s:%d)",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL_BY_FAME].GetString(), 
					(*g_pGameStringTable)[UI_STRING_MESSAGE_NEED_FAME].GetString(), 
					fame - g_char_slot_ingame.FAME );
			}
			g_descriptor_manager.Set(DID_INFO, x+_x, y+_y, (void *)temp_str[0],0,0);
		}
		else if(_x > 187 && _x < 264 && _y > 15 && _y < 35)	// level
		{
			if(g_char_slot_ingame.m_AdvancementLevel> 0) 
				wsprintf(temp_str[0],"%s : %s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHINGHO].GetString(),GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel));
			else
				wsprintf(temp_str[0],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_LEVEL].GetString(),g_char_slot_ingame.level);

			g_descriptor_manager.Set(DID_INFO, x+_x, y+_y, (void *)temp_str[0],0,0);
		}
		else if(_x > 79 && _y > 58 && _x < 249 && _y < 138)
		{
			int num=(_y-63)/20;
			str[2]=NULL;
			str[1]=NULL;

			if(!(g_char_slot_ingame.sz_guild_name.size()>0))
				num++;

			switch(num)
			{
			case 0 ://팀
				if(g_char_slot_ingame.sz_guild_name.size()>0)
					wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_CLAN_NAME].GetString(),g_char_slot_ingame.sz_guild_name.c_str());
				else
					wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_JOIN_ANY_CLAN].GetString());
				break;
			case 1 ://계급
				if(g_char_slot_ingame.GRADE > 0 &&g_char_slot_ingame.GRADE <= GRADE_MARK_MAX)
				{								
					wsprintf(temp_str[0],"%s : %s",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NAME].GetString(),vampire_grade[(g_char_slot_ingame.GRADE-1)/5]);
					wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LEVEL].GetString(),g_char_slot_ingame.GRADE);	
					__int64 goal_exp = g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface).GoalExp;
					wsprintf(temp_str[2], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), g_GetNumberString(g_char_slot_ingame.GRADE_EXP_REMAIN).c_str(), g_GetNumberString((goal_exp - g_char_slot_ingame.GRADE_EXP_REMAIN)*100/max(1, (goal_exp))).c_str());
					str[1]=temp_str[1];									
					str[2]=temp_str[2];
				}
				else
					str[0]=NULL;
				break;
			case 2 : // 명성
				wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_FAME].GetString());
				wsprintf(temp_str[1],"%d",g_char_slot_ingame.FAME);
				{
					std::string temp = temp_str[1];
					for(int i = 3; i <= 13; i += 4)
						if(temp.size() > i)temp.insert(temp.size()-i, ",");
					wsprintf(temp_str[1],"%s",temp.c_str() );
				}
				
				str[0] = temp_str[0];
				str[1] = NULL;
				str[2] = temp_str[1];
				break;
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
			case 3: // 기여도
			{
				int contributeGrade = 7 - countContributeGrade(g_char_slot_ingame.ContributePoint);
				if (contributeGrade >= 0 || contributeGrade < 8)
				{
					wsprintf(temp_str[0],"%s : %d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CONTRIBUTE].GetString(),g_char_slot_ingame.ContributePoint);
					wsprintf(temp_str[1],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_VAMPIRE_CONTRIBUTENAME_7+contributeGrade].GetString());
					str[1]=temp_str[1];
				}
				break;
			}
#endif //__CONTRIBUTE_SYSTEM
			default :
				str[0]=NULL;
				break;
			}
			if(str[0]!=NULL)
			{
				if(str[1]!=NULL)
				{
					if(str[2]!=NULL)
						g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,3);
					else
						g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,2);
				}
				else
				{
					if(str[2]!=NULL)
						g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)str,0,0);
					else
						g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,1);
				}
			}
		}
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
		if(_x > m_rt_char_box.x && _x < m_rt_char_box.x+125 && _y > 145 && _y < 145+20*8)
		{
			if(!((_y-145)/20 < 3 && _x > m_rt_char_box.x+35 && g_char_slot_ingame.bonus_point > 0))
			{
				int num=(_y-145)/20;
#else
		if(_x > m_rt_char_box.x && _x < m_rt_char_box.x+125 && _y > 125 && _y < 125+20*8)
		{
			if(!((_y-125)/20 < 3 && _x > m_rt_char_box.x+35 && g_char_slot_ingame.bonus_point > 0))
			{
				int num=(_y-125)/20;
#endif //__CONTRIBUTE_SYSTEM
				wsprintf(temp_str[0],info_vampire_title_string[num]);
				switch(num)
				{
				case 0 :
					wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.STR_CUR,g_char_slot_ingame.STR_MAX);
					break;
				case 1 :
					wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.DEX_CUR,g_char_slot_ingame.DEX_MAX);
					break;
				case 2 :
					wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.INT_CUR,g_char_slot_ingame.INT_MAXX);
					break;
				case 3 :
					wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.HP,g_char_slot_ingame.HP_MAX);
					break;
				case 4 :
					wsprintf(temp_str[2],"%d",g_char_slot_ingame.TOHIT);
					break;
				case 5 :
					{
						//damage
						int dam1, dam2;
						dam1 = g_char_slot_ingame.DAM + g_char_slot_ingame.SILVER_DAM;
						dam2 = g_char_slot_ingame.DAM2 + g_char_slot_ingame.SILVER_DAM2;
						if (dam1 == dam2)
							sprintf(temp_str[2], "%d", dam1);
						else
							sprintf(temp_str[2], "%d~%d", dam2, dam1);									
					}
					break;
				case 6 :
					wsprintf(temp_str[2],"%d",g_char_slot_ingame.DEFENSE);
					break;
				case 7 :
					wsprintf(temp_str[2],"%d",g_char_slot_ingame.PROTECTION);
					break;
				}				
				str[0]=temp_str[0];
				str[1]=NULL;
				str[2]=temp_str[2];
				g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)str,0);
			}
		}
		break;
		
	case RACE_OUSTERS:
		{
//			int fix_face_x = 2, fix_face_y = 10;
//			if( g_eRaceInterface != RACE_OUSTERS )
//			{
//				fix_face_x = 0;
//				fix_face_y = 0;
//			}
//			if(m_rt_char_box.x+fix_face_x < _x && m_rt_char_box.x+55+fix_face_x > _x &&
//				m_rt_char_box.y+fix_face_y < _y && m_rt_char_box.y+70+fix_face_y > _y)
//			{
//				wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_TIP_CHANGE_PICTURE_CLICK_HERE].GetString());
//				str[1]=NULL;
//				str[2]=NULL;
//				g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void *)str,1);						 
//			} 
// 			else 
			if(_x > 74 && _x < 181 && _y > 15 && _y < 55)	// alignment
			{
				int num=(_y-20)/20;
				
				switch(num)
				{
				case 0 :			//name
					wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_NAME].GetString(),g_char_slot_ingame.sz_name.c_str());
					str[1]=NULL;
					str[2]=NULL;
					break;
				case 1 :			//ali
					wsprintf(temp_str[0], "%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGNMENT].GetString());
					if(g_char_slot_ingame.alignment_num > 0)
					{
						wsprintf(temp_str[2], "(+%d)", g_char_slot_ingame.alignment_num);
					}
					else
					{
						wsprintf(temp_str[2], "(%d)", g_char_slot_ingame.alignment_num);
					}
					str[1] = NULL;
					str[2]=temp_str[2];
					break;
				}						
				g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)str,0,0);
			}
			else if(_x > 187 && _x < 321 && _y > 36 && _y < 58)	// exp
			{
				int LeftExp = g_char_slot_ingame.EXP_REMAIN;//g_pExperienceTable->GetVampireInfo(g_char_slot_ingame.level).AccumExp - g_char_slot_ingame.EXP_CUR;
				
				if(LeftExp < 0)
				{
					wsprintf(temp_str[0], "%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL].GetString());
				}
				else
				{
					char szTemp[256] = {0,};
					std::string temp[2];

					wsprintf(szTemp,"%d", g_char_slot_ingame.EXP_REMAIN);
					temp[0] = szTemp;
					for(int i = 3; i <= 13; i += 4)
					{
						if(temp[0].size() > i)temp[0].insert(temp[0].size()-i, ",");
					}
					const __int64 goal_exp = g_pExperienceTable->GetOustersInfo(g_char_slot_ingame.level).GoalExp;
					wsprintf(szTemp,"%d", (goal_exp - g_char_slot_ingame.EXP_REMAIN)*100/max(1, (goal_exp)));
					temp[1] = szTemp;
					for(i = 3; i <= 13; i += 4)
						if(temp[1].size() > i)temp[1].insert(temp[1].size()-i, ",");
					wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), temp[0].c_str(), temp[1].c_str());
					int fame = g_pFameInfoTable->GetFameForLevel( SKILLDOMAIN_OUSTERS, g_char_slot_ingame.level );

					if(g_char_slot_ingame.FAME < fame )
						wsprintf(temp_str[0], "%s(%s:%d)",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL_BY_FAME].GetString(), 
						(*g_pGameStringTable)[UI_STRING_MESSAGE_NEED_FAME].GetString(), 
						fame - g_char_slot_ingame.FAME );
				}
				g_descriptor_manager.Set(DID_INFO, x+_x, y+_y, (void *)temp_str[0],0,0);
			}
			else if(_x > 187 && _x < 264 && _y > 15 && _y < 35)	// level
			{
				if(g_char_slot_ingame.m_AdvancementLevel> 0) 
					wsprintf(temp_str[0],"%s : %s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHINGHO].GetString(),GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel));
				else
					wsprintf(temp_str[0],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_LEVEL].GetString(),g_char_slot_ingame.level);
				g_descriptor_manager.Set(DID_INFO, x+_x, y+_y, (void *)temp_str[0],0,0);
			}
			else if(_x > 79 && _y > 58 && _x < 249 && _y < 138)
			{
				int num=(_y-63)/20;
				str[2]=NULL;
				str[1]=NULL;
				if(!(g_char_slot_ingame.sz_guild_name.size()>0))
					num++;
				
				switch(num)
				{
				case 0 ://팀
					if(g_char_slot_ingame.sz_guild_name.size()>0)
						wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_CLAN_NAME].GetString(),g_char_slot_ingame.sz_guild_name.c_str());
					else
						wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_JOIN_ANY_CLAN].GetString());
					break;
				case 1 ://계급
					if(g_char_slot_ingame.GRADE > 0 &&g_char_slot_ingame.GRADE <= GRADE_MARK_MAX)
					{								
						wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NAME].GetString(),ousters_grade[(g_char_slot_ingame.GRADE-1)/5]);
						wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LEVEL].GetString(),g_char_slot_ingame.GRADE);	
					__int64 goal_exp = g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface).GoalExp;
					wsprintf(temp_str[2], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), g_GetNumberString(g_char_slot_ingame.GRADE_EXP_REMAIN).c_str(), g_GetNumberString((goal_exp - g_char_slot_ingame.GRADE_EXP_REMAIN)*100/max(1, (goal_exp))).c_str());
						str[1]=temp_str[1];									
						str[2]=temp_str[2];
					}
					else
						str[0]=NULL;
					break;
				case 2 : // 명성
					wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_FAME].GetString());
					wsprintf(temp_str[1],"%d",g_char_slot_ingame.FAME);
					{
						std::string temp = temp_str[1];
						for(int i = 3; i <= 13; i += 4)
							if(temp.size() > i)temp.insert(temp.size()-i, ",");
							wsprintf(temp_str[1],"%s",temp.c_str() );
					}
					
					str[0] = temp_str[0];
					str[1] = NULL;
					str[2] = temp_str[1];
					break;
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
				case 3: // 기여도
					{
						int contributeGrade = 7 - countContributeGrade(g_char_slot_ingame.ContributePoint);
						if (contributeGrade >= 0 || contributeGrade < 8)
						{
							wsprintf(temp_str[0],"%s : %d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CONTRIBUTE].GetString(),g_char_slot_ingame.ContributePoint);
							wsprintf(temp_str[1],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OUSTERS_CONTRIBUTENAME_7+contributeGrade].GetString());
							str[1]=temp_str[1];
						}
						break;
					}	
#endif //__CONTRIBUTE_SYSTEM
				default :
					str[0]=NULL;
					break;
				}
				if(str[0]!=NULL)
				{
					if(str[1]!=NULL)
					{
						if(str[2]!=NULL)
							g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,3);
						else
							g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,2);
					}
					else
					{
						if(str[2]!=NULL)
							g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)str,0,0);
						else
							g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,1);
					}
				}
			}
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
			if(_x > m_rt_char_box.x && _x < m_rt_char_box.x+125 && _y > 145 && _y < 145+20+20*8)
			{
				if(!((_y-145)/20 < 3 && _x > m_rt_char_box.x+35 && g_char_slot_ingame.bonus_point > 0))
				{
					int num=(_y-145)/20;
#else
			if(_x > m_rt_char_box.x && _x < m_rt_char_box.x+125 && _y > 125 && _y < 125+20+20*8)
			{
				if(!((_y-125)/20 < 3 && _x > m_rt_char_box.x+35 && g_char_slot_ingame.bonus_point > 0))
				{
					int num=(_y-125)/20;

#endif //__CONTRIBUTE_SYSTEM
					wsprintf(temp_str[0],info_ousters_title_string[num]);
					switch(num)
					{
					case 0 :
						wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.STR_CUR,g_char_slot_ingame.STR_MAX);
						break;
					case 1 :
						wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.DEX_CUR,g_char_slot_ingame.DEX_MAX);
						break;
					case 2 :
						wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.INT_CUR,g_char_slot_ingame.INT_MAXX);
						break;
					case 3 :
						wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.HP,g_char_slot_ingame.HP_MAX);
						break;
					case 5 :
						wsprintf(temp_str[2],"%d",g_char_slot_ingame.TOHIT);
						break;
					case 6 :
						{
							//damage
							int dam1, dam2;
							dam1 = g_char_slot_ingame.DAM + g_char_slot_ingame.SILVER_DAM;
							dam2 = g_char_slot_ingame.DAM2 + g_char_slot_ingame.SILVER_DAM2;
							if (dam1 == dam2)
								sprintf(temp_str[2], "%d", dam1);
							else
								sprintf(temp_str[2], "%d~%d", dam2, dam1);									
						}
						break;
					case 7 :
						wsprintf(temp_str[2],"%d",g_char_slot_ingame.DEFENSE);
						break;
					case 8 :
						wsprintf(temp_str[2],"%d",g_char_slot_ingame.PROTECTION);
						break;
					case 4 :
						wsprintf(temp_str[2],"%d/%d",g_char_slot_ingame.MP,g_char_slot_ingame.MP_MAX);
						break;
					}				
					str[0]=temp_str[0];
					str[1]=NULL;
					str[2]=temp_str[2];
					g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)str,0);
				}
			}
		}
		break;
	}	
	return true;
}


bool	C_VS_UI_INFO::SkillInfoMouseControl(UINT message, int _x, int _y)
{	
	static char temp_str[3][100];
	static LPSTR str[3] = { temp_str[0], temp_str[1], temp_str[2] };
	str[0] = temp_str[0];
	str[1] = temp_str[1];
	str[2] = temp_str[2];

	if(g_eRaceInterface == RACE_OUSTERS)
	{
		if(g_bLButtonDown == false)
		{
			m_CenterPos.x = -1;
		}
		else
		{
			if(m_CenterPos.x != -1)	// 가운데 버튼 누르고 스크롤
			{
				m_pC_skill_scroll_bar_width->SetScrollPos(m_pC_skill_scroll_bar_width->GetScrollPos()+m_CenterPos.x-_x);
				m_CenterPos.x = _x;
				m_pC_skill_scroll_bar->SetScrollPos(max(0,m_pC_skill_scroll_bar->GetScrollPos())+m_CenterPos.y-_y);
				m_CenterPos.y = _y;
			}
		}
	}

	if(!
			(
				(g_eRaceInterface == RACE_VAMPIRE && m_iDomain >=POISON_ID && m_iDomain <= INNATE_ID && m_pC_skill_scroll_bar->GetScrollPos() >= 0 && m_skill_domain == SKILLDOMAIN_VAMPIRE) || 
				(g_eRaceInterface == RACE_SLAYER && m_iDomain >=BLADE_ID && m_iDomain <= ENCHANT_ID && m_pC_skill_scroll_bar->GetScrollPos() >= 0 && (m_skill_domain == SKILLDOMAIN_SWORD || m_skill_domain == SKILLDOMAIN_BLADE || m_skill_domain == SKILLDOMAIN_GUN || m_skill_domain == SKILLDOMAIN_HEAL || m_skill_domain == SKILLDOMAIN_ENCHANT)) ||
				(g_eRaceInterface == RACE_OUSTERS && m_iDomain >=COMBAT_ID && m_iDomain <= ELEMENTAL_ID && m_pC_skill_scroll_bar->GetScrollPos() >= 0 && m_skill_domain == SKILLDOMAIN_OUSTERS)
			)
		)
		return false;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			if(m_info_mode != GRADE3_INFO_MODE)
			{
				if(_x > 24 && _x < 292 && _y > 72 && _y < 84)			//Domain Level
				{
					static char temp_string[100];
					static char* leveldesc[1]={ temp_string};
					
					switch(m_iDomain)
					{
					case BLADE_ID :
						wsprintf(temp_string,"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_BLADE_LEVEL].GetString(),(*g_pSkillManager)[m_iDomain-BLADE_ID].GetDomainLevel());
						break;
					case SWORD_ID :
						wsprintf(temp_string,"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_SWORD_LEVEL].GetString(),(*g_pSkillManager)[m_iDomain-BLADE_ID].GetDomainLevel());
						break;
					case ENCHANT_ID :
						wsprintf(temp_string,"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_ENCHANT_LEVEL].GetString(),(*g_pSkillManager)[m_iDomain-BLADE_ID].GetDomainLevel());
						break;
					case HEAL_ID :
						wsprintf(temp_string,"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_HEAL_LEVEL].GetString(),(*g_pSkillManager)[m_iDomain-BLADE_ID].GetDomainLevel());
						break;
					case GUN_ID :
						wsprintf(temp_string,"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_GUN_LEVEL].GetString(),(*g_pSkillManager)[m_iDomain-BLADE_ID].GetDomainLevel());
						break;
					}						
					g_descriptor_manager.Set(DID_STRINGS, x+_x+24, y+_y+86, (void *)leveldesc, 1);
				}
				if(_x > 24 && _x < 292 && _y > 90 && _y < 104)	// domain exp
				{
					if(g_pSkillManager)
					{
						int level = (*g_pSkillManager)[m_skill_domain].GetDomainLevel();
						int exp_remain = (*g_pSkillManager)[m_skill_domain].GetDomainExpRemain();
						
						if(level >= 0 && exp_remain >= 0)
						{
							char sz_temp[100];
							std::string sstr;
							int i;
							
							//						int next_exp = (*g_pSkillManager)[m_skill_domain].GetExpInfo(level).AccumExp;
							
							// 숫자사이에 ,넣기
							wsprintf(sz_temp, "%d", exp_remain);
							sstr = sz_temp;
							for(i = 3; i <= 13; i += 4)
								if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
								
								const __int64 goal_exp = (*g_pSkillManager)[m_skill_domain].GetExpInfo(level).GoalExp;
								wsprintf(sz_temp, "%d", (goal_exp - exp_remain)*100/max(1, (goal_exp)));
								std::string sstr2 = sz_temp;
								for(i = 3; i <= 13; i += 4)
									if(sstr2.size() > i)sstr2.insert(sstr2.size()-i, ",");
									
									wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), sstr.c_str(), sstr2.c_str());
									
									int fame = g_pFameInfoTable->GetFameForLevel( (SKILLDOMAIN) m_skill_domain, level );
									
									if( g_char_slot_ingame.FAME < fame )
									{
										wsprintf(temp_str[2], "%s(%s:%d)",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL_BY_FAME].GetString(),
											(*g_pGameStringTable)[UI_STRING_MESSAGE_NEED_FAME].GetString(), fame - g_char_slot_ingame.FAME );
									}
									
									g_descriptor_manager.Set(DID_STRINGS, x+_x+24, y+_y+86, (void *)str, 1);//3);
						}
					}
				}
				// skill desc
				else if(_x >= m_rcSkillDesciption.left-19 && _y >= m_rcSkillDesciption.top && _x < m_rcSkillDesciption.right && _y < m_rcSkillDesciption.bottom)
				{
					const SKILL_STEP step = (SKILL_STEP)(SKILL_STEP_APPRENTICE);
					
					if(g_pSkillManager && (*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))
					{
						const int num = (_y - m_rcSkillDesciption.top)/19+max(0,m_pC_skill_scroll_bar->GetScrollPos());
						
						if(num >= (*((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step))).size())return false;
						
						const int id = ( *( (*g_pSkillManager)[m_skill_domain].GetSkillStepList( step ) ) )[num];
						
						g_descriptor_manager.Set(DID_SKILLTREE, x+_x, y+_y, (void *)&m_skill_domain, id, 0);
						m_focused_skill_id = id;
					}
				}
			}
			// 전직스킬설명 
			/*
			if(_x >= m_rcSkillDesciption.left-19 && _y >= m_rcSkillDesciption.top-20 && _x < m_rcSkillDesciption.right-200 && _y < m_rcSkillDesciption.bottom && m_info_mode == GRADE3_INFO_MODE)
			{
				const SKILL_STEP step = (SKILL_STEP)(SKILL_STEP_SLAYER_BLADE_ADVANCEMENT + m_skill_domain);
				
				if(g_pSkillManager && (*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))
				{
					const int num = (_y - m_rcSkillDesciption.top)/40+max(0,m_pC_grade3_scroll_bar->GetScrollPos());
					
					if(num >= (*((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step))).size())return false;
					
					const int id = ( *( (*g_pSkillManager)[m_skill_domain].GetSkillStepList( step ) ) )[num];
					
					g_descriptor_manager.Set(DID_SKILLTREE, x+_x, y+_y, (void *)&m_skill_domain, id, 0);
					m_focused_skill_id = id;
				}
			}

			if(_x >= m_rcSkillDesciption.left+10 && _y >= m_rcSkillDesciption.top-20 && _x < m_rcSkillDesciption.right && _y < m_rcSkillDesciption.bottom && m_info_mode == GRADE3_INFO_MODE)
			{
				const SKILL_STEP step = (SKILL_STEP)(SKILL_STEP_SLAYER_BLADE_ADVANCEMENT + m_skill_domain);
				
				if(g_pSkillManager && (*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))
				{
					const int num = (_y - m_rcSkillDesciption.top)/40+max(0,m_pC_grade3_scroll_bar->GetScrollPos());
					
					if(num >= (*((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step))).size())return false;
					
					const int id = ( *( (*g_pSkillManager)[m_skill_domain].GetSkillStepList( step ) ) )[num];
					
					g_descriptor_manager.Set(DID_SKILLTREE, x+_x, y+_y, (void *)&m_skill_domain, id, 0);
					m_focused_skill_id = id;
				}
			}
			*/
		}
		break;
		
	case RACE_VAMPIRE:
		{
			const SKILL_STEP step = (SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON);

			/*
						// 전직스킬설명 
			//if(_x >= m_rcSkillDesciption.left-19 && _y >= m_rcSkillDesciption.top&& _x < m_rcSkillDesciption.right-200 && _y < m_rcSkillDesciption.bottom +45 && m_info_mode == GRADE3_INFO_MODE)
			//if(_x >= m_rcSkillDesciption.left-19 && _y >= m_rcSkillDesciption.top+25 && _x < m_rcSkillDesciption.right-200 && _y < m_rcSkillDesciption.bottom && m_info_mode == GRADE3_INFO_MODE)
			if(_x >= m_rcSkillDesciption.left-19 && _y >= m_rcSkillDesciption.top+40 && _x < m_rcSkillDesciption.right-200 && _y < m_rcSkillDesciption.bottom+80 && m_info_mode == GRADE3_INFO_MODE)
			{
				const int domain_level = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetDomainLevel();
				SKILL_STEP step = (SKILL_STEP)(SKILL_STEP_VAMPIRE_ADVANCEMENT);

				if(g_pSkillManager && (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
				{
					//const int num = (_y-m_rcSkillDesciption.top)/40;//+max(0,m_pC_skill_scroll_bar->GetScrollPos());
					//const int num = (_y - m_rcSkillDesciption.top-45)/40+max(0,m_pC_grade3_scroll_bar->GetScrollPos());
					const int num = ((_y - m_rcSkillDesciption.top) - 40)/55+max(0,m_pC_grade3_scroll_bar->GetScrollPos());
					if(num >= (*((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step))).size())return false;
					
					const int id = ( *( (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList( step ) ) )[num];
					
					g_descriptor_manager.Set(DID_SKILLTREE, x+_x, y+_y, (void *)&m_skill_domain, id, 0);
					m_focused_skill_id = id;
				} 
			}

			if(_x >= m_rcSkillDesciption.left+10 && _y >= m_rcSkillDesciption.top+40 && _x < m_rcSkillDesciption.right && _y < m_rcSkillDesciption.bottom+80 && m_info_mode == GRADE3_INFO_MODE)
			{
				SKILL_STEP step = (SKILL_STEP)(SKILL_STEP_VAMPIRE_ADVANCEMENT);
				
				if(g_pSkillManager && (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
				{
					const int num = ((_y - m_rcSkillDesciption.top) - 40)/55+max(0,m_pC_grade3_scroll_bar->GetScrollPos());
					if(num >= (*((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step))).size())return false;
					
					const int id = ( *( (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList( step ) ) )[num];
					
					g_descriptor_manager.Set(DID_SKILLTREE, x+_x, y+_y, (void *)&m_skill_domain, id, 0);
					m_focused_skill_id = id;
				}
			}
			*/

			
			if(g_pSkillManager && (*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step) && m_info_mode != GRADE3_INFO_MODE)
			{
				if(_x >= m_rcSkillDesciption.left-19 && _y >= m_rcSkillDesciption.top && _x < m_rcSkillDesciption.right && _y < m_rcSkillDesciption.bottom)
				{
					const int num = (_y - m_rcSkillDesciption.top)/19+max(0,m_pC_skill_scroll_bar->GetScrollPos());
					
					if(num >= (*((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step))).size())
						return false;
					
					const int id = ( *( (*g_pSkillManager)[m_skill_domain].GetSkillStepList( step ) ) )[num];
					
					g_descriptor_manager.Set(DID_SKILLTREE, x+_x, y+_y, (void *)&m_skill_domain, id, 0);
					m_focused_skill_id = id;
				}
			}


		}
		break;
		
	case RACE_OUSTERS:
		{
			SKILL_STEP step = (SKILL_STEP)(m_iDomain-COMBAT_ID+SKILL_STEP_OUSTERS_COMBAT);
			bool bCombat = (step == SKILL_STEP_OUSTERS_COMBAT);

			if(g_pSkillManager && (*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step) && m_info_mode != GRADE3_INFO_MODE)
			{
				if(_x >= m_rcSkillDesciption.left && _y >= m_rcSkillDesciption.top && _x < m_rcSkillDesciption.left+m_rcSkillDesciption.right && _y < m_rcSkillDesciption.top+m_rcSkillDesciption.bottom)
				{
					MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
					MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
					
					int iconHalf = 18;
					
					int id = -1;

					while(ss != list.end())
					{
						const ACTIONINFO SkillID = (ACTIONINFO)*ss;
						const int sprX = (*g_pSkillInfoTable)[SkillID].GetX();
						const int sprY = (*g_pSkillInfoTable)[SkillID].GetY();
						if(sprX == 0 && sprY == 0)
						{
							ss++;
							continue;
						}
						
						POINT p = {m_rcSkillDesciption.left+sprX, m_rcSkillDesciption.top+sprY};
						p.x -= m_pC_skill_scroll_bar_width->GetScrollPos();
						p.y -= max(0,m_pC_skill_scroll_bar->GetScrollPos());

						if(_x >= p.x && _x <= p.x+36 && _y >= p.y && _y <= p.y+36)
						{
							id = SkillID;
							break;
						}
						
						ss++;
					}	
					
					if(id != -1)
						g_descriptor_manager.Set(DID_SKILLTREE, x+_x, y+_y, (void *)&m_skill_domain, id, 0);
					m_focused_skill_id = id;
				}
			}

			if(m_focused_skill_id == -1 && m_info_mode != GRADE3_INFO_MODE)
			{
				step = SKILL_STEP_OUSTERS_ETC;
				if(g_pSkillManager && (*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))
				{
					if(_x >= m_rcSkillDesciption.left && _y >= m_rcSkillDesciption.top && _x < m_rcSkillDesciption.left+m_rcSkillDesciption.right && _y < m_rcSkillDesciption.top+m_rcSkillDesciption.bottom)
					{
						MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
						MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
						
						int iconHalf = 18;
						
						int id = -1;
						
						while(ss != list.end())
						{
							const ACTIONINFO SkillID = (ACTIONINFO)*ss;
							int sprX = (*g_pSkillInfoTable)[SkillID].GetX();
							int sprY = (*g_pSkillInfoTable)[SkillID].GetY();
							if(sprX == 0 && sprY == 0)
							{
								ss++;
								continue;
							}

							if(bCombat)
							{
								sprX = LOWORD(sprX);
								sprY = LOWORD(sprY);
							}
							else
							{
								sprX = HIWORD(sprX);
								sprY = HIWORD(sprY);
							}
							
							POINT p = {m_rcSkillDesciption.left+sprX, m_rcSkillDesciption.top+sprY};
							p.x -= m_pC_skill_scroll_bar_width->GetScrollPos();
							p.y -= max(0,m_pC_skill_scroll_bar->GetScrollPos());
							
							if(_x >= p.x && _x <= p.x+36 && _y >= p.y && _y <= p.y+36)
							{
								id = SkillID;
								break;
							}
							
							ss++;
						}	
						
						if(id != -1)
							g_descriptor_manager.Set(DID_SKILLTREE, x+_x, y+_y, (void *)&m_skill_domain, id, 0);
						m_focused_skill_id = id;
					}
				}
			}
			/*
			//by csm 전직스킬용 
			if(_x >= m_rcSkillDesciption.left-19 && _y >= m_rcSkillDesciption.top+40 && _x < m_rcSkillDesciption.right-200 && _y < m_rcSkillDesciption.bottom+80 && m_info_mode == GRADE3_INFO_MODE)
			{
				int num = ((_y - m_rcSkillDesciption.top) - 40)/60+max(0,m_pC_grade3_scroll_bar->GetScrollPos());
				SKILL_STEP step;
				if(m_ousters_Magic != -1)
					step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT+m_ousters_Magic);
				else
					step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT+num);
				
				if(g_pSkillManager && (*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))
				{
					if(m_ousters_Magic != -1)
					{
						if(num >= (*((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step))).size())return false;
					}
					else
					{
						if(num >= 4)return false;
					}
					
					if(m_ousters_Magic == -1)
						num = 0;
					const int id = ( *( (*g_pSkillManager)[m_skill_domain].GetSkillStepList( step ) ) )[num];
					
					g_descriptor_manager.Set(DID_SKILLTREE, x+_x, y+_y, (void *)&m_skill_domain, id, 0);
					m_focused_skill_id = id;
				}
			}
			*/
		}
		break;
	}


	// 종족 통합 승직 스킬 풍선 도움말 by chyaya
	if(m_info_mode == GRADE3_INFO_MODE)
	{
		RECT rcACSkillDesc = m_rcSkillDesciption;

		// 종족별로 다른 위치
		// 이것도 통합해야 하지만 시간 관계상 T-T 흑흑
		switch(g_eRaceInterface) {
		case RACE_SLAYER:
			rcACSkillDesc.left		-= 9;
			rcACSkillDesc.top		-= 20;
			rcACSkillDesc.bottom	+= 8;
			break;
		case RACE_VAMPIRE:
			rcACSkillDesc.left		-= 20;
			rcACSkillDesc.top		+= 25;
			rcACSkillDesc.right		-= 5;
			rcACSkillDesc.bottom	+= 52;
			break;
		case RACE_OUSTERS:
//			rcACSkillDesc.left		-= 19;
			rcACSkillDesc.top		+= 40;
			rcACSkillDesc.right		+= 25;
			rcACSkillDesc.bottom	+= 80;
			break;
		}


		if(_x >= rcACSkillDesc.left	&& _y >= rcACSkillDesc.top	&&
		   _x < rcACSkillDesc.right	&& _y < rcACSkillDesc.bottom)
		{
			if(!m_advance_skill_id_vec.empty())
			{
				int num = (_y - rcACSkillDesc.top) / 60;
				num += max(0, m_pC_grade3_scroll_bar->GetScrollPos());
				
				if(num >= m_advance_skill_id_vec.size()) return false;
				
				const int id = m_advance_skill_id_vec[num];
				
				g_descriptor_manager.Set(DID_SKILLTREE, x + _x, y + _y, (void *)&m_skill_domain, id, 0);
				m_focused_skill_id = id;
			}
		}
	}
				
	return true;
}


bool	C_VS_UI_INFO::RareSkillInfoMouseControl(UINT message, int _x, int _y)
{

	SKILL_STEP nRareSkillStep;
	static SKILLDOMAIN skillDomain = m_skill_domain;

	// 종족에 맞는 그림 모양을 선택한다.
	switch(g_eRaceInterface)
	{
	case RACE_VAMPIRE:
		nRareSkillStep						= SKILL_STEP_VAMPIRE_RARE;
		break;
	case RACE_OUSTERS:
		nRareSkillStep						= SKILL_STEP_OUSTERS_RARE;
		break;
//	case RACE_SLAYER:	
	default: // 기본값으로 슬레이어 혹시 모르니 -ㅅ-)
		nRareSkillStep						= SKILL_STEP_SLAYER_RARE;
		skillDomain							= SKILLDOMAIN_ETC;
		break;
	}

	CPoint	mousePoint(_x, _y);
	CRect	skillDescRect(CPoint(30, 53), CSize(262, 240));
	
	if(skillDescRect.PtInRect(mousePoint))
	{
		if(!m_rare_skill_id_vec.empty())
		{
			int num = (_y - skillDescRect.top) / 60;
			num += max(0, m_pC_rare_skill_scroll_bar->GetScrollPos());
			
			if(num >= m_rare_skill_id_vec.size()) return false;
			
			const int id = m_rare_skill_id_vec[num];
			
			g_descriptor_manager.Set(DID_SKILLTREE, x + _x, y + _y, (void *)&skillDomain, id, 0);
			m_focused_skill_id = id;
		}
	}


	return true;
}



//-----------------------------------------------------------------------------
// MouseControl
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_INFO::MouseControl(UINT message, int _x, int _y)
{
	static const char scancode_name[256][20] = 
	{
		"",						// 0x00
		"ESCAPE",				// 0x01
		"1",					// 0x02
		"2",					// 0x03
		"3",					// 0x04
		"4",					// 0x05
		"5",					// 0x06
		"6",					// 0x07
		"7",					// 0x08
		"8",					// 0x09
		"9",					// 0x0A
		"0",					// 0x0B
		"MINUS",				// 0x0C
		"EQUALS",				// 0x0D
		"BACK",					// 0x0E
		"TAB",					// 0x0F
		"Q",					// 0x10
		"W",					// 0x11
		"E",					// 0x12
		"R",					// 0x13
		"T",					// 0x14
		"Y",					// 0x15
		"U",					// 0x16
		"I",					// 0x17
		"O",					// 0x18
		"P",					// 0x19
		"LBRACKET",				// 0x1A
		"RBRACKET",				// 0x1B
		"RETURN",				// 0x1C
		"LCONTROL",				// 0x1D
		"A",					// 0x1E
		"S",					// 0x1F
		"D",					// 0x20
		"F",					// 0x21
		"G",					// 0x22
		"H",					// 0x23
		"J",					// 0x24
		"K",					// 0x25
		"L",					// 0x26
		":",					// 0x27
		"'",					// 0x28
		"~",					// 0x29
		"LSHIFT",				// 0x2A
		"BACKSLASH",			// 0x2B
		"Z",					// 0x2C
		"X",					// 0x2D
		"C",					// 0x2E
		"V",					// 0x2F
		"B",					// 0x30
		"N",					// 0x31
		"M",					// 0x32
		"COMMA",				// 0x33
		"PERIOD",				// 0x34
		"SLASH",				// 0x35
		"RSHIFT",				// 0x36
		"MULTIPLY",				// 0x37
		"LMENU",				// 0x38
		"SPACE",				// 0x39
		"CAPITAL",				// 0x3A
		"F1",					// 0x3B
		"F2",					// 0x3C
		"F3",					// 0x3D
		"F4",					// 0x3E
		"F5",					// 0x3F
		"F6",					// 0x40
		"F7",					// 0x41
		"F8",					// 0x42
		"F9",					// 0x43
		"F10",					// 0x44
		"NUMLOCK",				// 0x45
		"SCROLL",				// 0x46
		"NUMPAD7",				// 0x47
		"NUMPAD8",				// 0x48
		"NUMPAD9",				// 0x49
		"SUBTRACT",				// 0x4A
		"NUMPAD4",				// 0x4B
		"NUMPAD5",				// 0x4C
		"NUMPAD6",				// 0x4D
		"ADD",					// 0x4E
		"NUMPAD1",				// 0x4F
		"NUMPAD2",				// 0x50
		"NUMPAD3",				// 0x51
		"NUMPAD0",				// 0x52
		"DECIMAL",				// 0x53
		"",						// 0x54
		"",						// 0x55
		"",						// 0x56
		"F11",					// 0x57
		"F12",					// 0x58
		"",						// 0x59
		"",						// 0x5A
		"",						// 0x5B
		"",						// 0x5C
		"",						// 0x5D
		"",						// 0x5E
		"",						// 0x5F
		"",						// 0x60
		"",						// 0x61
		"",						// 0x62
		"",						// 0x63
		"F13",					// 0x64
		"F14",					// 0x65
		"F15",					// 0x66
		"",						// 0x67
		"",						// 0x68
		"",						// 0x69
		"",						// 0x6A
		"",						// 0x6B
		"",						// 0x6C
		"",						// 0x6D
		"",						// 0x6E
		"",						// 0x6F
		"KANA",					// 0x70
		"",						// 0x71
		"",						// 0x72
		"",						// 0x73
		"",						// 0x74
		"",						// 0x75
		"",						// 0x76
		"",						// 0x77
		"",						// 0x78
		"CONVERT",				// 0x79
		"",						// 0x7A
		"NOCONVERT",			// 0x7B
		"",						// 0x7C
		"YEN",					// 0x7D
		"",						// 0x7E
		"",						// 0x7F
		"",						// 0x80
		"",						// 0x81
		"",						// 0x82
		"",						// 0x83
		"",						// 0x84
		"",						// 0x85
		"",						// 0x86
		"",						// 0x87
		"",						// 0x88
		"",						// 0x89
		"",						// 0x8A
		"",						// 0x8B
		"",						// 0x8C
		"NUMPADEQUALS",			// 0x8D
		"",						// 0x8E
		"",						// 0x8F
		"CIRCUMFLEX",			// 0x90
		"AT",					// 0x91
		"COLON",				// 0x92
		"UNDERLINE",			// 0x93
		"KANJI",				// 0x94
		"STOP",					// 0x95
		"AX",					// 0x96
		"UNLABELED",			// 0x97
		"",						// 0x98
		"",						// 0x99
		"",						// 0x9A
		"",						// 0x9B
		"NUMPADENTER",			// 0x9C
		"RCONTROL",				// 0x9D
		"",						// 0x9E
		"",						// 0x9F
		"",						// 0xA0
		"",						// 0xA1
		"",						// 0xA2
		"",						// 0xA3
		"",						// 0xA4
		"",						// 0xA5
		"",						// 0xA6
		"",						// 0xA7
		"",						// 0xA8
		"",						// 0xA9
		"",						// 0xAA
		"",						// 0xAB
		"",						// 0xAC
		"",						// 0xAD
		"",						// 0xAE
		"",						// 0xAF
		"",						// 0xB0
		"",						// 0xB1
		"",						// 0xB2
		"NUMPADCOMMA",			// 0xB3
		"",						// 0xB4
		"DIVIDE",				// 0xB5
		"",						// 0xB6
		"SYSRQ",				// 0xB7
		"RMENU",				// 0xB8
		"",						// 0xB9
		"",						// 0xBA
		"",						// 0xBB
		"",						// 0xBC
		"",						// 0xBD
		"",						// 0xBE
		"",						// 0xBF
		"",						// 0xC0
		"",						// 0xC1
		"",						// 0xC2
		"",						// 0xC3
		"",						// 0xC4
		"PAUSE",				// 0xC5
		"",						// 0xC6
		"HOME",					// 0xC7
		"UP",					// 0xC8
		"PRIOR",				// 0xC9
		"",						// 0xCA
		"LEFT",					// 0xCB
		"",						// 0xCC
		"RIGHT",				// 0xCD
		"",						// 0xCE
		"END",					// 0xCF
		"DOWN",					// 0xD0
		"NEXT",					// 0xD1
		"INSERT",				// 0xD2
		"DELETE",				// 0xD3
		"",						// 0xD4
		"",						// 0xD5
		"",						// 0xD6
		"",						// 0xD7
		"",						// 0xD8
		"",						// 0xD9
		"",						// 0xDA
		"LWIN",					// 0xDB
		"RWIN",					// 0xDC
		"APPS",					// 0xDD
		"POWER",				// 0xDE
		"SLEEP",				// 0xDF
		"",						// 0xE0
		"",						// 0xE1
		"",						// 0xE2
		"",						// 0xE3
		"",						// 0xE4
		"",						// 0xE5
		"",						// 0xE6
		"",						// 0xE7
		"",						// 0xE8
		"",						// 0xE9
		"",						// 0xEA
		"",						// 0xEB
		"",						// 0xEC
		"",						// 0xED
		"",						// 0xEE
		"",						// 0xEF
		"",						// 0xF0
		"",						// 0xF1
		"",						// 0xF2
		"",						// 0xF3
		"",						// 0xF4
		"",						// 0xF5
		"",						// 0xF6
		"",						// 0xF7
		"",						// 0xF8
		"",						// 0xF9
		"",						// 0xFA
		"",						// 0xFB
		"",						// 0xFC
		"",						// 0xFD
		"",						// 0xFE
		"",						// 0xFF
	};
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;


	const char* m_info_string[7] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_CHARACTER_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_SKILL_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_MAGIC_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_GRADE1_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_GRADE2_INFO_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ADVANTE_INFO_WINODW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_RARE_SKILL_INFO_WINDOW].GetString(),
	};
				// GRADE
	const static char* slayer_grade[20] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PIVATE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_SERENT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FEACEL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LITENA].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KAINEL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GENEAL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FORE_GENEAL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MAJORIS_GENEAL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CLOEL_GENEAL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARSHAL].GetString(),
		"의裂제좆",
		"괭裂제좆",
		"襟裂제좆",
		"빪裂제좆",
		"斤嵐裂제",
		"覩제寧뿐바",
		"累逃",
		"댕낵",
		"累낀",
		"悧잿",
	};
	
	
	const static char* vampire_grade[20] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_RITTER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_REICHSRITTER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BARONET].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PREYHER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GRAF].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARKGRAF].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PFALZGRAF].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FURST].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HERZOG].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LANDESHER].GetString(),
		"랗된븜얽",
		"寧된븜얽",
		"쥴寮",
		"朞뒨븜",
		"무얽",
		"댕무얽",
		"항珙",
		"뇨엌",
		"沂뽈",
		"열힁",
	};

	const static char* ousters_grade[20] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MALCHUT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_YESOD].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HOD].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NETRETH].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_TIPHRETH].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GEBURAH].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHESED].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BINAH].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHOKMA].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KEATHER].GetString(),
		"첨景윗",
		"속겟죗",
		"윗爾랑",
		"벗쳄랑",
		"쵠瀁잇",
		"엥찝랑",
		"힉샘랑",
		"른샘랑",
		"윗폡랑",
		"첨檢景징",
	};

	const C_VS_UI_EVENT_BUTTON *p_button = m_pC_common_button_group->GetButton( CHANGE_IMAGE_ID );
	
	bool re = true;
	if( p_button != NULL && p_button->IsInRect( _x, _y ) )
	{
		if( m_info_mode == CHARACTER_INFO_MODE )
			re = m_pC_common_button_group->MouseControl(message, _x, _y);
	}
	else re = m_pC_common_button_group->MouseControl(message, _x, _y);

/*	if(m_skill_info_mode)
	{
		re &= m_pC_skill_button_group->MouseControl(message, _x, _y);
		re &= m_pC_skill_scroll_bar->MouseControl(message, _x, _y);
	}
	else	// char info mode
	{
		if(gbl_vampire_interface && g_char_slot_ingame.bonus_point > 0)
			re &= m_pC_char_button_group->MouseControl(message, _x, _y);
		re &= m_pC_char_scroll_bar->MouseControl(message, _x, _y);
	}*/
	switch(m_info_mode)
	{
	case CHARACTER_INFO_MODE :
		if(/*g_eRaceInterface != RACE_SLAYER &&*/ g_char_slot_ingame.bonus_point > 0)
			re &= m_pC_char_button_group->MouseControl(message, _x, _y);
		re &= m_pC_char_scroll_bar->MouseControl(message, _x, _y);
		break;

	case SKILL_INFO_MODE :
		re &= m_pC_skill_button_group->MouseControl(message, _x, _y);
		re &= m_pC_skill_scroll_bar->MouseControl(message, _x, _y);
		if(g_eRaceInterface == RACE_OUSTERS)
			re &= m_pC_skill_scroll_bar_width->MouseControl(message, _x, _y);
		break;

	case GRADE1_INFO_MODE :
		{
			// 화면에 출력되어야 할 버튼 수 			 
		
			C_VS_UI_EVENT_BUTTON *pButton=m_pC_grade1_button_group->IsInRect(_x,_y);
			if(pButton == NULL)
				re &= m_pC_grade1_button_group->MouseControl(message, _x, _y);
			else
			{
				if(m_pC_grade1_button_group->GetButton(GRADE1_BUTTON1_ID)->GetID()+m_draw_grade_skill_mark > pButton->GetID())
					re &= m_pC_grade1_button_group->MouseControl(message, _x, _y);		
			}
			//re &= m_pC_grade1_scroll_bar->MouseControl(message, _x, _y);

			
		}
		break;
	case GRADE2_INFO_MODE :
		{
			// 화면에 출력되어야 할 버튼 수 			 
		
			C_VS_UI_EVENT_BUTTON *pButton=m_pC_grade2_button_group->IsInRect(_x,_y);
			if(pButton == NULL)
				re &= m_pC_grade2_button_group->MouseControl(message, _x, _y);
			else
			{
				if(m_pC_grade2_button_group->GetButton(GRADE2_BUTTON1_ID)->GetID()+m_draw_grade_skill_mark > pButton->GetID())
					re &= m_pC_grade2_button_group->MouseControl(message, _x, _y);		
			}
			//re &= m_pC_grade1_scroll_bar->MouseControl(message, _x, _y);
			
		}
		break;
	case GRADE3_INFO_MODE :
		{
			re &= m_pC_grade3_scroll_bar->MouseControl(message, _x, _y);
			
			C_VS_UI_EVENT_BUTTON *pButton=m_pC_grade3_button_group->IsInRect(_x,_y);
			if(pButton == NULL)
				re &= m_pC_grade3_button_group->MouseControl(message, _x, _y);
			else
			{
				if(m_pC_grade3_button_group->GetButton(GRADE3_BUTTON1_ID)->GetID()+16 > pButton->GetID())
					re &= m_pC_grade3_button_group->MouseControl(message, _x, _y);		
			}
		}
		break;
	case RARE_SKILL_INFO_MODE:
		
		re &= m_pC_rare_skill_scroll_bar->MouseControl(message, _x, _y);
		
		break;
	}
	
	
	switch(message)
	{
	case M_MOVING:
		m_focused_skill_id = -1;
		if (_x > m_rt_tab.x &&
			_x < m_rt_tab.x + m_rt_tab.w * INFO_MODE_MAX &&
			_y > m_rt_tab.y &&
			_y < m_rt_tab.y + m_rt_tab.h)
		{
			//if(_x > m_rt_tab.x+m_rt_tab.w/2)
			int temp_mode = (_x - m_rt_tab.x - 4) / m_rt_tab.w;

			const int desc_x = x + m_rt_tab.x + m_rt_tab.w * temp_mode;
			const int desc_y = y + m_rt_tab.y;

			static char name[200];
			switch(temp_mode)
			{
			case CHARACTER_INFO_MODE :
				wsprintf(name,"%s (Ctrl+%s)",m_info_string[0],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_CHARINFO))]);
				g_descriptor_manager.Set(DID_INFO, desc_x, desc_y, (void *)name,0,0);
				break;
			case SKILL_INFO_MODE :				
				switch(g_eRaceInterface)
				{
				case RACE_SLAYER:
					wsprintf(name,"%s (Ctrl+%s)",m_info_string[1],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_SKILLINFO))]);
					g_descriptor_manager.Set(DID_INFO, desc_x, desc_y, (void *)name,0,0);
					break;
					
				case RACE_VAMPIRE:
					wsprintf(name,"%s (Ctrl+%s)",m_info_string[2],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_SKILLINFO))]);
					g_descriptor_manager.Set(DID_INFO, desc_x, desc_y, (void *)name,0,0);
					break;
					
				case RACE_OUSTERS:
					wsprintf(name,"%s (Ctrl+%s)",m_info_string[2],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_SKILLINFO))]);
					g_descriptor_manager.Set(DID_INFO, desc_x, desc_y, (void *)name,0,0);
					break;
				}
				break;
			case GRADE1_INFO_MODE :
				{
					if( !g_pSystemAvailableManager->IsAvailableRankBonusSystem() )
						wsprintf(name,"%s",m_info_string[4]);
					else
						wsprintf(name,"%s (Ctrl+%s)",m_info_string[3],scancode_name[ACCEL_GET_KEY(g_pKeyAccelerator->GetKey(ACCEL_GRADE1INFO))]);
					g_descriptor_manager.Set(DID_INFO, desc_x, desc_y, (void *)name,0,0);
				}
				break;
			case GRADE2_INFO_MODE :
				wsprintf(name,"%s",m_info_string[4]);
				g_descriptor_manager.Set(DID_INFO, desc_x, desc_y, (void *)name,0,0);
				break;				

			case GRADE3_INFO_MODE :
				wsprintf(name,"%s",m_info_string[5]);
				g_descriptor_manager.Set(DID_INFO, desc_x, desc_y, (void *)name,0,0);
				break;

			case RARE_SKILL_INFO_MODE:	
#if __CONTENTS(__RARE_SKILL)
				wsprintf(name,"%s",m_info_string[6]);
				g_descriptor_manager.Set(DID_INFO, desc_x, desc_y, (void *)name,0,0);
#endif
				break;

			}			
		}		
		{
			static char temp_str[3][100];
			static LPSTR str[3] = { temp_str[0], temp_str[1], temp_str[2] };
			str[0] = temp_str[0];
			str[1] = temp_str[1];
			str[2] = temp_str[2];
			
			bool Result = false;
			switch(m_info_mode)
			{
			case SKILL_INFO_MODE :
				Result = SkillInfoMouseControl(message,_x,_y);
				break;
			
			case RARE_SKILL_INFO_MODE:
				Result = RareSkillInfoMouseControl(message,_x,_y);
				break;

			case GRADE3_INFO_MODE:
				Result = SkillInfoMouseControl(message,_x,_y);
//				if(_x>37&& _y>29 &&_x<287&&_y<49)
//				{
//					__int64	goal_exp = max(1, g_pExperienceTable->GetAdvanceMent(g_char_slot_ingame.m_AdvancementLevel+1).GoalExp);
//					wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), g_GetNumberString(g_char_slot_ingame.EXP_REMAIN).c_str(), g_GetNumberString((goal_exp - g_char_slot_ingame.GRADE_EXP_REMAIN)*100/max(1, (goal_exp))).c_str());
//					g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str, 1);
//				}


				if(_x>37&& _y>49 &&_x<287&&_y<61)
				{
					__int64	goal_exp = max(1, g_pExperienceTable->GetAdvanceMent(g_char_slot_ingame.m_AdvancementLevel+1).GoalExp);
					wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), g_GetNumberString(g_char_slot_ingame.EXP_REMAIN).c_str(), g_GetNumberString((goal_exp - g_char_slot_ingame.EXP_REMAIN)*100/max(1, (goal_exp))).c_str());
					g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str, 1);
				}

//				if(_x>37&& _y>61 &&_x<287&&_y<6)
//				{
//					__int64	goal_exp = max(1, g_pExperienceTable->GetAdvanceMent(g_char_slot_ingame.m_AdvancementLevel+1).GoalExp);
//					wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), g_GetNumberString(g_char_slot_ingame.EXP_REMAIN).c_str(), g_GetNumberString((goal_exp - g_char_slot_ingame.GRADE_EXP_REMAIN)*100/max(1, (goal_exp))).c_str());
//					g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str, 1);
//				}

				break;
			case CHARACTER_INFO_MODE :
				Result = CharacterInfoMouseControl(message,_x,_y);
				break;
			case GRADE1_INFO_MODE :
			case GRADE2_INFO_MODE:
				if(g_char_slot_ingame.GRADE>0 && g_char_slot_ingame.GRADE <=GRADE_MARK_MAX)
				{
					if(_x>37&&_y>39&&_x<287&&_y<51)
					{
						// Grade Level Bar Description						
						int GradeID = (g_char_slot_ingame.GRADE-1)/5;
						
						char* pszGrade;
						switch(g_eRaceInterface)
						{
						case RACE_SLAYER:
							pszGrade = const_cast<char *>(slayer_grade[GradeID]);
							break;
							
						case RACE_VAMPIRE:
							pszGrade = const_cast<char *>(vampire_grade[GradeID]);
							break;
							
						case RACE_OUSTERS:
							pszGrade = const_cast<char *>(ousters_grade[GradeID]);
							break;
						}
						wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NAME].GetString(),pszGrade );
						wsprintf(temp_str[1],"%s%d / %d",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LEVEL].GetString(),g_char_slot_ingame.GRADE,GRADE_MARK_MAX);
						if(g_char_slot_ingame.GRADE == GRADE_MARK_MAX)
						{
							wsprintf(temp_str[2],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_GRADE].GetString());
							g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,3);
						} else
						{
							g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,2);														
						}
					} else if(_x>37&& _y>59 &&_x<287&&_y<71)
					{
						// Grade Exp Bar Description
						
						if(g_char_slot_ingame.GRADE == GRADE_MARK_MAX)
						{
							wsprintf(temp_str[0],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_GRADE].GetString());
							g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,1);
						} else
						{
							const ExpInfo* expinf = &g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface);
							__int64 goal_exp = expinf->GoalExp;

							wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), g_GetNumberString(g_char_slot_ingame.GRADE_EXP_REMAIN).c_str(), g_GetNumberString((goal_exp - g_char_slot_ingame.GRADE_EXP_REMAIN)*100/max(1, (goal_exp))).c_str());
//							wsprintf(temp_str[0],"%s%d / %d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_GRADE_EXP].GetString(),g_char_slot_ingame.GRADE_EXP,NextLevelExp);
//							wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_LEFT_EXP].GetString(),NextLevelExp - g_char_slot_ingame.GRADE_EXP);
						
							g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str, 1);
						}
					}
				}
				break;
			}
			if(Result == false) 
				break;			
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		{
			// 이미지 변경을 기존에 이미지를 눌러서 하던것에서 버튼 추가를 하면서 주석처리했다
//			int fix_face_x = 2, fix_face_y = 10;
//			if( g_eRaceInterface != RACE_OUSTERS )
//			{
//				fix_face_x = 0;
//				fix_face_y = 0;
//			}
//
//			if(m_info_mode == CHARACTER_INFO_MODE && m_rt_char_box.x+fix_face_x < _x && m_rt_char_box.x+55+fix_face_x > _x &&
//				m_rt_char_box.y+fix_face_y < _y && m_rt_char_box.y+70 +fix_face_y> _y)
//			{
//				gC_vs_ui.RunFileDialog(C_VS_UI_FILE_DIALOG::MODE_PROFILE_SELECT, ".bmp;.jpg");
//				break;
//			}
			
			if (_x > m_rt_tab.x &&
				_x < m_rt_tab.x + m_rt_tab.w * INFO_MODE_MAX &&
				_y > m_rt_tab.y &&
				_y < m_rt_tab.y + m_rt_tab.h)
			{
			/*if(_x > m_rt_tab.x+m_rt_tab.w/2)
			m_skill_info_mode = true;
			else
				m_skill_info_mode = false;*/
				int temp_mode = (_x - m_rt_tab.x - 4) / m_rt_tab.w;
				
				
				if(temp_mode >= CHARACTER_INFO_MODE && temp_mode <=GRADE2_INFO_MODE
#if __CONTENTS(__RARE_SKILL)
					|| temp_mode == RARE_SKILL_INFO_MODE
#endif
					)
				{	
					if( GRADE1_INFO_MODE == (INFO_MODE)temp_mode && g_pSystemAvailableManager->IsAvailableRankBonusSystem() ||
						GRADE1_INFO_MODE != (INFO_MODE)temp_mode )
					{
						if ( temp_mode != GRADE1_INFO_MODE && temp_mode != GRADE2_INFO_MODE )
						{
							m_info_mode =(INFO_MODE)temp_mode;					
							CheckGradeSkillIDList();
						}
					}
				}
				//else if(temp_mode >=GRADE2_INFO_MODE && temp_mode<=GRADE3_INFO_MODE)// &&	g_char_slot_ingame.m_AdvancementLevel>0)
				else if(temp_mode >=GRADE2_INFO_MODE && temp_mode<=GRADE3_INFO_MODE &&	g_char_slot_ingame.m_AdvancementLevel>0)
				{
//					if( GRADE1_INFO_MODE == (INFO_MODE)temp_mode && g_pSystemAvailableManager->IsAvailableRankBonusSystem() ||
//						GRADE1_INFO_MODE != (INFO_MODE)temp_mode )
//					{
						m_info_mode =(INFO_MODE)temp_mode;					
						
						//CheckGradeSkillIDList();
//					}
				}
			}
			else if(m_focused_skill_id != -1 && GRADE3_INFO_MODE != m_info_mode)
			{
				PlaySound( SOUND_OUSTERS_SKILL_INFO );

				if(g_eRaceInterface == RACE_OUSTERS
#if __CONTENTS(__SECOND_RARE_SKILL)					
					&& m_info_mode != RARE_SKILL_INFO_MODE
#endif //__SECOND_RARE_SKILL
					)
				{
					if( m_bOustersDownSkill )
					{
						if ( (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus((ACTIONINFO)m_focused_skill_id) ==MSkillDomain::SKILLSTATUS_LEARNED )
							gC_vs_ui.RunOustersSkillInfo(m_focused_skill_id, x+w, y, m_bOustersDownSkill);
					} else
					{
						gC_vs_ui.RunOustersSkillInfo(m_focused_skill_id, x+w, y, m_bOustersDownSkill);
					}
				}
				else
					gC_vs_ui.RunDescDialog(DID_SKILL, (void *)m_focused_skill_id);
			}
			else if (gpC_mouse_pointer->GetPickUpItem() == NULL && re)
			{
				if(m_info_mode == SKILL_INFO_MODE && g_eRaceInterface == RACE_OUSTERS &&
					_x >= m_rcSkillDesciption.left && _x <= m_rcSkillDesciption.left+m_rcSkillDesciption.right &&
					_y >= m_rcSkillDesciption.top && _y <= m_rcSkillDesciption.top+m_rcSkillDesciption.bottom)
				{
					m_CenterPos.x = _x;
					m_CenterPos.y = _y;
					g_bLButtonDown = TRUE;
					EMPTY_MOVE;
					break;
				}

				MoveReady();
				SetOrigin(_x, _y);
				break;
			}
		}
		break;

	case M_LEFTBUTTON_UP:
		m_CenterPos.x = -1;
		g_bLButtonDown = false;
		break;
		
	case M_WHEEL_UP:
//		if(m_skill_info_mode)
		if(m_info_mode == SKILL_INFO_MODE)
		{
			if(g_eRaceInterface == RACE_OUSTERS)
				m_pC_skill_scroll_bar->ScrollUp(10);
			else
				m_pC_skill_scroll_bar->ScrollUp();
		}
		else if(m_info_mode == GRADE3_INFO_MODE)
		{
			m_pC_grade3_scroll_bar->ScrollUp();
		}
		else if(m_info_mode == RARE_SKILL_INFO_MODE)
		{
			m_pC_rare_skill_scroll_bar->ScrollUp();
		}
		EMPTY_MOVE;
		break;
		
	case M_WHEEL_DOWN:
		//if(m_skill_info_mode)
		if(m_info_mode == SKILL_INFO_MODE)
		{
			if(g_eRaceInterface == RACE_OUSTERS)
				m_pC_skill_scroll_bar->ScrollDown(10);
			else
				m_pC_skill_scroll_bar->ScrollDown();
		}
		else if(m_info_mode == GRADE3_INFO_MODE)
		{
			m_pC_grade3_scroll_bar->ScrollDown();
		}
		else if(m_info_mode == RARE_SKILL_INFO_MODE)
		{
			m_pC_rare_skill_scroll_bar->ScrollDown();
		}
		EMPTY_MOVE;
		break;

	}
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_INFO
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_KEYDOWN && key == VK_ESCAPE)
	{
		//		Run(CLOSE);
	}
}

void C_VS_UI_INFO::RefreshImage()
{
	if(m_p_face)
		DeleteNew(m_p_face);
	
	m_p_face = new CSpritePack;
	m_p_face->Init(1);
	
	if(g_pProfileManager->HasProfile(g_char_slot_ingame.sz_name.c_str()))
	{
		const char *filename = g_pProfileManager->GetFilename(g_char_slot_ingame.sz_name.c_str());
		char filenamei[256];
		
		strcpy(filenamei, filename);
		strcat(filenamei, "i");
		
		if(!m_p_face->LoadFromFileData(0, 1, filename, filenamei ))
		{
			delete m_p_face;
			m_p_face = NULL;
		}
	}
	else
	{
		// face spk
		// portrait
		const int _VAMPIRE_OFFSET = 6;
		const int _WOMAN_OFFSET = 3;
		const int _OUSTERS_OFFSET = 8;
		int spriteID;

		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			if (g_char_slot_ingame.bl_female)
				spriteID = g_char_slot_ingame.man_info.face-M_FACE1+_WOMAN_OFFSET; 
			else
				spriteID = g_char_slot_ingame.man_info.face-M_FACE1;
			break;
			
		case RACE_VAMPIRE:
			if(g_char_slot_ingame.bl_female)
				spriteID = _VAMPIRE_OFFSET+1;
			else
				spriteID = _VAMPIRE_OFFSET;
			break;
			
		case RACE_OUSTERS:
			spriteID = _OUSTERS_OFFSET;
			break;
		}

		
		if(!m_p_face->LoadFromFileData(0, spriteID, SPK_FACE, SPKI_FACE))
		{
			delete m_p_face;
			m_p_face = NULL;
		}
	}
}

//-----------------------------------------------------------------------------------
// Show 가 길어져서 분리했다.			by sonee
// _Show1()
//   >> Skill Info
//-----------------------------------------------------------------------------------
void	C_VS_UI_INFO::_Show1()
{
	CSpriteSurface::SetEffect(CSpriteSurface::EFFECT_GRAY_SCALE);
	const InterfaceInformation *Skin = &g_pSkinManager->Get(SkinManager::INFO);
	///////////////////////////////////////////////////////////////////////////////////////////////////////
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			//const int domain_bar_x = 124, domain_bar_y = 69;
			const int domain_bar_x = Skin->GetPoint(0).x, domain_bar_y = Skin->GetPoint(0).y;
			const int domain_level = (*g_pSkillManager)[m_skill_domain].GetDomainLevel();
			const int exp_remain = (*g_pSkillManager)[m_skill_domain].GetDomainExpRemain();
			const __int64 goal_exp = (*g_pSkillManager)[m_skill_domain].GetExpInfo(domain_level).GoalExp;
			const int skip_y=4;
			
			if(gpC_base->m_p_DDSurface_back->Lock())	//그림 출력할게 많으므로 lock건 상태에서 한다.
			{
				if(GetAttributes()->alpha && m_iDomain != TOTAL_ID)
				{
					RECT alpha_rect;
					
					// Top
					SetRect(&alpha_rect, x+5, y+12, x+w-6, y+m_rcSkillDesciption.top);
					DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					
					// Bottom
					SetRect(&alpha_rect, x+5, y+m_rcSkillDesciption.bottom, x+w-6, y+h-12);
					DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					
					// Left
					SetRect(&alpha_rect, x+5, y+m_rcSkillDesciption.top, x+m_rcSkillDesciption.left, y+m_rcSkillDesciption.bottom);
					DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					
					// Right
					SetRect(&alpha_rect, x+m_rcSkillDesciption.right, y+m_rcSkillDesciption.top, x+w-6, y+m_rcSkillDesciption.bottom);
					DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
					
					//gpC_global_resource->DrawDialogOnlyLocked(x, y, w, h);
				}
				//by csm 2004.12.30 Ui수정 
				//else
				//	gpC_global_resource->DrawDialogLocked(x, y, w, h, GetAttributes()->alpha);
				
				if(m_iDomain != TOTAL_ID && !GetAttributes()->alpha)
				{
					gpC_base->m_p_DDSurface_back->Unlock();
					//도메인바 뒤에 검은색 칠하기
					RECT rect = {x+124, y+69+skip_y, x+124+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR), y+69+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DOMAIN_BAR)+skip_y };
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
					rect.top += 20;
					rect.bottom += 20;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
					gpC_base->m_p_DDSurface_back->Lock();
				}
				
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x -m_modify_wide-10, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_SKILL);
				//아웃라인
				gpC_global_resource->DrawOutBoxLocked(x+8, y+44+skip_y, 304, 249);
				//스킬선택 탭
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_pC_skill_button_group->GetButton(m_iDomain)->x, y+m_pC_skill_button_group->GetButton(m_iDomain)->y-1, m_pC_skill_button_group->GetButton(m_iDomain)->m_image_index+1);
				
				if(m_iDomain != TOTAL_ID)
				{
					//도메인 바
					gpC_global_resource->m_pC_info_spk->BltLocked(x+25, y+68+skip_y, C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL);
					gpC_global_resource->m_pC_info_spk->BltLocked(x+25, y+88+skip_y, C_GLOBAL_RESOURCE::TITLE_DOMAINEXP);
					
					gpC_global_resource->m_pC_info_spk->BltLocked(x+110, y+66+skip_y, C_GLOBAL_RESOURCE::DOMAIN_BACK);
					gpC_global_resource->m_pC_info_spk->BltLocked(x+110, y+86+skip_y, C_GLOBAL_RESOURCE::DOMAIN_BACK);
					
					//도메인 레벨 바
					Rect rect;
					rect.Set(0, 0, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)*domain_level/MAX_LEVEL, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DOMAIN_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+domain_bar_x, y+domain_bar_y+skip_y, rect, C_GLOBAL_RESOURCE::DOMAIN_BAR);
					
					//도메인 경험치 바
					rect.Set(0, 0, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)*(goal_exp - exp_remain)/max(1, goal_exp), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DOMAIN_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+domain_bar_x, y+domain_bar_y+20+skip_y, rect, C_GLOBAL_RESOURCE::DOMAIN_BAR);
					
					//스킬 리스트
					gpC_global_resource->m_pC_info_spk->BltLocked(x+15, y+108+skip_y, C_GLOBAL_RESOURCE::SKILL_TITLE);
					gpC_global_resource->m_pC_info_spk->BltLocked(x+15, y+108+skip_y, C_GLOBAL_RESOURCE::SKILL_BOX);
					
					// SKILL STEP이 있으면 스킬들을 출력한다
					if(m_iDomain >= BLADE_ID && m_iDomain <= ENCHANT_ID)
					{
						int i = 0; 
						
						SKILL_STEP step = (SKILL_STEP)(SKILL_STEP_APPRENTICE);  
						if((*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))
						{
							MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step));
																   
							MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin()+max(0,m_pC_skill_scroll_bar->GetScrollPos());
							
							const int level_plus = 127;
							DWORD shadow_color = RGB_BLACK;
							for(i = 0; i < min( 8, list.size() - max(0,m_pC_skill_scroll_bar->GetScrollPos()) ); i++)
							{
								const ACTIONINFO SkillID = (ACTIONINFO)*ss;
								MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus(SkillID);
								
								int sprID = (*g_pSkillInfoTable)[SkillID].GetSpriteID();
								if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < (*g_pSkillInfoTable)[SkillID].GetLearnLevel() )
									sprID = 12;
								
								//---------------------------------------
								// status는 다음과 같다. 
								//---------------------------------------
								//	MSkillDomain::SKILLSTATUS_LEARNED		// 배웠다.
								//	MSkillDomain::SKILLSTATUS_NEXT			// 다음에 배울 수 있다.
								//	MSkillDomain::SKILLSTATUS_OTHER			// 아직은 배울 수 없다.	
								//---------------------------------------
								
								POINT p = {x+16, y+128+i*19+skip_y};
								
								switch(status)
								{
								case MSkillDomain::SKILLSTATUS_LEARNED:
									{
										if(!GetAttributes()->alpha)
											gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED);
										else
										{
											RECT alpha_rect = { p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK)+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED), p.y+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED)-1 };
											DrawAlphaBox(&alpha_rect, 5, 7, 7, g_pUserOption->ALPHA_DEPTH);
											gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK_ALPHA);
										}
										
										if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
										{
											if(sprID < C_VS_UI_SKILL::m_C_spk_mini.GetSize() && C_VS_UI_SKILL::m_C_spk_mini[sprID].IsInit())
												gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk_mini[sprID]);
										}
										if((*g_pSkillInfoTable)[SkillID].IsPassive())
										{
											if(sprID < C_VS_UI_SKILL::m_C_spk_mini.GetSize() && C_VS_UI_SKILL::m_C_spk_mini[sprID].IsInit())
												gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&p, &C_VS_UI_SKILL::m_C_spk_mini[sprID], 315-256);
										}
										else
										{
											if(sprID < C_VS_UI_SKILL::m_C_spk_mini.GetSize() && C_VS_UI_SKILL::m_C_spk_mini[sprID].IsInit())
												gpC_base->m_p_DDSurface_back->BltSprite(&p, &C_VS_UI_SKILL::m_C_spk_mini[sprID]);
										}
									}
									break;
									
								default:
									if(!GetAttributes()->alpha)
										gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK);
									else
									{
										RECT alpha_rect = { p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK)+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED), p.y+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED)-1 };
										DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
										gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK_ALPHA);
									}
									if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk_mini.GetSize() && C_VS_UI_SKILL::m_C_spk_mini[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSpriteColor(&p, &C_VS_UI_SKILL::m_C_spk_mini[sprID], rgb_GREEN);
									}
									else
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk_mini.GetSize() && C_VS_UI_SKILL::m_C_spk_mini[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk_mini[sprID]);
									}
									break;
								}
								
								ss++;
								
								//Skill icon back
								gpC_global_resource->m_pC_info_spk->BltLocked(p.x, p.y, C_GLOBAL_RESOURCE::SKILL_ICON_BACK);
								
							}
						}			
						//스킬개수가 8개가 안될경우 나머지부분 출력
						for(; i < 8; i++)
						{
							POINT p = { x+16, y+128+i*19+skip_y };
							gpC_global_resource->m_pC_info_spk->BltLocked(p.x, p.y, C_GLOBAL_RESOURCE::SKILL_ICON_BACK);
							if(!GetAttributes()->alpha)
								gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK);
							else
							{
								RECT alpha_rect = { p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK)+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED)-1, p.y+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED)-1 };
								DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
								gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK_ALPHA);
							}
						}
				}
			}
			else	// TOTAL_ID 인경우
			{
				if(!GetAttributes()->alpha)
				{
					gpC_base->m_p_DDSurface_back->Unlock();
					for(int i = 0; i < 6; i++)
					{
						//도메인바 뒤에 검은색 칠하기
						RECT rect = {x+104, y+69+i*30+skip_y, x+104+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR), y+69+i*30+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DOMAIN_BAR)+skip_y };
						gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
					}
					gpC_base->m_p_DDSurface_back->Lock();
				}
				
				int dm_level = 0;
				int dm_sum = 0;
				for(int i = 0; i < 6; i++)
				{
					Rect rect;
					rect.Set(2, 2, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DM_BLADE+i*2)-4, 
						gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DM_BLADE+i*2)-2);
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+25, y+61+i*30+skip_y, rect, C_GLOBAL_RESOURCE::DM_BLADE+i*2);
					gpC_global_resource->m_pC_info_spk->BltLocked(x+90, y+66+i*30+skip_y, C_GLOBAL_RESOURCE::DOMAIN_BACK);
					
					//도메인 레벨 바
					if(i == 5)	// total인 경우는 따로 처리
						dm_level = dm_sum;
					else
					{
						dm_level = (*g_pSkillManager)[(SKILLDOMAIN)i].GetDomainLevel();
						dm_sum += dm_level;
					}
					rect.Set(0, 0, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)*dm_level/MAX_LEVEL, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DOMAIN_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+domain_bar_x-20, y+domain_bar_y+i*30+skip_y, rect, C_GLOBAL_RESOURCE::DOMAIN_BAR);
				}
				
			}
			m_pC_skill_button_group->Show();
			m_pC_common_button_group->Show();
			
			gpC_base->m_p_DDSurface_back->Unlock();
			
			if(m_iDomain != TOTAL_ID)
				m_pC_skill_scroll_bar->Show(x, y);
		}
		//글씨 찍기
		if(m_iDomain != TOTAL_ID)
		{
			g_FL2_GetDC();
			char sz_temp[80];
			wsprintf(sz_temp, "%d/%d",(*g_pSkillManager)[m_iDomain-BLADE_ID].GetDomainLevel(), MAX_LEVEL);
			g_PrintColorStrOut(x+domain_bar_x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+domain_bar_y+skip_y, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
			wsprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/max(1, (goal_exp)));
			g_PrintColorStrOut(x+domain_bar_x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+domain_bar_y+20+skip_y, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
			
			
			// SKILL STEP이 있으면 스킬이름들을 출력한다
			if(m_iDomain >= BLADE_ID && m_iDomain <= ENCHANT_ID)
			{
				
				SKILL_STEP step = (SKILL_STEP)(SKILL_STEP_APPRENTICE);
				if((*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))
				{
					MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step));
					
					
					MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin()+max(0,m_pC_skill_scroll_bar->GetScrollPos());
					
					//					int i = 0;
					//					(*g_pSkillManager)[m_skill_domain].SetBegin();
					//					for(int skip = 0; skip < m_pC_skill_scroll_bar->GetScrollPos(); skip++)
					//					{
					//						(*g_pSkillManager)[m_skill_domain].Next();
					//					}
					
					const int level_plus = 127;
					DWORD shadow_color = RGB_BLACK;
					//					if(GetAttributes()->alpha)
					//						shadow_color = 0xFFFFFFFF;
					for(int i = 0; i < min( 8, list.size() - max(0,m_pC_skill_scroll_bar->GetScrollPos())); i++)
					{
						const ACTIONINFO SkillID = (ACTIONINFO)*ss;
						
						MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus(SkillID);
						//					do
						//					{
						//						ACTIONINFO SkillID = (*g_pSkillManager)[m_skill_domain].GetSkillID();
						//						MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus(SkillID);
						const char *skill_name;
						const int exp_level = (*g_pSkillInfoTable)[SkillID].GetExpLevel();
						const int learn_level = (*g_pSkillInfoTable)[SkillID].GetLearnLevel();
						char sz_temp[10];
						char sz_temp2[10] = "???";

						if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < learn_level )
							skill_name = sz_temp2;
						else
							skill_name = (*g_pSkillInfoTable)[SkillID].GetHName();
						
						POINT p = {x+137, y+132+i*19+skip_y};
						
						//---------------------------------------
						// status는 다음과 같다. 
						//---------------------------------------
						//	MSkillDomain::SKILLSTATUS_LEARNED		// 배웠다.
						//	MSkillDomain::SKILLSTATUS_NEXT			// 다음에 배울 수 있다.
						//	MSkillDomain::SKILLSTATUS_OTHER			// 아직은 배울 수 없다.	
						//---------------------------------------
						
						switch(status)
						{
						case MSkillDomain::SKILLSTATUS_LEARNED:
							{
								if((*g_pSkillInfoTable)[SkillID].IsPassive())
								{
									g_PrintColorStrShadow(p.x +level_plus- 
										g_GetStringWidth((*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_chatting_pi.hfont)/2, p.y, (*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_chatting_pi, RGB(150, 200, 255), shadow_color);
								}
								else
								{
									wsprintf(sz_temp, "%d", exp_level);
									g_PrintColorStrShadow(p.x +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, p.y, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, shadow_color);
								}
								
								if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
								{
									if(skill_name)
									{
										g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_chatting_pi.hfont)/2, p.y, skill_name, gpC_base->m_chatting_pi, RGB_GRAY, shadow_color);
									}
								}
								else
									if((*g_pSkillInfoTable)[SkillID].IsPassive())
									{
										if(skill_name)
										{
											g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_chatting_pi.hfont)/2, p.y, skill_name, gpC_base->m_chatting_pi, RGB(150, 200, 255), shadow_color);
										}
									}
									else
									{
										if(skill_name)
										{
											g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_chatting_pi.hfont)/2, p.y, skill_name, gpC_base->m_chatting_pi, RGB_WHITE, shadow_color);
										}
									}
							}
							break;
							
						default:
							wsprintf(sz_temp, "%d", learn_level);
							g_PrintColorStrShadow(p.x +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, p.y, sz_temp, gpC_base->m_chatting_pi, RGB(70, 255, 70), shadow_color);
							
							if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
							{
								if(skill_name)
								{
									g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_chatting_pi.hfont)/2, p.y, skill_name, gpC_base->m_chatting_pi, RGB(70, 255, 70), shadow_color);
								}
							}
							else
							{
								if(skill_name)
								{
									g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_chatting_pi.hfont)/2, p.y, skill_name, gpC_base->m_chatting_pi, RGB_GRAY, shadow_color);
								}
							}
							break;
						}
						
						ss++;
						//						(*g_pSkillManager)[m_skill_domain].Next();
						//						i++;
						
						//					}while(!(*g_pSkillManager)[m_skill_domain].IsEnd() && i < 8);
					}
				}
			}
			m_pC_skill_button_group->ShowDescription();
			m_pC_common_button_group->ShowDescription();
			g_FL2_ReleaseDC();
		}
		else	// TOTAL_ID 인경우
		{
			g_FL2_GetDC();
			
			int dm_level = 0, dm_sum = 0;
			char sz_temp[80];
			
			for(int i = 0; i < 6; i++)
			{
				//도메인 레벨 바
				if(i == 5)	// total인 경우는 따로 처리
					dm_level = dm_sum;
				else
				{
					dm_level = (*g_pSkillManager)[(SKILLDOMAIN)i].GetDomainLevel();
					dm_sum += dm_level;
				}
				wsprintf(sz_temp, "%d/%d", dm_level,MAX_LEVEL);
				g_PrintColorStrOut(x+domain_bar_x-20+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, 
					y+domain_bar_y+i*30+skip_y, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
			}
			m_pC_skill_button_group->ShowDescription();
			m_pC_common_button_group->ShowDescription();
			g_FL2_ReleaseDC();
		}
	}	
	break;
	
	case RACE_VAMPIRE:
		{
			const int skip_y=4;
			if(gpC_base->m_p_DDSurface_back->Lock())	//그림 출력할게 많으므로 lock건 상태에서 한다.
			{
				
				if(GetAttributes()->alpha)
				{
					RECT alpha_rect;
					
					// Top
					SetRect(&alpha_rect, x+10, y+9, x+w-9, y+m_rcSkillDesciption.top);
					DrawAlphaBox(&alpha_rect, 2, 0, 0, g_pUserOption->ALPHA_DEPTH);
					
					// Bottom
					SetRect(&alpha_rect, x+10, y+m_rcSkillDesciption.bottom, x+w-9, y+h-10);
					DrawAlphaBox(&alpha_rect, 2, 0, 0, g_pUserOption->ALPHA_DEPTH);
					
					// Left
					SetRect(&alpha_rect, x+10, y+m_rcSkillDesciption.top, x+m_rcSkillDesciption.left, y+m_rcSkillDesciption.bottom);
					DrawAlphaBox(&alpha_rect, 2, 0, 0, g_pUserOption->ALPHA_DEPTH);
					
					// Right
					SetRect(&alpha_rect, x+m_rcSkillDesciption.right, y+m_rcSkillDesciption.top, x+w-9, y+m_rcSkillDesciption.bottom);
					DrawAlphaBox(&alpha_rect, 2, 0, 0, g_pUserOption->ALPHA_DEPTH);
					
					//gpC_global_resource->DrawDialogOnlyLocked(x, y, w, h);
				}
				//else
					//gpC_global_resource->DrawDialogLocked(x, y, w, h, GetAttributes()->alpha);
				
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-7, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_SKILL);
				//아웃라인
				gpC_global_resource->DrawOutBoxLocked(x+16, y+40+skip_y, 303, 236);
				//스킬선택 탭
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_pC_skill_button_group->GetButton(m_iDomain)->x, 
					y+m_pC_skill_button_group->GetButton(m_iDomain)->y-1, m_pC_skill_button_group->GetButton(m_iDomain)->m_image_index+1);
				
				//스킬 리스트
				gpC_global_resource->m_pC_info_spk->BltLocked(x+23, y+63+skip_y, C_GLOBAL_RESOURCE::SKILL_TITLE);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+23, y+63+skip_y, C_GLOBAL_RESOURCE::SKILL_BOX);
				
				if(m_iDomain >= POISON_ID && m_iDomain <= INNATE_ID && m_skill_domain == SKILLDOMAIN_VAMPIRE)
				{
					const int domain_level = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetDomainLevel();
					SKILL_STEP step = (SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON);
					if((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
					{
						MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step));
						MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin()+max(m_pC_skill_scroll_bar->GetScrollPos(),0);
						for(int i = 0; i < min( 8, list.size() - max(m_pC_skill_scroll_bar->GetScrollPos(),0)); i++)
						{
							const ACTIONINFO SkillID = (ACTIONINFO)*ss;
							MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStatus(SkillID);
							int sprID = (*g_pSkillInfoTable)[SkillID].GetSpriteID();

							if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < (*g_pSkillInfoTable)[SkillID].GetLearnLevel() )
								sprID = 12;
							
							
							//---------------------------------------
							// status는 다음과 같다. 
							//---------------------------------------
							//	MSkillDomain::SKILLSTATUS_LEARNED		// 배웠다.
							//	MSkillDomain::SKILLSTATUS_NEXT			// 다음에 배울 수 있다.
							//	MSkillDomain::SKILLSTATUS_OTHER			// 아직은 배울 수 없다.	
							//---------------------------------------
							POINT p = {x+24, y+83+i*19+skip_y};
							
							switch(status)
							{
							case MSkillDomain::SKILLSTATUS_LEARNED:
								{
									if(!GetAttributes()->alpha)
										gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED);
									else
									{
										RECT alpha_rect = { p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK)+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED), p.y+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED)-1 };
										DrawAlphaBox(&alpha_rect, 7, 5, 5, g_pUserOption->ALPHA_DEPTH);
										gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK_ALPHA);
									}
									
									if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk_mini.GetSize() && C_VS_UI_SKILL::m_C_spk_mini[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk_mini[sprID]);
									}
									if((*g_pSkillInfoTable)[SkillID].IsPassive())
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk_mini.GetSize() && C_VS_UI_SKILL::m_C_spk_mini[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&p, &C_VS_UI_SKILL::m_C_spk_mini[sprID], 315-256);
									}
									else
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk_mini.GetSize() && C_VS_UI_SKILL::m_C_spk_mini[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSprite(&p, &C_VS_UI_SKILL::m_C_spk_mini[sprID]);
									}
								}
								break;
								
							default:
								if(!GetAttributes()->alpha)
									gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK);
								else
								{
									RECT alpha_rect = { p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK)+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED),p.y+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED)-1 };
									DrawAlphaBox(&alpha_rect, 2, 0, 0, g_pUserOption->ALPHA_DEPTH);
									gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK_ALPHA);
								}
								
								if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk_mini.GetSize() && C_VS_UI_SKILL::m_C_spk_mini[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteColor(&p, &C_VS_UI_SKILL::m_C_spk_mini[sprID], rgb_GREEN);
								}
								else
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk_mini.GetSize() && C_VS_UI_SKILL::m_C_spk_mini[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk_mini[sprID]);
								}
								break;
							}
							//Skill icon back
							gpC_global_resource->m_pC_info_spk->BltLocked(p.x, p.y, C_GLOBAL_RESOURCE::SKILL_ICON_BACK);
							ss++;
						}
						
						//스킬이 꽉찬상태가 아닐때의 여분처리
						for(; i < 8; i++)
						{
							POINT p = {x+24, y+83+i*19+skip_y};
							gpC_global_resource->m_pC_info_spk->BltLocked(p.x, p.y, C_GLOBAL_RESOURCE::SKILL_ICON_BACK);
							
							if(!GetAttributes()->alpha)
								gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK);
							else
							{
								RECT alpha_rect = { p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK)+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED), p.y+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SKILL_BACK_HILIGHTED)-1 };
								DrawAlphaBox(&alpha_rect, 2, 0, 0, g_pUserOption->ALPHA_DEPTH);
								gpC_global_resource->m_pC_info_spk->BltLocked(p.x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SKILL_ICON_BACK), p.y, C_GLOBAL_RESOURCE::SKILL_BACK_ALPHA);
							}
						}
					}
				}
				m_pC_skill_button_group->Show();
				m_pC_common_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();
				m_pC_skill_scroll_bar->Show(x, y);
		}
		
		//글씨 찍기
		g_FL2_GetDC();
		
		char sz_temp[80];
		
		const int level_plus = 127;
		
		
		if(m_iDomain >= POISON_ID && m_iDomain <= INNATE_ID && m_skill_domain == SKILLDOMAIN_VAMPIRE)
		{
			const int domain_level = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetDomainLevel();
			SKILL_STEP step = (SKILL_STEP)(m_iDomain-POISON_ID+SKILL_STEP_VAMPIRE_POISON);
			if((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
			{
				MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step));
				
				MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin()+max(0,m_pC_skill_scroll_bar->GetScrollPos());
				for(int i = 0; i < min( 8, list.size() - max(m_pC_skill_scroll_bar->GetScrollPos(),0)); i++)
				{
					const ACTIONINFO SkillID = (ACTIONINFO)*ss;
					MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStatus(SkillID);
					
					//---------------------------------------
					// status는 다음과 같다. 
					//---------------------------------------
					//	MSkillDomain::SKILLSTATUS_LEARNED		// 배웠다.
					//	MSkillDomain::SKILLSTATUS_NEXT			// 다음에 배울 수 있다.
					//	MSkillDomain::SKILLSTATUS_OTHER			// 아직은 배울 수 없다.	
					//---------------------------------------
					POINT p = {x+145, y+87+i*19+skip_y};
					
					const int learn_level = (*g_pSkillInfoTable)[SkillID].GetLearnLevel();
					const char *skill_name; //= (*g_pSkillInfoTable)[SkillID].GetHName();

					char sz_temp2[10] = "???";
					
					if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < learn_level )
						skill_name = sz_temp2;
					else
						skill_name = (*g_pSkillInfoTable)[SkillID].GetHName();
					
					
					DWORD shadow_color = RGB_BLACK;
					//						if(GetAttributes()->alpha)
					//							shadow_color = 0xFFFFFFFF;
					
					wsprintf(sz_temp, "%d", learn_level);
					g_PrintColorStrShadow(p.x +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, p.y, sz_temp, gpC_base->m_chatting_pi, RGB(70, 255, 70), shadow_color);
					
					switch(status)
					{
					case MSkillDomain::SKILLSTATUS_LEARNED:
						{
							if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
							{
								if(skill_name)
								{
									g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_chatting_pi.hfont)/2, p.y, skill_name, gpC_base->m_chatting_pi, RGB_GRAY, shadow_color);
								}
							}
							else
								if((*g_pSkillInfoTable)[SkillID].IsPassive())
								{
									if(skill_name)
									{
										g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_chatting_pi.hfont)/2, p.y, skill_name, gpC_base->m_chatting_pi, RGB(150, 200, 255), shadow_color);
									}
								}
								else
								{
									if(skill_name)
									{
										g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_chatting_pi.hfont)/2, p.y, skill_name, gpC_base->m_chatting_pi, RGB_WHITE, shadow_color);
									}
								}
						}
						break;
						
					default:
						if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
						{
							if(skill_name)
							{
								g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_chatting_pi.hfont)/2, p.y, skill_name, gpC_base->m_chatting_pi, RGB(70, 255, 70), shadow_color);
							}
						}
						else
						{
							if(skill_name)
							{
								g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_chatting_pi.hfont)/2, p.y, skill_name, gpC_base->m_chatting_pi, RGB_GRAY, shadow_color);
							}
						}
						break;
					}
					
					ss++;
				}
			}
		}
		m_pC_skill_button_group->ShowDescription();
		m_pC_common_button_group->ShowDescription();
		g_FL2_ReleaseDC();
		
	}
	break;
	
	case RACE_OUSTERS:
		{
			const int skip_y=4;
			// skill point
			int skill_x = x+35, skill_y = y+32;

			if(gpC_base->m_p_DDSurface_back->Lock())	//그림 출력할게 많으므로 lock건 상태에서 한다.
			{
				
				//gpC_global_resource->DrawDialogLocked(x, y, w, h, GetAttributes()->alpha);
				
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-5, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_SKILL);

				//스킬선택 탭
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_pC_skill_button_group->GetButton(m_iDomain)->x, 
					y+m_pC_skill_button_group->GetButton(m_iDomain)->y-1, m_pC_skill_button_group->GetButton(m_iDomain)->m_image_index+1);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(skill_x, skill_y, C_GLOBAL_RESOURCE::OUSTERS_SKILL_POINT);

				Rect rtOutline(x+m_rcSkillDesciption.left, y+m_rcSkillDesciption.top, m_rcSkillDesciption.right, m_rcSkillDesciption.bottom);
				
				//아웃라인
				gpC_global_resource->DrawOutBoxLocked(rtOutline.x, rtOutline.y, rtOutline.w, rtOutline.h);

				RECT clipRect = { rtOutline.x+3, rtOutline.y+3, rtOutline.x+rtOutline.w-3, rtOutline.y+rtOutline.h-3 };
				gpC_base->m_p_DDSurface_back->SetClip(&clipRect);

				if(m_iDomain >= COMBAT_ID && m_iDomain <= ELEMENTAL_ID && m_skill_domain == SKILLDOMAIN_OUSTERS)
				{
					bool bCombat = false;

					SKILL_STEP step = (SKILL_STEP)(m_iDomain-COMBAT_ID+SKILL_STEP_OUSTERS_COMBAT);
					if(step == SKILL_STEP_OUSTERS_COMBAT)
						bCombat = true;

					if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
					{
						MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
						MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();

						int iconHalf = 18;

						while(ss != list.end())
						{
							const ACTIONINFO SkillID = (ACTIONINFO)*ss;
							const int sprX = (*g_pSkillInfoTable)[SkillID].GetX();
							const int sprY = (*g_pSkillInfoTable)[SkillID].GetY();
							if(sprX == 0 && sprY == 0)
							{
								ss++;
								continue;
							}
							
							POINT p = {rtOutline.x, rtOutline.y};
							p.x -= m_pC_skill_scroll_bar_width->GetScrollPos();
							p.y -= max(0,m_pC_skill_scroll_bar->GetScrollPos());
							
							SKILLINFO_NODE::SKILLTYPE_LIST::iterator itr = (*g_pSkillInfoTable)[SkillID].SkillTypeList.begin();
							SKILLINFO_NODE::SKILLTYPE_LIST::iterator endItr = (*g_pSkillInfoTable)[SkillID].SkillTypeList.end();
							
							//POINT source = {p.x+iconHalf+sprX, p.y+iconHalf+sprY}, dest;
							while(itr != endItr)
							{
								POINT source = {p.x+iconHalf+sprX, p.y+iconHalf+sprY}, dest;
								dest.x = (*g_pSkillInfoTable)[*itr].GetX();
								dest.y = (*g_pSkillInfoTable)[*itr].GetY();
								if((*g_pSkillInfoTable)[*itr].GetSkillStep() == SKILL_STEP_OUSTERS_ETC)
								{
									if(bCombat)
									{
										dest.x = LOWORD(dest.x);
										dest.y = LOWORD(dest.y);
									}
									else
									{
										dest.x = HIWORD(dest.x);
										dest.y = HIWORD(dest.y);
									}
								}
								dest.x = p.x+dest.x+iconHalf;
								dest.y = p.y+dest.y+iconHalf;

								BYTE r = 20, g = 31, b = 20;
								WORD c = CDirectDraw::Color(r, g, b);

								gpC_base->m_p_DDSurface_back->Line(source.x, source.y, dest.x, dest.y, c);

								// 현재 라디안
								float Radian = atan2f( float(dest.x - source.x), float(dest.y - source.y) );
								Radian += float( -60 ) * ( 3.141592f / 180.0f );
								int tx[2],ty[2],length = 5;

								source.x = (source.x+dest.x)/2;
								source.y = (source.y+dest.y)/2;

								float	cosValue = cosf( Radian );
								float	sinValue = sinf( Radian );
								
								tx[0] = float( length ) * cosValue;
								ty[0] = float( length ) * (-sinValue);

								Radian += float( -60 ) * ( 3.141592f / 180.0f );
								cosValue = cosf( Radian );
								sinValue = sinf( Radian );

								tx[1] = float( length ) * cosValue;
								ty[1] = float( length ) * (-sinValue);

								gpC_base->m_p_DDSurface_back->Line(source.x, source.y,source.x+tx[0], source.y+ty[0], c);
								gpC_base->m_p_DDSurface_back->Line(source.x, source.y,source.x+tx[1], source.y+ty[1], c);
								gpC_base->m_p_DDSurface_back->Line(source.x+tx[0], source.y+ty[0],source.x+tx[1], source.y+ty[1], c);

//								gpC_base->m_p_DDSurface_back->Line(source.x+tx[0], source.y+ty[0], source.x+tx[1], source.y+ty[1],0xFFFF);
																
								itr++;
							}

							ss++;
						}
					}
					// OUSTERS_ETC
					step = SKILL_STEP_OUSTERS_ETC;
					if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
					{
						MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
						MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();

						int iconHalf = 18;

						while(ss != list.end())
						{
							const ACTIONINFO SkillID = (ACTIONINFO)*ss;
							int sprX = (*g_pSkillInfoTable)[SkillID].GetX();
							int sprY = (*g_pSkillInfoTable)[SkillID].GetY();
							if(sprX == 0 && sprY == 0)
							{
								ss++;
								continue;
							}

							if(bCombat)
							{
								sprX = LOWORD(sprX);
								sprY = LOWORD(sprY);
							}
							else
							{
								sprX = HIWORD(sprX);
								sprY = HIWORD(sprY);
							}

							
							POINT p = {rtOutline.x, rtOutline.y};
							p.x -= m_pC_skill_scroll_bar_width->GetScrollPos();
							p.y -= max(0,m_pC_skill_scroll_bar->GetScrollPos());
							
							SKILLINFO_NODE::SKILLTYPE_LIST::iterator itr = (*g_pSkillInfoTable)[SkillID].SkillTypeList.begin();
							SKILLINFO_NODE::SKILLTYPE_LIST::iterator endItr = (*g_pSkillInfoTable)[SkillID].SkillTypeList.end();
							
							//POINT source = {p.x+iconHalf+sprX, p.y+iconHalf+sprY}, dest;
							while(itr != endItr)
							{
								POINT source = {p.x+iconHalf+sprX, p.y+iconHalf+sprY}, dest;
								dest.x = (*g_pSkillInfoTable)[*itr].GetX();
								dest.y = (*g_pSkillInfoTable)[*itr].GetY();
								if((*g_pSkillInfoTable)[*itr].GetSkillStep() == SKILL_STEP_OUSTERS_ETC)
								{
									if(bCombat)
									{
										dest.x = LOWORD(dest.x);
										dest.y = LOWORD(dest.y);
									}
									else
									{
										dest.x = HIWORD(dest.x);
										dest.y = HIWORD(dest.y);
									}
								}
								else
								{
									if(bCombat != ((*g_pSkillInfoTable)[*itr].GetSkillStep() == SKILL_STEP_OUSTERS_COMBAT))
									{
										itr++;
										continue;
									}
								}
								dest.x = p.x+dest.x+iconHalf;
								dest.y = p.y+dest.y+iconHalf;

								BYTE r = 20, g = 31, b = 20;
								WORD c = CDirectDraw::Color(r, g, b);

								gpC_base->m_p_DDSurface_back->Line(source.x, source.y, dest.x, dest.y, c);

								// 현재 라디안
								float Radian = atan2f( float(dest.x - source.x), float(dest.y - source.y) );
								Radian += float( -60 ) * ( 3.141592f / 180.0f );
								int tx[2],ty[2],length = 5;

								source.x = (source.x+dest.x)/2;
								source.y = (source.y+dest.y)/2;

								float	cosValue = cosf( Radian );
								float	sinValue = sinf( Radian );
								
								tx[0] = float( length ) * cosValue;
								ty[0] = float( length ) * (-sinValue);

								Radian += float( -60 ) * ( 3.141592f / 180.0f );
								cosValue = cosf( Radian );
								sinValue = sinf( Radian );

								tx[1] = float( length ) * cosValue;
								ty[1] = float( length ) * (-sinValue);

								gpC_base->m_p_DDSurface_back->Line(source.x, source.y,source.x+tx[0], source.y+ty[0], c);
								gpC_base->m_p_DDSurface_back->Line(source.x, source.y,source.x+tx[1], source.y+ty[1], c);
								gpC_base->m_p_DDSurface_back->Line(source.x+tx[0], source.y+ty[0],source.x+tx[1], source.y+ty[1], c);

//								gpC_base->m_p_DDSurface_back->Line(source.x+tx[0], source.y+ty[0], source.x+tx[1], source.y+ty[1],0xFFFF);
																
								itr++;
							}

							ss++;
						}
					}

					step = (SKILL_STEP)(m_iDomain-COMBAT_ID+SKILL_STEP_OUSTERS_COMBAT);

					if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
					{
						MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
						MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();

						ss = list.begin();

						while(ss != list.end())
						{
							const ACTIONINFO SkillID = (ACTIONINFO)*ss;
							MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus(SkillID);
							SKILLINFO_NODE sInfo = (*g_pSkillInfoTable)[SkillID];
							const int sprID = sInfo.GetSpriteID();
							const int sprX = sInfo.GetX();
							const int sprY = sInfo.GetY();
							if(sprX == 0 && sprY == 0)
							{
								ss++;
								continue;
							}
							
							bool bCanLearn = false;

							if(sInfo.SkillTypeList.empty())
								bCanLearn = true;
							else
							{
								SKILLINFO_NODE::SKILLTYPE_LIST::iterator itr = sInfo.SkillTypeList.begin();
								SKILLINFO_NODE::SKILLTYPE_LIST::iterator endItr = sInfo.SkillTypeList.end();
								
								while(itr != endItr)
								{
									if((*g_pSkillInfoTable)[*itr].GetSkillStep() == SKILL_STEP_OUSTERS_ETC && (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus((ACTIONINFO)*itr) == MSkillDomain::SKILLSTATUS_LEARNED)
									{
										SKILLINFO_NODE::SKILLTYPE_LIST::iterator itr2 = (*g_pSkillInfoTable)[*itr].SkillTypeList.begin();
										SKILLINFO_NODE::SKILLTYPE_LIST::iterator endItr2 = (*g_pSkillInfoTable)[*itr].SkillTypeList.end();
										while(itr2 != endItr2)
										{
											if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus((ACTIONINFO)*itr2) == MSkillDomain::SKILLSTATUS_LEARNED
												&& (bCombat == ((*g_pSkillInfoTable)[*itr2].GetSkillStep() == SKILL_STEP_OUSTERS_COMBAT) || (*g_pSkillInfoTable)[*itr2].GetSkillStep() == SKILL_STEP_OUSTERS_ETC))
											{
												bCanLearn = true;
												break;
											}
											itr2++;
										}
										if(bCanLearn)
											break;
									}
									else
									{
										if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus((ACTIONINFO)*itr) == MSkillDomain::SKILLSTATUS_LEARNED)
										{
											bCanLearn = true;
											break;
										}
									}
									itr++;
								}
							}
							
							//---------------------------------------
							// status는 다음과 같다. 
							//---------------------------------------
							//	MSkillDomain::SKILLSTATUS_LEARNED		// 배웠다.
							//	MSkillDomain::SKILLSTATUS_NEXT			// 다음에 배울 수 있다.
							//	MSkillDomain::SKILLSTATUS_OTHER			// 아직은 배울 수 없다.	
							//---------------------------------------
							POINT p = {rtOutline.x+sprX, rtOutline.y+sprY};
							p.x -= m_pC_skill_scroll_bar_width->GetScrollPos();
							p.y -= max(0,m_pC_skill_scroll_bar->GetScrollPos());
	
							switch(status)
							{
							case MSkillDomain::SKILLSTATUS_LEARNED:
								{
									if(sInfo.IsEnable() == false)
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
									}
									if(sInfo.IsPassive())
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&p, &C_VS_UI_SKILL::m_C_spk[sprID], 315-256);
									}
									else
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSprite(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
									}
								}
								break;
								
							default:
								if((sInfo.SkillPoint <= g_char_slot_ingame.skill_point && sInfo.GetLearnLevel() <= g_char_slot_ingame.level ) && bCanLearn)
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteColor(&p, &C_VS_UI_SKILL::m_C_spk[sprID], rgb_GREEN);
								}
								else
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
								}
								break;
							}
							//Skill icon back
							p.x-=7;p.y-=7;
							if(sInfo.GetLearnLevel()>1)
								gpC_base->m_p_DDSurface_back->BltSprite(&p, &gpC_global_resource->m_pC_info_spk->GetSprite(C_GLOBAL_RESOURCE::OUSTERS_SKILL_BACK_2));
							else
								gpC_base->m_p_DDSurface_back->BltSprite(&p, &gpC_global_resource->m_pC_info_spk->GetSprite(C_GLOBAL_RESOURCE::OUSTERS_SKILL_BACK));

							ss++;
//							gpC_global_resource->m_pC_info_spk->BltLocked(p.x-7, p.y-7, );
						}
					}

					// OUSTERS_ETC
					step = SKILL_STEP_OUSTERS_ETC;
					if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
					{
						MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
						MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();

						int iconHalf = 18;

						while(ss != list.end())
						{
							const ACTIONINFO SkillID = (ACTIONINFO)*ss;
							MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus(SkillID);
							SKILLINFO_NODE sInfo = (*g_pSkillInfoTable)[SkillID];
							const int sprID = sInfo.GetSpriteID();
							int sprX = sInfo.GetX();
							int sprY = sInfo.GetY();
							if(sprX == 0 && sprY == 0)
							{
								ss++;
								continue;
							}

							if(bCombat)
							{
								sprX = LOWORD(sprX);
								sprY = LOWORD(sprY);
							}
							else
							{
								sprX = HIWORD(sprX);
								sprY = HIWORD(sprY);
							}
							
							bool bCanLearn = false;

							if(sInfo.SkillTypeList.empty())
								bCanLearn = true;
							else
							{
								SKILLINFO_NODE::SKILLTYPE_LIST::iterator itr = sInfo.SkillTypeList.begin();
								SKILLINFO_NODE::SKILLTYPE_LIST::iterator endItr = sInfo.SkillTypeList.end();
								
								while(itr != endItr)
								{
									if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus((ACTIONINFO)*itr) == MSkillDomain::SKILLSTATUS_LEARNED)
									{
										bCanLearn = true;
										break;
									}
									itr++;
								}
							}
							
							//---------------------------------------
							// status는 다음과 같다. 
							//---------------------------------------
							//	MSkillDomain::SKILLSTATUS_LEARNED		// 배웠다.
							//	MSkillDomain::SKILLSTATUS_NEXT			// 다음에 배울 수 있다.
							//	MSkillDomain::SKILLSTATUS_OTHER			// 아직은 배울 수 없다.	
							//---------------------------------------
							POINT p = {rtOutline.x+sprX, rtOutline.y+sprY};
							p.x -= m_pC_skill_scroll_bar_width->GetScrollPos();
							p.y -= max(0,m_pC_skill_scroll_bar->GetScrollPos());
	
							switch(status)
							{
							case MSkillDomain::SKILLSTATUS_LEARNED:
								{
									if(sInfo.IsEnable() == false)
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
									}
									if(sInfo.IsPassive())
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&p, &C_VS_UI_SKILL::m_C_spk[sprID], 315-256);
									}
									else
									{
										if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
											gpC_base->m_p_DDSurface_back->BltSprite(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
									}
								}
								break;
								
							default:
								if((sInfo.SkillPoint <= g_char_slot_ingame.skill_point && sInfo.GetLearnLevel() <= g_char_slot_ingame.level )&& bCanLearn)
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteColor(&p, &C_VS_UI_SKILL::m_C_spk[sprID], rgb_GREEN);
								}
								else
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
								}
								break;
							}
							//Skill icon back
							p.x-=7;p.y-=7;
							if(sInfo.GetLearnLevel()>1)
								gpC_base->m_p_DDSurface_back->BltSprite(&p, &gpC_global_resource->m_pC_info_spk->GetSprite(C_GLOBAL_RESOURCE::OUSTERS_SKILL_BACK_2));
							else
								gpC_base->m_p_DDSurface_back->BltSprite(&p, &gpC_global_resource->m_pC_info_spk->GetSprite(C_GLOBAL_RESOURCE::OUSTERS_SKILL_BACK));

							ss++;
//							gpC_global_resource->m_pC_info_spk->BltLocked(p.x-7, p.y-7, );
						}
					}
				}
				gpC_base->m_p_DDSurface_back->SetClipNULL();

				m_pC_skill_button_group->Show();
				m_pC_common_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();

				m_pC_skill_scroll_bar->Show(x, y);
	 			m_pC_skill_scroll_bar_width->Show(x, y);

				Rect rect;
				skill_x += 60;
				skill_y -= 4;
				
				if(!GetAttributes()->alpha)
				{
					rect.Set(skill_x, skill_y, skill_x +40, skill_y+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
					gpC_base->m_p_DDSurface_back->FillRect((RECT *)&rect, 0);
				}
				if(gpC_base->m_p_DDSurface_back->Lock())
				{
					rect.Set(0, 0, 40, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(skill_x, skill_y, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(skill_x+rect.w, skill_y, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);

					gpC_base->m_p_DDSurface_back->Unlock();
				}

				char szTemp[512];
				sprintf(szTemp, "%d", g_char_slot_ingame.skill_point);
				g_PrintColorStrShadow(skill_x + 10, skill_y + 5, szTemp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);

//				m_pC_skill_button_group->ShowDescription();
				m_pC_common_button_group->ShowDescription();
			}
		}		
		break;
	}
}


const char * C_VS_UI_INFO::GetChinhoLevel(int level)
{
	static char sz_buf [32];
#ifdef __DESIGNED_CHS
	int LevelGrade = (level)/10;
	int LevelUnits = (level)%10;
	sprintf(sz_buf, (*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_0+LevelGrade].GetString(), LevelUnits);
#else
	int LevelGrade = (level-1)/10;
	int LevelUnits = (level-1)%10;

	sprintf(sz_buf, (*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_0+LevelGrade].GetString(), LevelUnits+1);
#endif

	return sz_buf;
//	const static char* chingho_name[11] = 
//	{
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_0].GetString(), 
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_1].GetString(), 
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_2].GetString(),
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_3].GetString(), 
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_4].GetString(),  
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_5].GetString(),  
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_6].GetString(),  
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_7].GetString(),  
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_8].GetString(),  
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_9].GetString(),  
//			(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANTE_10].GetString(), 
//	};
//	
//	int cur_ching_num = 0;
//	int last_num = 0;
//
//	if(level >= 1 && level <11)
//		cur_ching_num = 0;
//	else if(level >= 11 && level <21)
//		cur_ching_num = 1;
//	else if(level >= 21 && level <31)
//		cur_ching_num = 2;
//	else if(level >= 31 && level <41)
//		cur_ching_num = 3;
//	else if(level >= 41 && level <51)
//		cur_ching_num = 4;
//	else if(level >= 51 && level <61)
//		cur_ching_num = 5;
//	else if(level >= 61 && level <71)
//		cur_ching_num = 6;
//	else if(level >= 71 && level <81)
//		cur_ching_num = 7;
//	else if(level >= 81 && level <91)
//		cur_ching_num = 8;
//	else if(level >= 91 && level <101)
//		cur_ching_num = 9;
//	else if(level >= 101 && level <111)
//		cur_ching_num = 10;
//
//
////	if(level >= 151 && level <161)
////		cur_ching_num = 0;
////	else if(level >= 161 && level <171)
////		cur_ching_num = 1;
////	else if(level >= 171 && level <181)
////		cur_ching_num = 2;
////	else if(level >= 181 && level <191)
////		cur_ching_num = 3;
////	else if(level >= 191 && level <201)
////		cur_ching_num = 4;
////	else if(level >= 201 && level <211)
////		cur_ching_num = 5;
////	else if(level >= 211 && level <221)
////		cur_ching_num = 6;
////	else if(level >= 221 && level <231)
////		cur_ching_num = 7;
////	else if(level >= 231 && level <241)
////		cur_ching_num = 8;
////	else if(level >= 241 && level <251)
////		cur_ching_num = 9;
////	else if(level >= 251 && level <261)
////		cur_ching_num = 10;
//
//	last_num = level%10;
//	static char strtemp[256];
//	memset(strtemp,0,256);
//	wsprintf(strtemp, chingho_name[cur_ching_num],  last_num);
//	return strtemp;
}

//-------------------------------------------------------------------------------
//	Show 에서 분리			by sonee
//  _Show2()
//		>> Character Info
//-------------------------------------------------------------------------------
void	C_VS_UI_INFO::_Show2()
{
	const InterfaceInformation* pSkin = &g_pSkinManager->Get( SkinManager::INFO );

	const int slayerpos = pSkin->GetRect(0).left, vampirepos = pSkin->GetRect(0).top, ousterspos = pSkin->GetRect(0).right;
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			const int desc_box_x = pSkin->GetPoint( slayerpos ).x ,desc_box_y = pSkin->GetPoint( slayerpos ).y;
			const int field1_x = pSkin->GetPoint( slayerpos+1 ).x, field1_x2 = pSkin->GetPoint( slayerpos+1 ).y, 
								 field1_y = m_rt_char_box.y, field1_gap = 20;
			const int field2_x = m_rt_char_box.x, field2_x2 = field2_x+55, field2_y = desc_box_y, field2_gap = 20;
			
			
			if(!GetAttributes()->alpha)
			{
				RECT rect;
				rect.left = x+desc_box_x;
				rect.right = x+desc_box_x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DESC_BOX);
				rect.top = y+desc_box_y;
				rect.bottom = y+desc_box_y+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DESC_BOX);
				
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				
				int i = 0;
				int bar_width, bar_height;
				
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR);
				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);
				
				rect.left = x +field1_x2;
				rect.right = rect.left + bar_width;
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
				i = 4;
				if(g_char_slot_ingame.sz_guild_name.c_str() != NULL && strlen(g_char_slot_ingame.sz_guild_name.c_str()) > 0)
					i++;

				// 기여도만 칸이 크다 라이트 값을 키워 준다 하드 코딩..
				int contribute_bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SLAYER_CONTRIBUTE_LARGE_BAR);
				rect.top = y+field1_y+field1_gap*i;
				rect.right = rect.left + contribute_bar_width;
				rect.bottom = rect.top + bar_height;
				--i;
				
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				rect.right = rect.left + bar_width;
#else
				i = 3;
				if(g_char_slot_ingame.sz_guild_name.c_str() != NULL && strlen(g_char_slot_ingame.sz_guild_name.c_str()) > 0)
					i++;

#endif //__CONTRIBUTE_SYSTEM

	
				for(; i >= 0; i--)
				{
					if(i == 0)
					{
						rect.left = x +field1_x2;
						rect.right = rect.left + 70;
					}
					rect.top = y+field1_y+field1_gap*i;
					rect.bottom = rect.top+bar_height;

					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				}

				//by csm 슬레이어 칭호 
				if(g_char_slot_ingame.m_AdvancementLevel>0)
				{
					rect.top = y+field1_y; rect.bottom = rect.top + bar_height;
				rect.left = x +field1_x2+100; rect.right = rect.left + 100;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				}

				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR2);
				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SMALL_BAR2);

				rect.left = x +field2_x2;
				rect.right = rect.left + bar_width;
				
				for(i = 8; i > 2; i--)
				{
					rect.top = y+field2_y+field2_gap*i;
					rect.bottom = rect.top+bar_height;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				}
				
				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SMALL_BAR);
				for(i = 2; i >= 0; i--)
				{
					rect.top = y+field2_y+field2_gap*i;
					rect.bottom = rect.top+bar_height;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				}
				if(g_char_slot_ingame.bonus_point > 0)	// 보너스 포인트가 없을땐 출력하지 않는다.
				{
					rect.left = x +280;
					rect.top = y+82;
					rect.right = rect.left+38;
					rect.bottom = rect.top+20;
					
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
					
				}
			}
			
			if(gpC_base->m_p_DDSurface_back->Lock())	//그림 출력할게 많으므로 lock건 상태에서 한다.
			{
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-10, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_CHAR);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_char_box.x, y+m_rt_char_box.y, C_GLOBAL_RESOURCE::CHAR_BOX);
				
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+desc_box_x, y+desc_box_y, C_GLOBAL_RESOURCE::DESC_BOX);
				
				//얼굴 찍기
				POINT point = {x+m_rt_char_box.x+1, y+m_rt_char_box.y+1};
				
				if(m_p_face && m_p_face->GetSize() > 0)
				{
					gpC_base->m_p_DDSurface_back->BltSprite(&point, &(*m_p_face)[0]);
				}
				
				//name, fame, align, guild출력
				POINT	AddPosition = pSkin->GetPoint(slayerpos+2);
				AddPosition.x += x + field1_x;
				AddPosition.y += y + field1_y;
				gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x, AddPosition.y+field1_gap*0, C_GLOBAL_RESOURCE::TITLE_NAME);
				
				if(g_char_slot_ingame.m_AdvancementLevel>0)
					gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x+103, AddPosition.y+field1_gap*0, C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_NAME);

				gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x, AddPosition.y+field1_gap*1, C_GLOBAL_RESOURCE::TITLE_FAME);
				gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x, AddPosition.y+field1_gap*2, C_GLOBAL_RESOURCE::TITLE_ALIGN);
				
				//길드마크가 있으면 길드 마크를 출력하고, 없으면 Clan라는 글자를 출력, 길드 자체가 없으면 아예 출력 안함
				int gap_line=3;
				if(g_char_slot_ingame.sz_guild_name.c_str() != NULL && strlen(g_char_slot_ingame.sz_guild_name.c_str()) > 0)
				{
					if(m_p_guild_mark)
					{
						POINT point = {x+258, y+field1_y+field1_gap*3};
						gpC_base->m_p_DDSurface_back->BltSprite(&point, m_p_guild_mark);
						gpC_global_resource->m_pC_info_spk->BltLocked(point.x-1, point.y-1, C_GLOBAL_RESOURCE::GUILD_BACK);
					}
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x+10, y+field1_y+field1_gap*3+3, C_GLOBAL_RESOURCE::TITLE_TEAM);					
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2, y+field1_y+field1_gap*3, C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field1_y+field1_gap*3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					gap_line++;
				}			
				// 계급 이미지				
				if(g_char_slot_ingame.GRADE > 0 &&g_char_slot_ingame.GRADE <= GRADE_MARK_MAX)				
				{
					CSprite* GradeMark=g_pGuildMarkManager->GetGradeMarkSmall(g_char_slot_ingame.GRADE-1,g_eRaceInterface);
					if(GradeMark!=NULL)
					{
						POINT GradePoint = { x+258, y+field1_y+field1_gap*gap_line};
						gpC_base->m_p_DDSurface_back->BltSprite(&GradePoint,GradeMark);
					}
				}				  
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x+2,y+field1_y+field1_gap*gap_line+3,C_GLOBAL_RESOURCE::TITLE_GRADE);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2,y+field1_y+field1_gap*gap_line, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field1_y+field1_gap*gap_line, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				//by csm Ui 수정 
				//gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2, y+field1_y+field1_gap*0, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2, y+field1_y+field1_gap*0, C_GLOBAL_RESOURCE::SMALL_BAR2);
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
				gap_line++;
				gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x, AddPosition.y+field1_gap*gap_line, C_GLOBAL_RESOURCE::SLAYER_CONTRIBUTE);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2,y+field1_y+field1_gap*gap_line, C_GLOBAL_RESOURCE::SLAYER_CONTRIBUTE_LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SLAYER_CONTRIBUTE_LARGE_BAR), y+field1_y+field1_gap*gap_line, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
#endif //__CONTRIBUTE_SYSTEM
				if(g_char_slot_ingame.m_AdvancementLevel>0)
				{
					Rect rect_;
					rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+70+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field1_y+field1_gap*0, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2+100, y+field1_y+field1_gap*0, rect_, C_GLOBAL_RESOURCE::LARGE_BAR);
				}
				




				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2, y+field1_y+field1_gap*1, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2, y+field1_y+field1_gap*2, C_GLOBAL_RESOURCE::LARGE_BAR);
				//gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field1_y+field1_gap*0, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field1_y+field1_gap*1, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field1_y+field1_gap*2, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);


				//str, dx, int, hp, mp, tohit, damage, defence, protection출력
				AddPosition.x = x + field2_x;
				AddPosition.y = y + field2_y;

				for(int i = 0; i < 4; i++ )
				{
					gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x + pSkin->GetPoint( slayerpos + i + 3 ).x,
						AddPosition.y + pSkin->GetPoint( slayerpos + i + 3 ).y + field2_gap * i, C_GLOBAL_RESOURCE::TITLE_STR + i );
				}

				gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x + pSkin->GetPoint( slayerpos+ 4 + 3 ).x,   
					AddPosition.y+field2_gap*4+ pSkin->GetPoint( slayerpos+ 4 + 3 ).y, C_GLOBAL_RESOURCE::TITLE_MP);

				for(i = 5; i <= 8; i++ )
				{
					gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x + pSkin->GetPoint( slayerpos + i + 3 ).x,
						AddPosition.y + pSkin->GetPoint( slayerpos + i + 3 ).y + field2_gap * i, C_GLOBAL_RESOURCE::TITLE_TOHIT + i - 5 );
				}

				AddPosition.x = x + field2_x2;

				for( i = 0; i <= 2 ; i++ )
					gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x, AddPosition.y+field2_gap*i, C_GLOBAL_RESOURCE::SMALL_BAR);
				
				for( i = 3; i <= 8 ; i++ )
					gpC_global_resource->m_pC_info_spk->BltLocked( AddPosition.x, AddPosition.y+field2_gap*i, C_GLOBAL_RESOURCE::SMALL_BAR2 );				
				
				
				//EXP BAR
				Rect rect;
				__int64 goal_exp = g_pExperienceTable->GetSTRInfo(g_char_slot_ingame.STR_PURE).GoalExp;
				if(goal_exp)
				{
					rect.Set(0, 0, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::EXP_BAR)*(goal_exp - g_char_slot_ingame.STR_EXP_REMAIN)/(max(1, goal_exp)), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::EXP_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+field2_x2+3, y+field2_y+field2_gap*0+18, rect, C_GLOBAL_RESOURCE::EXP_BAR);
				}
				
				goal_exp = g_pExperienceTable->GetDEXInfo(g_char_slot_ingame.DEX_PURE).GoalExp;
				if(goal_exp)
				{
					rect.Set(0, 0, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::EXP_BAR)*(goal_exp - g_char_slot_ingame.DEX_EXP_REMAIN)/(max(1, goal_exp)), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::EXP_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+field2_x2+3, y+field2_y+field2_gap*1+18, rect, C_GLOBAL_RESOURCE::EXP_BAR);
				}
				
				goal_exp = g_pExperienceTable->GetINTInfo(g_char_slot_ingame.INT_PURE).GoalExp;
				if(goal_exp)
				{
					rect.Set(0, 0, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::EXP_BAR)*(goal_exp - g_char_slot_ingame.INT_EXP_REMAIN)/(max(1, goal_exp)), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::EXP_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+field2_x2+3, y+field2_y+field2_gap*2+18, rect, C_GLOBAL_RESOURCE::EXP_BAR);
				}
				if(/*g_eRaceInterface != RACE_SLAYER && */g_char_slot_ingame.bonus_point > 0)
					m_pC_char_button_group->Show();
				
				if(g_char_slot_ingame.bonus_point > 0)	// 보너스 포인트가 없을땐 출력하지 않는다.
				{
					gpC_global_resource->m_pC_info_spk->BltLocked(x + 285, y+70, 	C_GLOBAL_RESOURCE::ADVANCEMENT_BONUS_POINT);
					
					rect.Set(0, 0, 40, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x +280, y+82, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
					//gpC_global_resource->m_pC_info_spk->BltLocked(x +270, y+82, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				}
				m_pC_common_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();
			}
			
			//글자 출력할게 많으므로 따로 모아서 한다.
			g_FL2_GetDC();
			char sz_temp[50];
			std::string sstr;
			
			////////////////field1/////////////////////
			//name
			g_PrintColorStr(x+field1_x2+5, y+field1_y+field1_gap*0+5, g_char_slot_ingame.sz_name.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);

			if(g_char_slot_ingame.m_AdvancementLevel > 0) // 2차 전직 용 기어 인터페이스 
				g_PrintColorStr(x+field1_x2+105, y+field1_y+field1_gap*0+5, GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel), gpC_base->m_chatting_pi, RGB_WHITE);
//			else
//				g_PrintColorStr(x+field1_x2+105, y+field1_y+field1_gap*0+5, " " , gpC_base->m_chatting_pi, RGB_WHITE);

			//gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+130, y+field1_y+field1_gap*0, C_GLOBAL_RESOURCE::SMALL_BAR2);

			//fame
			// 숫자사이에 ,넣기
			wsprintf(sz_temp, "%d", g_char_slot_ingame.FAME);
			sstr = sz_temp;
			
			for(int i = 3; i <= 13; i += 4)
				if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
				
			g_PrintColorStr(x+field1_x2+5, y+field1_y+field1_gap*1+5, sstr.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
			//align
			const static char* align_temp[5] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_VERY_BAD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_BAD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_NORMAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_GOOD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_VERY_GOOD].GetString(),
			};
			g_PrintColorStr(x+field1_x2+5, y+field1_y+field1_gap*2+5, align_temp[g_char_slot_ingame.alignment], gpC_base->m_chatting_pi, RGB_WHITE);
			//guild
			
			int gap_line=3;
			if(g_char_slot_ingame.sz_guild_name.c_str() != NULL&&
				!g_char_slot_ingame.sz_guild_name.empty())
				//g_char_slot_ingame.sz_guild_name.size()>0)###@@@
			{
				g_PrintColorStr(x+field1_x2+5, y+field1_y+field1_gap*3+5, g_char_slot_ingame.sz_guild_name.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
				gap_line++;
			}
			// GRADE
			const static char* grade[20] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PIVATE].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_SERENT].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FEACEL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LITENA].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KAINEL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GENEAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FORE_GENEAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MAJORIS_GENEAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CLOEL_GENEAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARSHAL].GetString(),
				"의裂제좆",
				"괭裂제좆",
				"襟裂제좆",
				"빪裂제좆",
				"斤嵐裂제",
				"覩제寧뿐바",
				"累逃",
				"댕낵",
				"累낀",
				"悧잿",
			};
			
			
			if(g_char_slot_ingame.GRADE > 0 &&g_char_slot_ingame.GRADE <= GRADE_MARK_MAX)
				g_PrintColorStr(x+field1_x2+5,y+field1_y+field1_gap*gap_line+5,grade[(g_char_slot_ingame.GRADE-1)/5],gpC_base->m_chatting_pi,RGB_WHITE);
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
			gap_line++;
			int contributeGrade = countContributeGrade(g_char_slot_ingame.ContributePoint);
			if (contributeGrade >= 0 || contributeGrade < 8)
			{
				wsprintf(sz_temp, "%d/%d%s %s", g_char_slot_ingame.ContributePoint,contributeGrade, (*g_pGameStringTable)[UI_STRING_CONTRIBUTE_GRADE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_SLAYER_CONTRIBUTENAME_7+(7-contributeGrade)].GetString());
				g_PrintColorStr(x+field1_x2+5,y+field1_y+field1_gap*gap_line+5,sz_temp,gpC_base->m_chatting_pi,RGB_WHITE);
			}
#endif //__CONTRIBUTE_SYSTEM			
			////////////////field2/////////////////////
			//str
 			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.STR_CUR, g_char_slot_ingame.STR_MAX);//, g_char_slot_ingame.STR_PURE);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*0+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			//dex
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.DEX_CUR, g_char_slot_ingame.DEX_MAX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*1+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			//int
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.INT_CUR, g_char_slot_ingame.INT_MAXX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*2+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			//hp
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.HP, g_char_slot_ingame.HP_MAX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*3+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			//mp
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.MP, g_char_slot_ingame.MP_MAX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*4+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			//tohit
			wsprintf(sz_temp, "%d", g_char_slot_ingame.TOHIT);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*5+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			if(g_char_slot_ingame.bonus_point > 0)//보너스 포인트가 없을땐 출력하지 않는다.
			{
				wsprintf(sz_temp, "%d", g_char_slot_ingame.bonus_point);
				g_PrintColorStr(x+290, y+86, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			}
			//damage
			int dam1, dam2;
			dam1 = g_char_slot_ingame.DAM + g_char_slot_ingame.SILVER_DAM;
			dam2 = g_char_slot_ingame.DAM2 + g_char_slot_ingame.SILVER_DAM2;
			
			if (dam1 == dam2)
				sprintf(sz_temp, "%d", dam1);
			else
				sprintf(sz_temp, "%d~%d", dam2, dam1);
			
			if(g_char_slot_ingame.SILVER_DAM > 0)
				g_PrintColorStrOut(x+field2_x2+5, y+field2_y+field2_gap*6+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLUE);
			else
				g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*6+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			//defence
			wsprintf(sz_temp, "%d", g_char_slot_ingame.DEFENSE);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*7+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			//protection
			wsprintf(sz_temp, "%d", g_char_slot_ingame.PROTECTION);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*8+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			// desc box
			int px = x+desc_box_x+5, py = y+desc_box_y+5;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_STR_PURE].GetString(), g_char_slot_ingame.STR_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_DEX_PURE].GetString(), g_char_slot_ingame.DEX_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_INT_PURE].GetString(), g_char_slot_ingame.INT_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_SUM_PURE].GetString(), g_char_slot_ingame.STR_PURE+g_char_slot_ingame.DEX_PURE+g_char_slot_ingame.INT_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_SUM].GetString(), g_char_slot_ingame.STR_CUR+g_char_slot_ingame.DEX_CUR+g_char_slot_ingame.INT_CUR);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			const static char *weapon_speed_string[3] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_SPEED_SLOW].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_SPEED_NORMAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_SPEED_FAST].GetString(),
			};
			
			wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_ATTACK_SPEED].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;

			py += 16;

			wsprintf(sz_temp,"듐얩:%d", g_pMoneyManager->GetDianJuan());
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_GOLD);
			py += 16;
			
			/*if(g_char_slot_ingame.MagicRemainSec > 0)
			{	

				DWORD IRange =  (GetTickCount() - g_char_slot_ingame.MagicRemainTick) / 1000 ; 
				DWORD TimeLimit = g_char_slot_ingame.MagicRemainSec -  IRange ;

				int days = TimeLimit / 60 / 60 / 24;
				int hours = (TimeLimit / 60 / 60) % 24;
				int minutes = (TimeLimit / 60 ) % 60;


				wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_MAGICAL_PET_CHANGER_ACTIVE].GetString());
				g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
				py += 16;
				
				wsprintf(sz_temp,"%d일 %d시간 %d분" , days , hours , minutes);
				g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
				py += 16;
			}*/
					



	//		wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_RESISTANCE_ACID].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
	//		g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
	//		py += 16;
	//
	//		wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_RESISTANCE_POISON].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
	//		g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
	//		py += 16;
	//		
	//		wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_RESISTANCE_BLOODY].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
	//		g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
	//		py += 16;		
	//
	//		wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_RESISTANCE_CURSE].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
	//		g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
	//		py += 16;
	//		
			if(/*g_eRaceInterface != RACE_SLAYER &&*/ g_char_slot_ingame.bonus_point > 0)
				m_pC_char_button_group->ShowDescription();
			
			m_pC_common_button_group->ShowDescription();
			g_FL2_ReleaseDC();
		}	
		break;
		
	case RACE_VAMPIRE:
		{
			const int desc_box_x = pSkin->GetPoint( vampirepos ).x ,desc_box_y = pSkin->GetPoint( vampirepos ).y;
			const int field1_x = pSkin->GetPoint( vampirepos + 1 ).x, field1_x2 = pSkin->GetPoint( vampirepos + 1).y, 
					field1_x3 = pSkin->GetPoint( vampirepos + 2 ).x, field1_x4 = pSkin->GetPoint (vampirepos + 2 ).y, 
					field1_y = m_rt_char_box.y, field1_gap = 20;
			const int field2_x = m_rt_char_box.x, field2_x2 = field2_x+55, field2_y = desc_box_y, field2_gap = 20;
			
			if(!GetAttributes()->alpha)
			{
				RECT rect;
				rect.left = x+desc_box_x;
				rect.right = x+desc_box_x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DESC_BOX);
				rect.top = y+desc_box_y;
				rect.bottom = y+desc_box_y+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DESC_BOX);
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				
				int i = 0;
				int bar_width, bar_height;
				
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR);
				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);
				
				rect.left = x +field1_x2;
				rect.right = rect.left + 65;
				for(i = 0; i < 2; i++)
				{
					rect.top = y+field1_y+field1_gap*i;
					rect.bottom = rect.top+bar_height;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				}
				
				if(g_char_slot_ingame.sz_guild_name.c_str() != NULL && strlen(g_char_slot_ingame.sz_guild_name.c_str()) > 0)
				{
					rect.top = y+field1_y+field1_gap*i+5;
					rect.bottom = rect.top+bar_height;
					rect.right = rect.left + 113;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
					i++;
				}
				
				rect.top = y+field1_y+field1_gap*i+5;
				rect.bottom = rect.top+bar_height;
				rect.right = rect.left + 113;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);

				i++;
				rect.top = y+field1_y+field1_gap*i+5;
				rect.bottom = rect.top+bar_height;
				rect.right = rect.left + 113;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);

#if __CONTENTS(__CONTRIBUTE_SYSTEM)
				i++;
				int contribute_bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::VAMPIRE_CONTRIBUTE_LARGE_BAR);
				rect.top = y+field1_y+field1_gap*i+5;
				rect.bottom = rect.top+bar_height;
//아래쪽에서 변경 되서 일반 적인 사이즈로 변경 안한다.				
				rect.right = rect.left + contribute_bar_width;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
#endif //__CONTRIBUTE_SYSTEM

				rect.left = x +field1_x4;
				rect.top = y+field1_y+field1_gap*0;
				rect.right = rect.left +95;
				rect.bottom = rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				
				rect.right = rect.left + gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR);
				rect.top = y+field1_y+field1_gap*1;
				rect.bottom = rect.top+bar_height+3;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				
				if(g_char_slot_ingame.bonus_point > 0)	// 보너스 포인트가 없을땐 출력하지 않는다.
				{
					rect.left = x +field1_x4+53;
					rect.top = y+field1_y+field1_gap*3+3;
					rect.right = rect.left +40;
					rect.bottom = rect.top+bar_height;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				}
				
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR2);
				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SMALL_BAR2);
				rect.left = x +field2_x2;
				rect.right = rect.left + bar_width;

				
				for(i = 7; i >= 0; i--)
				{
					rect.top = y+field2_y+field2_gap*i;
					rect.bottom = rect.top+bar_height;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				}
			}
			
			if(gpC_base->m_p_DDSurface_back->Lock())	// 그림 출력할게 많으므로 lock건 상태에서 한다.
			{
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x -m_modify_wide-7, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_CHAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_char_box.x, y+m_rt_char_box.y, C_GLOBAL_RESOURCE::CHAR_BOX);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+desc_box_x, y+desc_box_y, C_GLOBAL_RESOURCE::DESC_BOX);
				
				//얼굴 찍기
				POINT point = {x+m_rt_char_box.x+1, y+m_rt_char_box.y+1};
				if(m_p_face && m_p_face->GetSize() > 0)
				{
					gpC_base->m_p_DDSurface_back->BltSprite(&point, &(*m_p_face)[0]);
				}
				
				Rect rect;
				//name, align, clan출력
				POINT AddPosition = { x + field1_x + pSkin->GetPoint( vampirepos + 3 ).x , y + field1_y + pSkin->GetPoint( vampirepos + 3).y };
				gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x, AddPosition.y+field1_gap*0, C_GLOBAL_RESOURCE::TITLE_NAME);
				gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x, AddPosition.y+field1_gap*1, C_GLOBAL_RESOURCE::TITLE_ALIGN);
				
				int gap_line=2;
				//길드마크가 있으면 길드 마크를 출력하고, 없으면 GUILD라는 글자를 출력, 길드 자체가 없으면 아예 만다-_-;
				if(g_char_slot_ingame.sz_guild_name.c_str() != NULL && strlen(g_char_slot_ingame.sz_guild_name.c_str()) > 0)
				{
					if(m_p_guild_mark)
					{
						POINT point = {x+232, y+field1_y+field1_gap*2+6};
						gpC_base->m_p_DDSurface_back->BltSprite(&point, m_p_guild_mark);
						gpC_global_resource->m_pC_info_spk->BltLocked(point.x-1, point.y-1, C_GLOBAL_RESOURCE::GUILD_BACK);
					}					
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x+4, y+field1_y+field1_gap*2+3+5, C_GLOBAL_RESOURCE::TITLE_CLAN);
					rect.Set(0, 0, 113, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2, y+field1_y+field1_gap*2+5, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+113, y+field1_y+field1_gap*2+5, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					gap_line++;
				}
				// Grade 출력
				if(g_char_slot_ingame.GRADE > 0 &&g_char_slot_ingame.GRADE <= GRADE_MARK_MAX)				
				{
					POINT GradePoint = { x + 232, y + field1_y + field1_gap * gap_line + 6};
					CSprite* GradeMark=g_pGuildMarkManager->GetGradeMarkSmall(g_char_slot_ingame.GRADE-1,g_eRaceInterface);
					if(GradeMark!=NULL)
						gpC_base->m_p_DDSurface_back->BltSprite(&GradePoint,GradeMark);
				}
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x + field1_x+4, y + field1_y + field1_gap * gap_line+10,C_GLOBAL_RESOURCE::TITLE_GRADE2);				
				rect.Set(0, 0, 65, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2, y+field1_y+field1_gap*0, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+65, y+field1_y+field1_gap*0, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2, y+field1_y+field1_gap*1, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+65, y+field1_y+field1_gap*1, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				
				rect.Set(0, 0, 113, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2, y+field1_y+field1_gap*gap_line+5, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+113, y+field1_y+field1_gap*gap_line+5, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gap_line ++;
				
				// 뱀파이어 명성
				gpC_global_resource->m_pC_info_spk->BltLocked( x+ field1_x+pSkin->GetPoint( vampirepos + 12 ).x, 
					y+ field1_y + field1_gap * gap_line + pSkin->GetPoint( vampirepos + 12 ).y, 
					C_GLOBAL_RESOURCE::VAMPIRE_FAME);
				rect.Set(0, 0, 113, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2, y+field1_y+field1_gap*gap_line+5, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+113, y+field1_y+field1_gap*gap_line+5, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);

#if __CONTENTS(__CONTRIBUTE_SYSTEM)
				gap_line ++;
				int contribute_bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::VAMPIRE_CONTRIBUTE_LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked( x+ field1_x+pSkin->GetPoint( vampirepos + 12 ).x, 
					y+ field1_y + field1_gap * gap_line + pSkin->GetPoint( vampirepos + 12 ).y, 
					C_GLOBAL_RESOURCE::VAMPIRE_CONTRIBUTE);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2, y+field1_y+field1_gap*gap_line+5, C_GLOBAL_RESOURCE::VAMPIRE_CONTRIBUTE_LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2 + contribute_bar_width, y+field1_y+field1_gap*gap_line+5, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
#endif //__CONTRIBUTE_SYSTEM

				// level, exp, bonus출력
				if(g_char_slot_ingame.m_AdvancementLevel> 0) 
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x3+pSkin->GetPoint( vampirepos + 13 ).x, y+field1_y+field1_gap*0+pSkin->GetPoint( vampirepos + 13 ).y, 
					C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_NAME);
				else
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x3+pSkin->GetPoint( vampirepos + 13 ).x, y+field1_y+field1_gap*0+pSkin->GetPoint( vampirepos + 13 ).y, 
					C_GLOBAL_RESOURCE::TITLE_LEVEL);

				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x3+pSkin->GetPoint( vampirepos + 14 ).x, y+field1_y+field1_gap*1+pSkin->GetPoint( vampirepos + 14).y, 
					C_GLOBAL_RESOURCE::TITLE_EXP);
				if(g_char_slot_ingame.bonus_point > 0)	// 보너스 포인트가 없을땐 출력하지 않는다.
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x4+pSkin->GetPoint( vampirepos + 15).x, y+field1_y+field1_gap*2+pSkin->GetPoint( vampirepos + 15).y, 
					C_GLOBAL_RESOURCE::TITLE_BONUS);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x4, y+field1_y+field1_gap*0, C_GLOBAL_RESOURCE::SMALL_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x4, y+field1_y+field1_gap*1, C_GLOBAL_RESOURCE::SMALL_BAR);
				
				if(g_char_slot_ingame.bonus_point > 0)	// 보너스 포인트가 없을땐 출력하지 않는다.
				{
					rect.Set(0, 0, 40, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x4+53, y+field1_y+field1_gap*3+3, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x4+93, y+field1_y+field1_gap*3+3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				}
				
				// str, dex, int, hp, mp, tohit, damage, defence, protection출력
				AddPosition.x = x + field2_x;
				AddPosition.y = y + field2_y;
				for( int i = 0; i < 8 ; i ++ )
				{
					gpC_global_resource->m_pC_info_spk->BltLocked( AddPosition.x + pSkin->GetPoint( vampirepos + 4+i ).x,
						AddPosition.y + pSkin->GetPoint( vampirepos + 4 +i ).y + field2_gap * i,
						C_GLOBAL_RESOURCE::TITLE_STR + i );
				}

				AddPosition.x = x + field2_x2;
				AddPosition.y = y + field2_y;
				for( i = 0; i < 8 ; i++ )
				{
					gpC_global_resource->m_pC_info_spk->BltLocked( AddPosition.x, AddPosition.y + field2_gap * i, C_GLOBAL_RESOURCE::SMALL_BAR2 );
				}
				
				//EXP BAR
				if(g_pExperienceTable->GetVampireInfo(g_char_slot_ingame.level).GoalExp)
				{
					__int64 goal_exp = g_pExperienceTable->GetVampireInfo(g_char_slot_ingame.level).GoalExp;
					
					rect.Set(0, 0, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::EXP_BAR)*(goal_exp - g_char_slot_ingame.EXP_REMAIN)/(max(1, goal_exp)), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::EXP_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+field1_x4+3, y+field1_y+field1_gap*2, rect, C_GLOBAL_RESOURCE::EXP_BAR);
				}
				if(/*g_eRaceInterface != RACE_SLAYER &&*/ g_char_slot_ingame.bonus_point > 0)
					m_pC_char_button_group->Show();
				
				m_pC_common_button_group->Show();
				
				gpC_base->m_p_DDSurface_back->Unlock();
			}
				
			//글자 출력할게 많으므로 따로 모아서 한다.
			g_FL2_GetDC();
			char sz_temp[50];
			std::string sstr;
			
			////////////////field1/////////////////////
			//name
			g_PrintColorStr(x+field1_x2+5, y+field1_y+field1_gap*0+5, g_char_slot_ingame.sz_name.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
			//align
			const static char *align_temp[5] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_VERY_BAD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_BAD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_NORMAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_GOOD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_VERY_GOOD].GetString(),
			};
			g_PrintColorStr(x+field1_x2+5, y+field1_y+field1_gap*1+5, align_temp[g_char_slot_ingame.alignment], gpC_base->m_chatting_pi, RGB_WHITE);
			//guild
			int gap_line=2;
			
			if(g_char_slot_ingame.sz_guild_name.c_str() != NULL&&
				!g_char_slot_ingame.sz_guild_name.empty())
				//g_char_slot_ingame.sz_guild_name.size()>0)		###@@@
			{
				g_PrintColorStr(x+field1_x2+5, y+field1_y+field1_gap*2+5+5, g_char_slot_ingame.sz_guild_name.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
				gap_line++;
			}
			
			const static char* grade[20] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_RITTER].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_REICHSRITTER].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BARONET].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PREYHER].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GRAF].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARKGRAF].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PFALZGRAF].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FURST].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HERZOG].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LANDESHER].GetString(),
				"랗된븜얽",
				"寧된븜얽",
				"쥴寮",
				"朞뒨븜",
				"무얽",
				"댕무얽",
				"항珙",
				"뇨엌",
				"沂뽈",
				"열힁",
			};
			
			if(g_char_slot_ingame.GRADE > 0 &&g_char_slot_ingame.GRADE <= GRADE_MARK_MAX)			
				g_PrintColorStr(x+field1_x2+5,y+field1_y+field1_gap*gap_line+5+5,grade[(g_char_slot_ingame.GRADE-1)/5],gpC_base->m_chatting_pi,RGB_WHITE);

			wsprintf(sz_temp,"%d", g_char_slot_ingame.FAME);
			sstr = sz_temp;
			for(int i = 3; i <= 13; i += 4)
				if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");

			gap_line++;
			g_PrintColorStr(x + field1_x2+5, y+field1_y+field1_gap*gap_line+5+5, sstr.c_str(), gpC_base->m_chatting_pi,RGB_WHITE);
			
			//level
			//wsprintf(sz_temp, "%d", g_char_slot_ingame.level);
			if(g_char_slot_ingame.m_AdvancementLevel> 0) 
				g_PrintColorStr(x+field1_x4+5, y+field1_y+field1_gap*0+5, GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel), gpC_base->m_chatting_pi, RGB_WHITE);
			else
			{
				wsprintf(sz_temp, "%d", g_char_slot_ingame.level);
				g_PrintColorStr(x+field1_x4+5, y+field1_y+field1_gap*0+5, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			}
			//exp
			g_PrintColorStr(x+field1_x4+5, y+field1_y+field1_gap*1+5, g_GetNumberString(g_char_slot_ingame.EXP_REMAIN).c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
			//bonus
			if(g_char_slot_ingame.bonus_point > 0)//보너스 포인트가 없을땐 출력하지 않는다.
			{
				wsprintf(sz_temp, "%d", g_char_slot_ingame.bonus_point);
				g_PrintColorStr(x+field1_x4+53+5, y+field1_y+field1_gap*3+5+3, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			}
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
			gap_line++;
			int contributeGrade = countContributeGrade(g_char_slot_ingame.ContributePoint);
			if (contributeGrade >= 0 || contributeGrade < 8)
			{
				wsprintf(sz_temp, "%d/%d%s %s", g_char_slot_ingame.ContributePoint,contributeGrade, (*g_pGameStringTable)[UI_STRING_CONTRIBUTE_GRADE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_VAMPIRE_CONTRIBUTENAME_7+(7-contributeGrade)].GetString());
				g_PrintColorStr(x+field1_x2+5,y+field1_y+field1_gap*gap_line+9,sz_temp,gpC_base->m_chatting_pi,RGB_WHITE);
			}
#endif //__CONTRIBUTE_SYSTEM
			
			////////////////field2/////////////////////
			//str
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.STR_CUR, g_char_slot_ingame.STR_MAX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*0+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			//dex
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.DEX_CUR, g_char_slot_ingame.DEX_MAX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*1+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			//int
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.INT_CUR, g_char_slot_ingame.INT_MAXX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*2+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			//hp
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.HP, g_char_slot_ingame.HP_MAX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*3+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			//tohit
			wsprintf(sz_temp, "%d", g_char_slot_ingame.TOHIT);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*4+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			//damage
			int dam1, dam2;
			dam1 = g_char_slot_ingame.DAM + g_char_slot_ingame.SILVER_DAM;
			dam2 = g_char_slot_ingame.DAM2 + g_char_slot_ingame.SILVER_DAM2;
			
			if (dam1 == dam2)
				sprintf(sz_temp, "%d", dam1);
			else
				sprintf(sz_temp, "%d~%d", dam2, dam1);
			
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*5+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			//defence
			wsprintf(sz_temp, "%d", g_char_slot_ingame.DEFENSE);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*6+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			//protection
			wsprintf(sz_temp, "%d", g_char_slot_ingame.PROTECTION);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*7+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			
			// desc box
			int px = x+desc_box_x+5, py = y+desc_box_y+5;
			
			wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_STR_PURE].GetString(), g_char_slot_ingame.STR_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp, 	(*g_pGameStringTable)[UI_STRING_MESSAGE_DEX_PURE].GetString(), g_char_slot_ingame.DEX_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_INT_PURE].GetString(), g_char_slot_ingame.INT_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_SUM_PURE].GetString(), g_char_slot_ingame.STR_PURE+g_char_slot_ingame.DEX_PURE+g_char_slot_ingame.INT_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_SUM].GetString(), g_char_slot_ingame.STR_CUR+g_char_slot_ingame.DEX_CUR+g_char_slot_ingame.INT_CUR);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			const static char *weapon_speed_string[3] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_SPEED_SLOW].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_SPEED_NORMAL].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_SPEED_FAST].GetString(),
			};
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_ATTACK_SPEED].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;

			py += 16;

			wsprintf(sz_temp, "듐얩:%d", g_pMoneyManager->GetDianJuan());
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_GOLD);
			py += 16;
			/*if(g_char_slot_ingame.MagicRemainSec > 0)
			{
				
				DWORD IRange =  (GetTickCount() - g_char_slot_ingame.MagicRemainTick) / 1000 ; 
				DWORD TimeLimit = g_char_slot_ingame.MagicRemainSec -  IRange ;

				int days = TimeLimit / 60 / 60 / 24;
				int hours = (TimeLimit / 60 / 60) % 24;
				int minutes = (TimeLimit / 60 ) % 60;


				wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_MAGICAL_PET_CHANGER_ACTIVE].GetString());
				g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
				py += 16;
				
				wsprintf(sz_temp,"%d일 %d시간 %d분" , days , hours , minutes);
				g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
				py += 16;
			}*/

	//		wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_RESISTANCE_ACID].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
	//		g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
	//		py += 16;
	//
	//		wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_RESISTANCE_POISON].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
	//		g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
	//		py += 16;
	//		
	//		wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_RESISTANCE_BLOODY].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
	//		g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
	//		py += 16;		
	//
	//		wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_RESISTANCE_CURSE].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
	//		g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
	//		py += 16;
	//		
			if(/*g_eRaceInterface != RACE_SLAYER &&*/ g_char_slot_ingame.bonus_point > 0)
				m_pC_char_button_group->ShowDescription();
			
			m_pC_common_button_group->ShowDescription();
			
			g_FL2_ReleaseDC();
		}
		break;
		
	case RACE_OUSTERS:
		{
			const int desc_box_x = pSkin->GetPoint( ousterspos ).x,desc_box_y = pSkin->GetPoint( ousterspos ).y;
			const int field1_x = pSkin->GetPoint( ousterspos + 1).x, field1_x2 = pSkin->GetPoint( ousterspos + 1).y, 
				field1_x3 = pSkin->GetPoint( ousterspos + 2).x, field1_x4 = pSkin->GetPoint( ousterspos + 2).y, 
				field1_y = m_rt_char_box.y+1, field1_gap = 20;
			const int field2_x = m_rt_char_box.x + 5, field2_x2 = field2_x+55, field2_y = desc_box_y, field2_gap = 20;
			
			if(!GetAttributes()->alpha)
			{
				RECT rect;
				rect.left = x+desc_box_x;
				rect.right = x+desc_box_x+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DESC_BOX);
				rect.top = y+desc_box_y;
				rect.bottom = y+desc_box_y+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DESC_BOX);
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				
				int i = 0;
				int bar_width, bar_height;
				
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR);
				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);
				
				rect.left = x +field1_x2;
				rect.right = rect.left + 65;
				for(i = 0; i < 2; i++)
				{
					rect.top = y+field1_y+field1_gap*i;
					rect.bottom = rect.top+bar_height;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				}
				
				if(g_char_slot_ingame.sz_guild_name.c_str() != NULL && strlen(g_char_slot_ingame.sz_guild_name.c_str()) > 0)
				{
					rect.top = y+field1_y+field1_gap*i+5;
					rect.bottom = rect.top+bar_height;
					rect.right = rect.left + 113;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
					i++;
				}
				
				rect.top = y+field1_y+field1_gap*i+5;
				rect.bottom = rect.top+bar_height;
				rect.right = rect.left + 113;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);

				i++;
				rect.top = y+field1_y+field1_gap*i+5;
				rect.bottom = rect.top+bar_height;
				rect.right = rect.left + 113;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				
#if __CONTENTS(__CONTRIBUTE_SYSTEM)

//아래쪽에서 변경 되서 일반 적인 사이즈로 변경 안한다.				
				i++;
				int contribute_bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_CONTRIBUTE_LARGE_BAR);
				rect.top = y+field1_y+field1_gap*i+5;
				rect.bottom = rect.top+bar_height;
				rect.right = rect.left + contribute_bar_width;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
#endif //__CONTRIBUTE_SYSTEM

				rect.left = x +field1_x4;
				rect.top = y+field1_y+field1_gap*0;
				rect.right = rect.left +95;
				rect.bottom = rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				
				rect.right = rect.left + gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR);
				rect.top = y+field1_y+field1_gap*1;
				rect.bottom = rect.top+bar_height+3;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				
				if(g_char_slot_ingame.bonus_point > 0)	// 보너스 포인트가 없을땐 출력하지 않는다.
				{
					rect.left = x +field1_x4+53;
					rect.top = y+field1_y+field1_gap*3+3;
					rect.right = rect.left +40;
					rect.bottom = rect.top+bar_height;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				}
				
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR2);
				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SMALL_BAR2);
				rect.left = x +field2_x2;
				rect.right = rect.left + bar_width;
				
				for(i = 8; i >= 0; i--)
				{
					rect.top = y+field2_y+field2_gap*i;
					rect.bottom = rect.top+bar_height;
					gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				}
			}
			
			if(gpC_base->m_p_DDSurface_back->Lock())	// 그림 출력할게 많으므로 lock건 상태에서 한다.
			{
				const int fix_face_x = 2, fix_face_y = 10;
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x -m_modify_wide-5, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_CHAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_char_box.x+fix_face_x, y+m_rt_char_box.y+fix_face_y, C_GLOBAL_RESOURCE::CHAR_BOX);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+desc_box_x, y+desc_box_y, C_GLOBAL_RESOURCE::DESC_BOX);
				
				//얼굴 찍기
				POINT point = {x+m_rt_char_box.x+1+fix_face_x, y+m_rt_char_box.y+1+fix_face_y};
				if(m_p_face && m_p_face->GetSize() > 0)
				{
					gpC_base->m_p_DDSurface_back->BltSprite(&point, &(*m_p_face)[0]);
				}
				
				Rect rect;
				//name, align, clan출력
				POINT AddPosition = { x+ field1_x + pSkin->GetPoint( ousterspos + 3).x, y+field1_y+pSkin->GetPoint( ousterspos + 3).y };
				gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x, AddPosition.y+field1_gap*0, C_GLOBAL_RESOURCE::TITLE_NAME);
				gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x, AddPosition.y+field1_gap*1, C_GLOBAL_RESOURCE::TITLE_ALIGN);
				
				int gap_line=2;
				//길드마크가 있으면 길드 마크를 출력하고, 없으면 GUILD라는 글자를 출력, 길드 자체가 없으면 아예 만다-_-;
				if(g_char_slot_ingame.sz_guild_name.c_str() != NULL && strlen(g_char_slot_ingame.sz_guild_name.c_str()) > 0)
				{
					if(m_p_guild_mark)
					{
						POINT point = {x+232, y+field1_y+field1_gap*2+6};
						gpC_base->m_p_DDSurface_back->BltSprite(&point, m_p_guild_mark);
						gpC_global_resource->m_pC_info_spk->BltLocked(point.x-1, point.y-1, C_GLOBAL_RESOURCE::GUILD_BACK);
					}					
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x+pSkin->GetPoint( ousterspos + 4 ).x, y+field1_y+field1_gap*2+pSkin->GetPoint( ousterspos+4 ).y, 
						C_GLOBAL_RESOURCE::OUSTERS_TITLE_GUILD);
					rect.Set(0, 0, 113, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2, y+field1_y+field1_gap*2+5, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+113, y+field1_y+field1_gap*2+5, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					gap_line++;
				}
				// Grade 출력
				if(g_char_slot_ingame.GRADE > 0 &&g_char_slot_ingame.GRADE <= GRADE_MARK_MAX)				
				{
					POINT GradePoint = { x + 232, y + field1_y + field1_gap * gap_line + 6};
					CSprite* GradeMark=g_pGuildMarkManager->GetGradeMarkSmall(g_char_slot_ingame.GRADE-1,g_eRaceInterface);
					if(GradeMark!=NULL)
						gpC_base->m_p_DDSurface_back->BltSprite(&GradePoint,GradeMark);
				}
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x + field1_x+pSkin->GetPoint(ousterspos+5).x, y + field1_y + field1_gap * gap_line+pSkin->GetPoint(ousterspos+5).y,
					C_GLOBAL_RESOURCE::OUSTERS_TITLE_GRADE2);
				rect.Set(0, 0, 65, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2, y+field1_y+field1_gap*0, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+65, y+field1_y+field1_gap*0, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2, y+field1_y+field1_gap*1, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+65, y+field1_y+field1_gap*1, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				
				rect.Set(0, 0, 113, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2, y+field1_y+field1_gap*gap_line+5, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+113, y+field1_y+field1_gap*gap_line+5, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gap_line ++;
				
				// 뱀파이어 명성
				gpC_global_resource->m_pC_info_spk->BltLocked( x+ field1_x+pSkin->GetPoint( ousterspos + 6 ).x, y+ field1_y + field1_gap * gap_line +pSkin->GetPoint( ousterspos + 6 ).y, 
					C_GLOBAL_RESOURCE::OUSTERS_FAME);
				rect.Set(0, 0, 113, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x2, y+field1_y+field1_gap*gap_line+5, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+113, y+field1_y+field1_gap*gap_line+5, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);

#if __CONTENTS(__CONTRIBUTE_SYSTEM)	
				gap_line ++;
				int contribute_bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_CONTRIBUTE_LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked( x+ field1_x+pSkin->GetPoint( ousterspos + 6 ).x, y+ field1_y + field1_gap * gap_line +pSkin->GetPoint( ousterspos + 6 ).y, 
					C_GLOBAL_RESOURCE::OUSTERS_CONTRIBUTE);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2, y+field1_y+field1_gap*gap_line+5, C_GLOBAL_RESOURCE::OUSTERS_CONTRIBUTE_LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x2+contribute_bar_width, y+field1_y+field1_gap*gap_line+5, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
#endif //__CONTRIBUTE_SYSTEM

				// level, exp, bonus출력
				if(g_char_slot_ingame.m_AdvancementLevel> 0) 
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x3+pSkin->GetPoint(ousterspos+7).x, y+field1_y+field1_gap*0+pSkin->GetPoint(ousterspos+7).y, 
						C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_NAME);
				else
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x3+pSkin->GetPoint(ousterspos+7).x, y+field1_y+field1_gap*0+pSkin->GetPoint(ousterspos+7).y, 
						C_GLOBAL_RESOURCE::TITLE_LEVEL);

				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x3+pSkin->GetPoint(ousterspos+8).x, y+field1_y+field1_gap*1+pSkin->GetPoint(ousterspos+8).y, 
					C_GLOBAL_RESOURCE::TITLE_EXP);
				if(g_char_slot_ingame.bonus_point > 0)	// 보너스 포인트가 없을땐 출력하지 않는다.
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x4+pSkin->GetPoint(ousterspos+9).x, y+field1_y+field1_gap*2+pSkin->GetPoint(ousterspos+9).y, 
					C_GLOBAL_RESOURCE::TITLE_BONUS);
				
//				rect.Set(0, 0, 40, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x4, y+field1_y+field1_gap*0, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
//				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x4+40, y+field1_y+field1_gap*0, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x4, y+field1_y+field1_gap*0, C_GLOBAL_RESOURCE::SMALL_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x4, y+field1_y+field1_gap*1, C_GLOBAL_RESOURCE::SMALL_BAR);
				
				if(g_char_slot_ingame.bonus_point > 0)	// 보너스 포인트가 없을땐 출력하지 않는다.
				{
					rect.Set(0, 0, 40, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field1_x4+53, y+field1_y+field1_gap*3+3, rect, C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field1_x4+93, y+field1_y+field1_gap*3+3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				}
				
				// str, dex, int, hp, mp, tohit, damage, defence, protection출력
				int line_count = 0; 
				AddPosition.x = x+ field2_x;
				AddPosition.y = y+field2_y;
				for( int i =0;i<4;i++ )
				{
					gpC_global_resource->m_pC_info_spk->BltLocked( AddPosition.x + pSkin->GetPoint( ousterspos + 10 + i).x,
						AddPosition.y + pSkin->GetPoint( ousterspos+10+i).y + field2_gap*i, C_GLOBAL_RESOURCE::TITLE_STR + i );
				}

				gpC_global_resource->m_pC_info_spk->BltLocked(AddPosition.x + pSkin->GetPoint( ousterspos + 14 ).x, 
					AddPosition.y + pSkin->GetPoint( ousterspos + 14 ).y + field2_gap * i, C_GLOBAL_RESOURCE::OUSTERS_EP );

				for( i = 5; i <= 8; i ++)
				{
					gpC_global_resource->m_pC_info_spk->BltLocked( AddPosition.x + pSkin->GetPoint( ousterspos + 10 + i ).x,
						AddPosition.y + pSkin->GetPoint( ousterspos + 10 + i ).y + field2_gap * i, C_GLOBAL_RESOURCE::TITLE_TOHIT+i-5);
				}
				
				for(i=0;i<9;i++)
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field2_x2, y+field2_y+field2_gap*i, C_GLOBAL_RESOURCE::SMALL_BAR2);
//				
//				//EXP BAR
				if(g_pExperienceTable->GetOustersInfo(g_char_slot_ingame.level).GoalExp)
				{
					__int64 goal_exp = g_pExperienceTable->GetOustersInfo(g_char_slot_ingame.level).GoalExp;
					
					rect.Set(0, 0, 
						gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::EXP_BAR)*
						(goal_exp - g_char_slot_ingame.EXP_REMAIN)/
						(max(1, goal_exp)), 
						gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::EXP_BAR));
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+field1_x4+3, y+field1_y+field1_gap*2, rect, C_GLOBAL_RESOURCE::EXP_BAR);
				}
				if(/*g_eRaceInterface != RACE_SLAYER &&*/ g_char_slot_ingame.bonus_point > 0)
					m_pC_char_button_group->Show();
				
				m_pC_common_button_group->Show();
				
				gpC_base->m_p_DDSurface_back->Unlock();
			}
				
			//글자 출력할게 많으므로 따로 모아서 한다.
			g_FL2_GetDC();
			char sz_temp[50];
			std::string sstr;
			
			////////////////field1/////////////////////
			//name
			g_PrintColorStr(x+field1_x2+5, y+field1_y+field1_gap*0+5, g_char_slot_ingame.sz_name.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
			//align
			const static char *align_temp[5] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_VERY_BAD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_BAD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_NORMAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_GOOD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_VERY_GOOD].GetString(),
			};
			g_PrintColorStr(x+field1_x2+5, y+field1_y+field1_gap*1+5, align_temp[g_char_slot_ingame.alignment], gpC_base->m_chatting_pi, RGB_WHITE);
			//guild
			int gap_line=2;
			
			if(g_char_slot_ingame.sz_guild_name.c_str() != NULL&&
				!g_char_slot_ingame.sz_guild_name.empty())
				//g_char_slot_ingame.sz_guild_name.size()>0)		###@@@
			{
				g_PrintColorStr(x+field1_x2+5, y+field1_y+field1_gap*2+5+5, g_char_slot_ingame.sz_guild_name.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
				gap_line++;
			}
			
			const static char* grade[20] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MALCHUT].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_YESOD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HOD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NETRETH].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_TIPHRETH].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GEBURAH].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHESED].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BINAH].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHOKMA].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KEATHER].GetString(),
				"첨景윗",
				"속겟죗",
				"윗爾랑",
				"벗쳄랑",
				"쵠瀁잇",
				"엥찝랑",
				"힉샘랑",
				"른샘랑",
				"윗폡랑",
				"첨檢景징",
			};
			
			if(g_char_slot_ingame.GRADE > 0 &&g_char_slot_ingame.GRADE <= GRADE_MARK_MAX)			
				g_PrintColorStr(x+field1_x2+5,y+field1_y+field1_gap*gap_line+5+5,grade[(g_char_slot_ingame.GRADE-1)/5],gpC_base->m_chatting_pi,RGB_WHITE);

			wsprintf(sz_temp,"%d", g_char_slot_ingame.FAME);
			sstr = sz_temp;
			for(int i = 3; i <= 13; i += 4)
				if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");

			gap_line++;
			g_PrintColorStr(x + field1_x2+5, y+field1_y+field1_gap*gap_line+5+5, sstr.c_str(), gpC_base->m_chatting_pi,RGB_WHITE);
			
			//level
//			wsprintf(sz_temp, "%d", g_char_slot_ingame.level);
//			g_PrintColorStr(x+field1_x4+5, y+field1_y+field1_gap*0+5, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);

			if(g_char_slot_ingame.m_AdvancementLevel> 0) 
				g_PrintColorStr(x+field1_x4+5, y+field1_y+field1_gap*0+5, GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel), gpC_base->m_chatting_pi, RGB_WHITE);
			else
			{
				wsprintf(sz_temp, "%d", g_char_slot_ingame.level);
				g_PrintColorStr(x+field1_x4+5, y+field1_y+field1_gap*0+5, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			}

			//exp
			// 숫자사이에 ,넣기
			g_PrintColorStr(x+field1_x4+5, y+field1_y+field1_gap*1+5, g_GetNumberString(g_char_slot_ingame.EXP_REMAIN).c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
			//bonus
			if(g_char_slot_ingame.bonus_point > 0)//보너스 포인트가 없을땐 출력하지 않는다.
			{
				wsprintf(sz_temp, "%d", g_char_slot_ingame.bonus_point);
				g_PrintColorStr(x+field1_x4+53+5, y+field1_y+field1_gap*3+5+3, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			}

#if __CONTENTS(__CONTRIBUTE_SYSTEM)
			gap_line++;
			int contributeGrade = countContributeGrade(g_char_slot_ingame.ContributePoint);
			if (contributeGrade >= 0 || contributeGrade < 8)
			{
				wsprintf(sz_temp, "%d/%d%s %s", g_char_slot_ingame.ContributePoint,contributeGrade, (*g_pGameStringTable)[UI_STRING_CONTRIBUTE_GRADE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_OUSTERS_CONTRIBUTENAME_7+(7-contributeGrade)].GetString());
				g_PrintColorStr(x+field1_x2+5,y+field1_y+field1_gap*gap_line+9,sz_temp,gpC_base->m_chatting_pi,RGB_WHITE);
			}
#endif //__CONTRIBUTE_SYSTEM			

			////////////////field2/////////////////////
			//str
			int line_count = 0;
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.STR_CUR, g_char_slot_ingame.STR_MAX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*line_count+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			line_count++;
			//dex
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.DEX_CUR, g_char_slot_ingame.DEX_MAX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*line_count+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			line_count++;
			//int
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.INT_CUR, g_char_slot_ingame.INT_MAXX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*line_count+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			line_count++;
			//hp
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.HP, g_char_slot_ingame.HP_MAX);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*line_count+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			line_count++;
			// ep
			wsprintf(sz_temp, "%d/%d", g_char_slot_ingame.MP, g_char_slot_ingame.MP_MAX );
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*line_count+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			line_count++;
			//tohit
			wsprintf(sz_temp, "%d", g_char_slot_ingame.TOHIT);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*line_count+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			line_count++;
			//damage
			int dam1, dam2;
			dam1 = g_char_slot_ingame.DAM + g_char_slot_ingame.SILVER_DAM;
			dam2 = g_char_slot_ingame.DAM2 + g_char_slot_ingame.SILVER_DAM2;
			
			if (dam1 == dam2)
				sprintf(sz_temp, "%d", dam1);
			else
				sprintf(sz_temp, "%d~%d", dam2, dam1);
			
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*line_count+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			line_count++;
			//defence
			wsprintf(sz_temp, "%d", g_char_slot_ingame.DEFENSE);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*line_count+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			line_count++;
			//protection
			wsprintf(sz_temp, "%d", g_char_slot_ingame.PROTECTION);
			g_PrintColorStr(x+field2_x2+5, y+field2_y+field2_gap*line_count+4, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			line_count++;
			
			// desc box
			int px = x+desc_box_x+5, py = y+desc_box_y+5;
			
			wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_STR_PURE].GetString(), g_char_slot_ingame.STR_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp, 	(*g_pGameStringTable)[UI_STRING_MESSAGE_DEX_PURE].GetString(), g_char_slot_ingame.DEX_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_INT_PURE].GetString(), g_char_slot_ingame.INT_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_SUM_PURE].GetString(), g_char_slot_ingame.STR_PURE+g_char_slot_ingame.DEX_PURE+g_char_slot_ingame.INT_PURE);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_SUM].GetString(), g_char_slot_ingame.STR_CUR+g_char_slot_ingame.DEX_CUR+g_char_slot_ingame.INT_CUR);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;
			
			const static char *weapon_speed_string[3] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_SPEED_SLOW].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_SPEED_NORMAL].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_SPEED_FAST].GetString(),
			};
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_ATTACK_SPEED].GetString(), weapon_speed_string[g_char_slot_ingame.WS], g_char_slot_ingame.WeaponSpeed);
			g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			py += 16;

			int vx = 0;

			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_OUSTERS_STONE].GetString(), (*g_pGameStringTable)[UI_STRING_MESSAGE_ELEMENTAL_FIRE].GetString());
			vx = g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, g_ELEMENTAL_COLOR[ITEMTABLE_INFO::ELEMENTAL_TYPE_FIRE]);
			wsprintf(sz_temp, "%d", g_char_slot_ingame.ElementalFire);
			g_PrintColorStr(vx, py, sz_temp, gpC_base->m_chatting_pi, g_ELEMENTAL_COLOR[ITEMTABLE_INFO::ELEMENTAL_TYPE_FIRE]);
			py += 16;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_OUSTERS_STONE].GetString(), (*g_pGameStringTable)[UI_STRING_MESSAGE_ELEMENTAL_WATER].GetString());
			vx = g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, g_ELEMENTAL_COLOR[ITEMTABLE_INFO::ELEMENTAL_TYPE_WATER]);
			wsprintf(sz_temp, "%d", g_char_slot_ingame.ElementalWater);
			g_PrintColorStr(vx, py, sz_temp, gpC_base->m_chatting_pi, g_ELEMENTAL_COLOR[ITEMTABLE_INFO::ELEMENTAL_TYPE_WATER]);
			py += 16;
			
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_OUSTERS_STONE].GetString(), (*g_pGameStringTable)[UI_STRING_MESSAGE_ELEMENTAL_EARTH].GetString());
			vx = g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, g_ELEMENTAL_COLOR[ITEMTABLE_INFO::ELEMENTAL_TYPE_EARTH]);
			wsprintf(sz_temp, "%d", g_char_slot_ingame.ElementalEarth);
			g_PrintColorStr(vx, py, sz_temp, gpC_base->m_chatting_pi, g_ELEMENTAL_COLOR[ITEMTABLE_INFO::ELEMENTAL_TYPE_EARTH]);
			py += 16;

			py += 9;

			wsprintf(sz_temp, "듐얩:%d", g_pMoneyManager->GetDianJuan());
			g_PrintColorStr(vx - 92, py, sz_temp, gpC_base->m_chatting_pi, RGB_GOLD);
			py += 16;
			

			/*if(g_char_slot_ingame.MagicRemainSec > 0)
			{

				DWORD IRange =  (GetTickCount() - g_char_slot_ingame.MagicRemainTick) / 1000 ; 
				DWORD TimeLimit = g_char_slot_ingame.MagicRemainSec -  IRange ;

				int days = TimeLimit / 60 / 60 / 24;
				int hours = (TimeLimit / 60 / 60) % 24;
				int minutes = (TimeLimit / 60 ) % 60;


				wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_MAGICAL_PET_CHANGER_ACTIVE].GetString());
				g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
				py += 16;
				
				wsprintf(sz_temp,"%d일 %d시간 %d분" , days , hours , minutes);
				g_PrintColorStr(px, py, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
				py += 16;
			}*/
			
			if(/*g_eRaceInterface != RACE_SLAYER &&*/ g_char_slot_ingame.bonus_point > 0)
				m_pC_char_button_group->ShowDescription();
			
			m_pC_common_button_group->ShowDescription();
			
			g_FL2_ReleaseDC();
		}
		break;
	}
}

//------------------------------------------------------------------------------
//	Show 에서 분리			by sonee
//	_Show3()
//		>> Grade1
//------------------------------------------------------------------------------
void	C_VS_UI_INFO::_Show3()
{
	int grade_text_x=37,grade_text_y=40;
	////by csm 2004.12.30 Ui수정 
	//gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				bool drawGrade = false;
				if(g_char_slot_ingame.GRADE > 0 && g_char_slot_ingame.GRADE <= GRADE_MARK_MAX )
					drawGrade=true;
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-10, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE1);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_pC_grade1_button_group->GetButton(m_iGrade)->x,
					y+m_pC_grade1_button_group->GetButton(m_iGrade)->y-1, m_pC_grade1_button_group->GetButton(m_iGrade)->m_image_index+1);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+5,y+grade_text_y,C_GLOBAL_RESOURCE::GRADE_LEVEL_HILIGHTED);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::GRADE_EXP_HILIGHTED);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y-2,C_GLOBAL_RESOURCE::DOMAIN_BACK);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y+18,C_GLOBAL_RESOURCE::DOMAIN_BACK);
				
				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DOMAIN_BAR);
				
				RECT box_rect = {x+grade_text_x+87,y+grade_text_y+1,x+grade_text_x+87+barWidth,y+grade_text_y+1+barHeight};
				gpC_base->m_p_DDSurface_back->Unlock();
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				box_rect.top+=20;
				box_rect.bottom+=20;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();
				//			// BAR
				//			if(drawGrade)
				//			{
				//				Rect rect(0,0,(barWidth*min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE)/GRADE_MARK_MAX),barHeight);				
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::DOMAIN_BAR);
				//				rect.Set(0,0,
				//					max(0,min(barWidth,(barWidth*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)))),
				//					barHeight);
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::DOMAIN_BAR);
				//			}			
				//BAR
				int	exp_remain = g_char_slot_ingame.GRADE_EXP_REMAIN;
				__int64	goal_exp = max(1, g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface).GoalExp);
				
				
				if(drawGrade)
				{
					Rect rect(0,0,(barWidth*min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE)/GRADE_MARK_MAX),barHeight);				
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::DOMAIN_BAR);
					
					rect.Set(0, 0, barWidth*(goal_exp - exp_remain)/goal_exp, barHeight); // hyungony
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::DOMAIN_BAR);
				}
				m_pC_grade1_button_group->Show();
				gpC_global_resource->DrawOutBoxLocked(x+15, y+120, 292, 176);
				m_pC_common_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();
				g_FL2_GetDC();
				char sz_temp[80];
				//			if(drawGrade)
				//			{
				//				wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
				//				g_PrintColorStrOut(x+grade_text_x+87+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				//				wsprintf(sz_temp, "%d%%/100%%", 
				//					(100*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)));
				//				//wsprintf(sz_temp, "%d%%/100%%", (exp - prev_exp)*100/max(1, (next_exp - prev_exp)));
				//				g_PrintColorStrOut(x+grade_text_x+87+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				//			}
				if(drawGrade)
				{
					wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
					g_PrintColorStrOut(x+grade_text_x+87+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
					
					wsprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/goal_exp); // hyungony		
					g_PrintColorStrOut(x+grade_text_x+87+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				}
				g_FL2_ReleaseDC();
			}
		}		
		break;
		
	case RACE_VAMPIRE:
		{
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				bool drawGrade = false;
				
				if(g_char_slot_ingame.GRADE > 0 && g_char_slot_ingame.GRADE <= GRADE_MARK_MAX )
					drawGrade = true;
				
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-7, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE1);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_pC_grade1_button_group->GetButton(m_iGrade)->x,
					y+m_pC_grade1_button_group->GetButton(m_iGrade)->y-1, m_pC_grade1_button_group->GetButton(m_iGrade)->m_image_index+1);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+5,y+grade_text_y,C_GLOBAL_RESOURCE::GRADE_LEVEL_HILIGHTED);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::GRADE_EXP_HILIGHTED);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y-2,C_GLOBAL_RESOURCE::GRADE_BAR_BACK);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y+18,C_GLOBAL_RESOURCE::GRADE_BAR_BACK);
				
				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_BAR);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_BAR);
				
				RECT box_rect = {x+grade_text_x+92,y+grade_text_y+1,x+grade_text_x+92+barWidth,y+grade_text_y+1+barHeight};
				
				gpC_base->m_p_DDSurface_back->Unlock();
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				box_rect.top+=20;
				box_rect.bottom+=20;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();
				
				//			// BAR
				//			if(drawGrade)
				//			{
				//				Rect rect(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
				//				
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);				
				//				rect.Set(0,0,
				//					max(0,min(barWidth,(barWidth*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)))),
				//					barHeight);
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
				//			}
				
				
				int	exp_remain = g_char_slot_ingame.GRADE_EXP_REMAIN;
				__int64	goal_exp = max(1, g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface).GoalExp);
				
				if(drawGrade)
				{
					Rect rect(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
					
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
					
					rect.Set(0, 0, barWidth*(goal_exp-exp_remain)/goal_exp, barHeight);  // hyungony
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
				}
				
				m_pC_grade1_button_group->Show();
				gpC_global_resource->DrawOutBoxLocked(x+18, y+122, 298, 180);
				m_pC_common_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();
				g_FL2_GetDC();
				char sz_temp[80];
				if(drawGrade)
				{
					wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
					g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
					wsprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/goal_exp); // hyungony
					g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				}
				
				//			if(drawGrade)
				//			{
				//				wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
				//				g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				//				wsprintf(sz_temp, "%d%%/100%%", 
				//					(100*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)));
				//				g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				//			}
				g_FL2_ReleaseDC();			
			}
		}
		break;
		
	case RACE_OUSTERS:
		{
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				bool drawGrade = false;
				
				if(g_char_slot_ingame.GRADE > 0 && g_char_slot_ingame.GRADE <= GRADE_MARK_MAX )
					drawGrade = true;
				
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x -m_modify_wide-5, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE1);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_pC_grade1_button_group->GetButton(m_iGrade)->x,
					y+m_pC_grade1_button_group->GetButton(m_iGrade)->y-1, m_pC_grade1_button_group->GetButton(m_iGrade)->m_image_index+1);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+5,y+grade_text_y,C_GLOBAL_RESOURCE::GRADE_LEVEL_HILIGHTED);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::GRADE_EXP_HILIGHTED);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y-2,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2_BACK);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y+18,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2_BACK);
				
				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
				
				RECT box_rect = {x+grade_text_x+92,y+grade_text_y+1,x+grade_text_x+92+barWidth,y+grade_text_y+1+barHeight};
				
				gpC_base->m_p_DDSurface_back->Unlock();
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				box_rect.top+=20;
				box_rect.bottom+=20;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();
				
				//			// BAR
				//			if(drawGrade)
				//			{
				//				Rect rect(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
				//				
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);				
				//				rect.Set(0,0,
				//					max(0,min(barWidth,(barWidth*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)))),
				//					barHeight);
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
				//			}
				
				
				int	exp_remain = g_char_slot_ingame.GRADE_EXP_REMAIN;
				__int64	goal_exp = max(1, g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface).GoalExp);
				
				if(drawGrade)
				{
					Rect rect(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
					
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
					
					rect.Set(0, 0,barWidth*(goal_exp - exp_remain)/goal_exp, barHeight);  // hyungony
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
				}
				
				m_pC_grade1_button_group->Show();
				gpC_global_resource->DrawOutBoxLocked(x+18, y+122, 298, 180);
				m_pC_common_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();
				g_FL2_GetDC();
				char sz_temp[80];
				if(drawGrade)
				{
					wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
					g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
					wsprintf(sz_temp, "%d%%/100%%", (int)((goal_exp - exp_remain)*100/goal_exp)); // hyungony
					g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				}
				
				//			if(drawGrade)
				//			{
				//				wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
				//				g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				//				wsprintf(sz_temp, "%d%%/100%%", 
				//					(100*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)));
				//				g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				//			}
				g_FL2_ReleaseDC();			
			}
		break;
		}
	}
	
	m_pC_common_button_group->ShowDescription();
	m_pC_grade1_button_group->ShowDescription();
}

//------------------------------------------------------------------------------
//  Show 에서 분리			by sonee
//	_Show4()
//		>> Grade2
//------------------------------------------------------------------------------
void	C_VS_UI_INFO::_Show4()
{
//	gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);
//	if(gpC_base->m_p_DDSurface_back->Lock())
//	{
//		gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE2);		
//		m_pC_common_button_group->Show();
//		gpC_base->m_p_DDSurface_back->Unlock();
//	}
//	m_pC_common_button_group->ShowDescription();
	int grade_text_x=37,grade_text_y=40;
	//by csm 2004.12.30 Ui수정 
	//gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				bool drawGrade = false;
				if(g_char_slot_ingame.GRADE > 0 && g_char_slot_ingame.GRADE <= GRADE_MARK_MAX )
					drawGrade=true;
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-10, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE2);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_pC_grade2_button_group->GetButton(m_iGrade)->x,
					y+m_pC_grade2_button_group->GetButton(m_iGrade)->y-1, m_pC_grade2_button_group->GetButton(m_iGrade)->m_image_index+1);
//				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+5,y+grade_text_y,C_GLOBAL_RESOURCE::GRADE_LEVEL_HILIGHTED);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::GRADE_EXP_HILIGHTED);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y-2,C_GLOBAL_RESOURCE::DOMAIN_BACK);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y+18,C_GLOBAL_RESOURCE::DOMAIN_BACK);
				
				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DOMAIN_BAR);
				
				RECT box_rect = {x+grade_text_x+87,y+grade_text_y+1,x+grade_text_x+87+barWidth,y+grade_text_y+1+barHeight};
				gpC_base->m_p_DDSurface_back->Unlock();
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				box_rect.top+=20;
				box_rect.bottom+=20;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();
				//			// BAR
				//			if(drawGrade)
				//			{
				//				Rect rect(0,0,(barWidth*min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE)/GRADE_MARK_MAX),barHeight);				
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::DOMAIN_BAR);
				//				rect.Set(0,0,
				//					max(0,min(barWidth,(barWidth*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)))),
				//					barHeight);
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::DOMAIN_BAR);
				//			}			
				//BAR
				
				int	exp_remain = g_char_slot_ingame.GRADE_EXP_REMAIN;
				__int64	goal_exp = max(1, g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface).GoalExp);
				
				
				if(drawGrade)
				{
					Rect rect(0,0,(barWidth*min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE)/GRADE_MARK_MAX),barHeight);				
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::DOMAIN_BAR);
					
					rect.Set(0, 0, barWidth*(goal_exp - exp_remain)/goal_exp, barHeight); // hyungony
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::DOMAIN_BAR);
				}
				m_pC_grade2_button_group->Show();
				
				gpC_global_resource->DrawOutBoxLocked(x+15, y+120, 292, 176);
				
				m_pC_common_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();
				g_FL2_GetDC();
				char sz_temp[80];
				if(drawGrade)
				{
					wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
					g_PrintColorStrOut(x+grade_text_x+87+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
					
					wsprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/goal_exp); // hyungony		
					g_PrintColorStrOut(x+grade_text_x+87+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				}
				g_FL2_ReleaseDC();
			}
		}		
		break;
		
	case RACE_VAMPIRE:
		{
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				bool drawGrade = false;
				
				if(g_char_slot_ingame.GRADE > 0 && g_char_slot_ingame.GRADE <= GRADE_MARK_MAX )
					drawGrade = true;
				
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x -m_modify_wide-7 , y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE2);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_pC_grade2_button_group->GetButton(m_iGrade)->x,
					y+m_pC_grade2_button_group->GetButton(m_iGrade)->y-1, m_pC_grade2_button_group->GetButton(m_iGrade)->m_image_index+1);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+5,y+grade_text_y,C_GLOBAL_RESOURCE::GRADE_LEVEL_HILIGHTED);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::GRADE_EXP_HILIGHTED);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y-2,C_GLOBAL_RESOURCE::GRADE_BAR_BACK);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y+18,C_GLOBAL_RESOURCE::GRADE_BAR_BACK);
				
				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_BAR);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_BAR);
				
				RECT box_rect = {x+grade_text_x+92,y+grade_text_y+1,x+grade_text_x+92+barWidth,y+grade_text_y+1+barHeight};
				
				gpC_base->m_p_DDSurface_back->Unlock();
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				box_rect.top+=20;
				box_rect.bottom+=20;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();
				
				//			// BAR
				//			if(drawGrade)
				//			{
				//				Rect rect(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
				//				
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);				
				//				rect.Set(0,0,
				//					max(0,min(barWidth,(barWidth*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)))),
				//					barHeight);
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
				//			}
				
				
				int	exp_remain = g_char_slot_ingame.GRADE_EXP_REMAIN;
				__int64	goal_exp = max(1, g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface).GoalExp);
				
				if(drawGrade)
				{
					Rect rect(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
					
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
					
					rect.Set(0, 0, barWidth*(goal_exp-exp_remain)/goal_exp, barHeight);  // hyungony
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
				}
				
				m_pC_grade2_button_group->Show();
				gpC_global_resource->DrawOutBoxLocked(x+18, y+122, 298, 180);
				m_pC_common_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();
				g_FL2_GetDC();
				char sz_temp[80];
				if(drawGrade)
				{
					wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
					g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
					wsprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/goal_exp); // hyungony
					g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				}
				
				//			if(drawGrade)
				//			{
				//				wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
				//				g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				//				wsprintf(sz_temp, "%d%%/100%%", 
				//					(100*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)));
				//				g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				//			}
				g_FL2_ReleaseDC();			
			}
		}
		break;
		
	case RACE_OUSTERS:
		{
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				bool drawGrade = false;
				
				if(g_char_slot_ingame.GRADE > 0 && g_char_slot_ingame.GRADE <= GRADE_MARK_MAX )
					drawGrade = true;
				
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x -m_modify_wide-5, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE2);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_pC_grade2_button_group->GetButton(m_iGrade)->x,
					y+m_pC_grade2_button_group->GetButton(m_iGrade)->y-1, m_pC_grade2_button_group->GetButton(m_iGrade)->m_image_index+1);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+5,y+grade_text_y,C_GLOBAL_RESOURCE::GRADE_LEVEL_HILIGHTED);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::GRADE_EXP_HILIGHTED);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y-2,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2_BACK);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+73,y+grade_text_y+18,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2_BACK);
				
				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
				
				RECT box_rect = {x+grade_text_x+92,y+grade_text_y+1,x+grade_text_x+92+barWidth,y+grade_text_y+1+barHeight};
				
				gpC_base->m_p_DDSurface_back->Unlock();
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				box_rect.top+=20;
				box_rect.bottom+=20;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();
				
				//			// BAR
				//			if(drawGrade)
				//			{
				//				Rect rect(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
				//				
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);				
				//				rect.Set(0,0,
				//					max(0,min(barWidth,(barWidth*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)))),
				//					barHeight);
				//				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
				//			}
				
				
				int	exp_remain = g_char_slot_ingame.GRADE_EXP_REMAIN;
				__int64	goal_exp = max(1, g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface).GoalExp);
				
				if(drawGrade)
				{
					Rect rect(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
					
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
					
					rect.Set(0, 0,barWidth*(goal_exp - exp_remain)/goal_exp, barHeight);  // hyungony
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+21,rect,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
				}
				
				m_pC_grade2_button_group->Show();
				gpC_global_resource->DrawOutBoxLocked(x+18, y+122, 298, 180);
				m_pC_common_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();
				g_FL2_GetDC();
				char sz_temp[80];
				if(drawGrade)
				{
					wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
					g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
					wsprintf(sz_temp, "%d%%/100%%", (int)((goal_exp - exp_remain)*100/goal_exp)); // hyungony
					g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				}
				
				//			if(drawGrade)
				//			{
				//				wsprintf(sz_temp, "%d/50", g_char_slot_ingame.GRADE);
				//				g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+1, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				//				wsprintf(sz_temp, "%d%%/100%%", 
				//					(100*(g_char_slot_ingame.GRADE_EXP-PrevLevelExp))/max(1,(NextLevelExp-PrevLevelExp)));
				//				g_PrintColorStrOut(x+grade_text_x+87+barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+grade_text_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				//			}
				g_FL2_ReleaseDC();			
			}
		break;
		}
	}
	
	m_pC_common_button_group->ShowDescription();
	m_pC_grade2_button_group->ShowDescription();
}


//------------------------------------------------------------------------------
// Show5()
// : 승직스킬 관련 탭
//   기존에 있던 승직 스킬 리스트 출력 부분은 _Show5_ACSkillList() 함수로 뺌
//   2006.11.17 by chyaya
//
// : 오랫만에 다시 보니까 꼭 아래 코드를 내가 작업한것 같은데
//   내가 한거 아님 - _-;;
//   전에 더 심했던거 수정한거임
//   2007.09.17 by chyaya
//------------------------------------------------------------------------------
void	C_VS_UI_INFO::_Show5()
{
	int grade_text_x=37,grade_text_y=20;
	////by csm 2004.12.30 Ui수정 
	//gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);
	CSpriteSurface::SetEffect(CSpriteSurface::EFFECT_GRAY_SCALE);
	const InterfaceInformation *Skin = &g_pSkinManager->Get(SkinManager::INFO);
	const int domain_bar_x = Skin->GetPoint(0).x, domain_bar_y = Skin->GetPoint(0).y;
	const int domain_level = (*g_pSkillManager)[m_skill_domain].GetDomainLevel();
	const int exp_remain = (*g_pSkillManager)[m_skill_domain].GetDomainExpRemain();
	const __int64 goal_exp = (*g_pSkillManager)[m_skill_domain].GetExpInfo(domain_level).GoalExp;
	const int skip_y=4;
	int i = 0, ousters_num = 0;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			if(gpC_base->m_p_DDSurface_back->Lock())
			{	
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-10, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE3);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_NAME);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_EXP);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+43,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_KIND);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+65,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_SKILL);
				x -=30;
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+87,y+grade_text_y+21,C_GLOBAL_RESOURCE::DOMAIN_BACK);
				
				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DOMAIN_BAR);
				
				RECT box_rect = {x+grade_text_x+87,y+grade_text_y,x+grade_text_x+87+barWidth,y+grade_text_y+1+barHeight};
				gpC_base->m_p_DDSurface_back->Unlock();
				box_rect.bottom+=5;
				box_rect.right-=53;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				
				box_rect.top+=24;
				box_rect.left+=15;
				box_rect.bottom+=18;
				box_rect.right+=67;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				
				box_rect.top+=21;
				box_rect.left-=15;
				box_rect.bottom+=27;
				box_rect.right-=67;

				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();


				Rect rect_;
				rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y-2,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);

				rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y+41, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+41,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);

				__int64	goal_exp = max(1, g_pExperienceTable->GetAdvanceMent(g_char_slot_ingame.m_AdvancementLevel+1).GoalExp);
				//const int exp_remain = (*g_pSkillManager)[m_skill_domain].GetDomainExpRemain();
				const int exp_remain = g_char_slot_ingame.EXP_REMAIN;

				Rect rect;
				rect.Set(0, 0, barWidth*(goal_exp - exp_remain)/goal_exp, barHeight); // hyungony
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+103,y+grade_text_y+24,rect,C_GLOBAL_RESOURCE::DOMAIN_BAR);
				
				x +=30;
				
				m_pC_common_button_group->Show();
				//gpC_global_resource->DrawOutBoxLocked(x+15, y+102, 292, 196);
				gpC_global_resource->DrawOutBoxLocked(x+15, y+102, 307, 203);

				m_pC_grade3_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();

				m_pC_grade3_scroll_bar->Show(x, y);
				
				////////////////////// 문자 출력 
				g_FL2_GetDC();
				char sz_temp[80];
				g_PrintColorStr(x+100, y+22, GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel), 
					gpC_base->m_chatting_pi, RGB_WHITE);
				
				const static char* domain_name[5] = 
				{
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_BLADE].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_SWORD].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_SOLDER].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_HEAL].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_ENCHANT].GetString(),
				};
				g_PrintColorStr(x+100, y+65, domain_name[m_skill_domain], 
					gpC_base->m_chatting_pi, RGB_WHITE);

				sprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/max(1, (goal_exp)));
				g_PrintColorStrOut(x+grade_text_x+95+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2,
								   y+grade_text_y+24, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				
				m_pC_skill_button_group->ShowDescription();
				m_pC_common_button_group->ShowDescription();
				g_FL2_ReleaseDC();
			
			}
		}		
		break;
		
	case RACE_VAMPIRE:
		{
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
	
				//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-7, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE3);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y,C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_NAME);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_EXP);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+43,C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_KIND);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+65,C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_SKILL);
				
				x-=30;
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+87,y+grade_text_y+21,C_GLOBAL_RESOURCE::GRADE_BAR_BACK);		


				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_BAR);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_BAR);
				
				RECT box_rect = {x+grade_text_x+87,y+grade_text_y,x+grade_text_x+87+barWidth,y+grade_text_y+1+barHeight};
				gpC_base->m_p_DDSurface_back->Unlock();
				box_rect.bottom+=5;
				box_rect.right-=53;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				
				box_rect.top+=24;
				box_rect.left+=15;
				box_rect.bottom+=18;
				box_rect.right+=72;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				
				box_rect.top+=21;
				box_rect.left-=15;
				box_rect.bottom+=28;
				box_rect.right-=72;			

				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();


				Rect rect_;
				rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y-2,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);

				rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y+42, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+42,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);

				//const int exp_remain = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetDomainExpRemain();
				
				const int exp_remain = g_char_slot_ingame.EXP_REMAIN;
				__int64	goal_exp = max(1, g_pExperienceTable->GetAdvanceMent(g_char_slot_ingame.m_AdvancementLevel).GoalExp);
				
				Rect rect;//(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
				//gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
				
				rect.Set(0, 0, barWidth*(goal_exp-exp_remain)/goal_exp, barHeight);  // hyungony
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+105,y+grade_text_y+23,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
				x+=30;
				
				//gpC_global_resource->DrawOutBoxLocked(x+15, y+102, 292, 196);
				gpC_global_resource->DrawOutBoxLocked(x+15, y+102, 307, 203);
				m_pC_common_button_group->Show();
				
				gpC_base->m_p_DDSurface_back->Unlock();
				
				m_pC_grade3_scroll_bar->Show(x, y);
						
				////////////////////// 문자 출력 
				g_FL2_GetDC();
				char sz_temp[80];

				g_PrintColorStr(x+100, y+22, GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel), 
					gpC_base->m_chatting_pi, RGB_WHITE);
							
				g_PrintColorStr(x+100, y+66, (*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_VAMPIRE].GetString(), 
					gpC_base->m_chatting_pi, RGB_WHITE);


				sprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/max(1, (goal_exp)));
				g_PrintColorStrOut(x+grade_text_x+140+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2,
								   y+grade_text_y+24, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);

				m_pC_skill_button_group->ShowDescription();
				m_pC_common_button_group->ShowDescription();
				g_FL2_ReleaseDC();			
			}
		}
		break;
		
	case RACE_OUSTERS:
		if(gpC_base->m_p_DDSurface_back->Lock())
		{	
			//gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-5, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE3);
			
			gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_NAME);
			gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_EXP);
			gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+43,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_KIND);
			gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+65,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_SKILL);
			
			
			x-=30;
			
			const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
			const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
			
			RECT box_rect = {x+grade_text_x+87,y+grade_text_y,x+grade_text_x+87+barWidth,y+grade_text_y+1+barHeight};
			gpC_base->m_p_DDSurface_back->Unlock();
			box_rect.bottom+=5;
			box_rect.right-=53;
			gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
			
			box_rect.top+=24;
			box_rect.left+=15;
			box_rect.bottom+=18;
			box_rect.right+=74;
			gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
			
			box_rect.top+=20;
			box_rect.left-=15;
			box_rect.bottom+=28;
			box_rect.right-=74;
			
			gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
			gpC_base->m_p_DDSurface_back->Lock();
			
			
			Rect rect_;
			rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
			gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
			gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y-2,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);
			
			rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
			gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y+42, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
			gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+42,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);
			
			
			
			//		const int exp_remain = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetDomainExpRemain();
			const int exp_remain = g_char_slot_ingame.EXP_REMAIN;
			__int64	goal_exp = max(1, g_pExperienceTable->GetAdvanceMent(g_char_slot_ingame.m_AdvancementLevel).GoalExp);
			
			Rect rect;//(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
			//gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
			
			rect.Set(12, 0, barWidth*(goal_exp-exp_remain)/goal_exp, barHeight);  // hyungony
			
			gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+89,y+grade_text_y+25,rect,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
			gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+89,y+grade_text_y+21,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2_BACK);
			
			x+=30;
			//gpC_global_resource->DrawOutBoxLocked(x+15, y+102, 292, 196);
			gpC_global_resource->DrawOutBoxLocked(x+15, y+102, 307, 203);
			m_pC_common_button_group->Show();
			
			gpC_base->m_p_DDSurface_back->Unlock();
			
			m_pC_grade3_scroll_bar->Show(x, y);
			
			////////////////////// 문자 출력 
			g_FL2_GetDC();
			
			
			g_PrintColorStr(x+100, y+22, GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel), 
				gpC_base->m_chatting_pi, RGB_WHITE);
			
			if(m_ousters_Magic != -1)
			{
				const static char* domain_name[4] = 
				{
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_COMBAT].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_EARTH].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_FIRE].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_WATER].GetString(),
				};
				g_PrintColorStr(x+100, y+65, domain_name[m_ousters_Magic], 
					gpC_base->m_chatting_pi, RGB_WHITE);
			}
			
			char sz_temp[80];
			
			sprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/max(1, (goal_exp)));
			g_PrintColorStrOut(x+grade_text_x+150+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2,
				y+grade_text_y+24, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
			
			m_pC_skill_button_group->ShowDescription();
			m_pC_common_button_group->ShowDescription();
			
			g_FL2_ReleaseDC();
		}	
		break;
	}


	/*
	////by csm 2004.12.30 Ui수정 
	//gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);
	CSpriteSurface::SetEffect(CSpriteSurface::EFFECT_GRAY_SCALE);
	const InterfaceInformation *Skin = &g_pSkinManager->Get(SkinManager::INFO);
	const int domain_bar_x = Skin->GetPoint(0).x, domain_bar_y = Skin->GetPoint(0).y;
	const int domain_level = (*g_pSkillManager)[m_skill_domain].GetDomainLevel();
	const int exp_remain = (*g_pSkillManager)[m_skill_domain].GetDomainExpRemain();
	const __int64 goal_exp = (*g_pSkillManager)[m_skill_domain].GetExpInfo(domain_level).GoalExp;
	const int skip_y=4;
	int i = 0, ousters_num = 0;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			SKILL_STEP step = (SKILL_STEP)(SKILL_STEP_SLAYER_BLADE_ADVANCEMENT + m_skill_domain);
			const MSkillDomain::SKILL_STEP_LIST& list = *((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step));

			int nScrollPosBackup = m_pC_grade3_scroll_bar->GetScrollPos();
			m_pC_grade3_scroll_bar->SetPosMax(list.size()+1-3);
			m_pC_grade3_scroll_bar->SetScrollPos(nScrollPosBackup);

			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				
				if((*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))
				{
					MSkillDomain::SKILL_STEP_LIST::const_iterator ss = list.begin();//+max(0,m_pC_skill_scroll_bar->GetScrollPos());
					
					int aa = list.size();
					const int level_plus = 127;
					DWORD shadow_color = RGB_BLACK;
					m_advance_skill_count = list.size();
					for(i = 0; i < min( 3, list.size() - max(0,m_pC_grade3_scroll_bar->GetScrollPos()) ); i++)
					{
						const ACTIONINFO SkillID = (ACTIONINFO)*ss;
						MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus(SkillID);
						
						int sprID = (*g_pSkillInfoTable)[SkillID].GetSpriteID();
						if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < (*g_pSkillInfoTable)[SkillID].GetLearnLevel() )
							sprID = 12;
						
						//---------------------------------------
						// status는 다음과 같다. 
						//---------------------------------------
						//	MSkillDomain::SKILLSTATUS_LEARNED		// 배웠다.
						//	MSkillDomain::SKILLSTATUS_NEXT			// 다음에 배울 수 있다.
						//	MSkillDomain::SKILLSTATUS_OTHER			// 아직은 배울 수 없다.	
						//---------------------------------------
						POINT p = {x+40, y+123+i*60+skip_y};
						switch(status)
						{
						case MSkillDomain::SKILLSTATUS_LEARNED:
							{
								gpC_base->m_p_DDSurface_back->Unlock();
								RECT alpha_rect = {p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
									p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD),
									p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD)};
								
								
								gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
								gpC_base->m_p_DDSurface_back->Lock();
								gpC_global_resource->m_pC_info_spk->BltLocked
									(p.x-(C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()/2)+2, p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
									C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILL);
								
								gpC_global_resource->m_pC_info_spk->BltLocked
									(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
									C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD);
								
								gpC_global_resource->m_pC_info_spk->BltLocked
									(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+ gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD) ,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
									C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD_BAR);

								
								if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
								}
								if((*g_pSkillInfoTable)[SkillID].IsPassive())
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&p, &C_VS_UI_SKILL::m_C_spk[sprID], 315-256);
								}
								else
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSprite(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
								}
							}
							break;
							
						default:

							gpC_base->m_p_DDSurface_back->Unlock();
							RECT alpha_rect = {p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD),
							p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD)};
							

							gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
							gpC_base->m_p_DDSurface_back->Lock();
							gpC_global_resource->m_pC_info_spk->BltLocked
							(p.x-(C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()/2)+2, p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILL);

							gpC_global_resource->m_pC_info_spk->BltLocked
							(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD);

							gpC_global_resource->m_pC_info_spk->BltLocked
							(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+ gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD) ,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD_BAR);


							if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
							{
								if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
								gpC_base->m_p_DDSurface_back->BltSpriteColor(&p, &C_VS_UI_SKILL::m_C_spk[sprID], rgb_GREEN);
							}
							else
							{
								if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
									gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
							}
							break;
						}
						
						ss++;
						
					}
				}			
				
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-10, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE3);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_NAME);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_EXP);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+43,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_KIND);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+65,C_GLOBAL_RESOURCE::ADVANCEMENT_CHINGHO_SKILL);
				x -=30;
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+87,y+grade_text_y+21,C_GLOBAL_RESOURCE::DOMAIN_BACK);
				
				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::DOMAIN_BAR);
				
				RECT box_rect = {x+grade_text_x+87,y+grade_text_y,x+grade_text_x+87+barWidth,y+grade_text_y+1+barHeight};
				gpC_base->m_p_DDSurface_back->Unlock();
				box_rect.bottom+=5;
				box_rect.right-=53;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				
				box_rect.top+=24;
				box_rect.left+=15;
				box_rect.bottom+=18;
				box_rect.right+=67;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				
				box_rect.top+=21;
				box_rect.left-=15;
				box_rect.bottom+=27;
				box_rect.right-=67;

				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();


				Rect rect_;
				rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y-2,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);

				rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y+41, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+41,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);

				__int64	goal_exp = max(1, g_pExperienceTable->GetAdvanceMent(g_char_slot_ingame.m_AdvancementLevel+1).GoalExp);
				//const int exp_remain = (*g_pSkillManager)[m_skill_domain].GetDomainExpRemain();
				const int exp_remain = g_char_slot_ingame.EXP_REMAIN;

				Rect rect;
				rect.Set(0, 0, barWidth*(goal_exp - exp_remain)/goal_exp, barHeight); // hyungony
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+103,y+grade_text_y+24,rect,C_GLOBAL_RESOURCE::DOMAIN_BAR);
				
				x +=30;
				
				m_pC_common_button_group->Show();
				gpC_global_resource->DrawOutBoxLocked(x+15, y+102, 292, 196);
				gpC_global_resource->DrawOutBoxLocked(x+20, y+105, 280, 175);
				m_pC_grade3_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();
				if(m_advance_skill_count > 2)
					m_pC_grade3_scroll_bar->Show(x+5, y+25);
				
				////////////////////// 문자 출력 
				g_FL2_GetDC();
				char sz_temp[80];
				g_PrintColorStr(x+100, y+22, GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel), 
					gpC_base->m_chatting_pi, RGB_WHITE);
				
				const static char* domain_name[5] = 
				{
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_BLADE].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_SWORD].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_SOLDER].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_HEAL].GetString(),
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_ENCHANT].GetString(),
				};
				g_PrintColorStr(x+100, y+65, domain_name[m_skill_domain], 
					gpC_base->m_chatting_pi, RGB_WHITE);

				sprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/max(1, (goal_exp)));
				g_PrintColorStrOut(x+grade_text_x+95+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2,
								   y+grade_text_y+24, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);


				if((*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))
				{
					MSkillDomain::SKILL_STEP_LIST::const_iterator ss = list.begin();//+max(0,m_pC_skill_scroll_bar->GetScrollPos());
					
					const int level_plus = 127;
					DWORD shadow_color = RGB_BLACK;
					for(i = 0; i < min( 3, list.size() - max(0,m_pC_grade3_scroll_bar->GetScrollPos()) ); i++)
					{
						const ACTIONINFO SkillID = (ACTIONINFO)*ss;
						
						MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus(SkillID);
						const char *skill_name;
						const int exp_level = (*g_pSkillInfoTable)[SkillID].GetExpLevel();
						const int learn_level = g_char_slot_ingame.m_AdvancementLevel;
						char sz_temp[10];
						char sz_temp2[10] = "???";
						
						if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < learn_level )
							skill_name = sz_temp2;
						else
							skill_name = (*g_pSkillInfoTable)[SkillID].GetHName();
						
						POINT p = {x+165, y+130+i*60+skip_y};
						switch(status)
						{
						case MSkillDomain::SKILLSTATUS_LEARNED:
							{
								if((*g_pSkillInfoTable)[SkillID].IsPassive())
								{
									g_PrintColorStrShadow(p.x +level_plus- 
										g_GetStringWidth((*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_desc_menu_pi.hfont)/2, p.y, (*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_desc_menu_pi, RGB(150, 200, 255), shadow_color);
								}
								else
								{
									wsprintf(sz_temp, "%d", exp_level);
									g_PrintColorStrShadow(p.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, p.y, sz_temp, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
								}
								
								if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
								{
									if(skill_name)
									{
										g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
									}
								}
								else
									if((*g_pSkillInfoTable)[SkillID].IsPassive())
									{
										if(skill_name)
										{
											g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB(150, 200, 255), shadow_color);
										}
									}
									else
									{
										if(skill_name)
										{
											g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
										}
									}
							}
							break;
							
						default:
							wsprintf(sz_temp, "%d", exp_level);
							g_PrintColorStrShadow(p.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, p.y, sz_temp, gpC_base->m_desc_menu_pi, RGB(70, 255, 70), shadow_color);
							
							if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
							{
								if(skill_name)
								{
									g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB(70, 255, 70), shadow_color);
								}
							}
							else
							{
								if(skill_name)
								{
									g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
								}
							}
							break;
						}
						
						ss++;
					}
				}
			m_pC_skill_button_group->ShowDescription();
			m_pC_common_button_group->ShowDescription();
			g_FL2_ReleaseDC();
		
			}
		}		
		break;
		
	case RACE_VAMPIRE:
		{
			SKILL_STEP step;

			for(i = 0; i < 2 ; i++)
			{
				step = (SKILL_STEP)(SKILL_STEP_VAMPIRE_WARRIOR_ADVANCEMENT+i);
				if((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
				{
					MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step));
					MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
					MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStatus((ACTIONINFO)*ss);
					
					if(MSkillDomain::SKILLSTATUS::SKILLSTATUS_LEARNED == status)
					{
						m_vampire_ACType = i;	
						m_pC_grade3_scroll_bar->SetScrollPos(0); 
						break;
					}
				}
			}


			//SKILL_STEP step = (SKILL_STEP)(SKILL_STEP_VAMPIRE_ADVANCEMENT);
			const MSkillDomain::SKILL_STEP_LIST& list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step));

			int nScrollPosBackup = m_pC_grade3_scroll_bar->GetScrollPos();
			m_pC_grade3_scroll_bar->SetPosMax(list.size()+1-3);
			m_pC_grade3_scroll_bar->SetScrollPos(nScrollPosBackup);

			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				if((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
				{
					MSkillDomain::SKILL_STEP_LIST::const_iterator ss = list.begin() + max(0,m_pC_grade3_scroll_bar->GetScrollPos());
					
					int aa = list.size();
					const int level_plus = 127;
					DWORD shadow_color = RGB_BLACK;
					m_advance_skill_count = list.size();
					for(i = 0; i < min( 3, list.size() - max(0,m_pC_grade3_scroll_bar->GetScrollPos()) ); i++)
					{

						const ACTIONINFO SkillID = (ACTIONINFO)*ss;
						MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStatus(SkillID);


						int sprID = (*g_pSkillInfoTable)[SkillID].GetSpriteID();
						if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < (*g_pSkillInfoTable)[SkillID].GetLearnLevel() )
							sprID = 12;
						
						POINT p = {x+40, y+123+i*60+skip_y};
						switch(status)
						{
						case MSkillDomain::SKILLSTATUS_LEARNED:
							{
							gpC_base->m_p_DDSurface_back->Unlock();
							RECT alpha_rect = {p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD),
							p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD)};
							

							gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
							gpC_base->m_p_DDSurface_back->Lock();
							gpC_global_resource->m_pC_info_spk->BltLocked
							(p.x-(C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()/2)+2, p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILL);

							gpC_global_resource->m_pC_info_spk->BltLocked
							(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD);

							gpC_global_resource->m_pC_info_spk->BltLocked
							(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+ gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD) ,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD_BAR);
								
								if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
								}
								if((*g_pSkillInfoTable)[SkillID].IsPassive())
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&p, &C_VS_UI_SKILL::m_C_spk[sprID], 315-256);
								}
								else
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSprite(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
								}
							}
							break;
							
						default:

							gpC_base->m_p_DDSurface_back->Unlock();
							RECT alpha_rect = {p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD),
							p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD)};
							

							gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
							gpC_base->m_p_DDSurface_back->Lock();
							gpC_global_resource->m_pC_info_spk->BltLocked
							(p.x-(C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()/2)+2, p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILL);

							gpC_global_resource->m_pC_info_spk->BltLocked
							(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD);

							gpC_global_resource->m_pC_info_spk->BltLocked
							(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+ gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD) ,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
							C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD_BAR);


							if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
							{
								if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
								gpC_base->m_p_DDSurface_back->BltSpriteColor(&p, &C_VS_UI_SKILL::m_C_spk[sprID], rgb_GREEN);
							}
							else
							{
								if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
									gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
							}
							break;
						}
						
						ss++;
						
					}
				}	
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-7, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE3);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y,C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_NAME);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_EXP);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+43,C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_KIND);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+65,C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_CHINGHO_SKILL);
				
				x-=30;
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+87,y+grade_text_y+21,C_GLOBAL_RESOURCE::GRADE_BAR_BACK);
				
				


				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::GRADE_BAR);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::GRADE_BAR);
				
				RECT box_rect = {x+grade_text_x+87,y+grade_text_y,x+grade_text_x+87+barWidth,y+grade_text_y+1+barHeight};
				gpC_base->m_p_DDSurface_back->Unlock();
				box_rect.bottom+=5;
				box_rect.right-=53;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				
				box_rect.top+=24;
				box_rect.left+=15;
				box_rect.bottom+=18;
				box_rect.right+=72;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				
				box_rect.top+=21;
				box_rect.left-=15;
				box_rect.bottom+=28;
				box_rect.right-=72;


								

				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();


				Rect rect_;
				rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y-2,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);

				rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y+42, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+42,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);

				//const int exp_remain = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetDomainExpRemain();
				
				const int exp_remain = g_char_slot_ingame.EXP_REMAIN;
				__int64	goal_exp = max(1, g_pExperienceTable->GetAdvanceMent(g_char_slot_ingame.m_AdvancementLevel).GoalExp);

				Rect rect;//(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
					//gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
					
					rect.Set(0, 0, barWidth*(goal_exp-exp_remain)/goal_exp, barHeight);  // hyungony
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+105,y+grade_text_y+23,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
				x+=30;
				
					gpC_global_resource->DrawOutBoxLocked(x+15, y+102, 292, 196);
					m_pC_common_button_group->Show();
					
					gpC_base->m_p_DDSurface_back->Unlock();
					if(m_advance_skill_count > 2)
						m_pC_grade3_scroll_bar->Show(x+5, y+25);

				
				////////////////////// 문자 출력 
				g_FL2_GetDC();
				char sz_temp[80];

				g_PrintColorStr(x+100, y+22, GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel), 
					gpC_base->m_chatting_pi, RGB_WHITE);
							
				g_PrintColorStr(x+100, y+66, (*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_VAMPIRE].GetString(), 
					gpC_base->m_chatting_pi, RGB_WHITE);


				sprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/max(1, (goal_exp)));
				g_PrintColorStrOut(x+grade_text_x+140+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2,
								   y+grade_text_y+24, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);


				if((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
				{
					MSkillDomain::SKILL_STEP_LIST::const_iterator ss = list.begin() + max(0,m_pC_grade3_scroll_bar->GetScrollPos());
					
					int aa = list.size();
					const int level_plus = 127;
					DWORD shadow_color = RGB_BLACK;
					for(i = 0; i < min( 3, list.size() - max(0,m_pC_grade3_scroll_bar->GetScrollPos()) ); i++)
					{
						const ACTIONINFO SkillID = (ACTIONINFO)*ss;
						
						MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus(SkillID);
						const char *skill_name;
						const int exp_level = (*g_pSkillInfoTable)[SkillID].GetExpLevel();
						const int learn_level = (*g_pSkillInfoTable)[SkillID].GetLearnLevel();
						char sz_temp[10];
						char sz_temp2[10] = "???";
						
						if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < learn_level )
							skill_name = sz_temp2;
						else
							skill_name = (*g_pSkillInfoTable)[SkillID].GetHName();
						
						POINT p = {x+165, y+130+i*60+skip_y};
						switch(status)
						{
						case MSkillDomain::SKILLSTATUS_LEARNED:
							{
								if((*g_pSkillInfoTable)[SkillID].IsPassive())
								{
									g_PrintColorStrShadow(p.x +level_plus- 
										g_GetStringWidth((*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_desc_menu_pi.hfont)/2, p.y, (*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_desc_menu_pi, RGB(150, 200, 255), shadow_color);
								}
								else
								{
									wsprintf(sz_temp, "%d", exp_level);
									g_PrintColorStrShadow(p.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, p.y, sz_temp, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
								}
								
								if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
								{
									if(skill_name)
									{
										g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
									}
								}
								else
									if((*g_pSkillInfoTable)[SkillID].IsPassive())
									{
										if(skill_name)
										{
											g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB(150, 200, 255), shadow_color);
										}
									}
									else
									{
										if(skill_name)
										{
											g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
										}
									}
							}
							break;
							
						default:
							wsprintf(sz_temp, "%d", exp_level);
							g_PrintColorStrShadow(p.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, p.y, sz_temp, gpC_base->m_desc_menu_pi, RGB(70, 255, 70), shadow_color);
							
							if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
							{
								if(skill_name)
								{
									g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB(70, 255, 70), shadow_color);
								}
							}
							else
							{
								if(skill_name)
								{
									g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
								}
							}
							break;
						}
						
						ss++;
					}
				}
			m_pC_skill_button_group->ShowDescription();
			m_pC_common_button_group->ShowDescription();
			g_FL2_ReleaseDC();			
			}
		}
		break;
		
	case RACE_OUSTERS:
		if(gpC_base->m_p_DDSurface_back->Lock())
		{	
			// By Csm // 
			SKILL_STEP step;

			for(i = 0; i < 4 ; i++)
			{
				step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT+i);
				if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
				{
					MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
					MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
					MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus((ACTIONINFO)*ss);
					
					if(MSkillDomain::SKILLSTATUS::SKILLSTATUS_LEARNED == status)
					{
						m_ousters_Magic = i;	
						m_pC_grade3_scroll_bar->SetScrollPos(0); 
						break;
					}
				}
			}
			
			if(m_ousters_Magic == -1)
			{
				for(i = 0; i < min( 3, 4 - max(0,m_pC_grade3_scroll_bar->GetScrollPos()) ); i++)
				{
					step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT+i);
					if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
					{
						MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
						MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
						MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus((ACTIONINFO)*ss);
						
						if(MSkillDomain::SKILLSTATUS::SKILLSTATUS_LEARNED != status)
						{
							if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
							{
								MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
								MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();//+max(0,m_pC_grade3_scroll_bar->GetScrollPos());
								
								const int level_plus = 127;
								DWORD shadow_color = RGB_BLACK;
								m_advance_skill_count = 4;
								//							for(i = 0; i < min( 3, list.size() - max(0,m_pC_grade3_scroll_bar->GetScrollPos()) ); i++)
								{
									const ACTIONINFO SkillID = (ACTIONINFO)*ss;
									MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus(SkillID);
									
									int sprID = (*g_pSkillInfoTable)[SkillID].GetSpriteID()+m_pC_grade3_scroll_bar->GetScrollPos();
									if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < (*g_pSkillInfoTable)[SkillID].GetLearnLevel() )
										sprID = 12;
									POINT p = {x+40, y+123+i*60+skip_y};
									switch(status)
									{
									case MSkillDomain::SKILLSTATUS_LEARNED:
										{
											gpC_base->m_p_DDSurface_back->Unlock();
											RECT alpha_rect = {p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
												p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD),
												p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD)};
											
											
											gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
											gpC_base->m_p_DDSurface_back->Lock();
											gpC_global_resource->m_pC_info_spk->BltLocked
												(p.x-(C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()/2)+2, p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
												C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILL);
											
											gpC_global_resource->m_pC_info_spk->BltLocked
												(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
												C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD);
											
											gpC_global_resource->m_pC_info_spk->BltLocked
												(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+ gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD) ,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
												C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD_BAR);
											
											
											if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
											{
												if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
													gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
											}
											if((*g_pSkillInfoTable)[SkillID].IsPassive())
											{
												if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
													gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&p, &C_VS_UI_SKILL::m_C_spk[sprID], 315-256);
											}
											else
											{
												if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
													gpC_base->m_p_DDSurface_back->BltSprite(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
											}
										}
										break;
										
									default:
										gpC_base->m_p_DDSurface_back->Unlock();
										RECT alpha_rect = {p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
											p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD),
											p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD)};
										
										
										gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
										gpC_base->m_p_DDSurface_back->Lock();
										gpC_global_resource->m_pC_info_spk->BltLocked
											(p.x-(C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()/2)+2, p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
											C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILL);
										
										gpC_global_resource->m_pC_info_spk->BltLocked
											(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
											C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD);
										
										gpC_global_resource->m_pC_info_spk->BltLocked
											(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+ gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD) ,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
											C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD_BAR);
										
										
										//if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
										
										if(((*g_pSkillInfoTable)[SkillID].SkillPoint <= g_char_slot_ingame.skill_point && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= g_char_slot_ingame.level && MSkillDomain::SKILLSTATUS::SKILLSTATUS_LEARNED !=status))// && bCanLearn)
										{
											if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
												gpC_base->m_p_DDSurface_back->BltSpriteColor(&p, &C_VS_UI_SKILL::m_C_spk[sprID], rgb_GREEN);
										}
										else
										{
											if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
												gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
										}
										break;
									}
									
								}
							}			
							
							
							gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-5, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE3);
							
							gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_NAME);
							gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_EXP);
							gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+43,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_KIND);
							gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+65,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_SKILL);
							
							
							x-=30;
							
							const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
							const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
							
							RECT box_rect = {x+grade_text_x+87,y+grade_text_y,x+grade_text_x+87+barWidth,y+grade_text_y+1+barHeight};
							gpC_base->m_p_DDSurface_back->Unlock();
							box_rect.bottom+=5;
							box_rect.right-=53;
							gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
							
							box_rect.top+=24;
							box_rect.left+=15;
							box_rect.bottom+=18;
							box_rect.right+=74;
							gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
							
							box_rect.top+=20;
							box_rect.left-=15;
							box_rect.bottom+=28;
							box_rect.right-=74;
							
							gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
							gpC_base->m_p_DDSurface_back->Lock();
							
							
							Rect rect_;
							rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
							gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
							gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y-2,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);
							
							rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
							gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y+42, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
							gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+42,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);
							
							
							
					//		const int exp_remain = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetDomainExpRemain();
							const int exp_remain = g_char_slot_ingame.EXP_REMAIN;
							__int64	goal_exp = max(1, g_pExperienceTable->GetAdvanceMent(g_char_slot_ingame.m_AdvancementLevel).GoalExp);
							
							Rect rect;//(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
							//gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
							
							rect.Set(12, 0, barWidth*(goal_exp-exp_remain)/goal_exp, barHeight);  // hyungony

							gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+89,y+grade_text_y+25,rect,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
							gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+89,y+grade_text_y+21,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2_BACK);

							x+=30;
							gpC_global_resource->DrawOutBoxLocked(x+15, y+102, 292, 196);
							m_pC_common_button_group->Show();
							
							gpC_base->m_p_DDSurface_back->Unlock();
							if(m_advance_skill_count > 2)
								m_pC_grade3_scroll_bar->Show(x+5, y+25);
							
							////////////////////// 문자 출력 
							g_FL2_GetDC();
							
							
							g_PrintColorStr(x+100, y+22, GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel), 
								gpC_base->m_chatting_pi, RGB_WHITE);
							
							
							char sz_temp[80];
							
							sprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/max(1, (goal_exp)));
							g_PrintColorStrOut(x+grade_text_x+150+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2,
								y+grade_text_y+24, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
							
							
							step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT+i+max(0,m_pC_grade3_scroll_bar->GetScrollPos()));
							if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
							{
								MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
								MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
								
								const int level_plus = 127;
								DWORD shadow_color = RGB_BLACK;
								{
									const ACTIONINFO SkillID = (ACTIONINFO)*ss;
									
									MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus(SkillID);
									const char *skill_name;
									const int exp_level = (*g_pSkillInfoTable)[SkillID].GetExpLevel();
									const int learn_level = (*g_pSkillInfoTable)[SkillID].GetLearnLevel();
									char sz_temp[10];
									char sz_temp2[10] = "???";
									
									if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < learn_level )
										skill_name = sz_temp2;
									else
										skill_name = (*g_pSkillInfoTable)[SkillID].GetHName();
									
									POINT p = {x+170, y+130+i*60+skip_y};
									switch(status)
									{
									case MSkillDomain::SKILLSTATUS_LEARNED:
										{
											if((*g_pSkillInfoTable)[SkillID].IsPassive())
											{
												g_PrintColorStrShadow(p.x +level_plus- 
													g_GetStringWidth((*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_desc_menu_pi.hfont)/2, p.y, (*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_desc_menu_pi, RGB(150, 200, 255), shadow_color);
											}
											else
											{
												wsprintf(sz_temp, "%d", exp_level);
												g_PrintColorStrShadow(p.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, p.y, sz_temp, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
											}
											
											if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
											{
												if(skill_name)
												{
													g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
												}
											}
											else
												if((*g_pSkillInfoTable)[SkillID].IsPassive())
												{
													if(skill_name)
													{
														g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB(150, 200, 255), shadow_color);
													}
												}
												else
												{
													if(skill_name)
													{
														g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
													}
												}
										}
										break;
										
									default:
										wsprintf(sz_temp, "%d", exp_level);
										g_PrintColorStrShadow(p.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, p.y, sz_temp, gpC_base->m_desc_menu_pi, RGB(70, 255, 70), shadow_color);
										
										if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
										{
											if(skill_name)
											{
												g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB(70, 255, 70), shadow_color);
											}
										}
										else
										{
											if(skill_name)
											{
												g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
											}
										}
										break;
									}
									
								}
							}
							m_pC_skill_button_group->ShowDescription();
							m_pC_common_button_group->ShowDescription();
							g_FL2_ReleaseDC();		
							
							
					}
				}
			}
			}
			
			if(m_ousters_Magic != -1)
			{
				step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT+m_ousters_Magic);

				if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
				{
					MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
					MSkillDomain::SKILL_STEP_LIST::iterator ss;
					m_advance_skill_count = list.size();

					if(m_advance_skill_count>2)
						ss = list.begin()+max(0,m_pC_grade3_scroll_bar->GetScrollPos());
					else
						ss = list.begin();
					
					const int level_plus = 127;
					DWORD shadow_color = RGB_BLACK;
					
					for(i = 0; i < min( 3, list.size() - max(0,m_pC_grade3_scroll_bar->GetScrollPos()) ); i++)
					{
						const ACTIONINFO SkillID = (ACTIONINFO)*ss;
						MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus(SkillID);
						
						int sprID = (*g_pSkillInfoTable)[SkillID].GetSpriteID();
						if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < (*g_pSkillInfoTable)[SkillID].GetLearnLevel() )
							sprID = 12;
						POINT p = {x+40, y+123+i*60+skip_y};
						switch(status)
						{
						case MSkillDomain::SKILLSTATUS_LEARNED:
							{
								gpC_base->m_p_DDSurface_back->Unlock();
								RECT alpha_rect = {p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
									p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD),
									p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD)};
								
								
								gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
								gpC_base->m_p_DDSurface_back->Lock();
								gpC_global_resource->m_pC_info_spk->BltLocked
									(p.x-(C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()/2)+2, p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
									C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILL);
								
								gpC_global_resource->m_pC_info_spk->BltLocked
									(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
									C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD);
								
								gpC_global_resource->m_pC_info_spk->BltLocked
									(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+ gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD) ,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
									C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD_BAR);
								
								
								if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
								}
								if((*g_pSkillInfoTable)[SkillID].IsPassive())
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&p, &C_VS_UI_SKILL::m_C_spk[sprID], 315-256);
								}
								else
								{
									if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
										gpC_base->m_p_DDSurface_back->BltSprite(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
								}
							}
							break;
							
						default:
							gpC_base->m_p_DDSurface_back->Unlock();
							RECT alpha_rect = {p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
								p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD),
								p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD)};
							
							
							gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
							gpC_base->m_p_DDSurface_back->Lock();
							gpC_global_resource->m_pC_info_spk->BltLocked
								(p.x-(C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()/2)+2, p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
								C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILL);
							
							gpC_global_resource->m_pC_info_spk->BltLocked
								(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
								C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD);
							
							gpC_global_resource->m_pC_info_spk->BltLocked
								(p.x+C_VS_UI_SKILL::m_C_spk[sprID].GetWidth()+20+ gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD) ,  p.y-(C_VS_UI_SKILL::m_C_spk[sprID].GetHeight()/2)+2,
								C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD_BAR);
							
							
							if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
							{
								if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
									gpC_base->m_p_DDSurface_back->BltSpriteColor(&p, &C_VS_UI_SKILL::m_C_spk[sprID], rgb_GREEN);
							}
							else
							{
								if(sprID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[sprID].IsInit())
									gpC_base->m_p_DDSurface_back->BltSpriteEffect(&p, &C_VS_UI_SKILL::m_C_spk[sprID]);
							}
							break;
						}
						
						ss++;
						
					}
				}			
				
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+m_rt_tab.x-m_modify_wide-5, y+m_rt_tab.y, C_GLOBAL_RESOURCE::TAB_GRADE3);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_NAME);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+20,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_EXP);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+43,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_KIND);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x,y+grade_text_y+65,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_CHINGHO_SKILL);
				
				x-=30;
				
				const int barWidth = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
				const int barHeight = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
				
				RECT box_rect = {x+grade_text_x+87,y+grade_text_y,x+grade_text_x+87+barWidth,y+grade_text_y+1+barHeight};
				gpC_base->m_p_DDSurface_back->Unlock();
				box_rect.bottom+=5;
				box_rect.right-=53;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				
				box_rect.top+=24;
				box_rect.left+=15;
				box_rect.bottom+=18;
				box_rect.right+=74;
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				
				box_rect.top+=16;
				box_rect.left-=15;
				box_rect.bottom+=24;
				box_rect.right-=74;
				
				gpC_base->m_p_DDSurface_back->FillRect(&box_rect, 0);
				gpC_base->m_p_DDSurface_back->Lock();
				
				
				Rect rect_;
				rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y-2,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);
				
				rect_.Set(0, 0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-30, gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR) );
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+53+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),y+grade_text_y+42, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+87,y+grade_text_y+42,rect_, C_GLOBAL_RESOURCE::LARGE_BAR);
				
				
				
				//		const int exp_remain = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetDomainExpRemain();
				const int exp_remain = g_char_slot_ingame.EXP_REMAIN;
				__int64	goal_exp = max(1, g_pExperienceTable->GetAdvanceMent(g_char_slot_ingame.m_AdvancementLevel).GoalExp);
				
				Rect rect;//(0,0,(barWidth*(min(GRADE_MARK_MAX,g_char_slot_ingame.GRADE))/GRADE_MARK_MAX),barHeight);
				//gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+92,y+grade_text_y+1,rect,C_GLOBAL_RESOURCE::GRADE_BAR);
				
				rect.Set(12, 0, barWidth*(goal_exp-exp_remain)/goal_exp, barHeight);  // hyungony
				
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+grade_text_x+89,y+grade_text_y+25,rect,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+grade_text_x+89,y+grade_text_y+21,C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2_BACK);
				x+=30;
				gpC_global_resource->DrawOutBoxLocked(x+15, y+102, 292, 196);
				m_pC_common_button_group->Show();

							
				gpC_base->m_p_DDSurface_back->Unlock();
				if(m_advance_skill_count > 2)
					m_pC_grade3_scroll_bar->Show(x+5, y+25);
				////////////////////// 문자 출력 
				g_FL2_GetDC();
				char sz_temp[80];

				
				g_PrintColorStr(x+100, y+22, GetChinhoLevel(g_char_slot_ingame.m_AdvancementLevel), 
					gpC_base->m_chatting_pi, RGB_WHITE);
				
				const static char* domain_name[4] = 
				{
					(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_COMBAT].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_EARTH].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_FIRE].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_ADVANCEMENT_JOB_WATER].GetString(),
				};
				g_PrintColorStr(x+100, y+65, domain_name[m_ousters_Magic], 
					gpC_base->m_chatting_pi, RGB_WHITE);
				
				sprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/max(1, (goal_exp)));
				g_PrintColorStrOut(x+grade_text_x+150+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::DOMAIN_BAR)/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2,
					y+grade_text_y+24, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);

				
				
				if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
				{
					MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
					MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();//+max(0,m_pC_skill_scroll_bar->GetScrollPos());
					
					if(m_advance_skill_count>2)
						ss = list.begin()+max(0,m_pC_grade3_scroll_bar->GetScrollPos());
					else
						ss = list.begin();

					const int level_plus = 127;
					DWORD shadow_color = RGB_BLACK;
					for(i = 0; i < min( 3, list.size() - max(0,m_pC_grade3_scroll_bar->GetScrollPos()) ); i++)
					{
						const ACTIONINFO SkillID = (ACTIONINFO)*ss;
						
						MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus(SkillID);
						const char *skill_name;
						const int exp_level = (*g_pSkillInfoTable)[SkillID].GetExpLevel();
						const int learn_level = (*g_pSkillInfoTable)[SkillID].GetLearnLevel();
						char sz_temp[10];
						char sz_temp2[10] = "???";
						
						if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < learn_level )
							skill_name = sz_temp2;
						else
							skill_name = (*g_pSkillInfoTable)[SkillID].GetHName();
						
						POINT p = {x+170, y+130+i*60+skip_y};
						switch(status)
						{
						case MSkillDomain::SKILLSTATUS_LEARNED:
							{
								if((*g_pSkillInfoTable)[SkillID].IsPassive())
								{
									g_PrintColorStrShadow(p.x +level_plus- 
										g_GetStringWidth((*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_desc_menu_pi.hfont)/2, p.y, (*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_desc_menu_pi, RGB(150, 200, 255), shadow_color);
								}
								else
								{
									wsprintf(sz_temp, "%d", exp_level);
									g_PrintColorStrShadow(p.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, p.y, sz_temp, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
								}
								
								if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
								{
									if(skill_name)
									{
										g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
									}
								}
								else
									if((*g_pSkillInfoTable)[SkillID].IsPassive())
									{
										if(skill_name)
										{
											g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB(150, 200, 255), shadow_color);
										}
									}
									else
									{
										if(skill_name)
										{
											g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
										}
									}
							}
							break;
							
						default:
							wsprintf(sz_temp, "%d", exp_level);
							g_PrintColorStrShadow(p.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, p.y, sz_temp, gpC_base->m_desc_menu_pi, RGB(70, 255, 70), shadow_color);
							
							if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= domain_level && (*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0)
							{
								if(skill_name)
								{
									g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB(70, 255, 70), shadow_color);
								}
							}
							else
							{
								if(skill_name)
								{
									g_PrintColorStrShadow(p.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, p.y, skill_name, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
								}
							}
							break;
						}
						
						ss++;
					}
				}
				m_pC_skill_button_group->ShowDescription();
				m_pC_common_button_group->ShowDescription();
				g_FL2_ReleaseDC();		
				}
			}
			
		break;
	}
	*/

	// 승직 스킬 리스트 출력
	_Show5_ACSkillList();

	m_pC_common_button_group->ShowDescription();
	m_pC_grade3_button_group->ShowDescription();
}


//-----------------------------------------------------------------------------
// _Show5_ACSkillList()
// : 승직 스킬 리스트 출력
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::_Show5_ACSkillList()
{
	//////////////////////////////////////////////////////////////////////////
	// 2006.11.19 by chyaya
	// 승직 스킬 리스트 출력 시작
	// : 승직 스킬 출력 구문을 종족 구분 없이 하나로 통일한다.
	//   짜집기의 승리라 볼수있다. -_-;;
	//   종족 별로 다른 승직스킬 처리 방식은 Process_ACSkillTab()를 확인

	const int domain_level	= (*g_pSkillManager)[m_skill_domain].GetDomainLevel();
	const int advance_level	= g_char_slot_ingame.m_AdvancementLevel;
	const int sum_level		= domain_level + advance_level;
	const int skip_y		= 4;

	int nAdvanceSkillImageIdx_Skill;
	int nAdvanceSkillImageIdx_SkillQuad;
	int nAdvanceSkillImageIdx_SkillQuad_Bar;

	// 종족에 맞는 그림 모양을 선택한다.
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		nAdvanceSkillImageIdx_Skill			= C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILL;
		nAdvanceSkillImageIdx_SkillQuad		= C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD;
		nAdvanceSkillImageIdx_SkillQuad_Bar = C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD_BAR;
		break;
	case RACE_VAMPIRE:
		nAdvanceSkillImageIdx_Skill			= C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILL;
		nAdvanceSkillImageIdx_SkillQuad		= C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD;
		nAdvanceSkillImageIdx_SkillQuad_Bar = C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD_BAR;
		break;
	case RACE_OUSTERS:
		nAdvanceSkillImageIdx_Skill			= C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILL;
		nAdvanceSkillImageIdx_SkillQuad		= C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD;
		nAdvanceSkillImageIdx_SkillQuad_Bar = C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD_BAR;
		break;
	default: // 기본값으로 슬레이어 혹시 모르니 -ㅅ-)
		nAdvanceSkillImageIdx_Skill			= C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILL;
		nAdvanceSkillImageIdx_SkillQuad		= C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD;
		nAdvanceSkillImageIdx_SkillQuad_Bar = C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD_BAR;
		break;
	}

	int nScrollPos = m_pC_grade3_scroll_bar->GetScrollPos();
	m_pC_grade3_scroll_bar->SetPosMax(m_advance_skill_id_vec.size() + 1 - 3);
	m_pC_grade3_scroll_bar->SetScrollPos(nScrollPos);

	const int level_plus = 127;
	const DWORD shadow_color = RGB_BLACK;
	
	MSkillDomain::SKILL_STEP_LIST::const_iterator iter		= m_advance_skill_id_vec.begin();
	std::advance(iter, nScrollPos);	// 스크롤 위치만큼 이동
	
	int LoopCnt = min(3, m_advance_skill_id_vec.size() - max(0, nScrollPos));
	for(int i = 0; i < LoopCnt; ++i)
	{
		const ACTIONINFO SkillID = iter[i];
		
		MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[m_skill_domain].GetSkillStatus(SkillID);

		if ( status == MSkillDomain::SKILLSTATUS_OTHER )
		{
			status = (*g_pSkillManager)[SKILLDOMAIN_ETC].GetSkillStatus(SkillID);
		}
		
		int SpriteID = (*g_pSkillInfoTable)[SkillID].GetSpriteID();
		const int DisableSpriteID = 12;
		
		if(g_pSystemAvailableManager->GetLimitLearnSkillLevel() < (*g_pSkillInfoTable)[SkillID].GetLearnLevel())
			SpriteID = DisableSpriteID;


		// 글씨 관련 변수 블록
		const char *skill_name;
		const int exp_level			= (*g_pSkillInfoTable)[SkillID].GetExpLevel();
		const int skill_learn_level = (*g_pSkillInfoTable)[SkillID].GetLearnLevel();

		char sz_temp[10];
		char sz_temp2[10] = "???";
		
		if( g_pSystemAvailableManager->GetLimitLearnSkillLevel() < advance_level )
			skill_name = sz_temp2;
		else
			skill_name = (*g_pSkillInfoTable)[SkillID].GetHName();
		// 여까지
		
		//---------------------------------------
		// status는 다음과 같다. 
		//---------------------------------------
		//	MSkillDomain::SKILLSTATUS_LEARNED		// 배웠다.
		//	MSkillDomain::SKILLSTATUS_NEXT			// 다음에 배울 수 있다.
		//	MSkillDomain::SKILLSTATUS_OTHER			// 아직은 배울 수 없다.	
		//---------------------------------------
		POINT IconDrawPos = {x+40, y+123+i*60+skip_y};
		POINT TextDrawPos = {x+175, y+132+i*60+skip_y};
		
		switch(status)
		{
		case MSkillDomain::SKILLSTATUS_LEARNED:
			{
				RECT alpha_rect = {IconDrawPos.x+C_VS_UI_SKILL::m_C_spk[SpriteID].GetWidth()+20,  IconDrawPos.y-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetHeight()/2)+2,
					IconDrawPos.x+C_VS_UI_SKILL::m_C_spk[SpriteID].GetWidth()+20+gpC_global_resource->m_pC_info_spk->GetWidth(nAdvanceSkillImageIdx_SkillQuad),
					IconDrawPos.y-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetHeight()/2)+2+gpC_global_resource->m_pC_info_spk->GetHeight(nAdvanceSkillImageIdx_SkillQuad)};
				
				gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
				if(gpC_base->m_p_DDSurface_back->Lock())
				{
					gpC_global_resource->m_pC_info_spk->BltLocked
						(IconDrawPos.x-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetWidth()/2)+2, IconDrawPos.y-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetHeight()/2)+2,
						nAdvanceSkillImageIdx_Skill);
					
					gpC_global_resource->m_pC_info_spk->BltLocked
						(IconDrawPos.x+C_VS_UI_SKILL::m_C_spk[SpriteID].GetWidth()+20,  IconDrawPos.y-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetHeight()/2)+2,
						nAdvanceSkillImageIdx_SkillQuad);
					
					gpC_global_resource->m_pC_info_spk->BltLocked
						(IconDrawPos.x+C_VS_UI_SKILL::m_C_spk[SpriteID].GetWidth()+20 + gpC_global_resource->m_pC_info_spk->GetWidth(nAdvanceSkillImageIdx_SkillQuad), 
						 IconDrawPos.y-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetHeight()/2)+2,
						nAdvanceSkillImageIdx_SkillQuad_Bar);
					
					
					if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
					{
						if(SpriteID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[SpriteID].IsInit())
							gpC_base->m_p_DDSurface_back->BltSpriteEffect(&IconDrawPos, &C_VS_UI_SKILL::m_C_spk[SpriteID]);
					}
					if((*g_pSkillInfoTable)[SkillID].IsPassive())
					{
						if(SpriteID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[SpriteID].IsInit())
							gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&IconDrawPos, &C_VS_UI_SKILL::m_C_spk[SpriteID], 315-256);
					}
					else
					{
						if(SpriteID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[SpriteID].IsInit())
							gpC_base->m_p_DDSurface_back->BltSprite(&IconDrawPos, &C_VS_UI_SKILL::m_C_spk[SpriteID]);
					}
					gpC_base->m_p_DDSurface_back->Unlock();	// 아이콘 출력 끝
				}

				// 여기서부터 글씨 출력
				g_FL2_GetDC();	// 문자를 출력하기 위한 준비

				if((*g_pSkillInfoTable)[SkillID].IsPassive())
				{
					g_PrintColorStrShadow(TextDrawPos.x +level_plus- 
						g_GetStringWidth((*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_desc_menu_pi.hfont)/2, TextDrawPos.y, (*g_pGameStringTable)[UI_STRING_MESSAGE_PASSIVE].GetString(), gpC_base->m_desc_menu_pi, RGB(150, 200, 255), shadow_color);
				}
				else
				{
					// 승직 스킬은 승직 레벨에 따라 스킬 등급이 올라간다.
					wsprintf(sz_temp, "%d", min(max(sum_level - skill_learn_level + 1, 0), 10));
					g_PrintColorStrShadow(TextDrawPos.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, TextDrawPos.y, sz_temp, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
				}
				
				if((*g_pSkillInfoTable)[SkillID].IsEnable() == false)
				{
					if(skill_name)
					{
						g_PrintColorStrShadow(TextDrawPos.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, TextDrawPos.y, skill_name, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
					}
				}
				else if((*g_pSkillInfoTable)[SkillID].IsPassive())
				{
					if(skill_name)
					{
						g_PrintColorStrShadow(TextDrawPos.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, TextDrawPos.y, skill_name, gpC_base->m_desc_menu_pi, RGB(150, 200, 255), shadow_color);
					}
				}
				else
				{
					if(skill_name)
					{
						g_PrintColorStrShadow(TextDrawPos.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, TextDrawPos.y, skill_name, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
					}
				}
				g_FL2_ReleaseDC();	// 문자 출력 끝
				
			}
			break;
			
		default:
			RECT alpha_rect = {IconDrawPos.x+C_VS_UI_SKILL::m_C_spk[SpriteID].GetWidth()+20,  IconDrawPos.y-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetHeight()/2)+2,
				IconDrawPos.x+C_VS_UI_SKILL::m_C_spk[SpriteID].GetWidth()+20+gpC_global_resource->m_pC_info_spk->GetWidth(nAdvanceSkillImageIdx_SkillQuad),
				IconDrawPos.y-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetHeight()/2)+2+gpC_global_resource->m_pC_info_spk->GetHeight(nAdvanceSkillImageIdx_SkillQuad)};
			
			gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
			
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				gpC_global_resource->m_pC_info_spk->BltLocked
					(IconDrawPos.x-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetWidth()/2)+2, IconDrawPos.y-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetHeight()/2)+2,
					nAdvanceSkillImageIdx_Skill);
				
				gpC_global_resource->m_pC_info_spk->BltLocked
					(IconDrawPos.x+C_VS_UI_SKILL::m_C_spk[SpriteID].GetWidth()+20,  IconDrawPos.y-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetHeight()/2)+2,
					nAdvanceSkillImageIdx_SkillQuad);
				
				gpC_global_resource->m_pC_info_spk->BltLocked
					(IconDrawPos.x+C_VS_UI_SKILL::m_C_spk[SpriteID].GetWidth()+20+ gpC_global_resource->m_pC_info_spk->GetWidth(nAdvanceSkillImageIdx_SkillQuad) ,  IconDrawPos.y-(C_VS_UI_SKILL::m_C_spk[SpriteID].GetHeight()/2)+2,
					nAdvanceSkillImageIdx_SkillQuad_Bar);
				
				// 배울 수 있는 스킬인가?
				if((*g_pSkillInfoTable)[SkillID].GetLearnLevel() >= 0	&& domain_level >= 150	&& advance_level > 0 &&
				   (*g_pSkillInfoTable)[SkillID].GetLearnLevel() <= sum_level)
				{
					if(SpriteID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[SpriteID].IsInit())
						gpC_base->m_p_DDSurface_back->BltSpriteColor(&IconDrawPos, &C_VS_UI_SKILL::m_C_spk[SpriteID], rgb_GREEN);
				}
				else
				{
					if(SpriteID < C_VS_UI_SKILL::m_C_spk.GetSize() && C_VS_UI_SKILL::m_C_spk[SpriteID].IsInit())
						gpC_base->m_p_DDSurface_back->BltSpriteEffect(&IconDrawPos, &C_VS_UI_SKILL::m_C_spk[SpriteID]);
				}
				gpC_base->m_p_DDSurface_back->Unlock();	// 아이콘 출력 끝
			}


			// 여기서 부터 글씨 출력
			g_FL2_GetDC();	// 문자를 출력하기 위한 준비

			// 아직 안 배운 스킬이기 때문에 0이다.
			wsprintf(sz_temp, "%d", 0);

			// 배울 수 있는 스킬인가?
			if(skill_learn_level >= 0	&& domain_level >= 150	&& advance_level > 0 &&
			   skill_learn_level <= sum_level)
			{
				if(skill_name)
					g_PrintColorStrShadow(TextDrawPos.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, TextDrawPos.y, skill_name, gpC_base->m_desc_menu_pi, RGB(70, 255, 70), shadow_color);
				g_PrintColorStrShadow(TextDrawPos.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, TextDrawPos.y, sz_temp, gpC_base->m_desc_menu_pi, RGB(70, 255, 70), shadow_color);
			}
			else
			{
				if(skill_name)
					g_PrintColorStrShadow(TextDrawPos.x - g_GetStringWidth(skill_name, gpC_base->m_desc_menu_pi.hfont)/2, TextDrawPos.y, skill_name, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
				g_PrintColorStrShadow(TextDrawPos.x-40 +level_plus- g_GetStringWidth(sz_temp, gpC_base->m_desc_menu_pi.hfont)/2, TextDrawPos.y, sz_temp, gpC_base->m_desc_menu_pi, RGB_GRAY, shadow_color);
			}
			g_FL2_ReleaseDC();	// 문자 출력 끝
			
			break;
		}
	}

	// 승직 스킬 리스트 출력 끝
	//////////////////////////////////////////////////////////////////////////
}


//------------------------------------------------------------------------------
// _Show6()
// : SkillBook 아이템을 통해 배우는 레어 스킬을 표시하는 탭이다.
//   2007.09.17 by chyaya
//------------------------------------------------------------------------------
void C_VS_UI_INFO::_Show6()
{
	int			indexGradeBar;
	int			indexGradeBarBack;
	int			indexRareSkillLearnCount;

	switch(g_eRaceInterface)
	{
	case RACE_VAMPIRE:
		indexGradeBar				= C_GLOBAL_RESOURCE::GRADE_BAR;	
		indexGradeBarBack			= C_GLOBAL_RESOURCE::GRADE_BAR_BACK;
		indexRareSkillLearnCount	= C_GLOBAL_RESOURCE::VAMPIRE_RARE_SKILL_LEARN_COUNT;
		break;
	case RACE_OUSTERS:
		indexGradeBar				= C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2;	
		indexGradeBarBack			= C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2_BACK;
		indexRareSkillLearnCount	= C_GLOBAL_RESOURCE::OUSTERS_RARE_SKILL_LEARN_COUNT;
		break;
//	case RACE_SLAYER:
	default:
		indexGradeBar				= C_GLOBAL_RESOURCE::DOMAIN_BAR;	
		indexGradeBarBack			= C_GLOBAL_RESOURCE::DOMAIN_BACK;
		indexRareSkillLearnCount	= C_GLOBAL_RESOURCE::SLAYER_RARE_SKILL_LEARN_COUNT;
		break;
	}

	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		gpC_global_resource->DrawOutBoxLocked(x + 15, y + 42, 307, 263);
	
		int maxCnt		= 100;
		int learnCnt	= m_rare_skill_id_vec.size();

		int nScrollPos = m_pC_rare_skill_scroll_bar->GetScrollPos();
		m_pC_rare_skill_scroll_bar->SetPosMax(learnCnt + 1 - 4);
		m_pC_rare_skill_scroll_bar->SetScrollPos(nScrollPos);

		C_SPRITE_PACK &infoSpk = *gpC_global_resource->m_pC_info_spk;

		const int barWidth = infoSpk.GetWidth(indexGradeBar);
		const int barHeight = infoSpk.GetHeight(indexGradeBar);

		const int barBackWidth = infoSpk.GetWidth(indexGradeBarBack);

		const int learnBarX = 108;
		const int learnBarY = 20;

		infoSpk.BltLocked(
			x + learnBarX - 70,
			y + learnBarY + 3,
			indexRareSkillLearnCount);

		Rect rect(0, 0, barWidth * learnCnt / maxCnt, barHeight); 
		
		// 검은색으로 채우기
		gpC_base->m_p_DDSurface_back->Unlock();
		RECT boxRect = {0, 0, barWidth, barHeight};
		OffsetRect(&boxRect,
			x + learnBarX + (barBackWidth - barWidth) / 2,
			y + learnBarY + 3
		);

		gpC_base->m_p_DDSurface_back->FillRect(&boxRect, 0);
		gpC_base->m_p_DDSurface_back->Lock();
		
		infoSpk.BltLockedClip(
			x + learnBarX + (barBackWidth - barWidth) / 2,
			y + learnBarY + 3,
			rect, indexGradeBar);

		infoSpk.BltLocked(
			x + learnBarX,
			y + learnBarY,
			indexGradeBarBack);	

		m_pC_common_button_group->Show();

		gpC_base->m_p_DDSurface_back->Unlock();

		g_FL2_GetDC();	// 문자를 출력하기 위한 준비

 		char sz_temp[80];
 		wsprintf(sz_temp, "%d/%d", learnCnt, maxCnt);

		const int textW = g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont);

 		g_PrintColorStrOut(
			x + learnBarX + (barBackWidth - textW) / 2,
			y + learnBarY + 3,
			sz_temp, gpC_base->m_chatting_pi,
			RGB_WHITE, RGB_BLACK);
		
		g_FL2_ReleaseDC();	// 문자 출력 끝
	}

	m_pC_rare_skill_scroll_bar->Show(x, y);

	_Show6_RareSkillList();

	m_pC_common_button_group->ShowDescription();
}



//-----------------------------------------------------------------------------
// _Show5_ACSkillList()
// : 레어 스킬 리스트 출력
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::_Show6_RareSkillList()
{
	//////////////////////////////////////////////////////////////////////////
	// 2007.09.17 by chyaya
	// : 레어 스킬 리스트를 출력한다.
	//   사실 승직 스킬 리스트 부분 카피한거다
	//   이 기회에 스킬 출력 리스트라고 아예 class를 하나 만들까 싶었만
	//   스킬 리스트마다 약간씩 출력 방법이 틀려서
	//   귀찮이즘의 압박으로 = _=;;

	const int skip_y		= 4;

	int nAdvanceSkillImageIdx_Skill;
	int nAdvanceSkillImageIdx_SkillQuad;
	int nAdvanceSkillImageIdx_SkillQuad_Bar;

	// 종족에 맞는 그림 모양을 선택한다.
	switch(g_eRaceInterface)
	{
	case RACE_VAMPIRE:
		nAdvanceSkillImageIdx_Skill			= C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILL;
		nAdvanceSkillImageIdx_SkillQuad		= C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD;
		nAdvanceSkillImageIdx_SkillQuad_Bar = C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_SKILLQUAD_BAR;
		break;
	case RACE_OUSTERS:
		nAdvanceSkillImageIdx_Skill			= C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILL;
		nAdvanceSkillImageIdx_SkillQuad		= C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD;
		nAdvanceSkillImageIdx_SkillQuad_Bar = C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_SKILLQUAD_BAR;
		break;
//	case RACE_SLAYER:	
	default: // 기본값으로 슬레이어 혹시 모르니 -ㅅ-)
		nAdvanceSkillImageIdx_Skill			= C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILL;
		nAdvanceSkillImageIdx_SkillQuad		= C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD;
		nAdvanceSkillImageIdx_SkillQuad_Bar = C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYERS_SKILLQUAD_BAR;
		break;
	}

	// 여기서부터 막장
	int nScrollPos = m_pC_rare_skill_scroll_bar->GetScrollPos();
	m_pC_grade3_scroll_bar->SetPosMax(m_advance_skill_id_vec.size() + 1 - 3);
	m_pC_grade3_scroll_bar->SetScrollPos(nScrollPos);

	const int level_plus = 127;
	const DWORD shadow_color = RGB_BLACK;
	
	const MSkillDomain::SKILL_STEP_LIST& skillList = m_rare_skill_id_vec;

	MSkillDomain::SKILL_STEP_LIST::const_iterator iter		= skillList.begin();
	std::advance(iter, nScrollPos);	// 스크롤 위치만큼 이동
	int maxSize = min(4, skillList.size() - max(0, nScrollPos));
	int showCnt = 0;


	for(; iter != skillList.end() && showCnt < maxSize; ++iter)
	{
		const ACTIONINFO skillID = *iter;
		
		POINT IconDrawPos = {x + 40, y + 63 + showCnt * 60 + skip_y};
		POINT TextDrawPos = {x + 195, y + 72 + showCnt * 60 + skip_y};
		
		const int spriteID = (*g_pSkillInfoTable)[skillID].GetSpriteID();
		
		if(spriteID >= C_VS_UI_SKILL::m_C_spk.GetSize()) continue;
		
		CSprite& IconSprite = C_VS_UI_SKILL::m_C_spk[spriteID];
		
		if(!IconSprite.IsInit()) continue;
		
		C_SPRITE_PACK& infoSpk = *gpC_global_resource->m_pC_info_spk;
		
		const int skillTemplateW = infoSpk.GetWidth(nAdvanceSkillImageIdx_SkillQuad);
		const int skillTemplateH = infoSpk.GetHeight(nAdvanceSkillImageIdx_SkillQuad);
		
		const int iconW = IconSprite.GetWidth();
		const int iconH = IconSprite.GetHeight();
		
		const char *skillName = (*g_pSkillInfoTable)[skillID].GetHName();
		
		RECT alpha_rect = {
			IconDrawPos.x + iconW + 20,
				IconDrawPos.y - iconH / 2 + 2,
				IconDrawPos.x + iconW + 20 + skillTemplateW,
				IconDrawPos.y - iconH / 2 + 2 + skillTemplateH
		};
		
		gpC_base->m_p_DDSurface_back->FillRect(&alpha_rect, 0);
		if(gpC_base->m_p_DDSurface_back->Lock())
		{
			infoSpk.BltLocked(
				IconDrawPos.x - iconW / 2 + 2,
				IconDrawPos.y - iconH / 2 + 2,
				nAdvanceSkillImageIdx_Skill);
			
			infoSpk.BltLocked(
				IconDrawPos.x + iconW + 20,
				IconDrawPos.y - iconH / 2 + 2,
				nAdvanceSkillImageIdx_SkillQuad);
			
			infoSpk.BltLocked(
				IconDrawPos.x + iconW + 20	+ skillTemplateW,
				IconDrawPos.y - iconH / 2 + 2,
				nAdvanceSkillImageIdx_SkillQuad_Bar);
			
			
			gpC_base->m_p_DDSurface_back->BltSprite(&IconDrawPos, &IconSprite);
			
			gpC_base->m_p_DDSurface_back->Unlock();	// 아이콘 출력 끝
		}
		
		
		// 여기서부터 글씨 출력
		g_FL2_GetDC();	// 문자를 출력하기 위한 준비
		g_PrintColorStrShadow(
			TextDrawPos.x - g_GetStringWidth(skillName, gpC_base->m_desc_menu_pi.hfont) / 2,
			TextDrawPos.y, skillName, gpC_base->m_desc_menu_pi, RGB_WHITE, shadow_color);
		g_FL2_ReleaseDC();	// 문자 출력 끝
		
		
		++showCnt;
	}

	// 레어 스킬 리스트 출력 끝
	//////////////////////////////////////////////////////////////////////////
}



//-----------------------------------------------------------------------------
// Show
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::Show()
{
	/*
	if(m_skill_info_mode)	//Skill Info Mode
	{
		_Show1();
	}
	else	// Character Info Mode
	{
		gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);
		_Show2();
		m_pC_char_scroll_bar->Show(x, y);
	}*/
	///*
	gpC_global_resource->DrawDialog(x-10, y, w+25, h, GetAttributes()->alpha);



	// show tab
	const int TAB_IMAGE_BASIS = C_GLOBAL_RESOURCE::TAB_CHAR;
	
	gpC_base->m_p_DDSurface_back->Lock();


	int i = INFO_MODE_MAX - 1;

#if !__CONTENTS(__RARE_SKILL)
	--i;
#endif

	for(; i >= 0 ; --i)
	{
		if(m_info_mode != i)
		{
			gpC_global_resource->m_pC_info_spk->BltLocked(
				x + m_rt_tab.x + m_rt_tab.w * i,
				y + m_rt_tab.y,
				TAB_IMAGE_BASIS + i * 2);
		}
	}

	i = m_info_mode;

	gpC_global_resource->m_pC_info_spk->BltLocked(
		x + m_rt_tab.x + m_rt_tab.w * i,
		y + m_rt_tab.y,
		TAB_IMAGE_BASIS + i * 2 + 1);

	gpC_base->m_p_DDSurface_back->Unlock();


	switch(m_info_mode)
	{
	case CHARACTER_INFO_MODE :
	//	gpC_global_resource->DrawDialog(x-5, y, w+30, h, GetAttributes()->alpha);
		_Show2();
		m_pC_char_scroll_bar->Show(x, y);
		break;
	case SKILL_INFO_MODE :
	//	gpC_global_resource->DrawDialog(x-5, y, w+30, h, GetAttributes()->alpha);
		_Show1();
		break;
	case GRADE1_INFO_MODE :		
	//	gpC_global_resource->DrawDialog(x-5, y, w+30, h, GetAttributes()->alpha);
		_Show3();
		break;
	case GRADE2_INFO_MODE :		
	//	gpC_global_resource->DrawDialog(x-5, y, w+30, h, GetAttributes()->alpha);
		_Show4();
		break;
	case GRADE3_INFO_MODE:
		//g_char_slot_ingame.m_AdvancementLevel
		_Show5();	
		break;
	case RARE_SKILL_INFO_MODE: 
#if __CONTENTS(__RARE_SKILL)
		_Show6();
#endif
		break;
	}//*/
}

//-----------------------------------------------------------------------------
// Start
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::Start(INFO_MODE	Info_Mode)
{
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::INFO));
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::INFO);
	if(rect.w != -1)
	{
		x = rect.x;
		y = rect.y;
	}
	
	//길드마크 로딩
	m_p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(g_char_slot_ingame.GUILD_ID);
	
	if (m_p_guild_mark==NULL)
	{
		//-------------------------------------------------
		// file에 있는지 본다.
		//-------------------------------------------------
		g_pGuildMarkManager->LoadGuildMark(g_char_slot_ingame.GUILD_ID);
		
		//-------------------------------------------------
		// file에서 load되었는지 다시 체크
		//-------------------------------------------------
		m_p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(g_char_slot_ingame.GUILD_ID);
	}

	PI_Processor::Start();
	
	//	m_pC_button_group->Init();
	m_pC_common_button_group->Init();
	m_pC_char_button_group->Init();
	m_pC_skill_button_group->Init();
	
	m_info_mode = Info_Mode;
	
	
	m_iGrade=max(YESOD_ID,m_iGrade);
	m_iGrade=min(m_iGrade,KEATHER_ID);

	CheckGradeSkillIDList();
	
	gpC_window_manager->AppearWindow(this);

	m_bOustersDownSkill = false;

	// 2004, 11, 25, sobeit add start - 슬레일 경우 자기 도메인 스킬이 나오도록..
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			int level = -1;
			for(int i = 0; i < 5; i++)
			{
				int level_temp = (*g_pSkillManager)[(SKILLDOMAIN)i].GetDomainLevel();
				if(level_temp > level)
				{
					level = level_temp;
					m_skill_domain = (SKILLDOMAIN)i;
					m_iDomain = BLADE_ID+i;
					const MSkillDomain::SKILL_STEP_LIST* pSkillList = (*g_pSkillManager)[m_skill_domain].GetSkillStepList((SKILL_STEP)(SKILL_STEP_APPRENTICE));
					if ( pSkillList )
						m_pC_skill_scroll_bar->SetPosMax(pSkillList->size()-7);
					else
					{
						LogError("pSkillList == NULL!!!!");
					}
					//				m_pC_skill_scroll_bar->SetPosMax((*g_pSkillManager)[(SKILLDOMAIN)i].GetSize()-7);
				}
			}
		}
		break;
	}	
	// 2004, 11, 25, sobeit add end

//	Button *pButton = m_pC_common_button_group->GetButton(PET_INFO_ID);
//	if(pButton != NULL && m_pPetItem != NULL)
//	{
//		int pet_x = 0, pet_y = 0;
//
//		switch(g_eRaceInterface)
//		{
//		case RACE_SLAYER:
//			pet_x = w-10;
//			pet_y = 29;
//			break;
//
//		case RACE_VAMPIRE:
//			pet_x = w-10;
//			pet_y = 30;
//			break;
//
//		case RACE_OUSTERS:
//			pet_x = w-22;
//			pet_y = 45;
//			break;
//		}
//		pButton->Set(pet_x, pet_y, m_petButtonSpk.GetWidth((m_pPetItem->GetItemType()-1)*2), m_petButtonSpk.GetHeight((m_pPetItem->GetItemType()-1)*2));
//	}
	RefreshImage();
	
	EMPTY_MOVE;
}

////-----------------------------------------------------------------------------
//// Start
////
//// 
////-----------------------------------------------------------------------------
//void C_VS_UI_INFO::Start(bool skill_mode)
//{
//	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::INFO));
//	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::INFO);
//	if(rect.w != -1)
//	{
//		x = rect.x;
//		y = rect.y;
//	}
//	
//	//길드마크 로딩
//	m_p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(g_char_slot_ingame.GUILD_ID);
//	
//	if (m_p_guild_mark==NULL)
//	{
//		//-------------------------------------------------
//		// file에 있는지 본다.
//		//-------------------------------------------------
//		g_pGuildMarkManager->LoadGuildMark(g_char_slot_ingame.GUILD_ID);
//		
//		//-------------------------------------------------
//		// file에서 load되었는지 다시 체크
//		//-------------------------------------------------
//		m_p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(g_char_slot_ingame.GUILD_ID);
//	}
//	
//	PI_Processor::Start();
//	
//	//	m_pC_button_group->Init();
//	m_pC_common_button_group->Init();
//	m_pC_char_button_group->Init();
//	m_pC_skill_button_group->Init();
//	
//	//m_skill_info_mode = skill_mode;
//	if(skill_mode)
//		m_info_mode = SKILL_INFO_MODE;
//	else
//		m_info_mode = CHARACTER_INFO_MODE;
//	
//	gpC_window_manager->AppearWindow(this);
//
//	m_bOustersDownSkill = false;
//	
//	EMPTY_MOVE;
//}

void C_VS_UI_INFO::Finish()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::INFO, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::INFO, Rect(x, y, w, h));
	
	//	if(gpC_global_resource->m_pC_info_spk)
	//	{
	//		DeleteNew(m_pC_info_spk);
	//		m_pC_info_spk = NULL;
	//	}
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
	
}

//-----------------------------------------------------------------------------
// Process
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::Process()
{
	m_pC_common_button_group->Process();

	switch(m_info_mode)
	{
	case CHARACTER_INFO_MODE :
		m_pC_char_button_group->Process();
		if(g_char_slot_ingame.Race != RACE_SLAYER && g_char_slot_ingame.bonus_point > 0)
		{
//			gpC_base->SendMessage(UI_RUN_LEVELUP);
			if(!gC_vs_ui.IsRunningLevelUp())
				gC_vs_ui.LevelUp();
		}
		else
			gC_vs_ui.FinishLevelUp();
		break;
	case SKILL_INFO_MODE :
		m_pC_skill_button_group->Process();
		break;
	case GRADE1_INFO_MODE :
		m_pC_grade1_button_group->Process();
		break;
	case GRADE2_INFO_MODE :
		m_pC_grade2_button_group->Process();
		break;
	case GRADE3_INFO_MODE :
		m_pC_grade3_button_group->Process();
		Process5_ACSkillList();
		break;
	case RARE_SKILL_INFO_MODE :
		Process6_RareSkillList();
		break;
	}
	/*if(m_skill_info_mode)
		m_pC_skill_button_group->Process();
	else
	{
		m_pC_char_button_group->Process();
		if(g_char_slot_ingame.bl_vampire && g_char_slot_ingame.bonus_point > 0)
			gC_vs_ui.LevelUp();
		else
			gC_vs_ui.FinishLevelUp();
	}*/
}


//-----------------------------------------------------------------------------
// Process_ACSkillTab
// : 승직 스킬탭에 관련된 처리를 한다.
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::Process5_ACSkillList()
{
	int nScrollPosBackup = m_pC_grade3_scroll_bar->GetScrollPos();
	m_pC_grade3_scroll_bar->SetPosMax(m_advance_skill_id_vec.size() + 1 - 3);
	m_pC_grade3_scroll_bar->SetScrollPos(nScrollPosBackup);

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:	Process5_ACSkillList_Slayer();	break;
	case RACE_VAMPIRE:	Process5_ACSkillList_Vampire();	break;
	case RACE_OUSTERS:	Process5_ACSkillList_Ousters();	break;
	}
}


//-----------------------------------------------------------------------------
// Process_ACSkillTab_Slayer
// : 슬레이어 승직 스킬탭에 관련된 처리를 한다.
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::Process5_ACSkillList_Slayer()
{
	SKILL_STEP step = (SKILL_STEP)(SKILL_STEP_SLAYER_BLADE_ADVANCEMENT + m_skill_domain);
	//SKILL_STEP step2 = (SKILL_STEP)(SKILL_STEP_SLAYER_201_NEW);
	
	if((*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))// && (*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step2))
	{
		const MSkillDomain::SKILL_STEP_LIST& list = *((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step));
	//	const MSkillDomain::SKILL_STEP_LIST& list2 = *((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step2));

		m_advance_skill_id_vec = list;

	//	int nSize = list2.size();

		//for (int i=0; i<nSize; i++)
		//{
		//	m_advance_skill_id_vec.push_back( list2[i] );
		//}
	}
		step = (SKILL_STEP)(SKILL_STEP_SLAYER_201_NEW);

	if((*g_pSkillManager)[m_skill_domain].IsExistSkillStep(step))
	{
		MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[m_skill_domain].GetSkillStepList(step));

		for (int i=0; i<list.size(); i++)
		{
			m_advance_skill_id_vec.push_back( list[i] );
		}
	}
}

//-----------------------------------------------------------------------------
// Process_ACSkillTab_Vampire
// : 뱀파이어 승직 스킬탭에 관련된 처리를 한다.
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::Process5_ACSkillList_Vampire()
{
	m_advance_skill_id_vec.clear();

	m_vampire_ACType = -1;

	SKILL_STEP step;
	for(int i = 0; i < 2 ; i++)
	{
		step = (SKILL_STEP)(SKILL_STEP_VAMPIRE_WARRIOR_ADVANCEMENT+i);
		if((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
		{
			MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step));
			MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
			MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStatus((ACTIONINFO)*ss);
			
			if(MSkillDomain::SKILLSTATUS::SKILLSTATUS_LEARNED == status)
			{
				m_vampire_ACType = i;	
				m_pC_grade3_scroll_bar->SetScrollPos(0); 
				break;
			}
		}
	}

	// 전투 계열 결정 전
	if(m_vampire_ACType == -1)
	{
		for(i = 0; i < 2; i++)
		{
			step = (SKILL_STEP)(SKILL_STEP_VAMPIRE_WARRIOR_ADVANCEMENT+i);
			if((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
			{
				MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step));
				MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
				MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStatus((ACTIONINFO)*ss);
				
				if(MSkillDomain::SKILLSTATUS::SKILLSTATUS_LEARNED != status)
				{
					if((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
					{
						MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step));
						MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
						const ACTIONINFO SkillID = (ACTIONINFO)*ss;

						m_advance_skill_id_vec.push_back(SkillID);
					}
				}
			}
		}
	}
	// 전투 계열 결정 후
	else
	{
		step = (SKILL_STEP)(SKILL_STEP_VAMPIRE_WARRIOR_ADVANCEMENT + m_vampire_ACType);

		if((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
		{
			MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step));
			
			MSkillDomain::SKILL_STEP_LIST::iterator iter = list.begin();

			for(; iter != list.end(); ++iter)
			{
				const ACTIONINFO SkillID = (ACTIONINFO)*iter;

				// 피의 저주는 피의 향연과 세트 스킬이기 때문에 넣어줄 필요가 없다.
				if(SkillID != SKILL_BLOOD_CURSE)
					m_advance_skill_id_vec.push_back(SkillID);
			}
		}
	}

	step = (SKILL_STEP)(SKILL_STEP_VANPIRE_201_NEW);

	if((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].IsExistSkillStep(step))
	{
		MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_VAMPIRE].GetSkillStepList(step));

		for (int i=0; i<list.size(); i++)
		{
			m_advance_skill_id_vec.push_back( list[i] );
		}
	}
}


//-----------------------------------------------------------------------------
// Process_ACSkillTab_Ousters
// : 아우스터 승직 스킬탭에 관련된 처리를 한다.
//-----------------------------------------------------------------------------
void C_VS_UI_INFO::Process5_ACSkillList_Ousters()
{
	m_advance_skill_id_vec.clear();

	m_ousters_Magic = -1;

	SKILL_STEP step;
	
	for(int i = 0; i < 4 ; i++)
	{
		step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT+i);
		if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
		{
			MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
			MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
			MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus((ACTIONINFO)*ss);
			
			if(MSkillDomain::SKILLSTATUS::SKILLSTATUS_LEARNED == status)
			{
				m_ousters_Magic = i;	
				m_pC_grade3_scroll_bar->SetScrollPos(0); 
				break;
			}
		}
	}

	// 정령 계열 결정 전
	if(m_ousters_Magic == -1)
	{
		for(i = 0; i < 4; i++)
		{
			step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT+i);
			if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
			{
				MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
				MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
				MSkillDomain::SKILLSTATUS status = (*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStatus((ACTIONINFO)*ss);
				
				if(MSkillDomain::SKILLSTATUS::SKILLSTATUS_LEARNED != status)
				{
					if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
					{
						MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
						MSkillDomain::SKILL_STEP_LIST::iterator ss = list.begin();
						const ACTIONINFO SkillID = (ACTIONINFO)*ss;

						m_advance_skill_id_vec.push_back(SkillID);
					}
				}
			}
		}
	}
	// 정령 계열 결정 후
	else
	{
		step = (SKILL_STEP)(SKILL_STEP_OUSTERS_COMBAT_ADVANCEMENT + m_ousters_Magic);

		if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
		{
			MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));
			
			m_advance_skill_id_vec = list;
		}
	}


	step = (SKILL_STEP)(SKILL_STEP_OUSTERS_201_NEW);

	if((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].IsExistSkillStep(step))
	{
		MSkillDomain::SKILL_STEP_LIST list = *((*g_pSkillManager)[SKILLDOMAIN_OUSTERS].GetSkillStepList(step));

		for (int i=0; i<list.size(); i++)
		{
			m_advance_skill_id_vec.push_back( list[i] );
		}
	}
}


void C_VS_UI_INFO::Process6_RareSkillList()
{

	std::vector<SKILL_STEP>	rareSkillStepVec;
	std::vector<SKILLDOMAIN> skillDomainVec;

	switch(g_eRaceInterface)
	{
	case RACE_VAMPIRE:
		rareSkillStepVec.push_back(SKILL_STEP_VAMPIRE_RARE);
		skillDomainVec.push_back(SKILLDOMAIN_VAMPIRE);
		break;
	case RACE_OUSTERS:
		rareSkillStepVec.push_back(SKILL_STEP_OUSTERS_RARE);
		skillDomainVec.push_back(SKILLDOMAIN_OUSTERS);
		break;
//	case RACE_SLAYER:
	default:
		rareSkillStepVec.push_back(SKILL_STEP_SLAYER_RARE);
		skillDomainVec.push_back(SKILLDOMAIN_BLADE);
		skillDomainVec.push_back(SKILLDOMAIN_SWORD);
		skillDomainVec.push_back(SKILLDOMAIN_GUN);
		skillDomainVec.push_back(SKILLDOMAIN_HEAL);
		skillDomainVec.push_back(SKILLDOMAIN_ENCHANT);
		skillDomainVec.push_back(SKILLDOMAIN_ETC);
		break;
	}

	rareSkillStepVec.push_back(SKILL_STEP_COMMON_RARE);

	// 기획팀에서 나중에 추가한다고 일단 20으로 하잔다. - _-;;
	m_rare_skill_max = 100;
	//m_rare_skill_max = 0;

	m_rare_skill_id_vec.clear();

	std::vector<SKILLDOMAIN>::iterator skillDomainIter = skillDomainVec.begin();

	for(; skillDomainIter != skillDomainVec.end(); ++skillDomainIter)
	{
		const SKILLDOMAIN skillDomain = *skillDomainIter;

		std::vector<SKILL_STEP>::iterator skillStepIter = rareSkillStepVec.begin();

		for(; skillStepIter != rareSkillStepVec.end(); ++skillStepIter)
		{
			const SKILL_STEP rareSkillStep = *skillStepIter;

			const MSkillDomain::SKILL_STEP_LIST& skillList = *((*g_pSkillManager)[skillDomain].GetSkillStepList(rareSkillStep));
		
			MSkillDomain::SKILL_STEP_LIST::const_iterator iter = skillList.begin();

			for(; iter != skillList.end(); ++iter)
			{
				const ACTIONINFO skillID = *iter;
				
				MSkillDomain::SKILLSTATUS skillStatus = (*g_pSkillManager)[skillDomain].GetSkillStatus(skillID);
			
				if(skillStatus == MSkillDomain::SKILLSTATUS_LEARNED)
				{
					m_rare_skill_id_vec.push_back(skillID);
				}

				//++m_rare_skill_max;
			}
		}
	}

}


//-----------------------------------------------------------------------------
// C_VS_UI_HPBAR
//
//-----------------------------------------------------------------------------
C_VS_UI_HPBAR::C_VS_UI_HPBAR()
{
	m_pC_hpbar_spk = NULL;
	
	AttrTopmost(false);
	AttrPin(true);
	
	m_width_mode = true;//false;
	m_small_mode = false;
	m_small_offset = 0;	
	
	g_RegisterWindow(this);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_pC_hpbar_spk = new C_SPRITE_PACK(SPK_HPBAR_SLAYER);
		break;

	case RACE_VAMPIRE:
		m_pC_hpbar_spk = new C_SPRITE_PACK(SPK_HPBAR_VAMPIRE);
		break;

	case RACE_OUSTERS:
		m_pC_hpbar_spk = new C_SPRITE_PACK(SPK_HPBAR_OUSTERS);
		break;	
	}	
	Set(0, 0, m_pC_hpbar_spk->GetWidth(), m_pC_hpbar_spk->GetHeight());
	
	//skillinfo 버튼
	m_pC_width_button_group = new ButtonGroup(this);
	m_pC_height_button_group = new ButtonGroup(this);
	m_pC_small_width_button_group = new ButtonGroup(this);
	m_pC_small_height_button_group = new ButtonGroup(this);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_pC_small_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(133, 4, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON_WIDTH+SLAYER_MAX), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON_WIDTH+SLAYER_MAX), CHANGE_ID, this, CHANGE_BUTTON_WIDTH+SLAYER_MAX));
		m_pC_small_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(2, 4, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON_WIDTH+SLAYER_MAX), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON_WIDTH+SLAYER_MAX), RESIZE_ID, this, CHANGE_BUTTON_WIDTH+SLAYER_MAX));
		m_pC_small_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(4, 4, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON_HEIGHT+SLAYER_MAX), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON_HEIGHT+SLAYER_MAX), CHANGE_ID, this, CHANGE_BUTTON_HEIGHT+SLAYER_MAX));
		m_pC_small_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(4, 135, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON_HEIGHT+SLAYER_MAX), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON_HEIGHT+SLAYER_MAX), RESIZE_ID, this, CHANGE_BUTTON_HEIGHT+SLAYER_MAX));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(199, 5, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON_WIDTH), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON_WIDTH), CHANGE_ID, this, CHANGE_BUTTON_WIDTH));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(2, 5, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON_WIDTH), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON_WIDTH), RESIZE_ID, this, CHANGE_BUTTON_WIDTH));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(5, 6, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON_HEIGHT), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON_HEIGHT), CHANGE_ID, this, CHANGE_BUTTON_HEIGHT));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(5, 203, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON_HEIGHT), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON_HEIGHT), RESIZE_ID, this, CHANGE_BUTTON_HEIGHT));
		break;

	case RACE_VAMPIRE:
		m_pC_small_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(133, 3, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON+VAMPIRE_MAX), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON+VAMPIRE_MAX), CHANGE_ID, this, CHANGE_BUTTON+VAMPIRE_MAX));
		m_pC_small_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(4, 14, m_pC_hpbar_spk->GetWidth(SMALL_BUTTON+VAMPIRE_MAX), m_pC_hpbar_spk->GetHeight(SMALL_BUTTON+VAMPIRE_MAX), RESIZE_ID, this, SMALL_BUTTON+VAMPIRE_MAX));
		m_pC_small_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(2, 4, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON+VAMPIRE_MAX), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON+VAMPIRE_MAX), CHANGE_ID, this, CHANGE_BUTTON+VAMPIRE_MAX));
		m_pC_small_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(14, 136, m_pC_hpbar_spk->GetWidth(SMALL_BUTTON+VAMPIRE_MAX), m_pC_hpbar_spk->GetHeight(SMALL_BUTTON+VAMPIRE_MAX), RESIZE_ID, this, SMALL_BUTTON+VAMPIRE_MAX));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(200, 3, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON), CHANGE_ID, this, CHANGE_BUTTON));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(7, 21, m_pC_hpbar_spk->GetWidth(SMALL_BUTTON), m_pC_hpbar_spk->GetHeight(SMALL_BUTTON), RESIZE_ID, this, SMALL_BUTTON));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(3, 6, m_pC_hpbar_spk->GetWidth(CHANGE_BUTTON), m_pC_hpbar_spk->GetHeight(CHANGE_BUTTON), CHANGE_ID, this, CHANGE_BUTTON));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(21, 204, m_pC_hpbar_spk->GetWidth(SMALL_BUTTON), m_pC_hpbar_spk->GetHeight(SMALL_BUTTON), RESIZE_ID, this, SMALL_BUTTON));
		break;

	case RACE_OUSTERS:
		m_pC_small_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(121, 3, m_pC_hpbar_spk->GetWidth(OUSTERS_CHANGE_BUTTON_WIDTH+OUSTERS_MAX), m_pC_hpbar_spk->GetHeight(OUSTERS_CHANGE_BUTTON_WIDTH+OUSTERS_MAX), CHANGE_ID, this, OUSTERS_CHANGE_BUTTON_WIDTH+OUSTERS_MAX));
		m_pC_small_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(2, 2, m_pC_hpbar_spk->GetWidth(OUSTERS_SMALL_BUTTON_WIDTH+OUSTERS_MAX), m_pC_hpbar_spk->GetHeight(OUSTERS_SMALL_BUTTON_WIDTH+OUSTERS_MAX), RESIZE_ID, this, OUSTERS_SMALL_BUTTON_WIDTH+OUSTERS_MAX));
		m_pC_small_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(3, 6, m_pC_hpbar_spk->GetWidth(OUSTERS_CHANGE_BUTTON_HEIGHT+OUSTERS_MAX), m_pC_hpbar_spk->GetHeight(OUSTERS_CHANGE_BUTTON_HEIGHT+OUSTERS_MAX), CHANGE_ID, this, OUSTERS_CHANGE_BUTTON_HEIGHT+OUSTERS_MAX));
		m_pC_small_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(2, 132, m_pC_hpbar_spk->GetWidth(OUSTERS_SMALL_BUTTON_HEIGHT+OUSTERS_MAX), m_pC_hpbar_spk->GetHeight(OUSTERS_SMALL_BUTTON_HEIGHT+OUSTERS_MAX), RESIZE_ID, this, OUSTERS_SMALL_BUTTON_HEIGHT+OUSTERS_MAX));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(179, 6, m_pC_hpbar_spk->GetWidth(OUSTERS_CHANGE_BUTTON_WIDTH), m_pC_hpbar_spk->GetHeight(OUSTERS_CHANGE_BUTTON_WIDTH), CHANGE_ID, this, OUSTERS_CHANGE_BUTTON_WIDTH));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(2, 3, m_pC_hpbar_spk->GetWidth(OUSTERS_SMALL_BUTTON_WIDTH), m_pC_hpbar_spk->GetHeight(OUSTERS_SMALL_BUTTON_WIDTH), RESIZE_ID, this, OUSTERS_SMALL_BUTTON_WIDTH));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(6, 10, m_pC_hpbar_spk->GetWidth(OUSTERS_CHANGE_BUTTON_HEIGHT), m_pC_hpbar_spk->GetHeight(OUSTERS_CHANGE_BUTTON_HEIGHT), CHANGE_ID, this, OUSTERS_CHANGE_BUTTON_HEIGHT));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(3, 196, m_pC_hpbar_spk->GetWidth(OUSTERS_SMALL_BUTTON_HEIGHT), m_pC_hpbar_spk->GetHeight(OUSTERS_SMALL_BUTTON_HEIGHT), RESIZE_ID, this, OUSTERS_SMALL_BUTTON_HEIGHT));
		break;		
	}	
}

//-----------------------------------------------------------------------------
// ~C_VS_UI_HPBAR
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_HPBAR::~C_VS_UI_HPBAR()
{
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::HPBAR, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::HPBAR, Rect(x, y, w, h));
	gpC_vs_ui_window_manager->SetHPBarHeight(!m_width_mode);
	gpC_vs_ui_window_manager->SetHPBarSmall(m_small_mode);
	
	g_UnregisterWindow(this);
	
	DeleteNew(m_pC_hpbar_spk);
	DeleteNew(m_pC_width_button_group);
	DeleteNew(m_pC_height_button_group);
	DeleteNew(m_pC_small_width_button_group);
	DeleteNew(m_pC_small_height_button_group);
}


void	C_VS_UI_HPBAR::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	static char* hpbar_string[4] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_SET_LARGE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_SET_SMALL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_SET_WIDTH].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_SET_HEIGHT].GetString(),		
	};
	
	if(p_button->GetID() == CHANGE_ID && m_width_mode == false)
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)hpbar_string[2],0,0);
	else if(p_button->GetID() == RESIZE_ID && m_small_mode)
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)hpbar_string[3],0,0);
	else
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)hpbar_string[p_button->GetID()],0,0);
}
//-----------------------------------------------------------------------------
// C_VS_UI_HPBAR::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_HPBAR::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y+1, p_button->m_image_index+1);
			else
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+1);
		}
		else
		{
			if(p_button->GetPressState())
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y+1, p_button->m_image_index);
			else
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
		}
		break;

	case RACE_VAMPIRE:
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+3);
			else
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+2);
		}
		else
		{
			if(p_button->GetPressState())
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+1);
			else
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
		}
		break;

	case RACE_OUSTERS:
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y+1, p_button->m_image_index+1);
			else
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+1);
		}
		else
		{
			if(p_button->GetPressState())
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y+1, p_button->m_image_index);
			else
				m_pC_hpbar_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
		}
		break;
	}
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_HPBAR::WindowEventReceiver(id_t event)
{
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_HPBAR::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	return IsInRect(_x, _y);
	//	if(m_width_mode)
	//		return m_pC_hpbar_spk->IsPixel(_x-x, _y-y, MAIN_WIDTH);
	//	else
	//		return m_pC_hpbar_spk->IsPixel(_x-x, _y-y, MAIN_HEIGHT);
	
	//	return false;
	//	return m_pC_charinfo->IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y), CHARINFO_WINDOW);
}

//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_HPBAR::Run(id_t id)
{
	switch (id)
	{
	case CHANGE_ID:
		m_width_mode = !m_width_mode;
		w^=h; h^=w; w^=h; //swap
		x -= w-h;
		EMPTY_MOVE;
		break;
		
	case RESIZE_ID:
		m_small_mode = !m_small_mode;
		if(m_small_mode)
		{
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				m_small_offset = SLAYER_MAX;
				break;

			case RACE_VAMPIRE:
				m_small_offset = VAMPIRE_MAX;
				break;

			case RACE_OUSTERS:
				m_small_offset = OUSTERS_MAX;
				break;
			}			
		}
		else m_small_offset = 0;
		if(m_width_mode)
		{
			w = m_pC_hpbar_spk->GetWidth(MAIN_WIDTH+m_small_offset);
			h = m_pC_hpbar_spk->GetHeight(MAIN_WIDTH+m_small_offset);
		}
		else
		{
			w = m_pC_hpbar_spk->GetWidth(MAIN_HEIGHT+m_small_offset);
			h = m_pC_hpbar_spk->GetHeight(MAIN_HEIGHT+m_small_offset);
		}
		EMPTY_MOVE;
		break;
	}
}

//-----------------------------------------------------------------------------
// MouseControl
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_HPBAR::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	
	bool re;
	int descType = 0;
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		if(m_small_mode)
		{
			if(m_width_mode)
			{
				re = m_pC_small_width_button_group->MouseControl(message, _x, _y);
				if(_x > 14 && _x < 120 && _y > 3 && _y < 15)
					descType = 1; // hp desc
				if(_x > 14 && _x < 120 && _y > 15 && _y < 22)
					descType = 2; // mp desc
			}
			else
			{
				re = m_pC_small_height_button_group->MouseControl(message, _x, _y);
				if(_y < h-14 && _y > h-120 && _x > 3 && _x < 15)
					descType = 1; // hp desc
				if(_y < h-14 && _y > h-120 && _x > 15 && _x < 22)
					descType = 2; // mp desc
			}
		}
		else
		{
			if(m_width_mode)
			{
				re = m_pC_width_button_group->MouseControl(message, _x, _y);
				if(_x > 20 && _x < 182 && _y > 3 && _y < 23)
					descType = 1; // hp desc
				if(_x > 20 && _x < 182 && _y > 23 && _y < 34)
					descType = 2; // mp desc
			}
			else
			{
				re = m_pC_height_button_group->MouseControl(message, _x, _y);
				if(_y < h-20 && _y > h-182 && _x > 3 && _x < 23)
					descType = 1; // hp desc
				if(_y < h-20 && _y > h-182 && _x > 23 && _x < 34)
					descType = 2; // mp desc
			}
		}
		break;

	case RACE_VAMPIRE:
		if(m_small_mode)
		{
			if(m_width_mode)
			{
				re = m_pC_small_width_button_group->MouseControl(message, _x, _y);
				if(_x > 14 && _x < 115 && _y > 3 && _y < 15)
					descType = 1; // hp desc
				if(_x > 14 && _x < 115 && _y > 15 && _y < 22)
					descType = 2; // mp desc
			}
			else
			{
				re = m_pC_small_height_button_group->MouseControl(message, _x, _y);
				if(_y < h-14 && _y > h-115 && _x > 3 && _x < 15)
					descType = 1; // hp desc
				if(_y < h-14 && _y > h-115 && _x > 15 && _x < 22)
					descType = 2; // mp desc
			}
		}
		else
		{
			if(m_width_mode)
			{
				re = m_pC_width_button_group->MouseControl(message, _x, _y);
				if(_x > 25 && _x < 172 && _y > 3 && _y < 23)
					descType = 1; // hp desc
				if(_x > 25 && _x < 172 && _y > 23 && _y < 34)
					descType = 2; // mp desc
			}
			else
			{
				re = m_pC_height_button_group->MouseControl(message, _x, _y);
				if(_y < h-25 && _y > h-172 && _x > 3 && _x < 23)
					descType = 1; // hp desc
				if(_y < h-25 && _y > h-172 && _x > 23 && _x < 34)
					descType = 2; // mp desc
			}
		}
		break;

	case RACE_OUSTERS:
		if(m_small_mode)
		{
			if(m_width_mode)
			{
				re = m_pC_small_width_button_group->MouseControl(message, _x, _y);
				if(_x > 6 && _x < 115 && _y > 3 && _y < 14)
					descType = 1; // hp desc
				else if(_x > 6 && _x < 110 && _y > 14 && _y < 21)
					descType = 2; // mp desc
				else if(_x > 6 && _x < 110 && _y > 21 && _y < 28)
					descType = 3; // exp desc
			}
			else
			{
				re = m_pC_small_height_button_group->MouseControl(message, _x, _y);
				if(_y < h-6 && _y > h-115 && _x > 3 && _x < 14)
					descType = 1; // hp desc
				else if(_y < h-6 && _y > h-110 && _x > 14 && _x < 21)
					descType = 2; // mp desc
				else if(_y < h-6 && _y > h-110 && _x > 21 && _x < 28)
					descType = 3; // mp desc
			}
		}
		else
		{
			if(m_width_mode)
			{
				re = m_pC_width_button_group->MouseControl(message, _x, _y);
				if(_x > 8 && _x < 166 && _y > 3 && _y < 21)
					descType = 1; // hp desc
				else if(_x > 8 && _x < 162 && _y > 21 && _y < 31)
					descType = 2; // mp desc
				else if(_x > 8 && _x < 162 && _y > 31 && _y < 44)
					descType = 3; // mp desc
			}
			else
			{
				re = m_pC_height_button_group->MouseControl(message, _x, _y);
				if(_y < h-8 && _y > h-166 && _x > 3 && _x < 21)
					descType = 1; // hp desc
				else if(_y < h-8 && _y > h-162 && _x > 21 && _x < 31)
					descType = 2; // mp desc
				else if(_y < h-8 && _y > h-162 && _x > 31 && _x < 44)
					descType = 3; // mp desc
			}
		}
		break;		
	}
	
	if(descType != 0)
	{
		static std::string hpbar_string[2];
		const static char *help_string[3] = {NULL, NULL, NULL};
		char temp_string[512];
		
		help_string[1] = NULL;
		help_string[2] = NULL;
		
		
		
		int print_x = gpC_mouse_pointer->GetPointerX();
		int print_y = gpC_mouse_pointer->GetPointerY();
		int color = 0;
		
		if(descType == 2 || descType == 3)	// MP
		{
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				{
					wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_MP_DESCRIPTION].GetString(), g_char_slot_ingame.MP, g_char_slot_ingame.MP_MAX);
					hpbar_string[0]=temp_string;
				}
				break;

			case RACE_VAMPIRE:
				{				
					int exp_remain = g_char_slot_ingame.EXP_REMAIN;
					wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_LEVEL_DESCRIPTION].GetString(), g_char_slot_ingame.level);
					hpbar_string[0]=temp_string;
					
					int fame = g_pFameInfoTable->GetFameForLevel( SKILLDOMAIN_VAMPIRE, g_char_slot_ingame.level );
					
					if(exp_remain < 0)
					{
						hpbar_string[1]=(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL].GetString();					
					}
					else
					if(g_char_slot_ingame.FAME < fame)
					{
						wsprintf(temp_string, "%s(%s:%d)",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL_BY_FAME].GetString(), 
							(*g_pGameStringTable)[UI_STRING_MESSAGE_NEED_FAME].GetString(), 
							fame- g_char_slot_ingame.FAME);
						hpbar_string[1] = temp_string;
					}
					else
					{
						const ExpInfo* expinf = &g_pExperienceTable->GetVampireInfo(g_char_slot_ingame.level);
						__int64 goal_exp = expinf->GoalExp;

						wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), g_GetNumberString(exp_remain).c_str(), g_GetNumberString((goal_exp - exp_remain)*100/max(1, (goal_exp))).c_str());

	//						g_char_slot_ingame.EXP_CUR, 
	//						g_pExperienceTable->GetVampireInfo(g_char_slot_ingame.level).AccumExp, 	LeftExp);
						hpbar_string[1]=temp_string;
					}
					help_string[2] = hpbar_string[1].c_str();
				}
				break;

			case RACE_OUSTERS:
				if(descType == 2)
				{
					wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EP_DESCRIPTION].GetString(), g_char_slot_ingame.MP, g_char_slot_ingame.MP_MAX);
					hpbar_string[0]=temp_string;
				}
				else
				{
					int exp_remain = g_char_slot_ingame.EXP_REMAIN;
					wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_LEVEL_DESCRIPTION].GetString(), g_char_slot_ingame.level);
					hpbar_string[0]=temp_string;
					
					int fame = g_pFameInfoTable->GetFameForLevel( SKILLDOMAIN_OUSTERS, g_char_slot_ingame.level );
					
					if(exp_remain < 0)
					{
						hpbar_string[1]=(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL].GetString();					
					}
					else if(g_char_slot_ingame.FAME < fame)
					{
						wsprintf(temp_string, "%s(%s:%d)",(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_UP_LEVEL_BY_FAME].GetString(), 
							(*g_pGameStringTable)[UI_STRING_MESSAGE_NEED_FAME].GetString(), 
							fame- g_char_slot_ingame.FAME);
						hpbar_string[1] = temp_string;
					}
					else
					{
						__int64 goal_exp = g_pExperienceTable->GetOustersInfo( g_char_slot_ingame.level ).GoalExp;
				
						wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_EXP_DESCRIPTION_NEW].GetString(), g_GetNumberString(exp_remain).c_str(), g_GetNumberString((goal_exp - exp_remain)*100/max(1, (goal_exp))).c_str());
						//						g_char_slot_ingame.EXP_CUR, 
						//						g_pExperienceTable->GetVampireInfo(g_char_slot_ingame.level).AccumExp, 	LeftExp);
						hpbar_string[1]=temp_string;
					}
					help_string[2] = hpbar_string[1].c_str();
				}
				break;
			}		
		}
		else	// HP
		{
#ifndef _LIB
			g_char_slot_ingame.SILVER_HP = 10;
#endif
			if(g_eRaceInterface != RACE_SLAYER && g_char_slot_ingame.SILVER_HP > 0)				
				wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_HP_DESCRIPTION_WITH_SILVERING].GetString(), g_char_slot_ingame.HP, g_char_slot_ingame.HP_MAX, g_char_slot_ingame.SILVER_HP);
			else
				wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_HP_DESCRIPTION].GetString(), g_char_slot_ingame.HP, g_char_slot_ingame.HP_MAX);
			
			hpbar_string[0]=temp_string;
			if(g_eRaceInterface == RACE_SLAYER && g_char_slot_ingame.bl_drained)
			{
				if(g_char_slot_ingame.CHANGE_VAMPIRE > 60)
				{
					if(g_char_slot_ingame.CHANGE_VAMPIRE > 60*24)
						wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_CHANGE_VAMPIRE_DAY].GetString(), g_char_slot_ingame.CHANGE_VAMPIRE/60/24, (g_char_slot_ingame.CHANGE_VAMPIRE/60)%24, g_char_slot_ingame.CHANGE_VAMPIRE%60);
					else
					{
						wsprintf(temp_string,(*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_CHANGE_VAMPIRE_HOUR].GetString(), g_char_slot_ingame.CHANGE_VAMPIRE/60, g_char_slot_ingame.CHANGE_VAMPIRE%60);
						color = RGB_YELLOW;
					}
					hpbar_string[1] = temp_string;
				}
				else
				{
					if(g_char_slot_ingame.CHANGE_VAMPIRE == 0)
						hpbar_string[1]=(*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_CHANGE_VAMPIRE_SOON].GetString();
					else
					{
						wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_CHANGE_VAMPIRE_MINUTE].GetString(),
							g_char_slot_ingame.CHANGE_VAMPIRE);
						hpbar_string[1]=temp_string;
					}					
					color = RGB_RED;
				}
				help_string[2] = hpbar_string[1].c_str();
			}			
		}		
		help_string[0] = hpbar_string[0].c_str();
		g_descriptor_manager.Set(DID_HELP, print_x+30, print_y, (void *)help_string, 0, color);
	}
	
	switch(message)
	{
	case M_MOVING:
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (gpC_mouse_pointer->GetPickUpItem() == false && re)
		{
			MoveReady();
			SetOrigin(_x, _y);
			break;
		}
		break;
		
	}
	
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_HPBAR
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_HPBAR::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_KEYDOWN && key == VK_ESCAPE)
	{
		//		Run(CLOSE);
	}
}

//-----------------------------------------------------------------------------
// Show
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_HPBAR::Show()
{
	int hp = min(max(0, g_char_slot_ingame.HP), g_char_slot_ingame.HP_MAX);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{		
			int mp = min(max(0, g_char_slot_ingame.MP), g_char_slot_ingame.MP_MAX);
			
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				if(m_width_mode)
				{
					m_pC_hpbar_spk->BltLocked(x, y, MAIN_WIDTH+m_small_offset);
					if(m_small_mode)
						m_pC_small_width_button_group->Show();
					else
						m_pC_width_button_group->Show();
					
					int hpbar_x = 19, hpbar_y = 3, mpbar_x = 19, mpbar_y = 16;
					if(!m_small_mode)
					{
						hpbar_x = 28; hpbar_y = 4; mpbar_x = 28; mpbar_y = 22;
					}
					
					
					Rect rect;
					//hpbar
					rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(HPBAR_WIDTH+m_small_offset)*hp/max(1, g_char_slot_ingame.HP_MAX), m_pC_hpbar_spk->GetHeight(HPBAR_WIDTH+m_small_offset));
					if(g_char_slot_ingame.bl_drained)
						m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_BLOOD_WIDTH+m_small_offset);
					else
						m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_WIDTH+m_small_offset);
					
					//mpbar
					rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(MPBAR_WIDTH+m_small_offset)*mp/g_char_slot_ingame.MP_MAX, m_pC_hpbar_spk->GetHeight(MPBAR_WIDTH+m_small_offset));
					m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, MPBAR_WIDTH+m_small_offset);
				}
				else
				{
					m_pC_hpbar_spk->BltLocked(x, y, MAIN_HEIGHT+m_small_offset);
					if(m_small_mode)
						m_pC_small_height_button_group->Show();
					else
						m_pC_height_button_group->Show();
					
					int hpbar_x = 3, hpbar_y = 28, mpbar_x = 16, mpbar_y = 28;
					if(!m_small_mode)
					{
						hpbar_x = 4; hpbar_y = 43; mpbar_x = 23; mpbar_y = 43;
					}
					
					Rect rect;
					//hpbar
					rect.Set(0, m_pC_hpbar_spk->GetHeight(HPBAR_HEIGHT+m_small_offset)-m_pC_hpbar_spk->GetHeight(HPBAR_HEIGHT+m_small_offset)*hp/g_char_slot_ingame.HP_MAX, m_pC_hpbar_spk->GetWidth(HPBAR_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(HPBAR_HEIGHT+m_small_offset)*hp/g_char_slot_ingame.HP_MAX);
					if(g_char_slot_ingame.bl_drained)
						m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_BLOOD_HEIGHT+m_small_offset);
					else
						m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_HEIGHT+m_small_offset);
					
					//mpbar
					rect.Set(0, m_pC_hpbar_spk->GetHeight(MPBAR_HEIGHT+m_small_offset)-m_pC_hpbar_spk->GetHeight(MPBAR_HEIGHT+m_small_offset)*mp/g_char_slot_ingame.MP_MAX, m_pC_hpbar_spk->GetWidth(MPBAR_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(MPBAR_HEIGHT+m_small_offset)*mp/g_char_slot_ingame.MP_MAX);
					m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, MPBAR_HEIGHT+m_small_offset);
				}
				gpC_base->m_p_DDSurface_back->Unlock();
			}
			if(m_width_mode)
			{
				if(m_small_mode)
					m_pC_small_width_button_group->ShowDescription();
				else
					m_pC_width_button_group->ShowDescription();
				
			} else
			{
				if(m_small_mode)
					m_pC_small_height_button_group->ShowDescription();
				else
					m_pC_height_button_group->ShowDescription();
				
			}
		}
		break;

	case RACE_VAMPIRE:
		{		
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				if(m_width_mode)
				{
					m_pC_hpbar_spk->BltLocked(x, y, MAIN_WIDTH+m_small_offset);
					if(m_small_mode)
						m_pC_small_width_button_group->Show();
					else
						m_pC_width_button_group->Show();
					
					int hpbar_x = 19, hpbar_y = 4, expbar_x = 19, expbar_y = 17;
					if(!m_small_mode)
					{
						hpbar_x = 28; hpbar_y = 6; expbar_x = 28; expbar_y = 25;
					}
					
					Rect rect;
					
					// hpbar
					rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(HPBAR_WIDTH+m_small_offset)*hp/g_char_slot_ingame.HP_MAX, m_pC_hpbar_spk->GetHeight(HPBAR_WIDTH+m_small_offset));
					m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_WIDTH+m_small_offset);
					
					// slivered hpbar
					rect.Set(m_pC_hpbar_spk->GetWidth(HPBAR_SILVER_WIDTH+m_small_offset)-m_pC_hpbar_spk->GetWidth(HPBAR_SILVER_WIDTH+m_small_offset)*g_char_slot_ingame.SILVER_HP/g_char_slot_ingame.HP_MAX, 0, m_pC_hpbar_spk->GetWidth(HPBAR_SILVER_WIDTH+m_small_offset)*g_char_slot_ingame.SILVER_HP/g_char_slot_ingame.HP_MAX, m_pC_hpbar_spk->GetHeight(HPBAR_SILVER_WIDTH+m_small_offset));
					m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_SILVER_WIDTH+m_small_offset);
					
					//exp bar
					int exp_remain = g_char_slot_ingame.EXP_REMAIN;
					__int64 goal_exp = g_pExperienceTable->GetVampireInfo( g_char_slot_ingame.level ).GoalExp;
					int exp_width = m_pC_hpbar_spk->GetWidth(EXPBAR_WIDTH+m_small_offset);
					int exp_height = m_pC_hpbar_spk->GetHeight(EXPBAR_WIDTH+m_small_offset);
					int exp_bar = exp_width * (goal_exp - exp_remain) / goal_exp;
					
					//exp bar
					rect.Set(0, 0, exp_bar, exp_height );
	//				rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(EXPBAR_WIDTH+m_small_offset)*(g_char_slot_ingame.EXP_CUR-cur_level)/(g_pExperienceTable->GetVampireInfo(g_char_slot_ingame.level).GoalExp), m_pC_hpbar_spk->GetHeight(EXPBAR_WIDTH+m_small_offset));
					m_pC_hpbar_spk->BltLockedClip(x+expbar_x, y+expbar_y, rect, EXPBAR_WIDTH+m_small_offset);
				}
				else
				{
					m_pC_hpbar_spk->BltLocked(x, y, MAIN_HEIGHT+m_small_offset);
					if(m_small_mode)
						m_pC_small_height_button_group->Show();
					else
						m_pC_height_button_group->Show();
					
					int hpbar_x = 4, hpbar_y = 31, expbar_x = 17, expbar_y = 31;
					if(!m_small_mode)
					{
						hpbar_x = 6; hpbar_y = 47; expbar_x = 25; expbar_y = 47;
					}
					
					Rect rect;
					
					// hpbar
					rect.Set(0, m_pC_hpbar_spk->GetHeight(HPBAR_HEIGHT+m_small_offset)-m_pC_hpbar_spk->GetHeight(HPBAR_HEIGHT+m_small_offset)*hp/g_char_slot_ingame.HP_MAX, m_pC_hpbar_spk->GetWidth(HPBAR_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(HPBAR_HEIGHT+m_small_offset)*hp/g_char_slot_ingame.HP_MAX);
					m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_HEIGHT+m_small_offset);
					
					// silver hpbar
					rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(HPBAR_SILVER_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(HPBAR_SILVER_HEIGHT+m_small_offset)*g_char_slot_ingame.SILVER_HP/g_char_slot_ingame.HP_MAX);
					m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_SILVER_HEIGHT+m_small_offset);
					
					int exp_remain = g_char_slot_ingame.EXP_REMAIN;
					__int64 goal_exp = g_pExperienceTable->GetVampireInfo( g_char_slot_ingame.level ).GoalExp;
					int exp_width = m_pC_hpbar_spk->GetWidth(EXPBAR_HEIGHT+m_small_offset);
					int exp_height = m_pC_hpbar_spk->GetHeight(EXPBAR_HEIGHT+m_small_offset);
					int exp_bar = exp_height * (goal_exp - exp_remain) / goal_exp;
					
					//exp bar
					rect.Set(0, exp_height - exp_bar, exp_width, exp_bar);

					//exp bar
			//		rect.Set(0, m_pC_hpbar_spk->GetHeight(EXPBAR_HEIGHT+m_small_offset)-m_pC_hpbar_spk->GetHeight(EXPBAR_HEIGHT+m_small_offset)*exp/goal_exp, m_pC_hpbar_spk->GetWidth(EXPBAR_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(EXPBAR_HEIGHT+m_small_offset)*exp/goal_exp);
					m_pC_hpbar_spk->BltLockedClip(x+expbar_x, y+expbar_y, rect, EXPBAR_HEIGHT+m_small_offset);
				}
				gpC_base->m_p_DDSurface_back->Unlock();
			}
			if(m_width_mode)
			{
				if(m_small_mode)
					m_pC_small_width_button_group->ShowDescription();
				else
					m_pC_width_button_group->ShowDescription();
				
			} else
			{
				if(m_small_mode)
					m_pC_small_height_button_group->ShowDescription();
				else
					m_pC_height_button_group->ShowDescription();
			}
		}
		break;

	case RACE_OUSTERS:
		{
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				int MaxMP = max(g_char_slot_ingame.MP_MAX, 1);
				int Magnification = min(2, (g_char_slot_ingame.MP / (MaxMP+1))) ;
				int CurrentMP = g_char_slot_ingame.MP - (MaxMP*Magnification);
				int mp = min(max(0, g_char_slot_ingame.MP), MaxMP);
				
				if(m_width_mode)
				{
					m_pC_hpbar_spk->BltLocked(x, y, MAIN_WIDTH+m_small_offset);
					if(m_small_mode)
						m_pC_small_width_button_group->Show();
					else
						m_pC_width_button_group->Show();
					
					//hpbar
					int hpbar_x = 8, hpbar_y = 3, mpbar_x = 8, mpbar_y = 15, expbar_x = 8, expbar_y = 22;
					if(!m_small_mode)
					{
						hpbar_x = 9; hpbar_y = 4; mpbar_x = 9; mpbar_y = 22; expbar_x = 9; expbar_y = 32;
					}

					Rect rect;
					
					// hpbar
					rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(HPBAR_WIDTH+m_small_offset)*hp/g_char_slot_ingame.HP_MAX, m_pC_hpbar_spk->GetHeight(HPBAR_WIDTH+m_small_offset));
//					if(g_char_slot_ingame.bl_drained)
						m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_WIDTH+m_small_offset);
//					else
//						m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, OUSTERS_HPBAR_BLOOD_WIDTH+m_small_offset);
					
					// slivered hpbar
					rect.Set(m_pC_hpbar_spk->GetWidth(OUSTERS_HPBAR_SILVER_WIDTH+m_small_offset)-m_pC_hpbar_spk->GetWidth(OUSTERS_HPBAR_SILVER_WIDTH+m_small_offset)*g_char_slot_ingame.SILVER_HP/g_char_slot_ingame.HP_MAX, 0, m_pC_hpbar_spk->GetWidth(OUSTERS_HPBAR_SILVER_WIDTH+m_small_offset)*g_char_slot_ingame.SILVER_HP/g_char_slot_ingame.HP_MAX, m_pC_hpbar_spk->GetHeight(OUSTERS_HPBAR_SILVER_WIDTH+m_small_offset));
					m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, OUSTERS_HPBAR_SILVER_WIDTH+m_small_offset);

					//mpbar
					if(Magnification == 0)
					{
						rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(MPBAR_WIDTH+m_small_offset)*mp/MaxMP, m_pC_hpbar_spk->GetHeight(MPBAR_WIDTH+m_small_offset));
						m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, MPBAR_WIDTH+m_small_offset);
					}
					else if( Magnification == 1)
					{
						int sprIndex1 = OUSTERS_2ND_MPBAR_WIDTH +((BYTE)m_small_mode*4);

						rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(MPBAR_WIDTH+m_small_offset), m_pC_hpbar_spk->GetHeight(MPBAR_WIDTH+m_small_offset));
						m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, MPBAR_WIDTH+m_small_offset);
						rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(sprIndex1)*CurrentMP/MaxMP, m_pC_hpbar_spk->GetHeight(sprIndex1));
						m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, sprIndex1);
					}
					else if( Magnification == 2)
					{
						int sprIndex1 = OUSTERS_2ND_MPBAR_WIDTH +((BYTE)m_small_mode*4);
						int sprIndex2 = OUSTERS_3ND_MPBAR_WIDTH +((BYTE)m_small_mode*4);

						rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(sprIndex1), m_pC_hpbar_spk->GetHeight(sprIndex1));
						m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, sprIndex1);
						rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(sprIndex2)*CurrentMP/MaxMP, m_pC_hpbar_spk->GetHeight(sprIndex2));
						m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, sprIndex2);
					}
					
					int exp_remain = g_char_slot_ingame.EXP_REMAIN;
					__int64 goal_exp = g_pExperienceTable->GetOustersInfo( g_char_slot_ingame.level ).GoalExp;
					int exp_width = m_pC_hpbar_spk->GetWidth(OUSTERS_EXPBAR_WIDTH+m_small_offset);
					int exp_height = m_pC_hpbar_spk->GetHeight(OUSTERS_EXPBAR_WIDTH+m_small_offset);
					int exp_bar = exp_width * (goal_exp - exp_remain) / goal_exp;
					/*int((float)exp_width * ((float)exp_remain / (float)goal_exp));*/
					
					
					//exp bar
					rect.Set(0, 0, exp_bar, exp_height);
					
					//exp bar
					//		rect.Set(0, m_pC_hpbar_spk->GetHeight(EXPBAR_HEIGHT+m_small_offset)-m_pC_hpbar_spk->GetHeight(EXPBAR_HEIGHT+m_small_offset)*exp/goal_exp, m_pC_hpbar_spk->GetWidth(EXPBAR_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(EXPBAR_HEIGHT+m_small_offset)*exp/goal_exp);
					m_pC_hpbar_spk->BltLockedClip(x+expbar_x, y+expbar_y, rect, OUSTERS_EXPBAR_WIDTH+m_small_offset);
				}
				else
				{
					m_pC_hpbar_spk->BltLocked(x, y, MAIN_HEIGHT+m_small_offset);
					if(m_small_mode)
						m_pC_small_height_button_group->Show();
					else
						m_pC_height_button_group->Show();

					//hpbar
					int hpbar_x = 3, hpbar_y = 25, mpbar_x = 15, mpbar_y = 29, expbar_x = 22, expbar_y = 29;
					if(!m_small_mode)
					{
						hpbar_x = 4; hpbar_y = 38; mpbar_x = 22; mpbar_y = 43; expbar_x = 32; expbar_y = 43;
					}
					
					Rect rect;
					
					// hpbar
					rect.Set(0, m_pC_hpbar_spk->GetHeight(HPBAR_HEIGHT+m_small_offset)-m_pC_hpbar_spk->GetHeight(HPBAR_HEIGHT+m_small_offset)*hp/g_char_slot_ingame.HP_MAX, m_pC_hpbar_spk->GetWidth(HPBAR_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(HPBAR_HEIGHT+m_small_offset)*hp/g_char_slot_ingame.HP_MAX);
					m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_HEIGHT+m_small_offset);
//					if(g_char_slot_ingame.bl_drained)
					m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, HPBAR_HEIGHT+m_small_offset);
//					else
//						m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, OUSTERS_HPBAR_BLOOD_HEIGHT+m_small_offset);
					
					// slivered hpbar
					rect.Set(0, 0, m_pC_hpbar_spk->GetWidth(OUSTERS_HPBAR_SILVER_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(OUSTERS_HPBAR_SILVER_HEIGHT+m_small_offset)*g_char_slot_ingame.SILVER_HP/g_char_slot_ingame.HP_MAX);
					m_pC_hpbar_spk->BltLockedClip(x+hpbar_x, y+hpbar_y, rect, OUSTERS_HPBAR_SILVER_HEIGHT+m_small_offset);
					
					//mpbar
					if(Magnification == 0)
					{
						rect.Set(0, m_pC_hpbar_spk->GetHeight(MPBAR_HEIGHT+m_small_offset)-m_pC_hpbar_spk->GetHeight(MPBAR_HEIGHT+m_small_offset)*mp/MaxMP, m_pC_hpbar_spk->GetWidth(MPBAR_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(MPBAR_HEIGHT+m_small_offset)*mp/MaxMP);
						m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, MPBAR_HEIGHT+m_small_offset);
					}
					else if( Magnification == 1)
					{
						int sprIndex1 = OUSTERS_2ND_MPBAR_HEIGHT +((BYTE)m_small_mode*4);
											
						rect.Set(0, m_pC_hpbar_spk->GetHeight(MPBAR_HEIGHT+m_small_offset)-m_pC_hpbar_spk->GetHeight(MPBAR_HEIGHT+m_small_offset), 
							m_pC_hpbar_spk->GetWidth(MPBAR_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(MPBAR_HEIGHT+m_small_offset));

						m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, MPBAR_HEIGHT+m_small_offset);
						float mp_rate = CurrentMP/MaxMP;
						mp_rate = min(max(mp_rate, 0.0f), 1.0f);
						rect.Set(0, 0,
							//m_pC_hpbar_spk->GetHeight(sprIndex1)-m_pC_hpbar_spk->GetHeight(sprIndex1)*CurrentMP/MaxMP, 
							m_pC_hpbar_spk->GetWidth(sprIndex1), m_pC_hpbar_spk->GetHeight(sprIndex1)*mp_rate);
					}
					else if( Magnification == 2)
					{
						int sprIndex1 = OUSTERS_2ND_MPBAR_HEIGHT +((BYTE)m_small_mode*4);
						int sprIndex2 = OUSTERS_3ND_MPBAR_HEIGHT +((BYTE)m_small_mode*4);

						rect.Set(0, m_pC_hpbar_spk->GetHeight(sprIndex1)-m_pC_hpbar_spk->GetHeight(sprIndex1)*mp/MaxMP, m_pC_hpbar_spk->GetWidth(sprIndex1), m_pC_hpbar_spk->GetHeight(sprIndex1));
						m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, sprIndex1);

						float mp_rate = CurrentMP/MaxMP;
						mp_rate = min(max(mp_rate, 0.0f), 1.0f);

						rect.Set(0, m_pC_hpbar_spk->GetHeight(sprIndex2)-m_pC_hpbar_spk->GetHeight(sprIndex2)*mp_rate,
							m_pC_hpbar_spk->GetWidth(sprIndex2), m_pC_hpbar_spk->GetHeight(sprIndex2)*mp_rate);
						m_pC_hpbar_spk->BltLockedClip(x+mpbar_x, y+mpbar_y, rect, sprIndex2);	
					}					
					int exp_remain = g_char_slot_ingame.EXP_REMAIN;
					__int64 goal_exp = g_pExperienceTable->GetOustersInfo( g_char_slot_ingame.level ).GoalExp;
					int exp_width = m_pC_hpbar_spk->GetWidth(OUSTERS_EXPBAR_HEIGHT+m_small_offset);
					int exp_height = m_pC_hpbar_spk->GetHeight(OUSTERS_EXPBAR_HEIGHT+m_small_offset);
					int exp_bar = exp_height * (goal_exp - exp_remain) / goal_exp;
					
					//exp bar
					rect.Set(0, exp_height-exp_bar, exp_width, exp_bar);
					
					//exp bar
//					rect.Set(0, exp_height-m_pC_hpbar_spk->GetHeight(OUSTERS_EXPBAR_HEIGHT+m_small_offset)*exp/goal_exp, m_pC_hpbar_spk->GetWidth(OUSTERS_EXPBAR_HEIGHT+m_small_offset), m_pC_hpbar_spk->GetHeight(OUSTERS_EXPBAR_HEIGHT+m_small_offset)*exp/goal_exp);
					m_pC_hpbar_spk->BltLockedClip(x+expbar_x, y+expbar_y, rect, OUSTERS_EXPBAR_HEIGHT+m_small_offset);
				}
				gpC_base->m_p_DDSurface_back->Unlock();
			}

			if(m_width_mode)
			{
				if(m_small_mode)
					m_pC_small_width_button_group->ShowDescription();
				else
					m_pC_width_button_group->ShowDescription();
				
			} else
			{
				if(m_small_mode)
					m_pC_small_height_button_group->ShowDescription();
				else
					m_pC_height_button_group->ShowDescription();
			}
		}
		break;
	}	
}

//-----------------------------------------------------------------------------
// Start
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_HPBAR::Start()
{
	PI_Processor::Start();
	
	m_pC_small_width_button_group->Init();
	m_pC_small_height_button_group->Init();
	m_pC_width_button_group->Init();
	m_pC_height_button_group->Init();
	
	gpC_window_manager->AppearWindow(this);
	
	AttrAutoHide(gpC_vs_ui_window_manager->GetAutoHide(C_VS_UI_WINDOW_MANAGER::HPBAR));
	if(m_width_mode == gpC_vs_ui_window_manager->IsHPBarHeight())Run(CHANGE_ID);
	if(gpC_vs_ui_window_manager->IsHPBarSmall() != m_small_mode)Run(RESIZE_ID);

	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::HPBAR);
	if(rect.w != -1)
	{
		x = rect.x;
		y = rect.y;
	}
	
}

void C_VS_UI_HPBAR::Finish()
{
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::HPBAR, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::HPBAR, Rect(x, y, w, h));
	gpC_vs_ui_window_manager->SetHPBarHeight(!m_width_mode);
	gpC_vs_ui_window_manager->SetHPBarSmall(m_small_mode);
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
	
}

//-----------------------------------------------------------------------------
// Process
//
//
//-----------------------------------------------------------------------------
void C_VS_UI_HPBAR::Process()
{
	ProcessHide();
	if(m_small_mode)
	{
		if(m_width_mode)
			m_pC_small_width_button_group->Process();
		else
			m_pC_small_height_button_group->Process();
	}
	else
	{
		if(m_width_mode)
			m_pC_width_button_group->Process();
		else
			m_pC_height_button_group->Process();
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_BLOOD_BURST
//
//-----------------------------------------------------------------------------
C_VS_UI_BLOOD_BURST::C_VS_UI_BLOOD_BURST()
{
	m_pC_BloodBurst_spk = NULL;
	
	AttrTopmost(false);
	AttrPin(true);

	g_RegisterWindow(this);
	
	m_width_mode = true ; 
	m_bGageAttackFull = false;
	m_bGageDefenseFull = false;
	m_bGagePartyFull = false;

	
	m_iAttackGage	=	0	;
	m_iDefenseGage	=	0	;
	m_iPartyGage	=	0	;


	m_dw_prev_Attacktickcount	=	0	;
	m_dw_prev_Defensetickcount	=	0	;
	m_dw_prev_Partyickcount		=	0	;

	m_bAttackTimerCheck		=	false;
	m_bDefenseTimerCheck	=	false;
	m_bPartyTimerCheck		=	false;
	
	m_fAttackGageStartPosition = 0.0f ; 
	m_fDefenseGageStartPosition = 0.0f ; 
	m_fPartyGageStartPosition = 0.0f ; 


	int iTypeYValue[3] = { 40 , 38 , 45 } ; 

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_pC_BloodBurst_spk = new C_SPRITE_PACK(SPK_BLOOD_BRUST_SLAYER);
		break;

	case RACE_VAMPIRE:
		m_pC_BloodBurst_spk = new C_SPRITE_PACK(SPK_BLOOD_BRUST_VAMPIRE);
		break;

	case RACE_OUSTERS:
		m_pC_BloodBurst_spk = new C_SPRITE_PACK(SPK_BLOOD_BRUST_OUSTERS);
		break;	
	}
	
	//Set(0, iTypeYValue[g_eRaceInterface], m_pC_BloodBurst_spk->GetWidth(), m_pC_BloodBurst_spk->GetHeight() + m_pC_BloodBurst_spk->GetHeight(2));

	//Set(0, iTypeYValue[g_eRaceInterface], m_pC_BloodBurst_spk->GetWidth(1) + m_pC_BloodBurst_spk->GetWidth(3), m_pC_BloodBurst_spk->GetHeight(1));
	Set(0, iTypeYValue[g_eRaceInterface], m_pC_BloodBurst_spk->GetWidth(), m_pC_BloodBurst_spk->GetHeight() + m_pC_BloodBurst_spk->GetHeight(PARTY_MAIN_WIDTH));
	
	//Set(0, iTypeYValue[g_eRaceInterface], m_pC_BloodBurst_spk->GetWidth(), m_pC_BloodBurst_spk->GetHeight());

	m_pC_width_button_group  = new ButtonGroup(this);
	m_pC_height_button_group = new ButtonGroup(this);

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(175, 12 , m_pC_BloodBurst_spk->GetWidth(CHANGE_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(CHANGE_BUTTON_WIDTH), BLOODBURST_CHANGE_ID, this, CHANGE_BUTTON_WIDTH));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(8, 2 , m_pC_BloodBurst_spk->GetWidth(ATTACK_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(ATTACK_BUTTON_WIDTH), ATTACK_ID, this, ATTACK_BUTTON_WIDTH));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(8, 16, m_pC_BloodBurst_spk->GetWidth(DEFENSE_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(DEFENSE_BUTTON_WIDTH), DEFENSE_ID, this, DEFENSE_BUTTON_WIDTH));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(8, 30,m_pC_BloodBurst_spk->GetWidth(PARTY_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(PARTY_BUTTON_WIDTH), PARTY_ID, this, PARTY_BUTTON_WIDTH));
		
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(25, 175 , m_pC_BloodBurst_spk->GetWidth(CHANGE_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(CHANGE_BUTTON_HEIGHT), BLOODBURST_CHANGE_ID, this, CHANGE_BUTTON_HEIGHT));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(16, 8 , m_pC_BloodBurst_spk->GetWidth(ATTACK_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(ATTACK_BUTTON_HEIGHT), ATTACK_ID, this, ATTACK_BUTTON_HEIGHT));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(30, 8 , m_pC_BloodBurst_spk->GetWidth(DEFENSE_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(DEFENSE_BUTTON_HEIGHT), DEFENSE_ID, this, DEFENSE_BUTTON_HEIGHT));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(1, 8 , m_pC_BloodBurst_spk->GetWidth(PARTY_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(PARTY_BUTTON_HEIGHT), PARTY_ID, this, PARTY_BUTTON_HEIGHT));


		break;

	case RACE_VAMPIRE:
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(191, 18 , m_pC_BloodBurst_spk->GetWidth(CHANGE_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(CHANGE_BUTTON_WIDTH), BLOODBURST_CHANGE_ID, this, CHANGE_BUTTON_WIDTH));

		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(16, 9 , m_pC_BloodBurst_spk->GetWidth(ATTACK_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(ATTACK_BUTTON_WIDTH), ATTACK_ID, this, ATTACK_BUTTON_WIDTH));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(16, 23 , m_pC_BloodBurst_spk->GetWidth(DEFENSE_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(DEFENSE_BUTTON_WIDTH), DEFENSE_ID, this, DEFENSE_BUTTON_WIDTH));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(16, 37 , m_pC_BloodBurst_spk->GetWidth(PARTY_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(PARTY_BUTTON_WIDTH), PARTY_ID, this, PARTY_BUTTON_WIDTH));
		
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(25, 192 , m_pC_BloodBurst_spk->GetWidth(CHANGE_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(CHANGE_BUTTON_HEIGHT), BLOODBURST_CHANGE_ID, this, CHANGE_BUTTON_HEIGHT));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(16, 15 , m_pC_BloodBurst_spk->GetWidth(ATTACK_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(ATTACK_BUTTON_HEIGHT), ATTACK_ID, this, ATTACK_BUTTON_HEIGHT));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(30, 15 , m_pC_BloodBurst_spk->GetWidth(DEFENSE_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(DEFENSE_BUTTON_HEIGHT), DEFENSE_ID, this, DEFENSE_BUTTON_HEIGHT));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(1, 15 , m_pC_BloodBurst_spk->GetWidth(PARTY_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(PARTY_BUTTON_HEIGHT), PARTY_ID, this, PARTY_BUTTON_HEIGHT));

		break;

	case RACE_OUSTERS:

		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(195, 21 , m_pC_BloodBurst_spk->GetWidth(CHANGE_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(CHANGE_BUTTON_WIDTH), BLOODBURST_CHANGE_ID, this, CHANGE_BUTTON_WIDTH));

		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(18, 12 , m_pC_BloodBurst_spk->GetWidth(ATTACK_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(ATTACK_BUTTON_WIDTH), ATTACK_ID, this, ATTACK_BUTTON_WIDTH));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(18, 26 , m_pC_BloodBurst_spk->GetWidth(DEFENSE_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(DEFENSE_BUTTON_WIDTH), DEFENSE_ID, this, DEFENSE_BUTTON_WIDTH));
		m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(18, 40 , m_pC_BloodBurst_spk->GetWidth(PARTY_BUTTON_WIDTH), m_pC_BloodBurst_spk->GetHeight(PARTY_BUTTON_WIDTH), PARTY_ID, this, PARTY_BUTTON_WIDTH));

	
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(26, 196 , m_pC_BloodBurst_spk->GetWidth(CHANGE_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(CHANGE_BUTTON_HEIGHT), BLOODBURST_CHANGE_ID, this, CHANGE_BUTTON_HEIGHT));

		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(16, 18 , m_pC_BloodBurst_spk->GetWidth(ATTACK_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(ATTACK_BUTTON_HEIGHT), ATTACK_ID, this, ATTACK_BUTTON_HEIGHT));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(30, 18 , m_pC_BloodBurst_spk->GetWidth(DEFENSE_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(DEFENSE_BUTTON_HEIGHT), DEFENSE_ID, this, DEFENSE_BUTTON_HEIGHT));
		m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(1, 18 , m_pC_BloodBurst_spk->GetWidth(PARTY_BUTTON_HEIGHT), m_pC_BloodBurst_spk->GetHeight(PARTY_BUTTON_HEIGHT), PARTY_ID, this, PARTY_BUTTON_HEIGHT));
		break;	
	}

	//SetGage()	;
}

C_VS_UI_BLOOD_BURST::~C_VS_UI_BLOOD_BURST()
{
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BURST_WINDOW, Rect(x, y, w, h));
	gpC_vs_ui_window_manager->SetBloodBurstHeight(!m_width_mode);
	g_UnregisterWindow(this);
	DeleteNew(m_pC_width_button_group);
	DeleteNew(m_pC_height_button_group);
	if(m_pC_BloodBurst_spk)
	{
		DeleteNew(m_pC_BloodBurst_spk);
		m_pC_BloodBurst_spk = NULL;
	}
}

void	C_VS_UI_BLOOD_BURST::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	
	if(p_button->m_image_index == CHANGE_BUTTON_WIDTH || p_button->m_image_index == CHANGE_BUTTON_HEIGHT)
	{
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_pC_BloodBurst_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index+1);
			else
				m_pC_BloodBurst_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index+2);
		}
		else
		{
			if(p_button->GetPressState())
				m_pC_BloodBurst_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + 1);
			else
				m_pC_BloodBurst_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
		}
	}
	else if( ((p_button->m_image_index == ATTACK_BUTTON_WIDTH  || p_button->m_image_index == ATTACK_BUTTON_HEIGHT)  && !m_bGageAttackFull)  ||
			 ((p_button->m_image_index == DEFENSE_BUTTON_WIDTH || p_button->m_image_index == DEFENSE_BUTTON_HEIGHT) && !m_bGageDefenseFull) ||
			 (((p_button->m_image_index == PARTY_BUTTON_WIDTH   || p_button->m_image_index == PARTY_BUTTON_HEIGHT)   && !m_bGagePartyFull)) && (g_pParty->GetSize() > 0))
	{
		m_pC_BloodBurst_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
	}
	else if( ((p_button->m_image_index == ATTACK_BUTTON_WIDTH  || p_button->m_image_index == ATTACK_BUTTON_HEIGHT)  && m_bGageAttackFull)  ||
			 ((p_button->m_image_index == DEFENSE_BUTTON_WIDTH || p_button->m_image_index == DEFENSE_BUTTON_HEIGHT) && m_bGageDefenseFull) ||
			 (((p_button->m_image_index == PARTY_BUTTON_WIDTH   || p_button->m_image_index == PARTY_BUTTON_HEIGHT)   && m_bGagePartyFull)) && (g_pParty->GetSize() > 0)) 	
	{
		DWORD	dwTimeRange		= 300 ; 
		DWORD	dwCurrentTick	= GetTickCount(); 
		static  int	iButton =  1 ; 
		if((m_dw_prev_Attacktickcount  + dwTimeRange)  <= dwCurrentTick)
		{
			m_dw_prev_Attacktickcount = dwCurrentTick ;  
			if(iButton) iButton = 0 ; 
			else iButton =  1 ; 
		}

		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_pC_BloodBurst_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index+1);
			else
				m_pC_BloodBurst_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index+2);
		}
		else
		{
		
			m_pC_BloodBurst_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + iButton);
		}	
		
	}
}

void	C_VS_UI_BLOOD_BURST::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
}

void	C_VS_UI_BLOOD_BURST::WindowEventReceiver(id_t event)
{
}

bool	C_VS_UI_BLOOD_BURST::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	return IsInRect(_x, _y);
}


void	C_VS_UI_BLOOD_BURST::Run(id_t id)
{
	switch (id)
	{
	case BLOODBURST_CHANGE_ID:
		m_width_mode = !m_width_mode;
		w^=h; h^=w; w^=h; //swap
		x -= w-h;
		EMPTY_MOVE;
		break;
	
	case ATTACK_ID:
		 if(m_bGageAttackFull)	
			 gpC_base->SendMessage(UI_BLOOD_BURST ,  ATTACK_ID) ;
		 break ;
	
	case DEFENSE_ID:
		 if(m_bGageDefenseFull)	
			 gpC_base->SendMessage(UI_BLOOD_BURST ,  DEFENSE_ID) ;
		 break ;

	case PARTY_ID:
		 if(m_bGagePartyFull)	
			 gpC_base->SendMessage(UI_BLOOD_BURST ,  PARTY_ID) ;
		 break ;		
	}
}

bool	C_VS_UI_BLOOD_BURST::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	bool re;
	
	if(m_width_mode)
		re = m_pC_width_button_group->MouseControl(message, _x, _y);
	else
		re = m_pC_height_button_group->MouseControl(message, _x, _y);

	switch(message)
	{
	case M_MOVING:
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (gpC_mouse_pointer->GetPickUpItem() == false && re)
		{
			MoveReady();
			SetOrigin(_x, _y);
			break;
		}
		break;
		
	}
	return true  ; 

}

void	C_VS_UI_BLOOD_BURST::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_KEYDOWN && key == VK_ESCAPE)
	{
		//		Run(CLOSE);
	}
}

void	C_VS_UI_BLOOD_BURST::SetGage()
{
	SetAttackGage() ; 
	SetDefenseGage();
	SetPartyGage()  ;
	int iTypeYValue[3] = { 40 , 38 , 45 } ;
	//if(g_pParty->GetSize() > 0)
	//{
		//Set(0, iTypeYValue[g_eRaceInterface], m_pC_BloodBurst_spk->GetWidth(), m_pC_BloodBurst_spk->GetHeight() + m_pC_BloodBurst_spk->GetHeight(PARTY_MAIN_WIDTH));
	//}
	//else
	//{
		//Set(0, iTypeYValue[g_eRaceInterface], m_pC_BloodBurst_spk->GetWidth(), m_pC_BloodBurst_spk->GetHeight());
	//}
}

void	C_VS_UI_BLOOD_BURST::SetAttackGage()
{	
	m_bGageAttackFull		=	false;
	m_iAttackGage = g_char_slot_ingame.AttackBloodBurstPoint ; 
	if(m_iAttackGage >= ATTACK_MAX_POINT)	m_iAttackGage = ATTACK_MAX_POINT ;
	m_fAttackGageStartPosition = (float)m_iAttackGage / (float)ATTACK_MAX_POINT ; 
}

void	C_VS_UI_BLOOD_BURST::SetDefenseGage()
{
	m_bGageDefenseFull = false ; 
	m_iDefenseGage = g_char_slot_ingame.DefenseBloodBurstPoint ; 

	if(m_iDefenseGage >= DEFENSE_MAX_POINT)	m_iDefenseGage = DEFENSE_MAX_POINT ; 
	m_fDefenseGageStartPosition = (float)m_iDefenseGage / (float)DEFENSE_MAX_POINT ; 
}
void	C_VS_UI_BLOOD_BURST::SetPartyGage()
{
	m_bGagePartyFull = false ; 
	int iTypeYValue[3] = { 40 , 38 , 45 } ;
	m_iPartyGage = g_char_slot_ingame.PartyBloodBurstPoint ; 
	if(m_iPartyGage >= PARTY_MAX_POINT)	m_iPartyGage = PARTY_MAX_POINT ; 
	m_fPartyGageStartPosition = (float)m_iPartyGage / (float)PARTY_MAX_POINT ; 
	//if(g_pParty->GetSize() > 0)
	//{
	//	Set(0, iTypeYValue[g_eRaceInterface], m_pC_BloodBurst_spk->GetWidth(), m_pC_BloodBurst_spk->GetHeight() + m_pC_BloodBurst_spk->GetHeight(PARTY_MAIN_WIDTH));
	//}
	//else
	//{
	//	Set(0, iTypeYValue[g_eRaceInterface], m_pC_BloodBurst_spk->GetWidth(), m_pC_BloodBurst_spk->GetHeight());
	//}

	//Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BURST_WINDOW);
	//if(rect.w != -1)
	//{
	//	x = rect.x;
	//	y = rect.y;
	//}	
}


void	C_VS_UI_BLOOD_BURST::Show()
{
	Rect RectAttack ;
	Rect RectDefense ;
	Rect RectParty ;

	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		if(m_width_mode)
		{
			int iWidthXRange[3][2] = { 25 ,  0 ,  34 ,  4  , 37 , 3 } ; 
			int iWidthYRange[3][4] = { 4 , 18 , 29 , 32 ,  11 , 25 , 36  , 39 , 14 , 28 , 39  , 42 } ; 
			// 바탕 이미지 그리기
			m_pC_BloodBurst_spk->BltLocked(x, y, MAIN_WIDTH);
			if(g_pParty->GetSize() > 0)
				m_pC_BloodBurst_spk->BltLocked(x + iWidthXRange[g_eRaceInterface][1], y + iWidthYRange[g_eRaceInterface][2], PARTY_MAIN_WIDTH);
			
			m_pC_BloodBurst_spk->BltLocked(x + iWidthXRange[g_eRaceInterface][0], y+iWidthYRange[g_eRaceInterface][0] , MAIN_GAGE_BASE_ATTACK_WIDTH);
			m_pC_BloodBurst_spk->BltLocked(x + iWidthXRange[g_eRaceInterface][0], y+iWidthYRange[g_eRaceInterface][1] , MAIN_GAGE_BASE_DEFENSE_WIDTH);
			// 게이지 그리기
			
			Rect rect ; 
			//=======================================================================================================================================================
			// 공격 게이지 계산
			//=======================================================================================================================================================
			//Rect rect;
			int iMaxGage  =  m_pC_BloodBurst_spk->GetWidth(ATTACK_GAGE_WIDTH);
			int	iCurrentGage = (1.0 - m_fAttackGageStartPosition) * iMaxGage ; 
			 
			int	iAttackRange = 0 ,  iDefenseRange = 0 , iPartyRange = 0 ; 			
			if(!m_bGageAttackFull && m_fAttackGageStartPosition == 1.0f)
			{
				m_bGageAttackFull = !m_bGageAttackFull ; 
			}
			else if(m_bGageAttackFull && m_fAttackGageStartPosition == 1.0f)
			{
				iAttackRange = 6; 		
			}
			rect.Set(iCurrentGage, 0 ,  m_pC_BloodBurst_spk->GetWidth(ATTACK_GAGE_WIDTH) , m_pC_BloodBurst_spk->GetHeight(ATTACK_GAGE_WIDTH) ) ; 
			m_pC_BloodBurst_spk->BltLockedClip(x + iWidthXRange[g_eRaceInterface][0], y+iWidthYRange[g_eRaceInterface][0] , rect, ATTACK_GAGE_WIDTH + iAttackRange);

			RectAttack.Set(x + iWidthXRange[g_eRaceInterface][0], y+iWidthYRange[g_eRaceInterface][0] , 
						   m_pC_BloodBurst_spk->GetWidth(ATTACK_GAGE_WIDTH) , 
						   m_pC_BloodBurst_spk->GetHeight(ATTACK_GAGE_WIDTH)) ; 	
			//=======================================================================================================================================================
			
			//=======================================================================================================================================================
			// 방어 게이지 계산
			//=======================================================================================================================================================
			iMaxGage  =  m_pC_BloodBurst_spk->GetWidth(DEFENSE_GAGE_WIDTH);
			iCurrentGage = (1.0 - m_fDefenseGageStartPosition) * iMaxGage ; 
			 
					
			if(!m_bGageDefenseFull && m_fDefenseGageStartPosition == 1.0f)
			{
				m_bGageDefenseFull = !m_bGageDefenseFull ; 
			}
			else if(m_bGageDefenseFull && m_fDefenseGageStartPosition == 1.0f)
			{
				iDefenseRange = 6; 		
			}

			rect.Set(iCurrentGage, 0 ,  m_pC_BloodBurst_spk->GetWidth(DEFENSE_GAGE_WIDTH) , m_pC_BloodBurst_spk->GetHeight(DEFENSE_GAGE_WIDTH) ) ; 
			m_pC_BloodBurst_spk->BltLockedClip(x + iWidthXRange[g_eRaceInterface][0], y+iWidthYRange[g_eRaceInterface][1] , rect, DEFENSE_GAGE_WIDTH+ iDefenseRange);

			RectDefense.Set(x + iWidthXRange[g_eRaceInterface][0], y+iWidthYRange[g_eRaceInterface][1] , 
						   m_pC_BloodBurst_spk->GetWidth(DEFENSE_GAGE_WIDTH) , 
						   m_pC_BloodBurst_spk->GetHeight(DEFENSE_GAGE_WIDTH)) ; 	
			//=======================================================================================================================================================
			
			if(g_pParty->GetSize() > 0)
			{
				//=======================================================================================================================================================
				// 파티 게이지 계산
				//=======================================================================================================================================================
				iMaxGage  =  m_pC_BloodBurst_spk->GetWidth(PARTY_GAGE_WIDTH);
				iCurrentGage = (1.0 - m_fPartyGageStartPosition) * iMaxGage ; 
				 
						
				if(!m_bGagePartyFull && m_fPartyGageStartPosition == 1.0f)
				{
					m_bGagePartyFull = !m_bGagePartyFull ; 
				}
				else if(m_bGagePartyFull && m_fPartyGageStartPosition == 1.0f)
				{
					iPartyRange = 6; 		
				}
				rect.Set(iCurrentGage,0  ,  m_pC_BloodBurst_spk->GetWidth(PARTY_GAGE_WIDTH) , m_pC_BloodBurst_spk->GetHeight(PARTY_GAGE_WIDTH) ) ; 
				m_pC_BloodBurst_spk->BltLockedClip(x + iWidthXRange[g_eRaceInterface][0], y+iWidthYRange[g_eRaceInterface][3] , rect, PARTY_GAGE_WIDTH + iPartyRange);
				RectParty.Set(x + iWidthXRange[g_eRaceInterface][0], y+iWidthYRange[g_eRaceInterface][3] , 
							   m_pC_BloodBurst_spk->GetWidth(PARTY_GAGE_WIDTH) , 
							   m_pC_BloodBurst_spk->GetHeight(PARTY_GAGE_WIDTH)) ; 	
				
				//=======================================================================================================================================================
			}
		}
		else
		{
			int iHeightXRange[3][4] = { 14 ,  18 ,  32 , 3 ,   7 ,  18  , 32 , 3 ,   4  , 18 , 32 , 3} ; 
			
			int iHeightYRange[3][2] = { 25 , 0 , 34 , 4 , 37 , 3 } ; 
			
			// 바탕 이미지 그리기
			m_pC_BloodBurst_spk->BltLocked(x +  iHeightXRange[g_eRaceInterface][0] , y ,  MAIN_HEIGHT);
			if(g_pParty->GetSize() > 0)
				m_pC_BloodBurst_spk->BltLocked(x , y + iHeightYRange[g_eRaceInterface][1], PARTY_MAIN_HEIGHT);

			m_pC_BloodBurst_spk->BltLocked(x +  iHeightXRange[g_eRaceInterface][1], y+iHeightYRange[g_eRaceInterface][0] , MAIN_GAGE_BASE_ATTACK_HEIGHT);
			m_pC_BloodBurst_spk->BltLocked(x +  iHeightXRange[g_eRaceInterface][2], y+iHeightYRange[g_eRaceInterface][0] , MAIN_GAGE_BASE_DEFENSE_HEIGHT);
			// 게이지 그리기
			Rect rect ; 
			//=======================================================================================================================================================
			// 공격 게이지 계산
			//=======================================================================================================================================================
			int iMaxGage  =  m_pC_BloodBurst_spk->GetHeight(ATTACK_GAGE_HEIGHT);
			int	iCurrentGage = (1.0 - m_fAttackGageStartPosition) * iMaxGage ; 
			 
			int	iAttackRange = 0 ,  iDefenseRange = 0 , iPartyRange = 0 ; 			
			if(!m_bGageAttackFull && m_fAttackGageStartPosition == 1.0f)
			{
				m_bGageAttackFull = !m_bGageAttackFull ; 
			}
			else if(m_bGageAttackFull && m_fAttackGageStartPosition == 1.0f)
			{
				iAttackRange = 6; 		
			}
			rect.Set(0, iCurrentGage ,  m_pC_BloodBurst_spk->GetWidth(ATTACK_GAGE_HEIGHT) , m_pC_BloodBurst_spk->GetHeight(ATTACK_GAGE_HEIGHT) - iCurrentGage ) ; 
			m_pC_BloodBurst_spk->BltLockedClip(x + iHeightXRange[g_eRaceInterface][1], y+iHeightYRange[g_eRaceInterface][0] , rect, ATTACK_GAGE_HEIGHT + iAttackRange);
			RectAttack.Set(x + iHeightXRange[g_eRaceInterface][1], y+iHeightYRange[g_eRaceInterface][0] , 
						   m_pC_BloodBurst_spk->GetWidth(ATTACK_GAGE_HEIGHT) , 
						   m_pC_BloodBurst_spk->GetHeight(ATTACK_GAGE_HEIGHT)) ; 	
			//=======================================================================================================================================================
			
			//=======================================================================================================================================================
			// 방어 게이지 계산
			//=======================================================================================================================================================
			iMaxGage  =  m_pC_BloodBurst_spk->GetHeight(DEFENSE_GAGE_HEIGHT);
			iCurrentGage = (1.0 - m_fDefenseGageStartPosition) * iMaxGage ; 
			 
					
			if(!m_bGageDefenseFull && m_fDefenseGageStartPosition == 1.0f)
			{
				m_bGageDefenseFull = !m_bGageDefenseFull ; 
			}
			else if(m_bGageDefenseFull && m_fDefenseGageStartPosition == 1.0f)
			{
				iDefenseRange = 6; 		
			}

			rect.Set(0, iCurrentGage ,  m_pC_BloodBurst_spk->GetWidth(DEFENSE_GAGE_HEIGHT) , m_pC_BloodBurst_spk->GetHeight(DEFENSE_GAGE_HEIGHT) - iCurrentGage ) ; 
			m_pC_BloodBurst_spk->BltLockedClip(x + iHeightXRange[g_eRaceInterface][2], y+iHeightYRange[g_eRaceInterface][0] , rect, DEFENSE_GAGE_HEIGHT+ iDefenseRange);

			RectDefense.Set(x + iHeightXRange[g_eRaceInterface][2], y+iHeightYRange[g_eRaceInterface][0] , 
						   m_pC_BloodBurst_spk->GetWidth(DEFENSE_GAGE_HEIGHT) , 
						   m_pC_BloodBurst_spk->GetHeight(DEFENSE_GAGE_HEIGHT)) ; 	
			//=======================================================================================================================================================
			
			if(g_pParty->GetSize() > 0)
			{	
				//=======================================================================================================================================================
				// 파티 게이지 계산
				//=======================================================================================================================================================
				iMaxGage  =  m_pC_BloodBurst_spk->GetHeight(PARTY_GAGE_HEIGHT);
				iCurrentGage = (1.0 - m_fPartyGageStartPosition) * iMaxGage ; 
				 
						
				if(!m_bGagePartyFull && m_fPartyGageStartPosition == 1.0f)
				{
					m_bGagePartyFull = !m_bGagePartyFull ; 
				}
				else if(m_bGagePartyFull && m_fPartyGageStartPosition == 1.0f)
				{
					iPartyRange = 6; 		
				}
				rect.Set(0, iCurrentGage ,  m_pC_BloodBurst_spk->GetWidth(PARTY_GAGE_HEIGHT) , m_pC_BloodBurst_spk->GetHeight(PARTY_GAGE_HEIGHT) - iCurrentGage ) ; 
				m_pC_BloodBurst_spk->BltLockedClip(x + iHeightXRange[g_eRaceInterface][3] , y+iHeightYRange[g_eRaceInterface][0] , rect, PARTY_GAGE_HEIGHT + iPartyRange);
				
				RectParty.Set(x + iHeightXRange[g_eRaceInterface][3] , y+iHeightYRange[g_eRaceInterface][0] , 
							   m_pC_BloodBurst_spk->GetWidth(PARTY_GAGE_HEIGHT) , 
							   m_pC_BloodBurst_spk->GetHeight(PARTY_GAGE_HEIGHT)) ; 
				//=======================================================================================================================================================
			}
		}
	}
	

	if(m_width_mode)
	{
		m_pC_width_button_group->Show()  ; 
	}
	else
	{
		m_pC_height_button_group->Show()  ; 
	}
	gpC_base->m_p_DDSurface_back->Unlock();

	
	int print_x = gpC_mouse_pointer->GetPointerX();
	int print_y = gpC_mouse_pointer->GetPointerY();
	int color = 0;
	
	static std::string bloodburst_string[1];
	const static char *help_string[1] =  {NULL} ;

	if(RectAttack.IsInRect(gpC_mouse_pointer->GetPointerX() , gpC_mouse_pointer->GetPointerY())) // && m_iAttackGage)
	{
		char temp_string[512];
		wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BURST_ATTACK].GetString(), m_iAttackGage , ATTACK_MAX_POINT);
		bloodburst_string[0]=temp_string;
					
		help_string[0] = bloodburst_string[0].c_str();
		g_descriptor_manager.Set(DID_HELP, print_x+30, print_y, (void *)help_string, 0, color);

	}
	else if(RectDefense.IsInRect(gpC_mouse_pointer->GetPointerX() , gpC_mouse_pointer->GetPointerY())) //  && m_iDefenseGage)
	{
		char temp_string[512];
		wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BURST_DEFENSE].GetString(), m_iDefenseGage , DEFENSE_MAX_POINT);
		bloodburst_string[0]=temp_string;
					
		help_string[0] = bloodburst_string[0].c_str();
		g_descriptor_manager.Set(DID_HELP, print_x+30, print_y, (void *)help_string, 0, color);
	}
	else if(RectParty.IsInRect(gpC_mouse_pointer->GetPointerX() , gpC_mouse_pointer->GetPointerY()))// && m_iPartyGage )
	{
		char temp_string[512];
		wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BURST_PARTY].GetString(), m_iPartyGage , PARTY_MAX_POINT);
		bloodburst_string[0]=temp_string;
					
		help_string[0] = bloodburst_string[0].c_str();
		g_descriptor_manager.Set(DID_HELP, print_x+30, print_y, (void *)help_string, 0, color);
	}
}

void	C_VS_UI_BLOOD_BURST::Process()
{
	ProcessHide();
	
	if(m_width_mode)
		m_pC_width_button_group->Process();
	else
		m_pC_height_button_group->Process();

}
void	C_VS_UI_BLOOD_BURST::Start()
{
	
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BURST_WINDOW);
	if(m_width_mode == gpC_vs_ui_window_manager->IsBloodBurstHeight())	Run(BLOODBURST_CHANGE_ID);
	if(rect.w != -1)
	{
		x = rect.x;
		y = rect.y;
	}	

	PI_Processor::Start();
	SetGage()	;
	m_pC_width_button_group->Init();
	m_pC_height_button_group->Init();
	gpC_window_manager->AppearWindow(this);

	
}

void	C_VS_UI_BLOOD_BURST::Finish()
{
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BURST_WINDOW, Rect(x, y, w, h));
	gpC_vs_ui_window_manager->SetBloodBurstHeight(!m_width_mode);
	PI_Processor::Finish();

	gpC_window_manager->DisappearWindow(this);
}



//-----------------------------------------------------------------------------
// C_VS_UI_BLOOD_BURST
//
//-----------------------------------------------------------------------------
/*C_VS_UI_MARKET_ACCOUNT::C_VS_UI_MARKET_ACCOUNT()
{
	m_pC_Market_spk = NULL;
	m_pC_Market_button_group= NULL;
	
	

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_pC_Market_spk = new C_SPRITE_PACK(SPK_MARKET_SLAYER);
		break;

	case RACE_VAMPIRE:
		m_pC_Market_spk = new C_SPRITE_PACK(SPK_MARKET_VAMPIRE);
		break;

	case RACE_OUSTERS:
		m_pC_Market_spk = new C_SPRITE_PACK(SPK_MARKET_OUSTERS);
		break;	
	}

	int iTypeYValue[3] = { 416 , 412  , 412 } ;
	
	int iTypeXValue[3] = { 0 ,  21  ,  42 } ;


	Set(740 , iTypeYValue[g_eRaceInterface] , 62 , m_pC_Market_spk->GetHeight())   ; 
	
	g_RegisterWindow(this);
	
	AttrPin(true);


	m_pC_Market_button_group  = new ButtonGroup(this);

	m_pC_Market_button_group->Add(new C_VS_UI_EVENT_BUTTON(iTypeXValue[0] , 0 , m_pC_Market_spk->GetWidth(), m_pC_Market_spk->GetHeight(), MARKETM_ID, this, MARKETM_BUTTON));
	m_pC_Market_button_group->Add(new C_VS_UI_EVENT_BUTTON(iTypeXValue[1] , 0 , m_pC_Market_spk->GetWidth(), m_pC_Market_spk->GetHeight(), MARKETB_ID, this, MARKETB_BUTTON));
	m_pC_Market_button_group->Add(new C_VS_UI_EVENT_BUTTON(iTypeXValue[2] , 0 , m_pC_Market_spk->GetWidth(), m_pC_Market_spk->GetHeight(), MARKETH_ID, this, MARKETH_BUTTON));
}


C_VS_UI_MARKET_ACCOUNT::~C_VS_UI_MARKET_ACCOUNT()
{
	g_UnregisterWindow(this);
	DeleteNew(m_pC_Market_button_group);
	if(m_pC_Market_spk)
	{
		DeleteNew(m_pC_Market_spk);
		m_pC_Market_spk = NULL;
	}
	
	
}

void	C_VS_UI_MARKET_ACCOUNT::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{

		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_pC_Market_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index+1);
			else
				m_pC_Market_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index+2);
		}
		else
		{
			if(p_button->GetPressState())
				m_pC_Market_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + 1);
			else
				m_pC_Market_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
		}
	//m_pC_Market_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index+1);


}

void	C_VS_UI_MARKET_ACCOUNT::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
}

void	C_VS_UI_MARKET_ACCOUNT::WindowEventReceiver(id_t event)
{
}

bool	C_VS_UI_MARKET_ACCOUNT::IsPixel(int _x, int _y)
{
	return IsInRect(_x, _y);
}

void	C_VS_UI_MARKET_ACCOUNT::Run(id_t id)
{
		switch (id)
	{
	
	case MARKETM_ID:	// 결제 웹 페이지 구동 
		 gpC_base->SendMessage(UI_MARKET_ACCOUNT ,  MARKETM_ID , 0) ;
		  break ;
	
	case MARKETB_ID:
		gpC_base->SendMessage(UI_MARKET_ACCOUNT ,  MARKETB_ID , 0) ;	
		 //if(gC_vs_ui.IsRunningItemListWindow())
		//	gC_vs_ui.CloseItemListWindow();
		// else
		//	gC_vs_ui.RunItemListWindow(); 
		 
		 //gpC_base->SendMessage(UI_MARKET_ACCOUNT ,  MARKETB_ID) ;
		 break ;

	case MARKETH_ID:
		 gpC_base->SendMessage(UI_MARKET_ACCOUNT ,  MARKETH_ID, 0) ;
		 break ;		
	}
}

bool	C_VS_UI_MARKET_ACCOUNT::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x -= x; _y -= y;

	m_pC_Market_button_group->MouseControl(message, _x, _y);
	return true;
}

void	C_VS_UI_MARKET_ACCOUNT::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_KEYDOWN && key == VK_ESCAPE)
	{
		//		Run(CLOSE);
	}
}

void	C_VS_UI_MARKET_ACCOUNT::Show()
{
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		//gpC_global_resource->DrawDialogLocked(x, y, w, h);
		m_pC_Market_button_group->Show()  ; 
	}
	gpC_base->m_p_DDSurface_back->Unlock();


}

void	C_VS_UI_MARKET_ACCOUNT::Process()
{
	ProcessHide();
	m_pC_Market_button_group->Process();
}

void	C_VS_UI_MARKET_ACCOUNT::Start()
{
	PI_Processor::Start();
	m_pC_Market_button_group->Init();
	gpC_window_manager->AppearWindow(this);
}

void	C_VS_UI_MARKET_ACCOUNT::Finish()
{
	PI_Processor::Finish();

	gpC_window_manager->DisappearWindow(this);
}
*/
//-----------------------------------------------------------------------------
// C_VS_UI_EFFECT_STATUS
//
//-----------------------------------------------------------------------------
C_VS_UI_EFFECT_STATUS::C_VS_UI_EFFECT_STATUS()
{
	m_scroll = 0;
	m_bl_effect_size_null = true;
	
	m_pC_effect_status_spk = NULL;
	
	AttrTopmost(false);
	AttrPin(true);
	
	m_width_mode = true;//false;
	
	g_RegisterWindow(this);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_pC_effect_status_spk = new C_SPRITE_PACK(SPK_EFFECT_STATUS_SLAYER);
		break;

	case RACE_VAMPIRE:
		m_pC_effect_status_spk = new C_SPRITE_PACK(SPK_EFFECT_STATUS_VAMPIRE);
		break;

	case RACE_OUSTERS:
		m_pC_effect_status_spk = new C_SPRITE_PACK(SPK_EFFECT_STATUS_OUSTERS);
		break;	
	}

	AttrAutoHide(ATTRIBUTES_HIDE_NOT);
	AttrWindowMove(false);

//	if(g_pUserInformation->IsResolution1024)
//	{
		int midpos = g_pUserInformation->iResolution_x/2;
		midpos = midpos - m_pC_effect_status_spk->GetWidth()/2;
		Set(midpos, 0, 8*36, 3*36);
//	}
//	else	Set(240, 0, m_pC_effect_status_spk->GetWidth(), m_pC_effect_status_spk->GetHeight());


//#ifdef CONVERT_1024_768
//	int midpos = RESOLUTION_X/2;
//	midpos = midpos - m_pC_effect_status_spk->GetWidth()/2;
//	Set(midpos, 0, m_pC_effect_status_spk->GetWidth(), m_pC_effect_status_spk->GetHeight());
//#else
//	Set(240, 0, m_pC_effect_status_spk->GetWidth(), m_pC_effect_status_spk->GetHeight());
//#endif
	
	
	m_pC_width_button_group = new ButtonGroup(this);
	m_pC_height_button_group = new ButtonGroup(this);
	
	const int width_pushpin_x = 5, width_pushpin_y = 8, width_change_x = 20, width_change_y = 7, width_left_x = 54, width_right_x = 37;
	m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(width_pushpin_x, width_pushpin_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), PUSHPIN_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN));
	m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(width_change_x, width_change_y, m_pC_effect_status_spk->GetWidth(BUTTON_CHANGE), m_pC_effect_status_spk->GetHeight(BUTTON_CHANGE), CHANGE_ID, this, BUTTON_CHANGE));
	m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(width_left_x, width_change_y, m_pC_effect_status_spk->GetWidth(BUTTON_LEFT), m_pC_effect_status_spk->GetHeight(BUTTON_LEFT), UP_ID, this, BUTTON_LEFT));
	m_pC_width_button_group->Add(new C_VS_UI_EVENT_BUTTON(width_right_x, width_change_y, m_pC_effect_status_spk->GetWidth(BUTTON_RIGHT), m_pC_effect_status_spk->GetHeight(BUTTON_RIGHT), DOWN_ID, this, BUTTON_RIGHT));
	
	const int height_pushpin_y = 5, height_pushpin_x = 7, height_change_y = 20, height_change_x = 6, height_left_y = 54, height_right_y = 37;
	m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(height_pushpin_x, height_pushpin_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), PUSHPIN_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN));
	m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(height_change_x, height_change_y, m_pC_effect_status_spk->GetWidth(BUTTON_CHANGE), m_pC_effect_status_spk->GetHeight(BUTTON_CHANGE), CHANGE_ID, this, BUTTON_CHANGE));
	m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(height_change_x, height_left_y, m_pC_effect_status_spk->GetWidth(BUTTON_UP), m_pC_effect_status_spk->GetHeight(BUTTON_UP), UP_ID, this, BUTTON_UP));
	m_pC_height_button_group->Add(new C_VS_UI_EVENT_BUTTON(height_change_x, height_right_y, m_pC_effect_status_spk->GetWidth(BUTTON_DOWN), m_pC_effect_status_spk->GetHeight(BUTTON_DOWN), DOWN_ID, this, BUTTON_DOWN));
	
	
}

//-----------------------------------------------------------------------------
// ~C_VS_UI_EFFECT_STATUS
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_EFFECT_STATUS::~C_VS_UI_EFFECT_STATUS()
{
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::EFFECT_STATUS, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::EFFECT_STATUS, Rect(x, y, w, h));
	gpC_vs_ui_window_manager->SetEffectStatusHeight(!m_width_mode);
	
	g_UnregisterWindow(this);
	
	DeleteNew(m_pC_effect_status_spk);
	DeleteNew(m_pC_width_button_group);
	DeleteNew(m_pC_height_button_group);
}

//-----------------------------------------------------------------------------
// C_VS_UI_EFFECT_STATUS::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_EFFECT_STATUS::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	const static char* m_effect_button_string[4] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_ON].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_OFF].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HEIGHT].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_WIDTH].GetString(),
	};
	if(m_width_mode)
	{
		if(p_button->GetID()==PUSHPIN_ID)
		{
			if(GetAttributes()->autohide)
				g_descriptor_manager.Set(DID_INFO, x+w-p_button->x-p_button->w, y+p_button->y, (void *)m_effect_button_string[1],0,0);
			else
				g_descriptor_manager.Set(DID_INFO, x+w-p_button->x-p_button->w, y+p_button->y, (void *)m_effect_button_string[0],0,0);
		}
		if(p_button->GetID()==CHANGE_ID)
		{
			g_descriptor_manager.Set(DID_INFO, x+w-p_button->x-p_button->w, y+p_button->y, (void *)m_effect_button_string[2],0,0);
		}
	} else
	{
		if(p_button->GetID()==PUSHPIN_ID)
		{
			if(GetAttributes()->autohide)
				g_descriptor_manager.Set(DID_INFO, x+p_button->x, y+h-p_button->y-p_button->h, (void *)m_effect_button_string[1],0,0);
			else
				g_descriptor_manager.Set(DID_INFO, x+p_button->x, y+h-p_button->y-p_button->h, (void *)m_effect_button_string[0],0,0);
		}
		if(p_button->GetID()==CHANGE_ID)
		{
			g_descriptor_manager.Set(DID_INFO, x+p_button->x, y+h-p_button->y-p_button->h, (void *)m_effect_button_string[3],0,0);
		}
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_EFFECT_STATUS::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_EFFECT_STATUS::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(m_width_mode)	// width mode
	{
		if(p_button->GetID() == PUSHPIN_ID)
		{
			if(GetAttributes()->autohide)
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+w-p_button->x-p_button->w, y+p_button->y, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN);
			else
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+w-p_button->x-p_button->w, y+p_button->y, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN_PUSHED);
		}
		else
		{
			if(p_button->GetFocusState())
			{
				if(p_button->GetPressState())
					m_pC_effect_status_spk->BltLocked(x+w-p_button->x-p_button->w, y+p_button->y, p_button->m_image_index+2);
				else
					m_pC_effect_status_spk->BltLocked(x+w-p_button->x-p_button->w, y+p_button->y, p_button->m_image_index+1);
			}
			else
				m_pC_effect_status_spk->BltLocked(x+w-p_button->x-p_button->w, y+p_button->y, p_button->m_image_index);
		}
	}
	else	// height mode
	{
		if(p_button->GetID() == PUSHPIN_ID)
		{
			if(GetAttributes()->autohide)				
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN);
			else				
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN_PUSHED);			
		}
		else
		{
			if(p_button->GetFocusState())
			{
				if(p_button->GetPressState())
					m_pC_effect_status_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index+2);
				else
					m_pC_effect_status_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index+1);
			}
			else
				m_pC_effect_status_spk->BltLocked(x+p_button->x, y+h-p_button->y-p_button->h, p_button->m_image_index);
		}
	}
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_EFFECT_STATUS::WindowEventReceiver(id_t event)
{
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_EFFECT_STATUS::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	return IsInRect(_x, _y);
	//	if(m_width_mode)
	//		return m_pC_EFFECT_STATUS_spk->IsPixel(_x-x, _y-y, MAIN_WIDTH);
	//	else
	//		return m_pC_EFFECT_STATUS_spk->IsPixel(_x-x, _y-y, MAIN_HEIGHT);
	
	//	return false;
	//	return m_pC_charinfo->IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y), CHARINFO_WINDOW);
}

//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_EFFECT_STATUS::Run(id_t id)
{
	/*switch (id)
	{
	case PUSHPIN_ID:
		if(GetAttributes()->autohide)
			AttrAutoHide(ATTRIBUTES_HIDE_NOT);
		else
		{
			if(m_width_mode)
				AttrAutoHide(ATTRIBUTES_HIDE_HEIGHT);
			else
				AttrAutoHide(ATTRIBUTES_HIDE_WIDTH);
		}
		EMPTY_MOVE;
		break;
		
	case CHANGE_ID:
		if(m_width_mode)
		{
			if(GetAttributes()->autohide != ATTRIBUTES_HIDE_NOT)
				AttrAutoHide(ATTRIBUTES_HIDE_WIDTH);
		}
		else
		{
			if(GetAttributes()->autohide != ATTRIBUTES_HIDE_NOT)
				AttrAutoHide(ATTRIBUTES_HIDE_HEIGHT);
		}
		m_width_mode = !m_width_mode;
		w^=h; h^=w; w^=h; //swap
		x -= w-h;
		EMPTY_MOVE;
		break;
		
	case UP_ID:
		if(m_scroll > 0)m_scroll--;
		break;
		
	case DOWN_ID:
		if(m_scroll+10 < g_char_slot_ingame.STATUS.size()+g_pUserInformation->WarInfo.size())
			m_scroll++;
		break;
	}*/
}

//-----------------------------------------------------------------------------
// MouseControl
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_EFFECT_STATUS::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	
	static int skill_id = -1;
	bool re;
	if(m_width_mode)
		re = m_pC_width_button_group->MouseControl(message, w-_x, _y);
	else
		re = m_pC_height_button_group->MouseControl(message, _x, h-_y);
	
	switch(message)
	{
	case M_MOVING:
		skill_id = -1;
		if(!g_pUserInformation->WarInfo.empty())
		{
			int select = -1;
			
			if(m_width_mode)
			{
				if(_x >= 5 && _x < 5+10*36 && _y >= 5 && _y < 5+3*36)
				{
					int selectiX = (_x-5)/36;
					int nselectiY = (_y-5)/36;
					select = nselectiY * 8 + selectiX;//(_x-5)/36+((_y-5)/36*8)+m_scroll;
					//select = (_x-5)/36+m_scroll;
				}
			}
			else
			{
				if(_y >= 5 && _y < 5+10*36 && _x >= 5 && _x < 5+36)
				{
					select = (_y-5)/36+m_scroll;
				}
			}

			if(select != -1 && select < g_char_slot_ingame.STATUS.size() + g_pUserInformation->WarInfo.size() )
			{
				if(select >= g_char_slot_ingame.STATUS.size() && select <= g_char_slot_ingame.STATUS.size() + g_pUserInformation->WarInfo.size())		// 상태가 아니라 전쟁 관련이면
				{
					int count = select - g_char_slot_ingame.STATUS.size();
					const WAR_INFO& ifo = g_pUserInformation->WarInfo[count];					
					char temp2[512]="";
					
					
					static std::string str[2];

					str[0] = ifo.zone_name;
					DWORD	current_time=timeGetTime()/1000;
					char temp_string[512]="";

					if(current_time > ifo.left_time)
							current_time = ifo.left_time;

					DWORD c_time = ifo.left_time - current_time;
						
					DWORD hours = c_time / 3600;
					DWORD min = (c_time - (hours * 3600) )/60;

					switch(ifo.war_type)
					{
					case WAR_GUILD:
						{
						sprintf(temp2,(*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_TIME_FORMAT].GetString(),hours,min);
						sprintf(temp_string,"%s, %s : %s, %s : %s, %s : %s",
							(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_WAR].GetString(),
							(*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_ATTACK_GUILD].GetString(),
							ifo.attack_guild_name.c_str(),
							(*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_DEFENSE_GUILD].GetString(),
							ifo.defense_guild_name.c_str(),
							(*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_LEFT_TIME].GetString(),
							temp2);
					
						static const char *change_vampire_string[3] ;
						
						long color = RGB_YELLOW;
						str[1] = temp_string;
						change_vampire_string[0]=str[0].c_str();					
						change_vampire_string[1]=NULL;
						change_vampire_string[2]=str[1].c_str();
						g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)change_vampire_string, 0, color);
						}
						break;

					case WAR_RACE:
						{
						sprintf(temp2,(*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_TIME_FORMAT].GetString(),hours,min);
						sprintf(temp_string,"%s, %s : %s",
							(*g_pGameStringTable)[UI_STRING_MESSAGE_RACE_WAR].GetString(),
							(*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_LEFT_TIME].GetString(),
							temp2);
					
						static const char *change_vampire_string[3] ;
						
						
						long color = RGB_YELLOW;
						str[1] = temp_string;
						change_vampire_string[0]=str[0].c_str();					
						change_vampire_string[1]=NULL;
						change_vampire_string[2]=str[1].c_str();
						g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)change_vampire_string, 0, color);
						}
						break;

					case WAR_LEVEL:
						{
							sprintf(temp2,(*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_TIME_FORMAT].GetString(),hours,min);
							sprintf(temp_string,"%s, %s : %s",
								(*g_pGameStringTable)[UI_STRING_MESSAGE_LEVEL_WAR].GetString(),
								(*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_LEFT_TIME].GetString(),
								temp2);
							
							static const char *change_vampire_string[3] ;
							
							
							long color = RGB_YELLOW;
							str[1] = temp_string;
							change_vampire_string[0]=str[0].c_str();					
							change_vampire_string[1]=NULL;
							change_vampire_string[2]=str[1].c_str();
							g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)change_vampire_string, 0, color);
						}
						break;
					}
				}
			}
		}
		if(!g_char_slot_ingame.STATUS.empty())
		{
			int select = -1;
			if(m_width_mode)
			{
				if(_x >= 5 && _x < 5+8*36 && _y >= 5 && _y < 5+4*36)
				{
					int selectiX = (_x-5)/36;
					int nselectiY = (_y-5)/36;
					select = nselectiY * 8 + selectiX;//(_x-5)/36+((_y-5)/36*8)+m_scroll;
				}
			}
			else
			{
				if(_y >= 5 && _y < 5+8*36 && _x >= 5 && _x < 5+36)
				{
					select = (_y-5)/36+m_scroll;
				}
			}
			if(select != -1 && select < g_char_slot_ingame.STATUS.size())
				skill_id = g_char_slot_ingame.STATUS[select].actionInfo;
			if(skill_id != -1 && skill_id != ACTIONINFO_NULL && skill_id >= 0 && skill_id < g_pSkillInfoTable->GetSize())
			{
				char temp_string[512]="";
				static std::string effectstatus_string[2];
				effectstatus_string[0] = (*g_pSkillInfoTable)[skill_id].GetHName();
				effectstatus_string[1] = "";
				
				static const char *help_string[3];

				DWORD timevalue = timeGetTime() / 100;
				DWORD delay100msec = g_char_slot_ingame.STATUS[select].delay100msec - timevalue;
				if(timevalue > g_char_slot_ingame.STATUS[select].delay100msec)
					delay100msec = 0;

				// 초단위로
				delay100msec /= 10;
				
//				if(skill_id == SKILL_BLOOD_DRAIN)
//				{
//					delayFrame = g_char_slot_ingame.CHANGE_VAMPIRE;
//				}

				int color = 0;
				
				int day = 0, time = 0, minute = 0, second = 0;
				
				second = delay100msec % 60;
				delay100msec /= 60;
				minute = delay100msec % 60;
				delay100msec /= 60;
				time = delay100msec % 24;
				delay100msec /= 24;
				day = delay100msec;

//				switch(skill_id)
				{

//				2007.08.22 chyaya - 흡혈 슬/뱀 변환 삭제
// 				case SKILL_BLOOD_DRAIN:
// 					{
// 						if(day > 0)
// 						{
// 							wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_CHANGE_VAMPIRE_DAY].GetString(), day, time, minute);
// 							color = 0;	// 검은색이 아니다 default값이다
// 						}
// 						else if(time > 0)
// 						{
// 							wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_CHANGE_VAMPIRE_HOUR].GetString(), time, minute);
// 							color = RGB_YELLOW;
// 						}
// 						else if(minute > 0)
// 						{
// 							wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_CHANGE_VAMPIRE_MINUTE].GetString(), minute);
// 							color = RGB_RED;
// 						}
// 						else
// 						{
// 							wsprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HPBAR_CHANGE_VAMPIRE_SOON].GetString());
// 							color = RGB_RED;
// 						}
// 						effectstatus_string[1] = temp_string;
// 
// 					}
// 					break;

//				default:
					strcpy(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_LEFT_TIME].GetString());
					effectstatus_string[1] = temp_string;
					effectstatus_string[1] += " : ";

					// 앞에께 찍히면 그뒤는 값이 없어도 찍는다
					bool bPrint = false;

					if(day > 0)
					{
						sprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_DAY].GetString(), day);
						effectstatus_string[1] += temp_string;
						effectstatus_string[1] += " ";
						bPrint = true;
					}

					if(time > 0 || bPrint)
					{
						sprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_HOUR].GetString(), time);
						effectstatus_string[1] += temp_string;
						effectstatus_string[1] += " ";
						bPrint = true;
					}
					
					if(minute > 0 || bPrint)
					{
						sprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_MINUTE].GetString(), minute);
						effectstatus_string[1] += temp_string;
						effectstatus_string[1] += " ";
						bPrint = true;
					}
					
					// 초는 무조건 찍는다
					sprintf(temp_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_SECOND].GetString(), second);
					effectstatus_string[1] += temp_string;
				}

				help_string[0] = effectstatus_string[0].c_str();					
				help_string[1] = NULL;
				if(skill_id != SKILL_CLIENT_HOODLUM_STIGMA)
					help_string[2] = effectstatus_string[1].c_str();
				else 
					help_string[2] = (*g_pGameStringTable)[UI_STRING_MESSAGE_HOODLUM_STIGMA].GetString() ;
				g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)help_string, 0, color);
				
			}
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if(skill_id != -1)
			gC_vs_ui.RunDescDialog(DID_SKILL, (void *)skill_id);
		if (gpC_mouse_pointer->GetPickUpItem() == false && re)
		{
			MoveReady();
			SetOrigin(_x, _y);
			break;
		}
		break;
		
	case M_WHEEL_UP:
		Run(UP_ID);
		break;
		
	case M_WHEEL_DOWN:
		Run(DOWN_ID);
		break;
	}
	
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_EFFECT_STATUS
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_EFFECT_STATUS::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_KEYDOWN && key == VK_ESCAPE)
	{
		//		Run(CLOSE);
	}
}

//-----------------------------------------------------------------------------
// Show
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_EFFECT_STATUS::Show()
{
	int size = g_char_slot_ingame.STATUS.size() + g_pUserInformation->WarInfo.size();
	if(size < m_scroll+10)
		m_scroll = max(0, size-10);
	bool bDrained = false;
	
	if(m_width_mode)
		// 가로 모드
	{
		/*
		상징물 석상: 성 문 앞에서 출입을 통제하는 역할을 합니다. 각 성의 상징물에 맞게 4종류의 석상을 각각 성 앞에 4개씩 배치하면 됩니다.
옥타부스(nw): 박쥐날개를 달고 있는 흑표범.
셉티무스(sw): 직립보행의 긴 뿔의 붉은 소
테르티우스(ne): 용
쿠아르투스(se): 불사조(Phoenix)
*/
		if(gpC_base->m_p_DDSurface_back->Lock())
		{
			Rect rect(0, 0, w-4, h);
			int i=0;
			//m_pC_effect_status_spk->BltLockedClip(x, y, rect, MAIN_WIDTH);
		//	m_pC_effect_status_spk->BltLocked(x+w-m_pC_effect_status_spk->GetWidth(MAIN_WIDTH_RIGHT), y, MAIN_WIDTH_RIGHT);

			int nBufferSize = g_pUserInformation->WarInfo.size();
			nBufferSize += g_char_slot_ingame.STATUS.size();

			int nRectY = nBufferSize / 8;

			int midpos = g_pUserInformation->iResolution_x/2;
			midpos = midpos - m_pC_effect_status_spk->GetWidth()/2;
			Set(midpos, 0, 8*36, (nRectY+1)*36);

			if(!g_char_slot_ingame.STATUS.empty())
			{
				DWORD CurrentFrame		= timeGetTime();
				DWORD Current100msec	= CurrentFrame / 100;
				

				for(i = 0; i < min(30, g_char_slot_ingame.STATUS.size()); i++)
				{
					const int skill_id = g_char_slot_ingame.STATUS[i+m_scroll].actionInfo;
					if(skill_id == ACTIONINFO_NULL || skill_id < 0 || skill_id >= g_pSkillInfoTable->GetSize())
						break;
					
					// 2007.08.22 chyaya - 흡혈 슬/뱀 변환 삭제
					//if(skill_id == SKILL_BLOOD_DRAIN)bDrained = true;

					int modIX = i % 8;
					int modIY = i / 8;


					int midpos = g_pUserInformation->iResolution_x/2;
					midpos = midpos - m_pC_effect_status_spk->GetWidth()/2;
					//Set(midpos, 0, 8*36, (modIY+1)*36);

					
					POINT point = {x+5+modIX*36, y+5+modIY*36};
					const int sprite_id = (*g_pSkillInfoTable)[skill_id].GetSpriteID();

					DWORD delay100msec = (g_char_slot_ingame.STATUS[i+m_scroll].delay100msec - Current100msec);
					if(Current100msec > g_char_slot_ingame.STATUS[i+m_scroll].delay100msec)
						delay100msec = 0;	
					
					if(skill_id == SKILL_CLIENT_MAGICAL_PET_CHANGER && delay100msec <= 0 )
					{
						gpC_base->SendMessage(UI_CLIENT_REMOVE_EFFECT_STATUS , skill_id ) ;
					}
						
					if(C_VS_UI_SKILL::m_C_spk_mini.GetSize() > sprite_id )
					{
						if(0 < delay100msec && delay100msec < 50)
						{
							if(g_CurrentFrame&0x04)
								gpC_base->m_p_DDSurface_back->BltSpriteAlpha(&point, &C_VS_UI_SKILL::m_C_spk_mini_new[sprite_id], 15);  //15앎角拷츠똑
						}
						else
							gpC_base->m_p_DDSurface_back->BltSpriteAlpha(&point, &C_VS_UI_SKILL::m_C_spk_mini_new[sprite_id], 15);//拷츠똑 15
					}
				}				
			}
			if(!g_pUserInformation->WarInfo.empty())
			{
				for(int a=0;a<g_pUserInformation->WarInfo.size();i++,a++)
				{					
					if(i>=30)
						break;

					int modIX = i % 8;
					int modIY = i / 8;

					POINT point = {x+5+modIX*36, y+5+modIY*36};
					int sprite_id = 12;

					int color_set = 315-256;

					if(g_pUserInformation->WarInfo[a].war_type == WAR_LEVEL)
					{
						sprite_id = 356;
					}
					else
					{
						switch(g_pUserInformation->WarInfo[a].zone_id)
						{
						case 1201 :
							sprite_id = 226;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 155;
							break;

						case 1202 :
							sprite_id = 227;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 25;
							break;
						
						case 1203 :
							sprite_id = 228;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 85;
							break;
						
						case 1204 :
							sprite_id = 229;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 40;
							break;

						case 1205 :
							sprite_id = 355;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 40;
							break;
							
						case 1206 :
							sprite_id = 354;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 40;
							break;
							
						}					
					}

					if(C_VS_UI_SKILL::m_C_spk_mini.GetSize() > sprite_id)
					{
						//gpC_base->m_p_DDSurface_back->BltSprite(&point, &C_VS_UI_SKILL::m_C_spk_mini[sprite_id]);

						gpC_base->m_p_DDSurface_back->BltSpriteAlpha(&point,&C_VS_UI_SKILL::m_C_spk_mini_new[sprite_id], 15);  //15앎角拷츠똑
					}
				}
			}
			
			//m_pC_width_button_group->Show();
			gpC_base->m_p_DDSurface_back->Unlock();
			//m_pC_width_button_group->ShowDescription();	
		}		
	}
	else
		// 세로 모드
	{
		if(gpC_base->m_p_DDSurface_back->Lock())
		{
			Rect rect(0, 0, w, h-4);
			int i=0;
			m_pC_effect_status_spk->BltLockedClip(x, y, rect, MAIN_HEIGHT);
			m_pC_effect_status_spk->BltLocked(x, y+h-m_pC_effect_status_spk->GetHeight(MAIN_HEIGHT_BOTTOM), MAIN_HEIGHT_BOTTOM);
			
			if(!g_char_slot_ingame.STATUS.empty())
			{
				DWORD CurrentFrame		= timeGetTime();
				DWORD Current100msec	= CurrentFrame / 100;
				
				for(int i = 0; i < min(10, g_char_slot_ingame.STATUS.size()); i++)
				{
					const int skill_id = g_char_slot_ingame.STATUS[i+m_scroll].actionInfo;
					if(skill_id == ACTIONINFO_NULL || skill_id < 0 || skill_id >= g_pSkillInfoTable->GetSize())
						break;
					
					// 2007.08.22 chyaya - 흡혈 슬/뱀 변환 삭제
					//if(skill_id == SKILL_BLOOD_DRAIN)bDrained = true;
					
					POINT point = {x+5, y+5+i*20};
					const int sprite_id = (*g_pSkillInfoTable)[skill_id].GetSpriteID();
					
					DWORD delay100msec = (g_char_slot_ingame.STATUS[i+m_scroll].delay100msec - Current100msec);
					if(Current100msec > g_char_slot_ingame.STATUS[i+m_scroll].delay100msec)
						delay100msec = 0;	

					if(skill_id == SKILL_CLIENT_MAGICAL_PET_CHANGER && delay100msec <= 0 )
					{
						gpC_base->SendMessage(UI_CLIENT_REMOVE_EFFECT_STATUS , skill_id ) ;
					}

					if(C_VS_UI_SKILL::m_C_spk_mini.GetSize() > sprite_id)
					{
						if(delay100msec < 50)
						{
							if(g_CurrentFrame&0x04)
								gpC_base->m_p_DDSurface_back->BltSprite(&point, &C_VS_UI_SKILL::m_C_spk_mini[sprite_id]);
						}
						else
							gpC_base->m_p_DDSurface_back->BltSprite(&point, &C_VS_UI_SKILL::m_C_spk_mini[sprite_id]);
					}
				}
			}if(!g_pUserInformation->WarInfo.empty())
			{
				for(int a=0;a<g_pUserInformation->WarInfo.size();i++,a++)
				{					
					if(i>=10)
						break;
					POINT point = {x+5, y+5+i*20};
					int sprite_id = 12;

					int color_set = 315-256;

					if(g_pUserInformation->WarInfo[a].war_type == WAR_LEVEL)
					{
						sprite_id = 356;
					}
					else
					{
						switch(g_pUserInformation->WarInfo[a].zone_id)
						{
						case 1201 :
							sprite_id = 226;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 155;
							break;

						case 1202 :
							sprite_id = 227;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 25;
							break;
						
						case 1203 :
							sprite_id = 228;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 85;
							break;
						
						case 1204 :
							sprite_id = 229;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 40;
							break;

						case 1205 :
							sprite_id = 355;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 40;
							break;
							
						case 1206 :
							sprite_id = 354;
							if(g_pUserInformation->WarInfo[a].war_type == WAR_GUILD)	// 길드전인경우
								color_set = 40;
							break;
						}					
					}

					if(C_VS_UI_SKILL::m_C_spk_mini.GetSize() > sprite_id)
					{
						//gpC_base->m_p_DDSurface_back->BltSprite(&point, &C_VS_UI_SKILL::m_C_spk_mini[sprite_id]);

						gpC_base->m_p_DDSurface_back->BltSpriteColorSet(&point,&C_VS_UI_SKILL::m_C_spk_mini[sprite_id], color_set);
					}
				}
//				for(int a=0;a<g_pUserInformation->WarInfo.size();i++,a++)
//				{					
//					if(i>=10)
//						break;
//					POINT point = {x+5, y+5+i*20};
//					
//					int sprite_id = 12;
//
//					switch(g_pUserInformation->WarInfo[a].zone_id)
//					{
//					case 1201 :
//						sprite_id = 226;
//						break;
//					case 1202 :
//						sprite_id = 227;
//						break;
//					case 1203 :
//						sprite_id = 228;
//						break;
//					case 1204 :
//						sprite_id = 229;
//						break;
//					}					
//
//					if(C_VS_UI_SKILL::m_C_spk_mini.GetSize() > sprite_id)
//					{
//						gpC_base->m_p_DDSurface_back->BltSprite(&point, &C_VS_UI_SKILL::m_C_spk_mini[sprite_id]);
//					}
//				}
			}
			m_pC_height_button_group->Show();
			gpC_base->m_p_DDSurface_back->Unlock();
			m_pC_height_button_group->ShowDescription();	
		}		
	}	
	g_char_slot_ingame.bl_drained = bDrained;
}

//-----------------------------------------------------------------------------
// ResetSize
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_EFFECT_STATUS::ResetSize()
{
	//13개가 넘으면 스크롤 버튼 나온다하!
}

//-----------------------------------------------------------------------------
// Start
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_EFFECT_STATUS::Start()
{
	PI_Processor::Start();
	
	m_pC_width_button_group->Init();
	m_pC_height_button_group->Init();
	
	gpC_window_manager->AppearWindow(this);
	
	AttrAutoHide(gpC_vs_ui_window_manager->GetAutoHide(C_VS_UI_WINDOW_MANAGER::EFFECT_STATUS));
	if(m_width_mode == gpC_vs_ui_window_manager->IsEffectStatusHeight())
		Run(CHANGE_ID);
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::EFFECT_STATUS);
	if(rect.w != -1)
	{
		x = rect.x;
		y = rect.y;
	}	
}

void C_VS_UI_EFFECT_STATUS::Finish()
{
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::EFFECT_STATUS, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::EFFECT_STATUS, Rect(x, y, w, h));
	gpC_vs_ui_window_manager->SetEffectStatusHeight(!m_width_mode);
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// Process
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_EFFECT_STATUS::Process()
{
	if((g_pUserInformation->WarInfo.empty() && g_char_slot_ingame.STATUS.empty()) && m_bl_effect_size_null == false )
	{
		m_bl_effect_size_null = true;
		if(m_width_mode)
			AttrAutoHide(ATTRIBUTES_HIDE_HEIGHT);
		else
			AttrAutoHide(ATTRIBUTES_HIDE_WIDTH);
	}
	else if(!(g_pUserInformation->WarInfo.empty() && g_char_slot_ingame.STATUS.empty()) && m_bl_effect_size_null == true)
	{
		m_bl_effect_size_null = false;
		AttrAutoHide(ATTRIBUTES_HIDE_NOT);
	}
	
	if(m_width_mode)
		m_pC_width_button_group->Process();
	else
		m_pC_height_button_group->Process();
	ProcessHide();
	
	/*std::vector<WAR_INFO>::iterator itr = g_pUserInformation->WarInfo.begin();
	
	while(itr != g_pUserInformation->WarInfo.end() )
	{
		//WAR_INFO info =(*itr);
		//if(info.left_time <= timeGetTime()/1000)

		if ( itr->left_time <= timeGetTime() / 1000 )

			
		itr++;
	}*/
}

const int zone_id_size = 73;

//-----------------------------------------------------------------------------
// GetZoneNumber
//
// ZoneID를 받아서 컨버팅
//-----------------------------------------------------------------------------
//int C_VS_UI_MINIMAP::GetZoneNumber(int zone_id)
//{
//	int id[zone_id_size] = {
//		11, 12, 13, 14, 21, 22, 23 ,24, 31, 32, 33, 34, 41, 42, 43, 44, 51, 52, 53, 54, 61, 62, 63, 64, // 필드
//		1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009, 1010, // 던젼&마을
//		1100, 1101, 1102, 1103, 1104, 1105, // 바토리 던전
//		1111, 1112, 1113, 1114, // 라센성
//		1121, 1122, 1123, 1124, // 성지
//		2000, 2001, 2002, 2003, 2004, 2010, 2011, 2012, 2013, 2014, 2020, 2021, 2022, 2023, 2024,//건물
//		//			2101, 2102, 2103, 2104, 2105, 2106,//튜토리얼
//		2101, 2102,
//		10001, 20001, 
//		1011, 1012,	// 로스트 타이얀
//		1013, // 아실리온
//		
//		60000, 60001, 60002};//클라이언트용 가짜 아이디
//		
//	for(int i = 0; i < zone_id_size; i++)
//		if(zone_id == id[i])break;
//		
//	if(i == zone_id_size)return -1;
//		return i;
//}

//-----------------------------------------------------------------------------
// GetZoneName
//
// ZoneID를 받아서 존이름을 반환한다
//-----------------------------------------------------------------------------
//char * C_VS_UI_MINIMAP::GetZoneName(int zone_id)
//{
//	char *map_name[zone_id_size] =
//	{
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_ESLANIA_NE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_ESLANIA_NW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_ESLANIA_SE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_ESLANIA_SW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_LIMBOLAIR_NE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_LIMBOLAIR_NW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_LIMBOLAIR_SE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_LIMBOLAIR_SW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_DROBETA_NE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_DROBETA_NW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_DROBETA_SE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_DROBETA_SW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_RODIN_NE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_RODIN_NW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_RODIN_SE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_RODIN_SW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_TIMORE_NE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_TIMORE_NW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_TIMORE_SE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_TIMORE_SW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_PERONA_NE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_PERONA_NW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_PERONA_SE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_PERONA_SW].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_UNDERGROUND_WATERWAY].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_ESLANIA_DUNGEON].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_IN_LIMBOLAIR].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_LIMBOLAIR_DEONGEON].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_EVENTOX].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_EVENT_STADIUM].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_IN_RASENCASTLE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_KALI_CAVE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_RASEN_TRAINING].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_PEIAC_TUNNEL].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_BATHORY_B1].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_BATHORY_B2].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_BATHORY_B3].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_BATHORY_B4].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_BATHORY_LAIR].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GHORGOBA_TUNNEL].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_RASEN_YARD].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_CASTLE_RASEN_1F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_CASTLE_RASEN_2F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEPES_LAIR].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_SLAYER_BATTLEZONE1].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_SLAYER_BATTLEZONE2].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_BATHORY_BATTLEZONE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_RASEN_BATTLEZONE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_ARMY_B1].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_ARMY_1F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_ARMY_2F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_ARMY_3F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_ARMY_4F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_CELRIC_B1].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_CELRIC_1F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_CELRIC_2F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_CELRIC_3F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_CELRIC_4F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_KNIGHT_B1].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_KNIGHT_1F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_KNIGHT_2F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_KNIGHT_3F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_KNIGHT_4F].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_TUTORIAL_N].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_TUTORIAL_S].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_HOUSE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLAN_HOUSE].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_LOST_TAIYAN_B1].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_LOST_TAIYAN_B2].GetString(),			
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_ASYLION_DUNGEON].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_TAKE_HELICOPTER].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_TAKE_ELIVATOR].GetString(),
//		(*g_pGameStringTable)[UI_STRING_MESSAGE_UNKNOW].GetString(),
//	};
//	
//	int id = GetZoneNumber(zone_id);
//	if(id == -1)return NULL;
//	else return map_name[id];
//}

//------------------------------------------------------------------------엊쌓--------------------------------------
C_VS_UI_MILITARYDLG::C_VS_UI_MILITARYDLG()
{
	m_pC_Military_spk = NULL;

	//AttrKeyboardControl(true);
	AttrTopmost(false);
	AttrPin(true);

	g_RegisterWindow(this);

	m_pC_Military_spk = new C_SPRITE_PACK(_ROOT"spk\\runetab.spk");


	Set(( g_pUserInformation->iResolution_x+m_pC_Military_spk->GetWidth(Window_Full_Background) ) / 2 - m_pC_Military_spk->GetWidth(Window_Full_Background),
		( g_pUserInformation->iResolution_y+m_pC_Military_spk->GetHeight(Window_Full_Background) ) / 2 - m_pC_Military_spk->GetHeight(Window_Full_Background),
		m_pC_Military_spk->GetWidth(Window_Full_Background), 
		m_pC_Military_spk->GetHeight(Window_Full_Background));

	m_rcPagePos.Set(12,69,0,0);

	//----------------------------뒤寧女------------------------------------
	m_rcSlot[MilitarySlot::L_P1_0].Set(381-1, 448-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_1].Set(171-1, 404-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_2].Set(381-1, 404-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_3].Set(381-1, 360-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_4].Set(171-1, 316-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_5].Set(381-1, 316-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_6].Set(381-1, 272-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_7].Set(171-1, 228-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_8].Set(213-1, 228-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_9].Set(381-1, 228-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_10].Set(381-1, 184-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_11].Set(171-1, 140-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_12].Set(213-1, 140-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_13].Set(381-1, 140-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_14].Set(381-1, 96-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_15].Set(171-1, 52-4, 26, 22);
	m_rcSlot[MilitarySlot::L_P1_16].Set(214-2, 50-2, 24, 24);
	m_rcSlot[MilitarySlot::L_P1_17].Set(381-1, 52-4, 26, 22);

	m_SlotPicIndex[MilitarySlot::L_P1_0] = SanJiao_Gray;
	m_SlotPicIndex[MilitarySlot::L_P1_1] = SanJiao_Green;
	m_SlotPicIndex[MilitarySlot::L_P1_2] = SanJiao_Gray;
	m_SlotPicIndex[MilitarySlot::L_P1_3] = SanJiao_Gray;
	m_SlotPicIndex[MilitarySlot::L_P1_4] = SanJiao_Blue;
	m_SlotPicIndex[MilitarySlot::L_P1_5] = SanJiao_Gray;
	m_SlotPicIndex[MilitarySlot::L_P1_6] = SanJiao_Gray;
	m_SlotPicIndex[MilitarySlot::L_P1_7] = SanJiao_Red;
	m_SlotPicIndex[MilitarySlot::L_P1_8] = SanJiao_Green;
	m_SlotPicIndex[MilitarySlot::L_P1_9] = SanJiao_Gray;
	m_SlotPicIndex[MilitarySlot::L_P1_10] = SanJiao_Gray;
	m_SlotPicIndex[MilitarySlot::L_P1_11] = SanJiao_Yellow;
	m_SlotPicIndex[MilitarySlot::L_P1_12] = SanJiao_Blue;
	m_SlotPicIndex[MilitarySlot::L_P1_13] = SanJiao_Gray;
	m_SlotPicIndex[MilitarySlot::L_P1_14] = SanJiao_Gray;
	m_SlotPicIndex[MilitarySlot::L_P1_15] = SanJiao_Red;
	m_SlotPicIndex[MilitarySlot::L_P1_16] = ZhengFang_Green;
	m_SlotPicIndex[MilitarySlot::L_P1_17] = SanJiao_Gray;

    //-----------------------------------------뒤랗女----------------------------------------

	m_rcSlot[MilitarySlot::L_P2_0].Set(171-1, 379-3, 26, 22);
	m_rcSlot[MilitarySlot::L_P2_1].Set(214-2, 378-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_2].Set(383-2, 378-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_3].Set(171-1, 329-3, 26, 22);
	m_rcSlot[MilitarySlot::L_P2_4].Set(214-2, 328-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_5].Set(383-2, 328-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_6].Set(171-1, 279-3, 26, 22);
	m_rcSlot[MilitarySlot::L_P2_7].Set(214-2, 278-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_8].Set(383-2, 278-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_9].Set(171-1, 229-3, 26, 22);
	m_rcSlot[MilitarySlot::L_P2_10].Set(214-2, 228-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_11].Set(383-2, 228-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_12].Set(171-1, 180-3, 26, 22);
	m_rcSlot[MilitarySlot::L_P2_13].Set(214-2, 178-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_14].Set(255-1, 178, 26, 26);
	m_rcSlot[MilitarySlot::L_P2_15].Set(383-2, 178-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_16].Set(171-1, 130-3, 26, 22);
	m_rcSlot[MilitarySlot::L_P2_17].Set(214-2, 129-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P2_18].Set(255-1, 127, 26, 26);
	m_rcSlot[MilitarySlot::L_P2_19].Set(381-1, 127, 26, 26);


	m_SlotPicIndex[MilitarySlot::L_P2_0] = SanJiao_Yellow;
	m_SlotPicIndex[MilitarySlot::L_P2_1] = ZhengFang_Blue;
	m_SlotPicIndex[MilitarySlot::L_P2_2] = ZhengFang_Gray;
	m_SlotPicIndex[MilitarySlot::L_P2_3] = SanJiao_Blue;
	m_SlotPicIndex[MilitarySlot::L_P2_4] = ZhengFang_Red;
	m_SlotPicIndex[MilitarySlot::L_P2_5] = ZhengFang_Gray;
	m_SlotPicIndex[MilitarySlot::L_P2_6] = SanJiao_Blue;
	m_SlotPicIndex[MilitarySlot::L_P2_7] = ZhengFang_Yellow;
	m_SlotPicIndex[MilitarySlot::L_P2_8] = ZhengFang_Gray;
	m_SlotPicIndex[MilitarySlot::L_P2_9] = SanJiao_Red;
	m_SlotPicIndex[MilitarySlot::L_P2_10] = ZhengFang_Green;
	m_SlotPicIndex[MilitarySlot::L_P2_11] = ZhengFang_Gray;
	m_SlotPicIndex[MilitarySlot::L_P2_12] = SanJiao_Yellow;
	m_SlotPicIndex[MilitarySlot::L_P2_13] = ZhengFang_Blue;
	m_SlotPicIndex[MilitarySlot::L_P2_14] = WuBian_Green;
	m_SlotPicIndex[MilitarySlot::L_P2_15] = ZhengFang_Gray;
	m_SlotPicIndex[MilitarySlot::L_P2_16] = SanJiao_Green;
	m_SlotPicIndex[MilitarySlot::L_P2_17] = ZhengFang_Red;
	m_SlotPicIndex[MilitarySlot::L_P2_18] = WuBian_Blue;
	m_SlotPicIndex[MilitarySlot::L_P2_19] = WuBian_Gray;

	//-------------------------------------------뒤힛女-------------------------------------------

	m_rcSlot[MilitarySlot::L_P3_0].Set(172-2, 379-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P3_1].Set(214-2, 378-1, 26, 25);
	m_rcSlot[MilitarySlot::L_P3_2].Set(256-2, 377-1, 24, 26);
	m_rcSlot[MilitarySlot::L_P3_3].Set(381-1, 378-1, 26, 25);
	m_rcSlot[MilitarySlot::L_P3_4].Set(172-2, 329-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P3_5].Set(214-2, 328-1, 26, 25);
	m_rcSlot[MilitarySlot::L_P3_6].Set(256-2, 327-1, 24, 26);
	m_rcSlot[MilitarySlot::L_P3_7].Set(381-1, 328-1, 26, 25);
	m_rcSlot[MilitarySlot::L_P3_8].Set(172-2, 279-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P3_9].Set(214-2, 278-1, 26, 25);
	m_rcSlot[MilitarySlot::L_P3_10].Set(256-2, 277-1, 24, 26);
	m_rcSlot[MilitarySlot::L_P3_11].Set(298-2, 277-1, 24, 26);
	m_rcSlot[MilitarySlot::L_P3_12].Set(381-1, 278-1, 26, 25);
	m_rcSlot[MilitarySlot::L_P3_13].Set(172-2, 229-3, 24, 24);
	m_rcSlot[MilitarySlot::L_P3_14].Set(214-2, 228-1, 26, 25);
	m_rcSlot[MilitarySlot::L_P3_15].Set(256-2, 227-1, 24, 26);
	m_rcSlot[MilitarySlot::L_P3_16].Set(298-2, 227-1, 24, 26);
	m_rcSlot[MilitarySlot::L_P3_17].Set(381-1, 227-1, 26, 25);

	m_SlotPicIndex[MilitarySlot::L_P3_0] = ZhengFang_Yellow;
	m_SlotPicIndex[MilitarySlot::L_P3_1] = WuBian_Red;
	m_SlotPicIndex[MilitarySlot::L_P3_2] = LiuBian_Green;
	m_SlotPicIndex[MilitarySlot::L_P3_3] = WuBian_Gray;
	m_SlotPicIndex[MilitarySlot::L_P3_4] = ZhengFang_Green;
	m_SlotPicIndex[MilitarySlot::L_P3_5] = WuBian_Yellow;
	m_SlotPicIndex[MilitarySlot::L_P3_6] = LiuBian_Blue;
	m_SlotPicIndex[MilitarySlot::L_P3_7] = WuBian_Gray;
	m_SlotPicIndex[MilitarySlot::L_P3_8] = ZhengFang_Blue;
	m_SlotPicIndex[MilitarySlot::L_P3_9] = WuBian_Green;
	m_SlotPicIndex[MilitarySlot::L_P3_10] = LiuBian_Red;
	m_SlotPicIndex[MilitarySlot::L_P3_11] = LiuBian_Yellow;
	m_SlotPicIndex[MilitarySlot::L_P3_12] = WuBian_Gray;
	m_SlotPicIndex[MilitarySlot::L_P3_13] = ZhengFang_Red;
	m_SlotPicIndex[MilitarySlot::L_P3_14] = WuBian_Blue;
	m_SlotPicIndex[MilitarySlot::L_P3_15] = LiuBian_Yellow;
	m_SlotPicIndex[MilitarySlot::L_P3_16] = LiuBian_Green;
	m_SlotPicIndex[MilitarySlot::L_P3_17] = WuBian_Gray;

	m_nPageIndex = 0;
	m_focus_slot = NOT_SELECTED;

	//skillinfo 버튼
	m_pC_button_group = new ButtonGroup(this);


	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(
		17, 
		43, 
		m_pC_Military_spk->GetWidth(TableBtn_Normal), 
		m_pC_Military_spk->GetHeight(TableBtn_Normal), 
		Button_Tab0, 
		this, 
		TableBtn_Normal)
		);

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(
		86, 
		43, 
		m_pC_Military_spk->GetWidth(TableBtn_Normal), 
		m_pC_Military_spk->GetHeight(TableBtn_Normal), 
		Button_Tab1, 
		this, 
		TableBtn_Normal)
		);

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(
		153, 
		43, 
		m_pC_Military_spk->GetWidth(TableBtn_Normal), 
		m_pC_Military_spk->GetHeight(TableBtn_Normal), 
		Button_Tab2, 
		this, 
		TableBtn_Normal)
		);

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(
		556, 
		3, 
		m_pC_Military_spk->GetWidth(Btn_Close), 
		m_pC_Military_spk->GetHeight(Btn_Close), 
		Button_Close, 
		this, 
		Btn_Close)
		);


	for ( int i = MilitarySlot::L_P1_0; i<MilitarySlot::L_MAX; i++ )
	{
		m_bSlotOpenState[i] = false;
	}
}


C_VS_UI_MILITARYDLG::~C_VS_UI_MILITARYDLG()
{
	DeleteNew(m_pC_Military_spk);
	DeleteNew(m_pC_button_group);
}


bool	C_VS_UI_MILITARYDLG::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	return IsInRect(_x, _y);
}

void C_VS_UI_MILITARYDLG::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{

	if ( p_button->GetID() >= Button_Tab0 && p_button->GetID() < Button_Close )
	{
		if ( p_button->GetID() == m_nPageIndex )
			m_pC_Military_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + 2);
		else
			m_pC_Military_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
	}
	else  //close Button
	{
		m_pC_Military_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
	}
}

void C_VS_UI_MILITARYDLG::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{

}

void ExecF_DestoryMilitarySlot(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch( id )
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_ITEM_DELETE_FROM_MILITARYSLOT, p_this_dialog->GetTempValue(), 0,NULL);
		break;


	case DIALOG_CANCEL:
		break;

	}
}

bool C_VS_UI_MILITARYDLG::Click(int window_x, int window_y, Rect * slot_rect)
{
	if (m_focus_slot == NOT_SELECTED )
	{
		return false;
	}

	int item_x, item_y;


	if(ACTION_STAND	!= g_pPlayer->GetAction())	//스킬을 사용중일때는 아이템 착용 불가
	{
		return false;
	}

	const MItem* p_cur_item = gC_vs_ui.GetMilitarySlot(m_focus_slot);

	if (gpC_mouse_pointer->GetPickUpItem()) // 柑깃鞠近鮎
	{
		if ( gpC_mouse_pointer->GetPickUpItem()->GetItemClass() != 104 )
			return false;

		if ( m_bSlotOpenState[m_focus_slot] == false )
			return false;

		MItem * p_old_item = NULL;

		if (gC_vs_ui.CanReplaceItemInMilitarySlot(gpC_mouse_pointer->GetPickUpItem(), m_focus_slot, p_old_item))
		{
			if (p_old_item != NULL) // replace 되는가?
			{
				item_x = window_x+m_rcSlot[m_focus_slot].x+m_rcSlot[m_focus_slot].w/2-gpC_item->GetWidth(p_old_item->GetInventoryFrameID());
				item_y = window_y+m_rcSlot[m_focus_slot].y+m_rcSlot[m_focus_slot].h/2-gpC_item->GetHeight(p_old_item->GetInventoryFrameID());

				gpC_base->SendMessage(UI_ITEM_DROP_TO_MILITARYSLOT,
					m_focus_slot, 
					MAKEDWORD(item_x, item_y), 
					p_old_item); 
			}
			else
			{
				// not replace, just drop at empty grid.

				gpC_base->SendMessage(UI_ITEM_DROP_TO_MILITARYSLOT, 
					m_focus_slot, 
					0, 
					NULL);
			}
		}
		else
		{
			return false;
		}
	}
	else//柑깃鷗奢鮎
	{
		if ( p_cur_item != NULL )
		{
			m_pC_dialog_buy_confirm = new C_VS_UI_DIALOG(x + 292,y + 287, 2, 0, ExecF_DestoryMilitarySlot, DIALOG_OK|DIALOG_CANCEL);
			char * pp_dmsg[1] = 
			{
				"角뤠빻롤100듐얩닫쁑侶몸괜柯？",
			};

			m_pC_dialog_buy_confirm->SetTempValue( m_focus_slot );

			m_pC_dialog_buy_confirm->SetMessage( pp_dmsg, 1, SMO_NOFIT );
			m_pC_dialog_buy_confirm->Start();
		}

	}

	return true;
}


bool C_VS_UI_MILITARYDLG::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;

	const static char* slayer_grade[20] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PIVATE].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_SERENT].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FEACEL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LITENA].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KAINEL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GENEAL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FORE_GENEAL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MAJORIS_GENEAL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CLOEL_GENEAL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARSHAL].GetString(),

			"의裂제좆",
			"괭裂제좆",
			"襟裂제좆",
			"빪裂제좆",
			"斤嵐裂제",
			"覩제寧뿐바",
			"累逃",
			"댕낵",
			"累낀",
			"悧잿",
	};


	const static char* vampire_grade[20] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_RITTER].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_REICHSRITTER].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BARONET].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PREYHER].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GRAF].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARKGRAF].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PFALZGRAF].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FURST].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HERZOG].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LANDESHER].GetString(),


			"랗된븜얽",
			"寧된븜얽",
			"쥴寮",
			"朞뒨븜",
			"무얽",
			"댕무얽",
			"항珙",
			"뇨엌",
			"沂뽈",
			"열힁",
	};

	const static char* ousters_grade[20] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MALCHUT].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_YESOD].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HOD].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NETRETH].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_TIPHRETH].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GEBURAH].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHESED].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BINAH].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHOKMA].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KEATHER].GetString(),

			"첨景윗",
			"속겟죗",
			"윗爾랑",
			"벗쳄랑",
			"쵠瀁잇",
			"엥찝랑",
			"힉샘랑",
			"른샘랑",
			"윗폡랑",
			"첨檢景징",
	};

	bool re = m_pC_button_group->MouseControl(message, _x, _y);

	int i;

	int px = _x + x;
	int py = _y + y;

	const MItem * p_selected_item = NULL;
	Rect rcRect;

	int nStartIndex = 0;
	int nEndIndex = 0;
	int begin_grade = 0;
	int end_grade = 0;
	static char sz_Temp[256];
	int line_y_offset = 0;
	int begin_Y = 0;

	switch(m_nPageIndex)
	{
	case 0:
		nStartIndex = MilitarySlot::L_P1_0;
		nEndIndex = MilitarySlot::L_P2_0;
		begin_grade = 0;
		end_grade = 50;
		line_y_offset = 24;
		begin_Y = 516;
		break;

	case 1:
		nStartIndex = MilitarySlot::L_P2_0;
		nEndIndex = MilitarySlot::L_P3_0;
		begin_grade = 50;
		end_grade = 80;
		line_y_offset = 30;
		begin_Y = 448;
		break;

	case 2:
		nStartIndex = MilitarySlot::L_P3_0;
		nEndIndex = MilitarySlot::L_MAX;
		begin_grade = 80;
		end_grade = 100;
		line_y_offset = 30;
		begin_Y = 448;
		break;
	}

	int line_y = 0;
	int line_x = 0;
	int start_y = 0;

	int grade_x = 0;
	int grade_y = 0;

	int GradeID = 0;
	char* pszGrade = NULL;

	switch (message)
	{
	case M_MOVING:
		{
			for (int i=nStartIndex; i<nEndIndex; i++)
			{
				rcRect = m_rcSlot[i];
				rcRect.x += x + m_rcPagePos.x;
				rcRect.y += y + m_rcPagePos.y;

				if ( rcRect.IsInRect(px, py) )
				{
					m_focus_slot = i;
					break;
				}
				m_focus_slot = NOT_SELECTED;
			}

			p_selected_item = gC_vs_ui.GetMilitarySlot(m_focus_slot);
			if ( p_selected_item )
			{
				g_descriptor_manager.Set(DID_ITEM, x+m_rcSlot[m_focus_slot].x, y+m_rcSlot[m_focus_slot].y, (void *)p_selected_item, 0, (int)0);
			}
			else
			{
				if ( m_focus_slot != -1 && m_SlotPicIndex[m_focus_slot] != SanJiao_Gray
					&& m_SlotPicIndex[m_focus_slot] != ZhengFang_Gray
					&& m_SlotPicIndex[m_focus_slot] != WuBian_Gray
					&& m_SlotPicIndex[m_focus_slot] != LiuBian_Gray
					)
				{
					if(m_SlotPicIndex[m_focus_slot]== SanJiao_Green || m_SlotPicIndex[m_focus_slot]== ZhengFang_Green || m_SlotPicIndex[m_focus_slot]== WuBian_Green || m_SlotPicIndex[m_focus_slot]== LiuBian_Green)
					{

					const static char* str_s[10] = {"쫄シ灝캉略醱","츱櫓", "柬柰", "妗頓", "HP疼", "MP疼", "HP俱澗", "MP俱澗","餉篁","침랬令"};
					g_descriptor_manager.Set(DID_STRINGS, px, py, (void *)str_s, 10);  
					}
					if(m_SlotPicIndex[m_focus_slot]== SanJiao_Blue || m_SlotPicIndex[m_focus_slot]== ZhengFang_Blue || m_SlotPicIndex[m_focus_slot]== WuBian_Blue || m_SlotPicIndex[m_focus_slot]== LiuBian_Blue)
					{

						const static char* str_s[9] = {"융シ灝캉略醱","쀼긁", "렝徒", "침랬렝徒", "膠잿렝徒", "침랬襁┝憁", "膠잿襁┝憁", "杰唐襁┝憁","悧예"};
						g_descriptor_manager.Set(DID_STRINGS, px, py, (void *)str_s, 9);  
					}
					if(m_SlotPicIndex[m_focus_slot]== SanJiao_Red || m_SlotPicIndex[m_focus_slot]== ZhengFang_Red || m_SlotPicIndex[m_focus_slot]== WuBian_Red || m_SlotPicIndex[m_focus_slot]== LiuBian_Red)
					{

						const static char* str_s[10] = {"븐シ灝캉略醱","침랬襁", "膠잿襁", "唐槻댔샌", "궜個", "묑샌醵똑", "홍콘제", "제좆","츌쌥","例제"};
						g_descriptor_manager.Set(DID_STRINGS, px, py, (void *)str_s, 10);  
					}
					if(m_SlotPicIndex[m_focus_slot]== SanJiao_Yellow || m_SlotPicIndex[m_focus_slot]== ZhengFang_Yellow || m_SlotPicIndex[m_focus_slot]== WuBian_Yellow || m_SlotPicIndex[m_focus_slot]== LiuBian_Yellow)
					{

						const static char* str_s[5] = {"뼝シ灝캉略醱","세콘襁", "세콘넣崎珂쇌", "세콘렀鍋藤속", "景喝묑샌槻벎"};
						g_descriptor_manager.Set(DID_STRINGS, px, py, (void *)str_s, 5);  
					}
				}
			}

			for (int i=begin_grade; i<end_grade; i++)
			{
				line_y = (i - begin_grade) / 5;
				line_x = (i - begin_grade) % 5;
				start_y = y + begin_Y;

				grade_x = x+34 + line_x* 20 + line_x*5;
				grade_y = start_y - line_y*20 - line_y*line_y_offset;
				rcRect.x = grade_x;
				rcRect.y = grade_y;
				rcRect.w = 20;
				rcRect.h = 20;

				if ( rcRect.IsInRect(px, py) )
				{
					int GradeID = (i)/5;

					switch(g_eRaceInterface)
					{
					case RACE_SLAYER:
						pszGrade = const_cast<char *>(slayer_grade[GradeID]);
						break;

					case RACE_VAMPIRE:
						pszGrade = const_cast<char *>(vampire_grade[GradeID]);
						break;

					case RACE_OUSTERS:
						pszGrade = const_cast<char *>(ousters_grade[GradeID]);
						break;
					}

					sprintf(sz_Temp, "쌓섬츰냔:%s(%d)\n ", pszGrade, i+1);

					//g_descriptor_manager.Set(DID_INFO, px, py, (void *)sz_Temp,0,0);

					const static char* str_s[1] = {sz_Temp};
					g_descriptor_manager.Set(DID_STRINGS, px, py, (void *)str_s,1);
				}

			}
	
		}
		break;

	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (gpC_mouse_pointer->GetPickUpItem() == false && re && !gC_vs_ui.GetMilitarySlot(m_focus_slot) )
		{
			MoveReady();
			SetOrigin(_x, _y);
			break;
		}

		{
			bool ret = Click(x, y, &rcRect);

			if (ret)
				EMPTY_MOVE;
		}
		break;

	case M_LEFTBUTTON_UP:
		break;

	case M_RIGHTBUTTON_DOWN:
		break;
	}

	return true;
}

void C_VS_UI_MILITARYDLG::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_KEYDOWN && key == VK_ESCAPE)
	{
		//		Run(CLOSE);
	}
}

void C_VS_UI_MILITARYDLG::Run(id_t id)
{
	switch( id )
	{
	case Button_Tab0:
		m_nPageIndex = id;
		break;

	case Button_Tab1:
		m_nPageIndex = id;
		break;

	case Button_Tab2:
		m_nPageIndex = id;
		break;

	case Button_Close:
		gC_vs_ui.CloseMilitary();
		break;
	}
}

void C_VS_UI_MILITARYDLG::UpdateMilitarySlotData(int nSlotID, int nType, int nGrade)
{
	m_bSlotOpenState[nSlotID] = true;
}

void C_VS_UI_MILITARYDLG::ToggleMilitary()
{
	gpC_base->SendMessage(UI_REQUEST_MILITARY_SLOTDATA, 0, 0,NULL);
}

void C_VS_UI_MILITARYDLG::ShowMilitarySlotItem()
{

	int nStartIndex = 0;
	int nEndIndex = 0;

	switch(m_nPageIndex)
	{
	case 0:
		{
			for (int i = 0; i<50; i++)
			{
				CSprite* GradeMark=g_pGuildMarkManager->GetGradeMarkSmall(i,g_eRaceInterface);
				if(GradeMark!=NULL)
				{
					int line_y = i / 5;
					int line_x = i % 5;
					int start_y = y + 516;
					POINT GradePoint = { x+34 + line_x* 20 + line_x*5, start_y - line_y*20 - line_y*24};

					if ( g_char_slot_ingame.GRADE - 1 < i )
					{
						CSpriteSurface::SetEffect(CSpriteSurface::EFFECT_GRAY_SCALE);
						gpC_base->m_p_DDSurface_back->BltSpriteEffect(&GradePoint,GradeMark);
					}
					else
					{
						gpC_base->m_p_DDSurface_back->BltSprite(&GradePoint,GradeMark);
					}
				}
			}
		}
		nStartIndex = MilitarySlot::L_P1_0;
		nEndIndex = MilitarySlot::L_P2_0;
		break;

	case 1:
		{
			for (int i = 50; i<80; i++)
			{
				CSprite* GradeMark=g_pGuildMarkManager->GetGradeMarkSmall(i,g_eRaceInterface);
				if(GradeMark!=NULL)
				{
					int line_y = (i - 50) / 5;
					int line_x = (i - 50) % 5;
					int start_y = y + 448;
					POINT GradePoint = { x+34 + line_x* 20 + line_x*5, start_y - line_y*20 - line_y*30};

					if ( g_char_slot_ingame.GRADE - 1 < i )
					{
						CSpriteSurface::SetEffect(CSpriteSurface::EFFECT_GRAY_SCALE);
						gpC_base->m_p_DDSurface_back->BltSpriteEffect(&GradePoint,GradeMark);
					}
					else
					{
						gpC_base->m_p_DDSurface_back->BltSprite(&GradePoint,GradeMark);
					}
				}
			}
		}

		nStartIndex = MilitarySlot::L_P2_0;
		nEndIndex = MilitarySlot::L_P3_0;
		break;

	case 2:
		{
			for (int i = 80; i<100; i++)
			{
				CSprite* GradeMark=g_pGuildMarkManager->GetGradeMarkSmall(i,g_eRaceInterface);
				if(GradeMark!=NULL)
				{
					int line_y = (i - 80) / 5;
					int line_x = (i - 80) % 5;
					int start_y = y + 448;
					POINT GradePoint = { x+34 + line_x* 20 + line_x*5, start_y - line_y*20 - line_y*30};

					if ( g_char_slot_ingame.GRADE - 1 < i )
					{
						CSpriteSurface::SetEffect(CSpriteSurface::EFFECT_GRAY_SCALE);
						gpC_base->m_p_DDSurface_back->BltSpriteEffect(&GradePoint,GradeMark);
					}
					else
					{
						gpC_base->m_p_DDSurface_back->BltSprite(&GradePoint,GradeMark);
					}
				}
			}
		}
		nStartIndex = MilitarySlot::L_P3_0;
		nEndIndex = MilitarySlot::L_MAX;
		break;
	}

	for (int i = nStartIndex; i<nEndIndex; i++)
	{
		if ( m_SlotPicIndex[i] != None_Show )
			m_pC_Military_spk->BltLocked(x + m_rcPagePos.x + m_rcSlot[i].x, y + m_rcPagePos.y + m_rcSlot[i].y, m_SlotPicIndex[i]);

		const MItem* pItem = gC_vs_ui.GetMilitarySlot(i);
		if ( pItem )
		{
			int nFrameID = pItem->GetInventoryFrameID();
			int nSharpID = GetIndexSharpe(m_SlotPicIndex[i]);
			int nOffsetX = 0;
			int nOffsetY = 0;
			switch(nSharpID)
			{
			case 1:
				nOffsetY = 2;
				break;

			case 2:
				nOffsetY = -1;
				break;

			case 4:
				nOffsetX = 1;
				break;
			}
			gpC_item->BltLocked(x + m_rcPagePos.x + m_rcSlot[i].x + 5 + nOffsetX, y + m_rcPagePos.y + m_rcSlot[i].y + 6 + nOffsetY, nFrameID);
		}
		
		if ( m_bSlotOpenState[i] == false ) //lock the slot
		{
			m_pC_Military_spk->BltLocked(x + m_rcPagePos.x + m_rcSlot[i].x + 5, y + m_rcPagePos.y + m_rcSlot[i].y + 5, Slot_Lock);
		}
	}

}

int C_VS_UI_MILITARYDLG::GetIndexSharpe(int indexID)
{
	if (indexID >= SanJiao_Red && indexID < ZhengFang_Red)
		return 1;
	else if ( indexID >= ZhengFang_Red && indexID < WuBian_Red )
		return 2;
	else if (indexID >= WuBian_Red && indexID < LiuBian_Red)
		return 3;
	else if (indexID >= LiuBian_Red && indexID <= LiuBian_Gray)
		return 4;

	return -1;
}

void C_VS_UI_MILITARYDLG::Show()
{

	const static char* slayer_grade[20] = 
	{
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PIVATE].GetString(),	 //
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_SERENT].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FEACEL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LITENA].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KAINEL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GENEAL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FORE_GENEAL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MAJORIS_GENEAL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CLOEL_GENEAL].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARSHAL].GetString(),
			"의裂제좆",
			"괭裂제좆",
			"襟裂제좆",
			"빪裂제좆",
			"斤嵐裂제",
			"覩제寧뿐바",
			"累逃",
			"댕낵",
			"累낀",
			"悧잿",
	};


	const static char* vampire_grade[20] = 
	{
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_RITTER].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_REICHSRITTER].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BARONET].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PREYHER].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GRAF].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARKGRAF].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PFALZGRAF].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FURST].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HERZOG].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LANDESHER].GetString(),
			"랗된븜얽",
			"寧된븜얽",
			"쥴寮",
			"朞뒨븜",
			"무얽",
			"댕무얽",
			"항珙",
			"뇨엌",
			"沂뽈",
			"열힁",
	};

	const static char* ousters_grade[20] = 
	{
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MALCHUT].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_YESOD].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HOD].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NETRETH].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_TIPHRETH].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GEBURAH].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHESED].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BINAH].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHOKMA].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KEATHER].GetString(),
			"첨景윗",
			"속겟죗",
			"윗爾랑",
			"벗쳄랑",
			"쵠瀁잇",
			"엥찝랑",
			"힉샘랑",
			"른샘랑",
			"윗폡랑",
			"첨檢景징",
	};


	int	exp_remain = g_char_slot_ingame.GRADE_EXP_REMAIN;
	__int64	goal_exp = max(1, g_pExperienceTable->GetRankInfo(g_char_slot_ingame.GRADE, g_eRaceInterface).GoalExp);
	int barWidth = m_pC_Military_spk->GetSprite(Progress_UpShow).GetWidth();
	int barHight = m_pC_Military_spk->GetSprite(Progress_UpShow).GetHeight();

	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_pC_Military_spk->BltLocked(x, y, Window_Full_Background);
		m_pC_Military_spk->BltLocked(x + m_rcPagePos.x, y + m_rcPagePos.y, Window_0_Background + m_nPageIndex);

		//몸훙뎠품쌓섬暠깃
		POINT GradePoint = {x + 19, y + 72};
		CSprite* GradeMark=g_pGuildMarkManager->GetGradeMarkSmall(g_char_slot_ingame.GRADE - 1,g_eRaceInterface);
		if ( GradeMark )
			gpC_base->m_p_DDSurface_back->BltSprite(&GradePoint,GradeMark);

		//삥齡쏵똑係교쒼
		m_pC_Military_spk->BltLocked(x + 237, y + 75, Progress_Background);

		//삥齡쏵똑係
		Rect rect;
		rect.Set(0, 0, barWidth*(goal_exp-exp_remain)/goal_exp, barHight);  
		m_pC_Military_spk->BltLockedClip(x+238,y+76,rect, Progress_UpShow);

		ShowMilitarySlotItem();

		m_pC_button_group->Show();

		gpC_base->m_p_DDSurface_back->Unlock();
	}

	g_FL2_GetDC();

	char sz_temp[80];
	gpC_base->m_info_pi.back_color = RGB_GRAY;
	int GradeID = (g_char_slot_ingame.GRADE-1)/5;
	char* pszGrade;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		pszGrade = const_cast<char *>(slayer_grade[GradeID]);
		break;

	case RACE_VAMPIRE:
		pszGrade = const_cast<char *>(vampire_grade[GradeID]);
		break;

	case RACE_OUSTERS:
		pszGrade = const_cast<char *>(ousters_grade[GradeID]);
		break;
	}

	sprintf(sz_temp, "%s(%d)", pszGrade, g_char_slot_ingame.GRADE);
	g_PrintColorStr(x + 43, y + 74, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);

	g_PrintColorStr(x + 27, y + 49, "놓섬쌓섬", gpC_base->m_chatting_pi, RGB_WHITE);
	g_PrintColorStr(x + 96, y + 49, "櫓섬쌓섬", gpC_base->m_chatting_pi, RGB_WHITE);
	g_PrintColorStr(x + 163, y + 49, "멕섬쌓섬", gpC_base->m_chatting_pi, RGB_WHITE);

	wsprintf(sz_temp, "%d%%/100%%", (goal_exp - exp_remain)*100/goal_exp); // hyungony
	g_PrintColorStrOut(x + 237 +barWidth/2-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, y+76, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
	m_pC_button_group->ShowDescription();
	Window::ShowWidget();

	g_FL2_ReleaseDC();
}


void C_VS_UI_MILITARYDLG::Process()
{
	if ( m_pC_button_group )
		m_pC_button_group->Process();
}

void C_VS_UI_MILITARYDLG::Start()
{
	PI_Processor::Start();
	m_pC_button_group->Init();
	AttrPin(true);

	//m_attack_key.EraseAll();
	gpC_window_manager->AppearWindow(this);
}

void C_VS_UI_MILITARYDLG::Finish()
{
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BURST_WINDOW, Rect(x, y, w, h));
	//gpC_vs_ui_window_manager->SetBloodBurstHeight(!m_width_mode);
	PI_Processor::Finish();

	gpC_window_manager->DisappearWindow(this);
}


//-----------------------------------------------엊쌓end-------------------------------------------------------------



//------------------------------------------------------------------加濫썹충--------------------------------------
C_VS_UI_HOLYWAR::C_VS_UI_HOLYWAR()
{
	m_pC_HollyWar_spk = NULL;

	AttrKeyboardControl(true);
	AttrTopmost(false);
	AttrPin(true);

	g_RegisterWindow(this);

	m_pC_HollyWar_spk = new C_SPRITE_PACK(_ROOT"spk\\warinfo.spk");


	Set(( g_pUserInformation->iResolution_x+m_pC_HollyWar_spk->GetWidth(HolyWar_Back) ) / 2 - m_pC_HollyWar_spk->GetWidth(HolyWar_Back),
		( g_pUserInformation->iResolution_y+m_pC_HollyWar_spk->GetHeight(HolyWar_Back) ) / 2 - m_pC_HollyWar_spk->GetHeight(HolyWar_Back),
		m_pC_HollyWar_spk->GetWidth(HolyWar_Back), 
		m_pC_HollyWar_spk->GetHeight(HolyWar_Back));

	//skillinfo 버튼
	m_pC_button_group = new ButtonGroup(this);


	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(
		765, 
		6, 
		m_pC_HollyWar_spk->GetWidth(HolyWar_CloseBtnNormal), 
		m_pC_HollyWar_spk->GetHeight(HolyWar_CloseBtnNormal), 
		Button_Close, 
		this, 
		HolyWar_CloseBtnNormal)
		);

	//PlayerScore st;
	//st.nKill = 10;
	//st.nDead = 9;
	//st.nScore = 100;
	//st.strName = "Hays";

	//for (int i=0; i<10; i++)
	//{
	//	AddHollyScore(st, RACE_SLAYER);
	//	AddHollyScore(st, RACE_VAMPIRE);
	//	AddHollyScore(st, RACE_OUSTERS);
	//}

	m_rcPersonScore[RACE_SLAYER].Set(22, 315, 232, 203);
	m_rcPersonScore[RACE_VAMPIRE].Set(275, 315, 232, 203);
	m_rcPersonScore[RACE_OUSTERS].Set(528, 315, 232, 203);

	m_rcRaceRect[RACE_SLAYER].Set(1, 38, 88, 88);
	m_rcRaceRect[RACE_VAMPIRE].Set(1, 93, 88, 88);
	m_rcRaceRect[RACE_OUSTERS].Set(1, 148, 88, 88);

	m_rcPlayerData.Set(2, 209, 88, 88);

	m_vRaceName[RACE_SLAYER] = "훙痢";
	m_vRaceName[RACE_VAMPIRE] = "뱁痢";
	m_vRaceName[RACE_OUSTERS] = "침痢";

	m_colorRace[RACE_SLAYER] = RGB_BLUE;
	m_colorRace[RACE_VAMPIRE] = RGB_RED;
	m_colorRace[RACE_OUSTERS] = RGB_GREEN;

	m_nRaceIndex = RACE_SLAYER;

	m_stPlayerData.KillCount = 0;
	m_stPlayerData.DeadCount = 0;
	m_stPlayerData.RacePoint = 0;
	m_stPlayerData.KillPoint = 0;
	m_stPlayerData.TotalPoint = 0;
}


C_VS_UI_HOLYWAR::~C_VS_UI_HOLYWAR()
{
	DeleteNew(m_pC_HollyWar_spk);
	DeleteNew(m_pC_button_group);
}


void    C_VS_UI_HOLYWAR::ClearAllData()
{
	for (int i = RACE_SLAYER; i<RACE_MAX; i++)
	{
		m_ScoreList[i].clear();
		m_stRaceData[i].BookIDList.clear();
	}

	m_nRaceIndex = RACE_SLAYER;

	m_stPlayerData.KillCount = 0;
	m_stPlayerData.DeadCount = 0;
	m_stPlayerData.RacePoint = 0;
	m_stPlayerData.KillPoint = 0;
	m_stPlayerData.TotalPoint = 0;
}

void C_VS_UI_HOLYWAR::AddHollyScore(PlayerScore score, int nRace)
{
	if ( nRace >= RACE_MAX )
		return;

	m_ScoreList[nRace].push_back( score );
}


void C_VS_UI_HOLYWAR::AddHollyRace(C_VS_UI_HOLYWAR::RaceData * data)
{
	if ( !data )
		return;

	m_stRaceData[m_nRaceIndex].nDead = data->nDead;
	m_stRaceData[m_nRaceIndex].nKill =data->nKill;
	m_stRaceData[m_nRaceIndex].nScore = data->nScore;
	
	for ( int i=0; i<data->BookIDList.size(); i++ )
		m_stRaceData[m_nRaceIndex].BookIDList.push_back( data->BookIDList[i] );

	m_nRaceIndex++;
}

void C_VS_UI_HOLYWAR::AddPlayerData(C_VS_UI_HOLYWAR::PlayerData data)
{
	m_stPlayerData = data;
}

bool	C_VS_UI_HOLYWAR::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	return IsInRect(_x, _y);
}

void C_VS_UI_HOLYWAR::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if (p_button->GetPressState()) // push state
	{
		m_pC_HollyWar_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + 1);
	}
	else
	{
		m_pC_HollyWar_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
	}
}

void C_VS_UI_HOLYWAR::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{

}

bool C_VS_UI_HOLYWAR::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;

	bool re = m_pC_button_group->MouseControl(message, _x, _y);

	return true;
}

void C_VS_UI_HOLYWAR::KeyboardControl(UINT message, UINT key, long extra)
{
	Window::KeyboardControl(message, key, extra);
}

void C_VS_UI_HOLYWAR::Run(id_t id)
{
	switch( id )
	{
	case Button_Close:
		gC_vs_ui.CloseHollyWar();
		break;
	}
}

void C_VS_UI_HOLYWAR::ShowSelfData()
{
	char szText[MAX_PATH];
	sprintf(szText, "%d", m_stPlayerData.KillCount);
	g_PrintColorStr(x + m_rcPlayerData.x + 197, y + m_rcPlayerData.y + 42, szText, gpC_base->m_chatting_pi, RGB_WHITE);

	sprintf(szText, "%d", m_stPlayerData.DeadCount);
	g_PrintColorStr(x + m_rcPlayerData.x + 197, y + m_rcPlayerData.y + 67, szText, gpC_base->m_chatting_pi, RGB_WHITE);

	sprintf(szText, "%d", m_stPlayerData.RacePoint);
	g_PrintColorStr(x + m_rcPlayerData.x + 476, y + m_rcPlayerData.y + 35, szText, gpC_base->m_chatting_pi, RGB_WHITE);

	sprintf(szText, "%d", m_stPlayerData.KillPoint);
	g_PrintColorStr(x + m_rcPlayerData.x + 476, y + m_rcPlayerData.y + 54, szText, gpC_base->m_chatting_pi, RGB_WHITE);


	//蘆痢속몸훙
	sprintf(szText, "%d", m_stPlayerData.RacePoint);
	g_PrintColorStr(x + m_rcPlayerData.x + 476, y + m_rcPlayerData.y + 73, szText, gpC_base->m_chatting_pi, RGB_WHITE);

	sprintf(szText, "%d", m_stPlayerData.KillPoint);
	g_PrintColorStr(x + m_rcPlayerData.x + 575, y + m_rcPlayerData.y + 73, szText, gpC_base->m_chatting_pi, RGB_WHITE);


	//悧묾휠桃
	sprintf(szText, "%d", m_stPlayerData.TotalPoint);
	g_PrintColorStr(x + m_rcPlayerData.x + 669, y + m_rcPlayerData.y + 73, szText, gpC_base->m_chatting_pi, RGB_WHITE);
}

void C_VS_UI_HOLYWAR::ShowScore(int nRace)
{
	int nSize = m_ScoreList[nRace].size();
	int nFirstLineOffSet = 52;


	//蘆痢츰俚
	g_PrintColorStrOut(x + m_rcPersonScore[nRace].x + 96, y + m_rcPersonScore[nRace].y + 7, m_vRaceName[nRace].c_str(), gpC_base->m_item_name_pi, RGB_WHITE, m_colorRace[nRace]);

	g_PrintColorStr(x + m_rcPersonScore[nRace].x + 31, y + m_rcPersonScore[nRace].y + 35, "츰俚", gpC_base->m_chatting_pi, RGB_WHITE);

	g_PrintColorStr(x + m_rcPersonScore[nRace].x + 100, y + m_rcPersonScore[nRace].y + 35, "샌", gpC_base->m_chatting_pi, RGB_WHITE);

	g_PrintColorStr(x + m_rcPersonScore[nRace].x + 139, y + m_rcPersonScore[nRace].y + 35, "价空", gpC_base->m_chatting_pi, RGB_WHITE);

	g_PrintColorStr(x + m_rcPersonScore[nRace].x + 191, y + m_rcPersonScore[nRace].y + 35, "생롸", gpC_base->m_chatting_pi, RGB_WHITE);

	for ( int i=0; i<nSize; i++ )
	{
		PlayerScore score = m_ScoreList[nRace][i];

		int nOffSet = 18;

		g_PrintColorStr(x + m_rcPersonScore[nRace].x, y + m_rcPersonScore[nRace].y + nFirstLineOffSet + i*nOffSet, score.strName.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);

		char szText[MAX_PATH];
		sprintf(szText, "%d", score.nKill);
		g_PrintColorStr(x + m_rcPersonScore[nRace].x + 95, y + m_rcPersonScore[nRace].y + nFirstLineOffSet + i*nOffSet, szText, gpC_base->m_chatting_pi, RGB_WHITE);

		sprintf(szText, "%d", score.nDead);
		g_PrintColorStr(x + m_rcPersonScore[nRace].x + 133, y + m_rcPersonScore[nRace].y + nFirstLineOffSet + i*nOffSet, szText, gpC_base->m_chatting_pi, RGB_WHITE);

		sprintf(szText, "%d", score.nScore);
		g_PrintColorStr(x + m_rcPersonScore[nRace].x + 171, y + m_rcPersonScore[nRace].y + nFirstLineOffSet + i*nOffSet, szText, gpC_base->m_chatting_pi, RGB_WHITE);

		gpC_base->m_info_pi.back_color = RGB_WHITE;
	}
}

void C_VS_UI_HOLYWAR::ShowRaceData()
{
	for ( int nRace = RACE_SLAYER; nRace<RACE_MAX; nRace++ )
	{
		g_PrintColorStrOut(x + m_rcRaceRect[nRace].x + 76, y + m_rcRaceRect[nRace].y + 15, m_vRaceName[nRace].c_str(), gpC_base->m_haysNameBig, RGB_WHITE, m_colorRace[nRace]);

		char szText[MAX_PATH];

		g_PrintColorStr(x + m_rcRaceRect[nRace].x + 238, y + m_rcRaceRect[nRace].y + 3 , "샌(K)", gpC_base->m_item_name_pi, RGB_WHITE);

		g_PrintColorStr(x + m_rcRaceRect[nRace].x + 296, y + m_rcRaceRect[nRace].y + 3, "价空(D)", gpC_base->m_item_name_pi, RGB_WHITE);

		g_PrintColorStr(x + m_rcRaceRect[nRace].x + 390, y + m_rcRaceRect[nRace].y + 3 , "생롸", gpC_base->m_item_name_pi, RGB_WHITE);

		g_PrintColorStr(x + m_rcRaceRect[nRace].x + 614, y + m_rcRaceRect[nRace].y + 3, "加蝎", gpC_base->m_item_name_pi, RGB_WHITE);

		sprintf(szText, "%d", m_stRaceData[nRace].nKill);
		g_PrintColorStr(x + m_rcRaceRect[nRace].x + 236, y + m_rcRaceRect[nRace].y + 23 , szText, gpC_base->m_haysNameBig, RGB_WHITE);

		sprintf(szText, "%d", m_stRaceData[nRace].nDead);
		g_PrintColorStr(x + m_rcRaceRect[nRace].x + 295, y + m_rcRaceRect[nRace].y + 23, szText, gpC_base->m_haysNameBig, RGB_WHITE);

		sprintf(szText, "%d", m_stRaceData[nRace].nScore);
		g_PrintColorStr(x + m_rcRaceRect[nRace].x + 356, y + m_rcRaceRect[nRace].y + 23, szText, gpC_base->m_haysNameBig, RGB_WHITE);

		sprintf(szText, "%d", m_stRaceData[nRace].BookIDList.size());
		g_PrintColorStrOut(x + m_rcRaceRect[nRace].x + 27, y + m_rcRaceRect[nRace].y + 19, szText, gpC_base->m_haysNameBig, RGB_WHITE, m_colorRace[nRace]);

		int nBookCount = m_stRaceData[nRace].BookIDList.size();

		for ( int i=0; i<nBookCount; i++ )
		{
			int nBookID = m_stRaceData[nRace].BookIDList[i];
			
		}

	}
}

void C_VS_UI_HOLYWAR::ShowBook()
{
	const int skill_id = 230;

	for ( int nRace = RACE_SLAYER; nRace<RACE_MAX; nRace++ )
	{
		int nBookCount = m_stRaceData[nRace].BookIDList.size();

		for ( int i=0; i<nBookCount; i++ )
		{
			POINT point;
			point.x = x + m_rcRaceRect[nRace].x + 471 + i*25;
			point.y = y + m_rcRaceRect[nRace].y + 26;

			int nBookID = m_stRaceData[nRace].BookIDList[i];

			gpC_base->m_p_DDSurface_back->BltSprite(&point, &C_VS_UI_SKILL::m_C_spk_mini[skill_id + nBookID]);	

		}

	}
}

void C_VS_UI_HOLYWAR::Show()
{

	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_pC_HollyWar_spk->BltLocked(x, y, HolyWar_Back);

		m_pC_button_group->Show();
		ShowBook();

		gpC_base->m_p_DDSurface_back->Unlock();
	}


	g_FL2_GetDC();

	gpC_base->m_info_pi.back_color = RGB_GRAY;

	for ( int i=RACE_SLAYER; i<RACE_MAX; i++ )
	{
		ShowScore(i);
	}

	ShowSelfData();
	ShowRaceData();

	m_pC_button_group->ShowDescription();
	Window::ShowWidget();
	g_FL2_ReleaseDC();
}


void C_VS_UI_HOLYWAR::Process()
{
	if ( m_pC_button_group )
		m_pC_button_group->Process();
}

void C_VS_UI_HOLYWAR::Start()
{
	PI_Processor::Start();
	m_pC_button_group->Init();
	AttrPin(true);

	//m_attack_key.EraseAll();
	gpC_window_manager->AppearWindow(this);
}

void C_VS_UI_HOLYWAR::Finish()
{
	ClearAllData();
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BURST_WINDOW, Rect(x, y, w, h));

	PI_Processor::Finish();

	gpC_window_manager->DisappearWindow(this);
}


//-----------------------------------------------加濫END------------------------------------------------------------




//-------------------------------------------------犬begin----------------------------------------------------------------
C_VS_UI_TMALL::C_VS_UI_TMALL()
{
	m_pC_TMall_spk = NULL;
	m_pC_dialog_buy_confirm = NULL;

	AttrKeyboardControl(true);
	AttrTopmost(false);
	AttrPin(true);

	g_RegisterWindow(this);

	m_pC_TMall_spk = new C_SPRITE_PACK(_ROOT"spk\\shopmall.spk");


	Set(( g_pUserInformation->iResolution_x+m_pC_TMall_spk->GetWidth(TMall_Background) ) / 2 - m_pC_TMall_spk->GetWidth(TMall_Background),
		( g_pUserInformation->iResolution_y+m_pC_TMall_spk->GetHeight(TMall_Background) ) / 2 - m_pC_TMall_spk->GetHeight(TMall_Background),
		m_pC_TMall_spk->GetWidth(TMall_Background), 
		m_pC_TMall_spk->GetHeight(TMall_Background));


	//skillinfo 버튼
	m_pC_button_group = new ButtonGroup(this);

	m_nClassIndex = 0;
	m_nPageIndex = 0;


	//6몸롸잚객큐
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(101, 106, 
		m_pC_TMall_spk->GetWidth(TMall_FangJuNormal), 
		m_pC_TMall_spk->GetHeight(TMall_FangJuNormal), 
		Button_FangJu, this, TMall_FangJuNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+40+102+8, 106,
		m_pC_TMall_spk->GetWidth(TMall_ShouShiNormal), 
		m_pC_TMall_spk->GetHeight(TMall_ShouShiNormal), 
		Button_ShouShi, this, TMall_ShouShiNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+40+102+8+104+8, 106, 
		m_pC_TMall_spk->GetWidth(TMall_BaoShiNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BaoShiNormal), 
		Button_BaoShi, this, TMall_BaoShiNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+40+102+8+104+8+103+8, 106, 
		m_pC_TMall_spk->GetWidth(TMall_TeXiaoNormal), 
		m_pC_TMall_spk->GetHeight(TMall_TeXiaoNormal), 
		Button_TeXiao, this, TMall_TeXiaoNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+40+102+8+104+8+103+8+103+8, 106, 
		m_pC_TMall_spk->GetWidth(TMall_ChongWuNormal), 
		m_pC_TMall_spk->GetHeight(TMall_ChongWuNormal), 
		Button_ChongWu, this, TMall_ChongWuNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+40+102+8+104+8+103+8+103+8+103+8, 106, 
		m_pC_TMall_spk->GetWidth(TMall_JiFenBuyNormal), 
		m_pC_TMall_spk->GetHeight(TMall_JiFenBuyNormal), 
		Button_JiFenBuy, this, TMall_JiFenBuyNormal));

	//9몸buy객큐
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211-20-56, 197+107-10-26, 
		m_pC_TMall_spk->GetWidth(TMall_BuyNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BuyNormal), 
		Button_Buy_0, this, TMall_BuyNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211-20-56+211+20, 197+107-10-26, 
		m_pC_TMall_spk->GetWidth(TMall_BuyNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BuyNormal), 
		Button_Buy_1, this, TMall_BuyNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211-20-56+211+20+211+20, 197+107-10-26, 
		m_pC_TMall_spk->GetWidth(TMall_BuyNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BuyNormal), 
		Button_Buy_2, this, TMall_BuyNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211-20-56, 197+107+8+107-10-26, 
		m_pC_TMall_spk->GetWidth(TMall_BuyNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BuyNormal), 
		Button_Buy_3, this, TMall_BuyNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211-20-56+211+20, 197+107+8+107-10-26, 
		m_pC_TMall_spk->GetWidth(TMall_BuyNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BuyNormal), 
		Button_Buy_4, this, TMall_BuyNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211-20-56+211+20+211+20, 197+107+8+107-10-26, 
		m_pC_TMall_spk->GetWidth(TMall_BuyNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BuyNormal), 
		Button_Buy_5, this, TMall_BuyNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211-20-56, 197+107+8+107+8+107-10-26, 
		m_pC_TMall_spk->GetWidth(TMall_BuyNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BuyNormal), 
		Button_Buy_6, this, TMall_BuyNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211-20-56+211+20, 197+107+8+107+8+107-10-26, 
		m_pC_TMall_spk->GetWidth(TMall_BuyNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BuyNormal), 
		Button_Buy_7, this, TMall_BuyNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211-20-56+211+20+211+20, 197+107+8+107+8+107-10-26, 
		m_pC_TMall_spk->GetWidth(TMall_BuyNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BuyNormal), 
		Button_Buy_8, this, TMall_BuyNormal));

	m_slot_rect[0].Set(x+61, y+197, 60, 90);
	m_slot_rect[1].Set(x+61+211+20, y+197, 60, 90);
	m_slot_rect[2].Set(x+61+211+20+211+20, y+197, 60, 90);

	m_slot_rect[3].Set(x+61, y+197+107+8, 60, 90);
	m_slot_rect[4].Set(x+61+211+20, y+197+107+8, 60, 90);
	m_slot_rect[5].Set(x+61+211+20+211+20, y+197+107+8, 60, 90);

	m_slot_rect[6].Set(x+61, y+197+107+8+107+8, 60, 90);
	m_slot_rect[7].Set(x+61+211+20, y+197+107+8+107+8, 60, 90);
	m_slot_rect[8].Set(x+61+211+20+211+20, y+197+107+8+107+8, 60, 90);

	for (int i=0; i<9; i++)
	{
		m_slot_rect[i].x += 14;
		m_slot_rect[i].y += 10;
	}

	//숫庫객큐
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211+20+30, 197+107+8+107+8+107+10, 
		m_pC_TMall_spk->GetWidth(TMall_BtnLeftArrow), 
		m_pC_TMall_spk->GetHeight(TMall_BtnLeftArrow), 
		Button_LeftArrow, this, TMall_BtnLeftArrow));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211+20+30+17+10+28+10+28+10+28+10, 197+107+8+107+8+107+10,
		m_pC_TMall_spk->GetWidth(TMall_BtnRightArrow), 
		m_pC_TMall_spk->GetHeight(TMall_BtnRightArrow), 
		Button_RightArrow, this, TMall_BtnRightArrow));

	//럇女乞多객큐
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211+20+30+17+10, 197+107+8+107+8+107+10,
		m_pC_TMall_spk->GetWidth(TMall_BtnIndexNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BtnIndexNormal), 
		Button_Index_1, this, TMall_BtnIndexNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211+20+30+17+10+28+10, 197+107+8+107+8+107+10, 
		m_pC_TMall_spk->GetWidth(TMall_BtnIndexNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BtnIndexNormal), 
		Button_Index_2, this, TMall_BtnIndexNormal));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(61+211+20+30+17+10+28+10+28+10, 197+107+8+107+8+107+10, 
		m_pC_TMall_spk->GetWidth(TMall_BtnIndexNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BtnIndexNormal), 
		Button_Index_3, this, TMall_BtnIndexNormal));

	//밑균객큐
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(739, 84, 
		m_pC_TMall_spk->GetWidth(TMall_BtnCloseNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BtnCloseNormal), 
		Button_Close, this, TMall_BtnCloseNormal));

	//념令객큐
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(625, 585, 
		m_pC_TMall_spk->GetWidth(TMall_BtnChongZhiNormal), 
		m_pC_TMall_spk->GetHeight(TMall_BtnChongZhiNormal), 
		Button_ChongZhi, this, TMall_BtnChongZhiNormal));




}


C_VS_UI_TMALL::~C_VS_UI_TMALL()
{
	DeleteNew(m_pC_TMall_spk);
	DeleteNew(m_pC_button_group);
}


bool	C_VS_UI_TMALL::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	return IsInRect(_x, _y);
}


void	C_VS_UI_TMALL::ClearItem()
{
	while(!m_ItemList.empty())
	{
		ItemList Item = m_ItemList.back();
		if(Item.pItem != NULL)
			delete Item.pItem;
		Item.pItem = NULL;
		m_ItemList.pop_back();
	}

	m_ItemList.clear();
}

bool	C_VS_UI_TMALL::AddItem(  C_VS_UI_TMALL::ItemList pItem )
{
	if(pItem.pItem == NULL)
		return false;

	m_ItemList.push_back( pItem );

	return true;
}

bool	C_VS_UI_TMALL::DeleteItem( DWORD ID )
{
	if( m_ItemList.empty() )
		return false;

	MItem *pDeleteItem = NULL;
	std::vector<ItemList>::iterator itr = m_ItemList.begin();
	std::vector<ItemList>::iterator endItr = m_ItemList.end();

	while( itr != endItr )
	{
		MItem* pItem = (*itr).pItem;

		if(pItem != NULL)
		{
			if ( pItem->GetID() == ID )
			{
				pDeleteItem = pItem;
				m_ItemList.erase( itr );
				break;
			}
		}
		itr++;
	}

	if(pDeleteItem != NULL)
	{
		delete pDeleteItem;
		pDeleteItem = NULL;

		EMPTY_MOVE;
		return true;

	}		

	return false;
}


void ExecF_Buy_TMall(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch( id )
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_BUY_TMALL_ITEM, p_this_dialog->GetTempValue2(), p_this_dialog->GetTempValue(),NULL);
		break;


	case DIALOG_CANCEL:
		break;

	}
}



void C_VS_UI_TMALL::BuyItem(int nIndex)
{
	int nRealIndex = m_nPageIndex*PageSize + nIndex;
	int nSize = m_ItemList.size();

	if ( nRealIndex >= nSize )
		return;

	ItemList kItem = m_ItemList[nRealIndex];
	int nItemID = kItem.pItem->GetID();
	int nKind = m_nClassIndex;

	DeleteNew( m_pC_dialog_buy_confirm );
	m_pC_dialog_buy_confirm = new C_VS_UI_DIALOG(x + 292,y + 287, 2, 0, ExecF_Buy_TMall, DIALOG_OK|DIALOG_CANCEL);
	char * pp_dmsg[1] = 
	{
		"角뤠뭔찜늪膠틔？",
	};

	m_pC_dialog_buy_confirm->SetTempValue2( nKind );
	m_pC_dialog_buy_confirm->SetTempValue( nItemID );
	
	m_pC_dialog_buy_confirm->SetMessage( pp_dmsg, 1, SMO_NOFIT );
	m_pC_dialog_buy_confirm->Start();
}


void C_VS_UI_TMALL::Run(id_t id)
{
	switch( id )
	{
	case Button_FangJu:
	case Button_ShouShi:
	case Button_BaoShi:
	case Button_TeXiao:
	case Button_ChongWu:
	case Button_JiFenBuy:
		if ( m_nClassIndex != id )
		{
			m_nClassIndex = id;
			m_nPageIndex = 0;
			ClearItem();
			ToggleTMall();
		}
		break;

	case Button_Buy_0:
	case Button_Buy_1:
	case Button_Buy_2:
	case Button_Buy_3:
	case Button_Buy_4:
	case Button_Buy_5:
	case Button_Buy_6:
	case Button_Buy_7:
	case Button_Buy_8:
		//딧痰찜찡변鑒 蕨륩蛟포랙箇뭔찜횅훰
		BuyItem( id - Button_Buy_0 );
		break;

	case Button_LeftArrow:
		m_nPageIndex -= 1;
		if ( m_nPageIndex < 0 )
			m_nPageIndex = 0;
		break;

	case Button_RightArrow:
		m_nPageIndex += 1;
		if ( m_nPageIndex > 2 )
			m_nPageIndex = 2;
		break;

	case Button_Index_1:
	case Button_Index_2:
	case Button_Index_3:
		m_nPageIndex = id - Button_Index_1;
		break;

	case Button_Close:
		gC_vs_ui.CloseTMall();
		break;

	case Button_ChongZhi:
		::ShellExecute(g_hWnd, NULL, "http://www.t1dk.com/yeepay.php",NULL,NULL,SW_SHOWNORMAL);
		break;
	}
}

void C_VS_UI_TMALL::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if ( !p_button )
		return;

	switch( p_button->GetID())
	{
	case Button_FangJu:
	case Button_ShouShi:
	case Button_BaoShi:
	case Button_TeXiao:
	case Button_ChongWu:
	case Button_JiFenBuy:
		if ( m_nClassIndex == p_button->GetID() )
			m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + 1);
		else
			m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
		break;

	case Button_Buy_0:
	case Button_Buy_1:
	case Button_Buy_2:
	case Button_Buy_3:
	case Button_Buy_4:
	case Button_Buy_5:
	case Button_Buy_6:
	case Button_Buy_7:
	case Button_Buy_8:
		if (p_button->GetPressState()) // push state
		{
			m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + 1);
		}
		else
		{
			m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
		}
		break;

	case Button_LeftArrow:
	case Button_RightArrow:
		m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
		break;

	case Button_Index_1:
	case Button_Index_2:
	case Button_Index_3:
		if ( m_nPageIndex + Button_Index_1 == p_button->GetID() )
			m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + 1);
		else
			m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
		break;

	case Button_Close:
		if (p_button->GetPressState()) // push state
		{
			m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + 1);
		}
		else
		{
			m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
		}
		break;

	case Button_ChongZhi:
		if (p_button->GetPressState()) // push state
		{
			m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + 1);
		}
		else
		{
			m_pC_TMall_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
		}
		break;
	}

}

void C_VS_UI_TMALL::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{

}

bool C_VS_UI_TMALL::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;

	bool re = m_pC_button_group->MouseControl(message, _x, _y);

	int px = _x + x;
	int py = _y + y;

	switch(message)
	{
	case M_MOVING:
		for (int i=0; i<9; i++)
		{
			if ( m_slot_rect[i].IsInRect(px, py) )
			{
				int nRealIndex = m_nPageIndex * PageSize + i;
				int nSize = m_ItemList.size();
				if ( nRealIndex < nSize )
				{
					MItem* p_item = m_ItemList[nRealIndex].pItem;
					if ( p_item )
						g_descriptor_manager.Set(DID_ITEM, x+m_slot_rect[i].x, y+m_slot_rect[i].y, (void *)p_item, 0, (int)0);
				}
			}
		}
		break;
	}

	return true;
}

void C_VS_UI_TMALL::KeyboardControl(UINT message, UINT key, long extra)
{
	Window::KeyboardControl(message, key, extra);
}

void C_VS_UI_TMALL::ToggleTMall()
{
	gpC_base->SendMessage(UI_REQUEST_TMALL_LIST, m_nClassIndex, 0,NULL);
}

void C_VS_UI_TMALL::ShowItemListIcon()
{
	int nSize = m_ItemList.size();

	int nStartIndex = m_nPageIndex * PageSize;
	int nEndIndex = nStartIndex + PageSize;

	for ( int i=nStartIndex; i<nEndIndex; i++ )
	{
		if ( i < nSize )
		{
			MItem* p_item = m_ItemList[i].pItem;
			if ( p_item )
			{
				int nFrameID = p_item->GetInventoryFrameID();
				int nFrameWidth = gpC_item->GetWidth(nFrameID);
				int nFrameHight = gpC_item->GetHeight(nFrameID);

				int nOffsetX = 30 - nFrameWidth * 0.5f;
				int nOffsetY = 45 - nFrameHight * 0.5f;

				int index = i - nStartIndex;
				gpC_item->BltLocked(m_slot_rect[index].x + nOffsetX , m_slot_rect[index].y + nOffsetY, nFrameID);
			}
		}
	}
}

void C_VS_UI_TMALL::ShowItemListText()
{
	int nSize = m_ItemList.size();

	int nStartIndex = m_nPageIndex * PageSize;
	int nEndIndex = nStartIndex + PageSize;

	for ( int i=nStartIndex; i<nEndIndex; i++ )
	{
		if ( i < nSize )
		{
            ItemList kItem = m_ItemList[i];
			MItem* p_item = kItem.pItem;
			if ( p_item )
			{
				int index = i - nStartIndex;
				gpC_base->m_info_pi.back_color = RGB_GRAY;

				char szText[MAX_PATH];

				sprintf(szText, "%s", p_item->GetName());
				g_PrintColorStr(m_slot_rect[index].x  + 64, m_slot_rect[index].y  + 14, szText, gpC_base->m_chatting_pi, RGB_WHITE);

				sprintf(szText, "鑒좆:%d", kItem.num);
				g_PrintColorStr(m_slot_rect[index].x  + 64, m_slot_rect[index].y  + 62, szText, gpC_base->m_chatting_pi, RGB_WHITE);

				if ( m_nClassIndex < 5 )
				{
					sprintf(szText, "듐얩:%d", kItem.nDianJuan);
					g_PrintColorStr(m_slot_rect[index].x  + 64 , m_slot_rect[index].y + 39, szText, gpC_base->m_chatting_pi, RGB_WHITE);
				}
				else
				{
					sprintf(szText, "생롸:%d", kItem.nPoint);
					g_PrintColorStr(m_slot_rect[index].x  + 64, m_slot_rect[index].y  + 39, szText, gpC_base->m_chatting_pi, RGB_WHITE);
				}

			}
		}
	}
}

void C_VS_UI_TMALL::Show()
{

	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_pC_TMall_spk->BltLocked(x, y, TMall_Background);	 //교쒼

		m_pC_TMall_spk->BltLocked(x+61, y+197, TMall_Background+1);		 //1-1   
		m_pC_TMall_spk->BltLocked(x+61+211+20, y+197, TMall_Background+1);	  //1-2
		m_pC_TMall_spk->BltLocked(x+61+211+20+211+20, y+197, TMall_Background+1);   //1-3

		m_pC_TMall_spk->BltLocked(x+61, y+197+107+8, TMall_Background+1);				//2-1
		m_pC_TMall_spk->BltLocked(x+61+211+20, y+197+107+8, TMall_Background+1);				 //2-2
		m_pC_TMall_spk->BltLocked(x+61+211+20+211+20, y+197+107+8, TMall_Background+1);			  //2-3

		m_pC_TMall_spk->BltLocked(x+61, y+197+107+8+107+8, TMall_Background+1);						   //3-1
		m_pC_TMall_spk->BltLocked(x+61+211+20, y+197+107+8+107+8, TMall_Background+1);						//3-2
		m_pC_TMall_spk->BltLocked(x+61+211+20+211+20, y+197+107+8+107+8, TMall_Background+1);					 //3-3

		ShowItemListIcon();

		m_pC_button_group->Show();

		gpC_base->m_p_DDSurface_back->Unlock();
	}



	g_FL2_GetDC();

	ShowItemListText();
	gpC_base->m_info_pi.back_color = RGB_GRAY;


	char sz_temp[50];
	wsprintf(sz_temp,"%d", g_pMoneyManager->GetDianJuan());
	g_PrintColorStr(x + 127, y + 598, sz_temp, gpC_base->m_chatting_pi, RGB_GOLD);

	wsprintf(sz_temp,"%d", g_pMoneyManager->GetJiFen());
	g_PrintColorStr(x + 260, y + 598, sz_temp, gpC_base->m_chatting_pi, RGB_GOLD);

	g_PrintColorStr(x + 61+211+20+30+17+10, y + 197+107+8+107+8+107+10, "  1    2     3", gpC_base->m_user_id_pi, RGB_WHITE);
	m_pC_button_group->ShowDescription();
	Window::ShowWidget();
	g_FL2_ReleaseDC();


}


void C_VS_UI_TMALL::Process()
{
	if ( m_pC_button_group )
		m_pC_button_group->Process();
}

void C_VS_UI_TMALL::Start()
{
	PI_Processor::Start();
	m_pC_button_group->Init();
	AttrPin(true);

	ClearItem();

	//m_attack_key.EraseAll();
	gpC_window_manager->AppearWindow(this);
}

void C_VS_UI_TMALL::Finish()
{
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BURST_WINDOW, Rect(x, y, w, h));
	//gpC_vs_ui_window_manager->SetBloodBurstHeight(!m_width_mode);
	PI_Processor::Finish();

	gpC_window_manager->DisappearWindow(this);
}

//-------------------------------------------------犬end------------------------------------------------------------------


C_VS_UI_GAMEHOOK::C_VS_UI_GAMEHOOK()
{
	m_pC_hook_button_spk = NULL;
	m_pC_hook_dialog_spk = NULL;

	AttrKeyboardControl(true);
	AttrTopmost(false);
	AttrPin(true);

	g_RegisterWindow(this);

	m_pC_hook_button_spk = new C_SPRITE_PACK("data\\ui\\spk\\new\\renewalfriend\\00000.spk");
	m_pC_hook_dialog_spk = new C_SPRITE_PACK("data\\ui\\spk\\new\\renewalfriend\\00016.spk");

	//Set(RESOLUTION_X-m_pC_minimap_spk->GetWidth(MINIMAP_MAIN)-m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), 0, m_pC_minimap_spk->GetWidth(MINIMAP_MAIN)+m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), m_pC_minimap_spk->GetHeight(MINIMAP_MAIN));

	Set(( g_pUserInformation->iResolution_x+m_pC_hook_dialog_spk->GetWidth(HOOK_DIALOG_BACKGROUND) ) / 2 - m_pC_hook_dialog_spk->GetWidth(HOOK_DIALOG_BACKGROUND),
		( g_pUserInformation->iResolution_y+m_pC_hook_dialog_spk->GetHeight(HOOK_DIALOG_BACKGROUND) ) / 2 - m_pC_hook_dialog_spk->GetHeight(HOOK_DIALOG_BACKGROUND),
		 m_pC_hook_dialog_spk->GetWidth(HOOK_DIALOG_BACKGROUND), 
		 m_pC_hook_dialog_spk->GetHeight(HOOK_DIALOG_BACKGROUND));

	//skillinfo 버튼
	m_pC_button_group = new ButtonGroup(this);


	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(
		332, 
		2, 
		m_pC_hook_button_spk->GetWidth(HOOK_BUTTON_CLOSE_NORMAL), 
		m_pC_hook_button_spk->GetHeight(HOOK_BUTTON_CLOSE_NORMAL), 
		CLOSE_HOOK, 
		this, 
		HOOK_BUTTON_CLOSE_NORMAL)
		);


	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(
		67, 
		391, 
		m_pC_hook_button_spk->GetWidth(HOOK_BUTTON_GREEN_NORMAL), 
		m_pC_hook_button_spk->GetHeight(HOOK_BUTTON_GREEN_NORMAL), 
		START_HOOK, 
		this, 
		HOOK_BUTTON_GREEN_NORMAL)
		);

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(
		202, 
		388, 
		m_pC_hook_button_spk->GetWidth(HOOK_BUTTON_RED_NORMAL), 
		m_pC_hook_button_spk->GetHeight(HOOK_BUTTON_RED_NORMAL), 
		STOP_HOOK, 
		this, 
		HOOK_BUTTON_RED_NORMAL)
		);



	AddLineEditor(m_lvKey[LV_ATTACK_KEY], 164, 82);


	AddLineEditor(m_lvKey[LV_HP_KEY], 118, 111);
	AddLineEditor(m_lvKey[LV_HP_PECENT], 188, 111);
	AddLineEditor(m_lvKey[LV_HP_TIME], 241, 112);

	AddLineEditor(m_lvKey[LV_MP_KEY], 118, 142);
	AddLineEditor(m_lvKey[LV_MP_PECENT], 187, 142);
	AddLineEditor(m_lvKey[LV_MP_TIME], 240, 142);

	AddLineEditor(m_lvKey[LV_BULLET_KEY], 199,  173);
	AddLineEditor(m_lvKey[LV_BULLET_TIME], 255,  172);

	AddLineEditor(m_lvKey[LV_EFFECT_KEY1], 176, 202);
	AddLineEditor(m_lvKey[LV_EFFECT_TIME1],  239, 202);

	AddLineEditor(m_lvKey[LV_EFFECT_KEY2],  177,  232);
	AddLineEditor(m_lvKey[LV_EFFECT_TIME2], 238,  232);

	AddLineEditor(m_lvKey[LV_EFFECT_KEY3],  177,  262);
	AddLineEditor(m_lvKey[LV_EFFECT_TIME3],  239, 261);

	AddLineEditor(m_lvKey[LV_EFFECT_KEY4], 177, 292);
	AddLineEditor(m_lvKey[LV_EFFECT_TIME4],  239,  292);

	AddLineEditor(m_lvKey[LV_EFFECT_KEY5], 178,  321);
	AddLineEditor(m_lvKey[LV_EFFECT_TIME5], 239,  321);

	AddLineEditor(m_lvKey[LV_EFFECT_KEY6], 178, 351);
	AddLineEditor(m_lvKey[LV_EFFECT_TIME6],  240,  351);

	for (int i=0; i<LV_MAX; i++)
	{
		m_lvKey[i].EraseAll();
	}
}

void C_VS_UI_GAMEHOOK::AddLineEditor(LineEditorVisual& kEditor, int nx, int ny)
{
	kEditor.SetPrintInfo(gpC_base->m_user_id_pi);
	kEditor.SetInputStringColor(RGB_GREEN);
	kEditor.SetPosition(x + nx,y + ny);
	kEditor.SetFontSize(12, 13);
	kEditor.SetByteLimit(5);//by viva
	Attach(&kEditor);
}

C_VS_UI_GAMEHOOK::~C_VS_UI_GAMEHOOK()
{
	DeleteNew(m_pC_hook_button_spk);
	DeleteNew(m_pC_hook_dialog_spk);
	DeleteNew(m_pC_button_group);
}


bool	C_VS_UI_GAMEHOOK::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	return IsInRect(_x, _y);
}

void C_VS_UI_GAMEHOOK::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{

	m_pC_hook_button_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);


	if(p_button->GetFocusState())
	{
		if (p_button->GetPressState()) // push state
		{
			m_pC_hook_button_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index + 1);
		}
		else
		{
			m_pC_hook_button_spk->BltLockedAlpha(x + p_button->x, y + p_button->y, p_button->m_image_index, p_button->m_alpha);
		}
	}

}

void C_VS_UI_GAMEHOOK::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{

}

bool C_VS_UI_GAMEHOOK::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;

	bool re;

	re = m_pC_button_group->MouseControl(message, _x, _y);

	for (int i=0; i<LV_MAX; i++)
	{
		m_lvKey[i].MouseControl(message, _x+x, _y+y);
	}

	return re;
}

void C_VS_UI_GAMEHOOK::KeyboardControl(UINT message, UINT key, long extra)
{
	Window::KeyboardControl(message, key, extra);
}

void C_VS_UI_GAMEHOOK::Run(id_t id)
{
	switch( id )
	{
	case START_HOOK:

		break;

	case STOP_HOOK:
		break;

	case CLOSE_HOOK:
		gC_vs_ui.CloseGameHook();
		break;
	}
}

void C_VS_UI_GAMEHOOK::Show()
{

	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_pC_hook_dialog_spk->BltLockedAlpha(x, y, HOOK_DIALOG_BACKGROUND, 25);

		m_pC_button_group->Show();

		gpC_base->m_p_DDSurface_back->Unlock();
	}


	DrawRect(163, 81, 187, 93);

	DrawRect(117, 110, 137, 122);
	DrawRect(187, 110, 207, 122);
	DrawRect(240, 111, 261, 123);

	DrawRect(117, 141, 137, 153);
	DrawRect(186, 141, 207, 153);
	DrawRect(239, 141, 261, 153);

	DrawRect(198, 172, 219, 184);
	DrawRect(254, 171, 274, 183);

	DrawRect(175, 201, 196, 213);
	DrawRect(238, 201, 258, 212);

	DrawRect(176, 231, 197, 243);
	DrawRect(237, 231, 258, 242);

	DrawRect(176, 261, 197, 273);
	DrawRect(238, 260, 258, 272);

	DrawRect(176, 291, 197, 303);
	DrawRect(238, 291, 258, 303);

	DrawRect(177, 320, 197, 333);
	DrawRect(238, 320, 257, 333);

	DrawRect(177, 350, 197, 363);
	DrawRect(239, 350, 258, 363);



	g_FL2_GetDC();

	int TextY = 30;
	int TextYOffSet = 80;

	gpC_base->m_info_pi.back_color = RGB_GRAY;

	g_PrintColorStr(x+130, y + 10 , "菱 땡 밈 샙", gpC_base->m_info_pi, RGB_WHITE);

	g_PrintColorStr(x+55, y + TextYOffSet , "묑샌세콘우쌥숩", gpC_base->m_info_pi, RGB_WHITE);
	g_PrintColorStr(x+55, y + TextYOffSet + TextY*1, "뎠HP됴黨   %珂,객   儺珂   취", gpC_base->m_info_pi, RGB_WHITE);
	g_PrintColorStr(x+55, y + TextYOffSet + TextY*2, "뎠HP됴黨   %珂,객   儺珂   취", gpC_base->m_info_pi, RGB_WHITE);
	g_PrintColorStr(x+55, y + TextYOffSet + TextY*3, "뎠綾뎐鑒됴黨10몸,객   儺珂   취（훙잚）", gpC_base->m_info_pi, RGB_WHITE);
	g_PrintColorStr(x+55, y + TextYOffSet + TextY*4, "菱땡속榴檄우쌥숩   ,儺珂   취", gpC_base->m_info_pi, RGB_WHITE);
	g_PrintColorStr(x+55, y + TextYOffSet + TextY*5, "菱땡속榴檄우쌥숩   ,儺珂   취", gpC_base->m_info_pi, RGB_WHITE);
	g_PrintColorStr(x+55, y + TextYOffSet + TextY*6, "菱땡속榴檄우쌥숩   ,儺珂   취", gpC_base->m_info_pi, RGB_WHITE);
	g_PrintColorStr(x+55, y + TextYOffSet + TextY*7, "菱땡속榴檄우쌥숩   ,儺珂   취", gpC_base->m_info_pi, RGB_WHITE);
	g_PrintColorStr(x+55, y + TextYOffSet + TextY*8, "菱땡속榴檄우쌥숩   ,儺珂   취", gpC_base->m_info_pi, RGB_WHITE);
	g_PrintColorStr(x+55, y + TextYOffSet + TextY*9, "菱땡속榴檄우쌥숩   ,儺珂   취", gpC_base->m_info_pi, RGB_WHITE);

	m_pC_button_group->ShowDescription();
	Window::ShowWidget();
	g_FL2_ReleaseDC();

	
}

void C_VS_UI_GAMEHOOK::DrawRect(int left, int top, int right, int bottom)
{
	RECT rc;
	rc.left = x + left;
	rc.top = y + top;
	rc.right = x + right;
	rc.bottom = y + bottom;
	gpC_base->m_p_DDSurface_back->DrawRect(&rc, DARKGRAY);
}

void C_VS_UI_GAMEHOOK::Process()
{
	if ( m_pC_button_group )
		m_pC_button_group->Process();
}

void C_VS_UI_GAMEHOOK::Start()
{
	PI_Processor::Start();
	m_pC_button_group->Init();
	
	
	m_lvKey[LV_ATTACK_KEY].Acquire();

	//m_attack_key.EraseAll();
	gpC_window_manager->AppearWindow(this);
}

void C_VS_UI_GAMEHOOK::Finish()
{
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BURST_WINDOW, Rect(x, y, w, h));
	//gpC_vs_ui_window_manager->SetBloodBurstHeight(!m_width_mode);
	PI_Processor::Finish();

	gpC_window_manager->DisappearWindow(this);
}
//--------------------------------------------------------념令삶땡start-------------------------------------------------------------

C_VS_UI_PAYEVENT::C_VS_UI_PAYEVENT()
{
	m_pC_PayEvent_spk = NULL;
	m_pC_dialog_buy_confirm = NULL;

	AttrKeyboardControl(true);
	AttrTopmost(false);
	AttrPin(true);

	g_RegisterWindow(this);

	m_pC_PayEvent_spk = new C_SPRITE_PACK(_ROOT"spk\\pay.spk");
	m_pC_Give_item_spk =  new C_SPRITE_PACK(SPK_ITEM);


	Set(( g_pUserInformation->iResolution_x+m_pC_PayEvent_spk->GetWidth(PAYEVENT_Background) ) / 2 - m_pC_PayEvent_spk->GetWidth(PAYEVENT_Background),
		( g_pUserInformation->iResolution_y+m_pC_PayEvent_spk->GetHeight(PAYEVENT_Background) ) / 2 - m_pC_PayEvent_spk->GetHeight(PAYEVENT_Background),
		m_pC_PayEvent_spk->GetWidth(PAYEVENT_Background), 
		m_pC_PayEvent_spk->GetHeight(PAYEVENT_Background));

	//skillinfo 버튼
	m_pC_button_group = new ButtonGroup(this);

	m_nLineIndex = 0;

	//4몸쥴혤객큐
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(584,106,
		m_pC_PayEvent_spk->GetWidth(PAYEVENT_GetItem), 
		m_pC_PayEvent_spk->GetHeight(PAYEVENT_GetItem), 
		Button_0, this, PAYEVENT_UnFinished));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(584,226,
		m_pC_PayEvent_spk->GetWidth(PAYEVENT_GetItem), 
		m_pC_PayEvent_spk->GetHeight(PAYEVENT_GetItem), 
		Button_1, this, PAYEVENT_UnFinished));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(584,346,
		m_pC_PayEvent_spk->GetWidth(PAYEVENT_GetItem), 
		m_pC_PayEvent_spk->GetHeight(PAYEVENT_GetItem), 
		Button_2, this, PAYEVENT_UnFinished));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(584,467,
		m_pC_PayEvent_spk->GetWidth(PAYEVENT_GetItem), 
		m_pC_PayEvent_spk->GetHeight(PAYEVENT_GetItem), 
		Button_3, this, PAYEVENT_UnFinished));

	ZeroMemory(&m_arrPriceLvData, sizeof(PriceLevelData)*LEVEL_MAX);

	/*for (int i=0; i<4; i++)
	{
		m_slot_rect[i].x += 14;
		m_slot_rect[i].y += 10;
	}*/

	m_ptPrice[0].x = 92;
	m_ptPrice[0].y = 142;
	m_ptPrice[1].x = 93;
	m_ptPrice[1].y = 259;
	m_ptPrice[2].x = 87;
	m_ptPrice[2].y = 380;
	m_ptPrice[3].x = 87;
	m_ptPrice[3].y = 497;

	m_ptCountMax[0].x = 609;
	m_ptCountMax[0].y = 153;

	m_ptCountMax[1].x = 611;
	m_ptCountMax[1].y = 271;

	m_ptCountMax[2].x = 608;
	m_ptCountMax[2].y = 392;

	m_ptCountMax[3].x = 609;
	m_ptCountMax[3].y = 514;

	m_PriceMax[LEVEL_20] = 10;
	m_PriceMax[LEVEL_50] = 1;
	m_PriceMax[LEVEL_100] = 10;
	m_PriceMax[LEVEL_200] = 1;

	m_PriceMax[LEVEL_500] = 10;
	m_PriceMax[LEVEL_1000] = 1;
	m_PriceMax[LEVEL_2000] = 1;
	m_PriceMax[LEVEL_5000] = 1;



	m_strPrice[LEVEL_20] = "20禱";
	m_strPrice[LEVEL_50] = "50禱";
	m_strPrice[LEVEL_100] = "100禱";
	m_strPrice[LEVEL_200] = "200禱";

	m_strPrice[LEVEL_500] = "500禱";
	m_strPrice[LEVEL_1000] = "1000禱";
	m_strPrice[LEVEL_2000] = "2000禱";
	m_strPrice[LEVEL_5000] = "5000禱";

	m_slot_rect[0].Set(x+190, y+77, 110, 110);
	m_slot_rect[1].Set(x+316, y+77, 110, 110);
	m_slot_rect[2].Set(x+441, y+77, 110, 110);

	m_slot_rect[3].Set(x+190, y+197, 110, 110);
	m_slot_rect[4].Set(x+316, y+197, 110, 110);
	m_slot_rect[5].Set(x+441, y+197, 110, 110);

	m_slot_rect[6].Set(x+190, y+318, 110, 110);
	m_slot_rect[7].Set(x+316, y+318, 110, 110);
	m_slot_rect[8].Set(x+441, y+318, 110, 110);

	m_slot_rect[9].Set(x+190, y+438, 110, 110);
	m_slot_rect[10].Set(x+316, y+438, 110, 110);
	m_slot_rect[11].Set(x+441, y+438, 110, 110);

	//숫庫객큐
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(639+70, 72, 
		m_pC_PayEvent_spk->GetWidth(PAYEVENT_Up), 
		m_pC_PayEvent_spk->GetHeight(PAYEVENT_Up), 
		Button_Up, this, PAYEVENT_Up));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(639+70, 530+3,
		m_pC_PayEvent_spk->GetWidth(PAYEVENT_Down), 
		m_pC_PayEvent_spk->GetHeight(PAYEVENT_Down), 
		Button_Down, this, PAYEVENT_Down));

	//밑균객큐
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(639+70, 4, 
		m_pC_PayEvent_spk->GetWidth(PAYEVENT_Close), 
		m_pC_PayEvent_spk->GetHeight(PAYEVENT_Close), 
		Button_Close, this, PAYEVENT_Close));

}


C_VS_UI_PAYEVENT::~C_VS_UI_PAYEVENT()
{
	DeleteNew(m_pC_PayEvent_spk);
	DeleteNew(m_pC_button_group);

	for ( int i = 0; i<LEVEL_MAX; i++ )
	{
		for ( int j=0; j<3; j++ )
		{
			if ( m_arrPriceLvData[i].itemData[j].pItem != NULL )
				DeleteNew(m_arrPriceLvData[i].itemData[j].pItem);
		}
	}
}


bool	C_VS_UI_PAYEVENT::IsPixel(int _x, int _y)
{
	if(Moving()) return true;
	return IsInRect(_x, _y);
}

void    C_VS_UI_PAYEVENT::SetCount(int nLevel, int nCount)
{
	m_arrPriceLvData[nLevel].nCount = nCount;
}

void    C_VS_UI_PAYEVENT::SetStautus(int nLevel, int nStautus)
{
	m_arrPriceLvData[nLevel].nStautus = nStautus;
}

bool	C_VS_UI_PAYEVENT::AddItem(  C_VS_UI_PAYEVENT::ItemData pItem )
{
  //侶쟁역迦瘻뻣
    int nLevel = pItem.nLevel;
	for ( int i=0; i<3; i++ )
	{
		if ( m_arrPriceLvData[nLevel].itemData[i].pItem == NULL )
		{
				m_arrPriceLvData[nLevel].itemData[i] = pItem;
				break;
		}
	}

	return true;
}


void ExecF_Buy_PAYEVENT(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	switch( id )
	{
	case DIALOG_EXECID_OK:
		gpC_base->SendMessage(UI_BUY_TMALL_ITEM, p_this_dialog->GetTempValue2(), p_this_dialog->GetTempValue(),NULL);
		break;


	case DIALOG_CANCEL:
		break;

	}
}



void C_VS_UI_PAYEVENT::OnGetPrice(int nIndex)
{
	
}


void ExecF_UI_PAY_GET_ITEM(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	gpC_base->SendMessage(UI_PAY_GET_ITEM,p_this_dialog->GetTempValue(), 0,NULL);
}


void C_VS_UI_PAYEVENT::Run(id_t id)
{
	switch( id )
	{
	case Button_Up:
		m_nLineIndex -= 1;
		if ( m_nLineIndex < 0 )
			m_nLineIndex = 0;
		break;

	case Button_Down:
		m_nLineIndex += 1;
		if ( m_nLineIndex > LEVEL_MAX/2 )
			m_nLineIndex = LEVEL_MAX/2;
		break;

	case Button_Close:
		gC_vs_ui.ClosePayEvent();
		break;

	case Button_0:
	case Button_1:
	case Button_2:
	case Button_3:
		{
			int nRealLine = m_nLineIndex + id;
			int nCount = m_arrPriceLvData[nRealLine].nCount;
			int nStautus = m_arrPriceLvData[nRealLine].nStautus;

			if (nCount < 10 &&  nStautus > 0)
			{
				DeleteNew( m_pC_dialog_buy_confirm );
				m_pC_dialog_buy_confirm = new C_VS_UI_DIALOG(x + 200,y + 200, 2, 0, ExecF_UI_PAY_GET_ITEM, DIALOG_OK);
				char * pp_dmsg[1] = 
				{
					"헝돕뭔膠났코瓊혤膠틔!",
				};

				m_pC_dialog_buy_confirm->SetTempValue( m_nLineIndex + id );
				m_pC_dialog_buy_confirm->SetMessage( pp_dmsg, 1, SMO_NOFIT );
				m_pC_dialog_buy_confirm->Start();
			}
		}
		//CGGetPayItem 꽝鑒moneyID
		break;



	}
}

void C_VS_UI_PAYEVENT::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if ( !p_button )
		return;

	switch( p_button->GetID())
	{
	case Button_Up:
	case Button_Down:
	case Button_Close:
		if (p_button->GetPressState()) // push state
		{
			m_pC_PayEvent_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index+1);
		}
		else
		{
			m_pC_PayEvent_spk->BltLocked(x + p_button->x, y + p_button->y, p_button->m_image_index);
		}
		break;

	case Button_0:
	case Button_1:
	case Button_2:
	case Button_3:
		{
			int nRealLine = m_nLineIndex + p_button->GetID();
			int nCount = m_arrPriceLvData[nRealLine].nCount;
			int nStautus = m_arrPriceLvData[nRealLine].nStautus;
			int nMaxCount = m_PriceMax[nRealLine];

			if ( nCount == nMaxCount )
			{
				m_pC_PayEvent_spk->BltLocked(x + p_button->x, y + p_button->y, PAYEVENT_SPK::PAYEVENT_Finished);;//綠供냥객큐
			}
			else if (nCount < 10 &&  nStautus > 0)
			{
				if (p_button->GetPressState()) // push state
				{
					m_pC_PayEvent_spk->BltLocked(x + p_button->x, y + p_button->y, PAYEVENT_SPK::PAYEVENT_GetItemDown);
				}
				else
				{
					m_pC_PayEvent_spk->BltLocked(x + p_button->x, y + p_button->y, PAYEVENT_SPK::PAYEVENT_GetItem);
				}
			}	
			else if ( nCount < 10 && nStautus == 0 )
			{
				m_pC_PayEvent_spk->BltLocked(x + p_button->x, y + p_button->y, PAYEVENT_SPK::PAYEVENT_UnFinished);;//灌供냥객큐
			}
			else
			{
				m_pC_PayEvent_spk->BltLocked(x + p_button->x, y + p_button->y, PAYEVENT_SPK::PAYEVENT_UnFinished);;//灌供냥객큐
			}
				
		}
		break;
	}

}

void C_VS_UI_PAYEVENT::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{

}

bool C_VS_UI_PAYEVENT::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;

	bool re = m_pC_button_group->MouseControl(message, _x, _y);

	int px = _x + x;
	int py = _y + y;
	char buff[256];

	switch(message)
	{
	case M_MOVING:
		for (int i=0; i<12; i++)
		{
			if ( m_slot_rect[i].IsInRect(px, py) )
			{
				int nRealLine = m_nLineIndex + i/3;
				int nItemIndex = i % 3;

				MItem* p_item = m_arrPriceLvData[nRealLine].itemData[nItemIndex].pItem;

				if ( p_item != NULL )
				{
					if ( p_item )
						g_descriptor_manager.Set(DID_ITEM, x+m_slot_rect[i].x, y+m_slot_rect[i].y, (void *)p_item, 0, (int)0);
				}
			}
		}
		break;

		case M_WHEEL_UP:
			m_nLineIndex -= 1;
			if ( m_nLineIndex < 0 )
				m_nLineIndex = 0;
			break;

		case M_WHEEL_DOWN:
			m_nLineIndex += 1;
			if ( m_nLineIndex > LEVEL_MAX / 2 )
				m_nLineIndex = LEVEL_MAX / 2;
			break;
	}

	return true;
}

void C_VS_UI_PAYEVENT::KeyboardControl(UINT message, UINT key, long extra)
{
	Window::KeyboardControl(message, key, extra);
}

void C_VS_UI_PAYEVENT::ShowItemListIcon()
{
	for (int i=0; i<12; i++)
	{
		int nRealLine = m_nLineIndex + i/3;
		int nItemIndex = i % 3;

		if ( m_arrPriceLvData[nRealLine].itemData[nItemIndex].pItem != NULL )
		{
			m_pC_PayEvent_spk->BltLocked(m_slot_rect[i].x-1 , m_slot_rect[i].y-1, PAYEVENT_ItemGridFrame);
			int nImageID = m_arrPriceLvData[nRealLine].itemData[nItemIndex].ImagID;

			//DrawImageID
			m_pC_Give_item_spk->BltLocked(m_slot_rect[i].x , m_slot_rect[i].y, nImageID);
		}

	}
}

void C_VS_UI_PAYEVENT::ShowItemListText()
{
	char buff[256];

	for (int i=0; i<12; i++)
	{
		int nRealLine = m_nLineIndex + i/3;
		int nItemIndex = i % 3;

		if ( m_arrPriceLvData[nRealLine].itemData[nItemIndex].pItem != NULL )
		{
			int nNum = m_arrPriceLvData[nRealLine].itemData[nItemIndex].num;

			sprintf(buff, "%d", nNum);
			g_PrintColorStr( m_slot_rect[i].x + 90, m_slot_rect[i].y + 93, buff, gpC_base->m_char_chat_large_pi, RGB_GOLD);
		}
	}
}

void C_VS_UI_PAYEVENT::Show()
{

	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_pC_PayEvent_spk->BltLocked(x, y, PAYEVENT_Background);	 //교쒼
		m_pC_PayEvent_spk->BltLocked(x +20, y +72,PAYEVENT_GridBackgound);
		m_pC_PayEvent_spk->BltLocked(x +20, y +119+72+2,PAYEVENT_GridBackgound);
		m_pC_PayEvent_spk->BltLocked(x +20, y +119+72+2+119+2,PAYEVENT_GridBackgound);
		m_pC_PayEvent_spk->BltLocked(x +20, y +119+72+2+119+2+119+2,PAYEVENT_GridBackgound);


		//for (int i=0; i<12; i++)
		//{
		//	int nRealLine = m_nLineIndex + i/3;
		//	int nItemkPos = i % 3;

		//	ItemData data = m_arrPriceLvData[nRealLine].itemData[nItemkPos];
		//	if ( data.pItem != NULL )
		//		m_pC_PayEvent_spk->BltLocked(m_slot_rect[i].x, m_slot_rect[i].y,PAYEVENT_ItemGridFrame);
		//}

		ShowItemListIcon();

		m_pC_button_group->Show();

		gpC_base->m_p_DDSurface_back->Unlock();
	}



	g_FL2_GetDC();

	ShowItemListText();
	gpC_base->m_info_pi.back_color = RGB_GRAY;


	char buff[256];
	for (int i=0; i<4; i++)
	{
		sprintf(buff, "%d/%d", m_arrPriceLvData[m_nLineIndex + i].nCount, m_PriceMax[m_nLineIndex + i]);
		g_PrintColorStr(x + m_ptCountMax[i].x, y + m_ptCountMax[i].y, buff, gpC_base->m_char_chat_large_pi, RGB_RED);
		g_PrintColorStr(x + m_ptPrice[i].x, y + m_ptPrice[i].y, m_strPrice[m_nLineIndex+i].c_str(), gpC_base->m_char_chat_large_pi, RGB_WHITE);
	}
	
	std::string strTotleChongzhi = "작셕념令댐돕";
	g_PrintColorStr(x + 55, y + 119-3, strTotleChongzhi.c_str(), gpC_base->m_char_chat_large_pi, RGB_WHITE);
	g_PrintColorStr(x + 55, y + 236-3, strTotleChongzhi.c_str(), gpC_base->m_char_chat_large_pi, RGB_WHITE);
	g_PrintColorStr(x + 55, y + 357-3, strTotleChongzhi.c_str(), gpC_base->m_char_chat_large_pi, RGB_WHITE);
	g_PrintColorStr(x + 55, y + 474-3, strTotleChongzhi.c_str(), gpC_base->m_char_chat_large_pi, RGB_WHITE);

	m_pC_button_group->ShowDescription();
	Window::ShowWidget();
	g_FL2_ReleaseDC();


}


void C_VS_UI_PAYEVENT::Process()
{
	if ( m_pC_button_group )
		m_pC_button_group->Process();
}

void C_VS_UI_PAYEVENT::Start()
{

	for ( int i = 0; i<LEVEL_MAX; i++ )
	{
		for ( int j=0; j<3; j++ )
		{
			if ( m_arrPriceLvData[i].itemData[j].pItem != NULL )
				DeleteNew(m_arrPriceLvData[i].itemData[j].pItem);
		}
	}

	ZeroMemory(&m_arrPriceLvData, sizeof(PriceLevelData)*LEVEL_MAX);

	PI_Processor::Start();
	m_pC_button_group->Init();
	AttrPin(true);

	//m_attack_key.EraseAll();
	gpC_window_manager->AppearWindow(this);
}

void C_VS_UI_PAYEVENT::Finish()
{
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BURST_WINDOW, Rect(x, y, w, h));
	//gpC_vs_ui_window_manager->SetBloodBurstHeight(!m_width_mode);
	PI_Processor::Finish();

	gpC_window_manager->DisappearWindow(this);
}

//-------------------------------------------------념令삶땡end------------------------------------------------------------------
//
//-----------------------------------------------------------------------------
// C_VS_UI_MINIMAP
//
//-----------------------------------------------------------------------------
C_VS_UI_MINIMAP::C_VS_UI_MINIMAP()
{
#if __CONTENTS(__GPS_ADD)	
	gwMiniMapCount++;
#endif //__GPS_ADD

	m_pC_minimap_spk = NULL;
	AttrTopmost(false);
	AttrPin(true);
	
	g_RegisterWindow(this);
	
	switch( g_eRaceInterface )
	{
	case RACE_SLAYER:
		m_pC_minimap_spk = new C_SPRITE_PACK(SPK_MINIMAP_SLAYER);
		break;

	case RACE_VAMPIRE:
		m_pC_minimap_spk = new C_SPRITE_PACK(SPK_MINIMAP_VAMPIRE);
		break;

	case RACE_OUSTERS:
		m_pC_minimap_spk = new C_SPRITE_PACK(SPK_MINIMAP_OUSTERS);
	}

	//Set(RESOLUTION_X-m_pC_minimap_spk->GetWidth(MINIMAP_MAIN)-m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), 0, m_pC_minimap_spk->GetWidth(MINIMAP_MAIN)+m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), m_pC_minimap_spk->GetHeight(MINIMAP_MAIN));
	
	Set(g_pUserInformation->iResolution_x-m_pC_minimap_spk->GetWidth(MINIMAP_MAIN)-m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), 0, m_pC_minimap_spk->GetWidth(MINIMAP_MAIN)+m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), m_pC_minimap_spk->GetHeight(MINIMAP_MAIN));

	//skillinfo 버튼
	m_pC_button_group = new ButtonGroup(this);
	
	int alpha_button_offset_x, alpha_button_offset_y;
	int pushpin_button_offset_x, pushpin_button_offset_y;

	alpha_button_offset_x = 7; alpha_button_offset_y = 36;
	pushpin_button_offset_x = 23; pushpin_button_offset_y = 36;

#if __CONTENTS(__080405_FIREST_UI_UPDATE)
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_button_offset_x, 
													alpha_button_offset_y, 
													gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD), 
													gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD), 
													ALPHA_ID, 
													this, 
													C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD)
													);
#else
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_button_offset_x, 
													alpha_button_offset_y, 
													gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), 
													gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), 
													ALPHA_ID, 
													this, 
													C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA)
													);
#endif //__080405_FIREST_UI_UPDATE


	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(pushpin_button_offset_x - 22, 
													pushpin_button_offset_y + 20, 
													gpC_global_resource->m_Tmall_spk->GetWidth(C_VS_UI_TMALL::TMall_BtnShangChenNormal), 
													gpC_global_resource->m_Tmall_spk->GetHeight(C_VS_UI_TMALL::TMall_BtnShangChenNormal), 
													HOOK_ID, 
													this, 
													C_VS_UI_TMALL::TMall_BtnShangChenNormal)
													);
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(pushpin_button_offset_x - 22, 
		pushpin_button_offset_y + 60, 
		gpC_global_resource->m_Tmall_spk->GetWidth(C_VS_UI_PAYEVENT::PAYEVENT_ICON), 
		gpC_global_resource->m_Tmall_spk->GetHeight(C_VS_UI_PAYEVENT::PAYEVENT_ICON), 
		PAYEVENT_ID, 
		this, 
		C_VS_UI_PAYEVENT::PAYEVENT_ICON)
		);


	//Add By Hays
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(pushpin_button_offset_x, 
													pushpin_button_offset_y, 
													gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), 
													gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), 
													PUSHPIN_ID, 
													this, 
													C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN)
													);

#if __CONTENTS(__GPS_ADD)
/*	int	gps_button_offset_x, gps_button_offset_y;
	gps_button_offset_x	= 7, gps_button_offset_y = 28+m_pC_minimap_spk->GetHeight(MINIMAP_BOARD)+1;
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(gps_button_offset_x, gps_button_offset_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_GPSVIEW), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_GPSVIEW), GPSVIEW_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_GPSVIEW));
*/	//GPS 버튼 부분
#endif //__GPS_ADD
	
	m_zone_id = -1;

//	m_bWindowEvent	= false;

	m_map_x = 0; m_map_y = 0;
	m_map_w = 0; m_map_h = 0;
	m_map_start_point.x = 4;
	m_map_start_point.y = 29;

	m_bl_refresh = false;
	
	// TIMER
	m_dw_minimap_prev_tickcount = GetTickCount();
	m_dw_minimap_millisec = 100;
	
	m_p_minimap_surface = new CSpriteSurface;
	
	m_p_minimap_surface->InitOffsurface(200, 100, DDSCAPS_SYSTEMMEMORY);
	m_p_minimap_surface->SetTransparency(0xffff);
	
	m_surface_w = 200;
	m_surface_w = 100;
	m_Block.clear();
	m_Flag.clear();

#if __CONTENTS(__GPS_ADD)
	if(x+w/2 < g_pUserInformation->iResolution_x/2)
		m_board_x = w-4;
	else
		m_board_x = -m_pC_minimap_spk->GetWidth(MINIMAP_BOARD)+4;
			//if(y+h/2 < RESOLUTION_Y/2)
	if(y+h/2 < g_pUserInformation->iResolution_y/2)
		m_board_y = 0;
	else
		m_board_y = h - m_pC_minimap_spk->GetHeight(MINIMAP_BOARD);

//	if(x+w/2 < g_pUserInformation->iResolution_x/2)
//		m_GPSBoard_X = w-4;
//	else
//		m_GPSBoard_X = -m_pC_minimap_spk->GetWidth(MINIMAP_GPSBTN_BOARD)+4;
//			//if(y+h/2 < RESOLUTION_Y/2)

//	if(y+h/2 < g_pUserInformation->iResolution_y/2)
//		m_GPSBoard_Y = m_board_y + m_pC_minimap_spk->GetHeight(MINIMAP_GPSBTN_BOARD)+1;
//	else
//		m_GPSBoard_Y = m_board_y + h - m_pC_minimap_spk->GetHeight(MINIMAP_GPSBTN_BOARD)+1;
//	//GPS 버튼 부분
	if(gpC_Gps != NULL)
	{
		delete gpC_Gps;
	}
	gpC_Gps	= NULL;

	gpC_Gps	= new C_VS_UI_GPS;
#else
	if(x+w/2 < g_pUserInformation->iResolution_x/2)
		m_board_x = w-4;
	else
		m_board_x = -m_pC_minimap_spk->GetWidth(MINIMAP_BOARD)+4;
	//if(y+h/2 < RESOLUTION_Y/2)
	if(y+h/2 < g_pUserInformation->iResolution_y/2)
		m_board_y = 0;
	else
		m_board_y = h - m_pC_minimap_spk->GetHeight(MINIMAP_BOARD);
#endif //__GPS_ADD

	
#ifndef _LIB
	m_map_w = 256;
	m_map_h = 256;
	SetZone(11);
	RECT rect = {110,110,140,150};
	SetSafetyZone(rect, true);
	SetRect(&rect, 10, 10, 30, 30);
	SetPortal(rect, 1001);
	MINIMAP_NPC npc;//{20, 50, 157};
	npc.x=20;
	npc.y=50;
	npc.id=157;
	npc.name = "sonee";
	SetNPC(npc);
#endif
	
}

//-----------------------------------------------------------------------------
// ~C_VS_UI_MINIMAP
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_MINIMAP::~C_VS_UI_MINIMAP()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::MINIMAP, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::MINIMAP, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::MINIMAP, Rect(x, y, w, h));
	m_bWindowEvent	= false;

	g_UnregisterWindow(this);
	
	if(m_p_minimap_surface != NULL)
	{
		DeleteNew(m_p_minimap_surface);
		m_p_minimap_surface = NULL;
	}
	DeleteNew(m_pC_minimap_spk);
	DeleteNew(m_pC_button_group);

#if __CONTENTS(__GPS_ADD)	

	if(gpC_Gps != NULL)
	{
		delete gpC_Gps;
	}
	gpC_Gps = NULL;

#endif //__GPS_ADD
}

//-----------------------------------------------------------------------------
// C_VS_UI_MINIMAP::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_MINIMAP::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	// 2006.08.22 sjheon
	if( m_bMiniMapDisableZone )
		return ; 

	const static char* m_minimap_button_string[7] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_ON].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_OFF].GetString(),
//#if __CONTENTS(__GPS_ADD)  侶쟁鬧姦딜，GPS혼뇜 侶쟁꼇鬧姦돨뺐삔괵。2011/7/24  By Hays
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GPS_VIEW].GetString(),
//#endif //__GPS_ADD
		"룩욺조掉犬",
		"념令삶땡",
	};

//	if(GetAttributes()->alpha && p_button->GetID() == ALPHA_ID)
//		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_minimap_button_string[2],0,0);
	if(GetAttributes()->autohide && p_button->GetID() == PUSHPIN_ID)
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_minimap_button_string[3],0,0);
	else if ( p_button->GetID() == HOOK_ID )
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_minimap_button_string[5],0,0);
	else if (p_button->GetID() == PAYEVENT_ID)
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_minimap_button_string[6],0,0);
	else
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_minimap_button_string[p_button->GetID()],0,0);
#if __CONTENTS(__GPS_ADD)
/*
	if(GetAttributes()->gpsview && p_button->GetID() == GPSVIEW_ID)
	{
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y+m_GPSBoard_Y, (void *)m_minimap_button_string[4],0,0);
	}
*/	//GPS 버튼 부분
#endif //__GPS_ADD
}

//-----------------------------------------------------------------------------
// C_VS_UI_MINIMAP::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_MINIMAP::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{	
	// 2006.08.22 sjheon
	static bool bGpsActive		= false;
	static bool bGpsNonActive	= true;

	if( m_bMiniMapDisableZone ) 
		return ; 

	if(p_button->GetID() == ALPHA_ID)
	{
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x+m_board_x, p_button->y+y+m_board_y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x+m_board_x, p_button->y+y+m_board_y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED_OLD);
	#else
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x+m_board_x, p_button->y+y+m_board_y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x+m_board_x, p_button->y+y+m_board_y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED);
	#endif //__080405_FIREST_UI_UPDATE
	}
	else if(p_button->GetID() == PUSHPIN_ID)
	{
		if(GetAttributes()->autohide)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x+m_board_x, p_button->y+y+m_board_y, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x+m_board_x, p_button->y+y+m_board_y, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN_PUSHED);
	}

	if ( p_button->GetID() == HOOK_ID )
	{
		if ( p_button->GetPressState() )
			gpC_global_resource->m_Tmall_spk->BltLocked(p_button->x+x+m_board_x, p_button->y+y+m_board_y, p_button->m_image_index+1);
		else
			gpC_global_resource->m_Tmall_spk->BltLocked(p_button->x+x+m_board_x, p_button->y+y+m_board_y, p_button->m_image_index);
	}
	if ( p_button->GetID() == PAYEVENT_ID )
	{
		if ( p_button->GetPressState() )
			gpC_global_resource->m_PayEvent_spk->BltLocked(p_button->x+x+m_board_x, p_button->y+y+m_board_y, p_button->m_image_index+1);
		else
			gpC_global_resource->m_PayEvent_spk->BltLocked(p_button->x+x+m_board_x, p_button->y+y+m_board_y, p_button->m_image_index);
	}
/*
#if __CONTENTS(__GPS_ADD)
	else if(p_button->GetID()	== GPSVIEW_ID)
	{
		if(GetAttributes()->gpsview)
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x+m_GPSBoard_X, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_GPSVIEW);
			if(bGpsActive)
			{
				gpC_Gps->NonActive();
				bGpsActive		= false;
				bGpsNonActive	= true;
			}
		}
		else
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x+m_GPSBoard_X, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_GPSVIEW_PUSHED);
			if(bGpsNonActive)
			{
				gpC_Gps->Active();
				bGpsNonActive	= false;
				bGpsActive		= true;
			}
		}
	}
#endif // __GPS_ADD
*/
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_MINIMAP::WindowEventReceiver(id_t event)
{
	// 2006.08.22 sjheon
	if( m_bMiniMapDisableZone ) 
		return ;  

	switch(event)
	{
	case EVENT_WINDOW_MOVE: 
		{

			m_bWindowEvent	= true;
			//if(x+w/2 < RESOLUTION_X/2)
			if(x+w/2 < g_pUserInformation->iResolution_x/2)
				m_board_x = w-4;
			else
				m_board_x = -m_pC_minimap_spk->GetWidth(MINIMAP_BOARD)+4;
			//if(y+h/2 < RESOLUTION_Y/2)
			if(y+h/2 < g_pUserInformation->iResolution_y/2)
				m_board_y = 0;
			else
				m_board_y = h - m_pC_minimap_spk->GetHeight(MINIMAP_BOARD);
#if __CONTENTS(__GPS_ADD)
/*
			if(x+w/2 < g_pUserInformation->iResolution_x/2)
				m_GPSBoard_X = w-4;
			else
				m_GPSBoard_X = -m_pC_minimap_spk->GetWidth(MINIMAP_GPSBTN_BOARD)+4;
				//if(y+h/2 < RESOLUTION_Y/2)
			if(y+h/2 < g_pUserInformation->iResolution_y/2)
				m_GPSBoard_Y = m_board_y + m_pC_minimap_spk->GetHeight(MINIMAP_GPSBTN_BOARD)+1;
			else
				m_GPSBoard_Y = m_board_y + h - m_pC_minimap_spk->GetHeight(MINIMAP_GPSBTN_BOARD)+1;
*/			// GPS 버튼 부분
#endif // __GPS_ADD
		}
		break;

	}
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_MINIMAP::IsPixel(int _x, int _y)
{
	// 2006.08.22 sjheon
	if( m_bMiniMapDisableZone ) 
		return false ; 

	if(Moving()) return true;
	if(GetAttributes()->alpha &&
		_x >= x+m_map_start_point.x && _x <= x+m_map_start_point.x+m_surface_w &&
		_y >= y+m_map_start_point.y && _y <= y+m_map_start_point.y+m_surface_h)
	{
		return false;
	}
	
	
	bool re = IsInRect(_x+40, _y+4);
	if(re == false)
	{
		re = m_pC_minimap_spk->IsPixel(_x-x-m_board_x, _y-y-m_board_y, MINIMAP_BOARD);
#if __CONTENTS(__GPS_ADD)
/*
		if(m_pC_minimap_spk->IsPixel(_x-x-m_board_x, _y-y-m_board_y, MINIMAP_BOARD)||m_pC_minimap_spk->IsPixel(_x-x-m_GPSBoard_X, _y-y-m_GPSBoard_Y, MINIMAP_GPSBTN_BOARD))
			re = true;
*/		// GPS 버튼 부분
#endif //__GPS_ADD
	}

	return re;

}

//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_MINIMAP::Run(id_t id)
{
	// 2006.08.22 sjheon
	if(m_bMiniMapDisableZone) 
		return ; 

	switch (id)
	{
		//	case CHANGE_ID:
		//		m_width_mode = !m_width_mode;
		//		w^=h; h^=w; w^=h; //swap
		//		x -= w-h;
		//		EMPTY_MOVE;
		//		break;
	case ALPHA_ID:
		AttrAlpha(!GetAttributes()->alpha);
		EMPTY_MOVE;
		break;
		
	case PUSHPIN_ID:
		if(GetAttributes()->autohide)
			AttrAutoHide(ATTRIBUTES_HIDE_NOT);
		else
			AttrAutoHide(ATTRIBUTES_HIDE_WIDTH);
		EMPTY_MOVE;
		break;

	case HOOK_ID://
		gC_vs_ui.ToggleTMall();
		//gC_vs_ui.OpenHollyWar();
		//gC_vs_ui.ToggleMilitary();
		//gC_vs_ui.OpenGameHook();
		break;
	case PAYEVENT_ID:
		gpC_base->SendMessage(UI_REQUEST_PAY_EVENT, 0, 0,NULL);
		//gC_vs_ui.OpenPayEvent();
		break;
#if __CONTENTS(__GPS_ADD)
/*
	case GPSVIEW_ID:
		m_bGPSViewOpen = GetAttributes()->gpsview;
		AttrGPS(!m_bGPSViewOpen);
*/
		break;
#endif //__GPS_ADD
	}
}

//-----------------------------------------------------------------------------
// MouseControl
//
// 
//-----------------------------------------------------------------------------
bool C_VS_UI_MINIMAP::MouseControl(UINT message, int _x, int _y)
{
	// 2006.08.22 sjheon
	if(m_bMiniMapDisableZone) 
		return false ; 

	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	
	bool re	= false;

	re = m_pC_button_group->MouseControl(message, _x-m_board_x, _y-m_board_y);
#if __CONTENTS(__GPS_ADD)
/*
		if(m_pC_button_group->MouseControl(message, _x-m_board_x, _y-m_board_y) || m_pC_button_group->MouseControl(message, _x-m_board_x, _y))
			re	= true;
*/
#endif	//__GPS_ADD

	switch(message)
	{
	case M_MOVING:
		break;
		
	case M_LEFTBUTTON_DOWN:
#if __CONTENTS(__MOVE_ZONE)
		// 개발자용 "맵 이동하는 기능" - 2008.11.7 ij-ch
		if(gpC_mouse_pointer->IsMoveZoneEffect())
		{
			SetMoveZone(_x,_y);
			break;
		}
#endif //__MOVE_ZONE
	case M_LB_DOUBLECLICK:
		// 반투명 상태에서 맵 클릭하면 이동되게
		if (gpC_mouse_pointer->GetPickUpItem() == false && re)
		{
			MoveReady();
			SetOrigin(_x, _y);
			break;
		}
		break;
		
	}

	return true;
}

//-----------------------------------------------------------------------------
// MouseControlExtra
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_MINIMAP::MouseControlExtra(UINT message, int _x, int _y)
{
	// 2006.08.22 sjheon
	if(m_bMiniMapDisableZone)
		return ; 

	_x-=x; _y-=y;
	
	switch(message)
	{
	case M_MOVING:
		// 미니맵 위에 마우스가 있다.
		{
			int map_w = m_surface_w, map_h = m_surface_h;
			//			if(m_map_w != m_map_h)
			//			{
			//				if(m_map_w > m_map_h)map_h = map_h * m_map_h / m_map_w;
			//				if(m_map_h > m_map_w)map_w = map_w * m_map_w / m_map_h;
			//			}
			
			for(int i = 0; i < m_portal.size(); i++)
			{
				int x = m_map_start_point.x + (m_portal[i].left+m_portal[i].right)/2*map_w/m_map_w;
				int y = m_map_start_point.y + (m_portal[i].top+m_portal[i].bottom)/2*map_h/m_map_h;
				if(_x > x-5 && _x < x+5 && _y > y-5 && _y < y+5)
				{
					if(m_portal_zone_id[i] != 1500)
						g_descriptor_manager.Set(DID_INFO, gpC_mouse_pointer->GetPointerX(), gpC_mouse_pointer->GetPointerY(), g_pZoneTable->Get(m_portal_zone_id[i])->Name.GetString());
					else
					{
						char* TempStr;
						switch(i)
						{
						case 0:
							TempStr = (*g_pGameStringTable)[STRING_MESSAGE_SIEGE_POTAL_201].GetString();
							break;
						case 1:
							TempStr = (*g_pGameStringTable)[STRING_MESSAGE_SIEGE_POTAL_200].GetString();
							break;
						case 2:
							TempStr = (*g_pGameStringTable)[STRING_MESSAGE_SIEGE_POTAL_202].GetString();
							break;
						case 3:
							TempStr = (*g_pGameStringTable)[STRING_MESSAGE_SIEGE_POTAL_203].GetString();
							break;
						}
						g_descriptor_manager.Set(DID_INFO, gpC_mouse_pointer->GetPointerX(), gpC_mouse_pointer->GetPointerY(), TempStr);
					}
					break;
				}
			}
			
			for(i = 0; i < m_npc.size(); i++)
			{
				int x = m_map_start_point.x + m_npc[i].x*map_w/m_map_w;
				int y = m_map_start_point.y + m_npc[i].y*map_h/m_map_h;
				
				if(_x > x-5 && _x < x+5 && _y > y-5 && _y < y+5)
				{
			//		static char npc_name[50];
			//		if((*g_pCreatureTable)[m_npc[i].id].Name.GetString())
			//			strcpy(npc_name, (*g_pCreatureTable)[m_npc[i].id].Name.GetString());
			//		else strcpy(npc_name, "");
					
					static S_DEFAULT_HELP_STRING npc_string;
			//		npc_string.sz_main_str = npc_name;
					if(m_npc[i].name.GetLength() >= 1)
						npc_string.sz_main_str = m_npc[i].name.GetString();
					else
						npc_string.sz_main_str = NULL;
					
					//					static char npc_description[50];
					NPC_INFO *npc_info = g_pNPCTable->GetData(m_npc[i].id);
					if(npc_info)
						npc_string.sz_sub_str = npc_info->Description;
					else
						npc_string.sz_sub_str = NULL;
					
					g_descriptor_manager.Set(DID_HELP, gpC_mouse_pointer->GetPointerX(), gpC_mouse_pointer->GetPointerY(), (void *)&npc_string);
					break;
				}
			}
			
			for(i = 0; i < m_shrine.size(); i++)
			{
				int x = m_map_start_point.x + m_shrine[i].x*map_w/m_map_w;
				int y = m_map_start_point.y + m_shrine[i].y*map_h/m_map_h;
				
				if(_x > x-5 && _x < x+5 && _y > y-5 && _y < y+5)
				{
					g_descriptor_manager.Set(DID_INFO, gpC_mouse_pointer->GetPointerX(), gpC_mouse_pointer->GetPointerY(), m_shrine[i].name.GetString());
					break;
				}
			}

			for(i = 0; i < g_pParty->GetSize(); i++)
			{
				PARTY_INFO *info = g_pParty->GetMemberInfo(i);
				if(info != NULL && info->zoneID == GetZoneID())
				{
					int x = m_map_start_point.x + info->zoneX*map_w/m_map_w;
					int y = m_map_start_point.y + info->zoneY*map_h/m_map_h;
					
					if(_x > x-5 && _x < x+5 && _y > y-5 && _y < y+5)
					{
						static char party_name[20];
						static char party_desc[50];
						if(info->Name.GetString())
							strcpy(party_name, info->Name.GetString());
						else strcpy(party_name, "");
						
						static S_DEFAULT_HELP_STRING party_string;
						party_string.sz_main_str = party_name;
						
						wsprintf(party_desc, "(%d,%d)", info->zoneX, info->zoneY);
						party_string.sz_sub_str = party_desc;
						
						g_descriptor_manager.Set(DID_HELP, gpC_mouse_pointer->GetPointerX(), gpC_mouse_pointer->GetPointerY(), (void *)&party_string);
						break;
					}
				}
			}
			
			for(i = 0; i < m_Flag.size(); i++)
			{
				int x = m_map_start_point.x + m_Flag[i].x*map_w/m_map_w;
				int y = m_map_start_point.y + m_Flag[i].y*map_h/m_map_h;
				
				if(_x > x-5 && _x < x+5 && _y > y-5 && _y < y+5)
				{
					g_descriptor_manager.Set(DID_INFO, gpC_mouse_pointer->GetPointerX(), gpC_mouse_pointer->GetPointerY(), m_Flag[i].name.GetString());
					break;
				}
			}
		}
		break;
	}
}

#if __CONTENTS(__MOVE_ZONE)
bool	C_VS_UI_MINIMAP::SetMoveZone(int iPox_X, int iPox_Y)
{
	// 2008.11.7 ij-ch
	RECT _rcBoundCheck = {0,};
	POINT _ptBoundCheck = {0,};

	_rcBoundCheck.left		= m_map_start_point.x;
	_rcBoundCheck.top		= m_map_start_point.y;
	_rcBoundCheck.right		= m_map_start_point.x + m_p_minimap_surface->GetWidth();
	_rcBoundCheck.bottom	= m_map_start_point.y + m_p_minimap_surface->GetHeight();

	_ptBoundCheck.x = iPox_X;
	_ptBoundCheck.y = iPox_Y;

	if(PtInRect(&_rcBoundCheck,_ptBoundCheck))
	{
		int _zw = g_pZone->GetWidth();
		int _zh = g_pZone->GetHeight();
					
		int _i_w = m_p_minimap_surface->GetWidth();
		int _i_h = m_p_minimap_surface->GetHeight();

		int _ml_x = _ptBoundCheck.x-_rcBoundCheck.left;
		int _ml_y = _ptBoundCheck.y-_rcBoundCheck.top;

		int _mov_x = (_zw*_ml_x)/_i_w;
		int _mov_y = (_zh*_ml_y)/_i_h;
		
		gpC_mouse_pointer->SetMoveZoneInfo(g_pZone->GetID(),_mov_x,_mov_y,30,gpC_mouse_pointer->GetPointerX(),gpC_mouse_pointer->GetPointerY());

		return TRUE;
	}
	
	return FALSE;
}
#endif //__MOVE_ZONE

//-----------------------------------------------------------------------------
// C_VS_UI_MINIMAP
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_MINIMAP::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_KEYDOWN && key == VK_ESCAPE)
	{
		//		Run(CLOSE);
	}
}

//-----------------------------------------------------------------------------
// Show
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_MINIMAP::Show()
{
	// 맵이 바뀌었으면 텍스쳐 세팅을 다시 해줘야 한다.
//	if(m_bl_refresh == true)
//	{
//		InitMinimap(m_p_minimap_surface);
//		m_bl_refresh = false;
//	}
	
	// 2006.08.22 sjheon
	if( m_bMiniMapDisableZone ) 
		return ; 

	// 맵출력
	if(GetAttributes()->alpha)
	{
		RECT rt = {0,0,m_p_minimap_surface->GetWidth(),m_p_minimap_surface->GetHeight()};
		POINT map_point = {x+m_map_start_point.x, y+m_map_start_point.y};

//		if(gpC_base->m_p_DDSurface_back->Lock())
		{
//			WORD * p_dest = (WORD *)m_p_minimap_surface->GetSurfacePointer();
//			p_dest = p_dest+(y+m_map_start_point.y)*m_p_minimap_surface->GetSurfacePitch()/2+x+m_map_start_point.x;
			gpC_base->m_p_DDSurface_back->BltHalf(&map_point, m_p_minimap_surface, &rt);
//			gpC_base->m_p_DDSurface_back->Unlock();
		}
//		DrawMinimapAlpha(x+m_map_start_point.x, y+m_map_start_point.y, m_p_minimap_surface);
	}
	else
	{
		RECT rt = {0, 0, m_surface_w, m_surface_h};
		POINT map_point = m_map_start_point;
		map_point.x+=x;
		map_point.y+=y;
		
//		if(gpC_base->m_p_DDSurface_back->Lock())
		{
			gpC_base->m_p_DDSurface_back->Blt(&map_point, m_p_minimap_surface, &rt);
//			gpC_base->m_p_DDSurface_back->Lock();
		}
	}
	
	// 미니맵위에 기타등등 출력
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
//		if(m_bWindowEvent)	//초기화 되었을 대는 임으로 지정
			m_pC_minimap_spk->BltLocked(x+m_board_x, y+m_board_y, MINIMAP_BOARD);
#if __CONTENTS(__GPS_ADD)
//			m_pC_minimap_spk->BltLocked(x+m_GPSBoard_X, y+m_GPSBoard_Y, MINIMAP_GPSBTN_BOARD);	// GPS 버튼 부분
#endif //__GPS_ADD
//		else
//			m_pC_minimap_spk->BltLocked(g_pUserInformation->iResolution_x-m_pC_minimap_spk->GetWidth(MINIMAP_MAIN) - m_pC_minimap_spk->GetWidth(MINIMAP_BOARD), 0, MINIMAP_BOARD);

		// 맵테두리
		Rect rect(0, 0, w-m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), h);
		if(GetAttributes()->alpha)
		{
			RECT alpha_rect = {x+4, y+4, x+w-4, y+25};
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				DrawAlphaBox(&alpha_rect, 0, 2, 2, g_pUserOption->ALPHA_DEPTH);
				break;

			case RACE_VAMPIRE:
				DrawAlphaBox(&alpha_rect, 2, 0, 0, g_pUserOption->ALPHA_DEPTH);
				break;

			case RACE_OUSTERS:
				DrawAlphaBox(&alpha_rect, 0, 4, 0, g_pUserOption->ALPHA_DEPTH);
				break;
			}
			m_pC_minimap_spk->BltLockedClip(x, y, rect, MINIMAP_MAIN_ALPHA);
		}
		else
			m_pC_minimap_spk->BltLockedClip(x, y, rect, MINIMAP_MAIN);
		
		rect.Set(0, 0, m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), h);
		m_pC_minimap_spk->BltLockedClip(x+w-m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), y, rect, MINIMAP_RIGHT);
		
		// use only peiac
		if(m_surface_h != 100)
		{
			rect.Set(0, m_pC_minimap_spk->GetHeight(MINIMAP_MAIN)-4, w-m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), 4);
			m_pC_minimap_spk->BltLockedClip(x, y-(100-m_surface_h), rect, MINIMAP_MAIN);
			rect.Set(0, m_pC_minimap_spk->GetHeight(MINIMAP_MAIN)-4, m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), 4);
			m_pC_minimap_spk->BltLockedClip(x+w-m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT), y-(100-m_surface_h), rect, MINIMAP_RIGHT);
		}
		
		// hiding중에는 기타등등 생략
		//		if(GetAttributes()->autohide && x < 0 || x+w > RESOLUTION_X || y < 0 || y+h > RESOLUTION_Y)
		//		{
		//			gpC_base->m_p_DDSurface_back->Unlock();
		//			return;
		//		}
		
		int map_w = m_surface_w, map_h = m_surface_h;
		//		if(m_map_w != m_map_h)
		//		{
		//			if(m_map_w > m_map_h)map_h = map_h * m_map_h / m_map_w;
		//			if(m_map_h > m_map_w)map_w = map_w * m_map_w / m_map_h;
		//		}
		
		
		
		WORD *mem = (WORD *)gpC_base->m_p_DDSurface_back->GetSurfacePointer();
		long pitch = gpC_base->m_p_DDSurface_back->GetSurfacePitch();
		long pitch_div_2 = pitch>>1;	// by sigi
		
		//		RECT rect = {m_map_start_point.x, m_map_start_point.y, m_map_start_point.x+m_surface_w, m_map_start_point.y+m_surface_h};
		
		static int color=21;
		static int color_direct = 1;
		if(TimerMinimap())
		{
			color += color_direct;
			if(color > 30 || color < 21)color_direct *= -1;
		}
		
		BYTE r = 31, g = 63, b = 31;
		WORD portal_color = CDirectDraw::Color(r, g, b);
		
		int i, _x, _y;
		WORD _color, _color2;
		
		// 포탈 위치 표시 ▽
		r = color, g = color-10, b = color;
		_color = CDirectDraw::Color(r, g, b);
		r = color*2/3, g = (color-10)*2/3, b = color*2/3;
		_color2 = CDirectDraw::Color(r, g, b);
		for(i = 0; i < m_portal.size(); i++)
		{
			_x = x+m_map_start_point.x + (m_portal[i].left+m_portal[i].right)/2*map_w/m_map_w;
			_y = y+m_map_start_point.y + (m_portal[i].top+m_portal[i].bottom)/2*map_h/m_map_h;
			
			//if(_x > 1 && _x < RESOLUTION_X-2 && _y > 2 && _y < RESOLUTION_Y-1)
			if(_x > 1 && _x < g_pUserInformation->iResolution_x-2 && _y > 2 && _y < g_pUserInformation->iResolution_y-1)
			{
				mem[(_y)*pitch_div_2 + _x] = _color;
				mem[(_y-1)*pitch_div_2 + _x-1] = _color2;
				mem[(_y-1)*pitch_div_2 + _x] = _color;
				mem[(_y-1)*pitch_div_2 + _x+1] = _color2;
				mem[(_y-2)*pitch_div_2 + _x-1] = _color;
				mem[(_y-2)*pitch_div_2 + _x] = _color;
				mem[(_y-2)*pitch_div_2 + _x+1] = _color;
				
				mem[(_y-3)*pitch_div_2 + _x-1] = 0;
				mem[(_y-3)*pitch_div_2 + _x] = 0;
				mem[(_y-3)*pitch_div_2 + _x+1] = 0;
				mem[(_y-2)*pitch_div_2 + _x-2] = 0;
				mem[(_y-2)*pitch_div_2 + _x+2] = 0;
				mem[(_y-1)*pitch_div_2 + _x-2] = 0;
				mem[(_y-1)*pitch_div_2 + _x+2] = 0;
				mem[(_y)*pitch_div_2 + _x-1] = 0;
				mem[(_y)*pitch_div_2 + _x+1] = 0;
				mem[(_y+1)*pitch_div_2 + _x] = 0;
			}
			
		}

				// 포탈 위치 표시 ▽
		r = color, g = color-10, b = color;
		_color = CDirectDraw::Color(r, g, b);
		r = color*2/3, g = (color-10)*2/3, b = color*2/3;
		_color2 = CDirectDraw::Color(r, g, b);
		for(i = 0; i < m_Block.size(); i++)
		{
			_x = x+m_map_start_point.x + (m_Block[i].x)*map_w/m_map_w;
			_y = y+m_map_start_point.y + (m_Block[i].y)*map_h/m_map_h;
			
			//if(_x > 0 && _x < RESOLUTION_X-1 && _y > 1 && _y < RESOLUTION_Y)
			if(_x > 0 && _x < g_pUserInformation->iResolution_x-1 && _y > 1 && _y < g_pUserInformation->iResolution_y)
			{
				mem[(_y)*pitch_div_2 + _x] = _color;
			}
			
		}
		
//		const int flagsize = 9;		
//		for( i = 0; i < m_Flag.size(); i++)
//		{
//			_x = x+m_map_start_point.x + (m_Flag[i].x)*map_w/m_map_w;
//			_y = y+m_map_start_point.y + (m_Flag[i].y)*map_h/m_map_h;
//
//			for(int j=_y;j< y+m_map_start_point.y + (m_Flag[i].y+flagsize)*map_h/m_map_h;j++)
//				wmemset(&mem[(j)*pitch_div_2 + _x], _color, flagsize*map_w/m_map_w);
//		}
		
		// npc위치 표시 †
		r = color-10, g = color, b = color-10;
		_color = CDirectDraw::Color(r, g, b);
		for(i = 0; i < m_npc.size(); i++)
		{
			_x = x+m_map_start_point.x + m_npc[i].x*map_w/m_map_w;
			_y = y+m_map_start_point.y + m_npc[i].y*map_h/m_map_h;

			if(m_npc[i].id == 659)	// 돼지정령
			{
				gpC_global_resource->m_pC_info_spk->BltLocked(_x-gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::OUSTERS_HORN)/2, _y-gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::OUSTERS_HORN)+5, C_GLOBAL_RESOURCE::OUSTERS_HORN);
			}
			else
			{
				//if(_x > 1 && _x < RESOLUTION_X-2 && _y > 3 && _y < RESOLUTION_Y-1)
				if(_x > 1 && _x < g_pUserInformation->iResolution_x-2 && _y > 3 && _y < g_pUserInformation->iResolution_y-1)
				{
					mem[(_y)*pitch_div_2 + _x] = _color;
					mem[(_y-1)*pitch_div_2 + _x] = _color;
					mem[(_y-2)*pitch_div_2 + _x-1] = _color;
					mem[(_y-2)*pitch_div_2 + _x] = _color;
					mem[(_y-2)*pitch_div_2 + _x+1] = _color;
					mem[(_y-3)*pitch_div_2 + _x] = _color;
					
					mem[(_y-4)*pitch_div_2 + _x] = 0;
					mem[(_y-3)*pitch_div_2 + _x-1] = 0;
					mem[(_y-3)*pitch_div_2 + _x+1] = 0;
					mem[(_y-2)*pitch_div_2 + _x-2] = 0;
					mem[(_y-2)*pitch_div_2 + _x+2] = 0;
					mem[(_y-1)*pitch_div_2 + _x-1] = 0;
					mem[(_y-1)*pitch_div_2 + _x+1] = 0;
					mem[(_y)*pitch_div_2 + _x-1] = 0;
					mem[(_y)*pitch_div_2 + _x+1] = 0;
					mem[(_y+1)*pitch_div_2 + _x] = 0;
				}
			}
		}

		// shrine위치 표시 †
		r = color-10, g = color-10, b = color;
		_color = CDirectDraw::Color(r, g, b);
		r = (color-10)*2/3, g = (color-10)*2/3, b = color*2/3;
		_color2 = CDirectDraw::Color(r, g, b);
		for(i = 0; i < m_shrine.size(); i++)
		{
			_x = x+m_map_start_point.x + m_shrine[i].x*map_w/m_map_w;
			_y = y+m_map_start_point.y + m_shrine[i].y*map_h/m_map_h;
			
			//if(_x > 1 && _x < RESOLUTION_X-2 && _y > 2 && _y < RESOLUTION_Y-3)
			if(_x > 1 && _x < g_pUserInformation->iResolution_x-2 && _y > 2 && _y < g_pUserInformation->iResolution_y-3)
			{
				mem[(_y)*pitch_div_2 + _x-1] = _color;
				mem[(_y)*pitch_div_2 + _x+1] = _color;
				mem[(_y-1)*pitch_div_2 + _x] = _color;
				mem[(_y-1)*pitch_div_2 + _x-1] = _color2;
				mem[(_y-1)*pitch_div_2 + _x+1] = _color2;
				mem[(_y-2)*pitch_div_2 + _x] = _color;
				mem[(_y+1)*pitch_div_2 + _x] = _color;
				mem[(_y+1)*pitch_div_2 + _x-1] = _color2;
				mem[(_y+1)*pitch_div_2 + _x+1] = _color2;
				mem[(_y+2)*pitch_div_2 + _x] = _color;
				
				mem[(_y)*pitch_div_2 + _x] = 0;
				mem[(_y)*pitch_div_2 + _x-2] = 0;
				mem[(_y)*pitch_div_2 + _x+2] = 0;
				mem[(_y-1)*pitch_div_2 + _x-2] = 0;
				mem[(_y-1)*pitch_div_2 + _x+2] = 0;
				mem[(_y-2)*pitch_div_2 + _x-1] = 0;
				mem[(_y-2)*pitch_div_2 + _x+1] = 0;
				mem[(_y-3)*pitch_div_2 + _x] = 0;
				mem[(_y+1)*pitch_div_2 + _x-2] = 0;
				mem[(_y+1)*pitch_div_2 + _x+2] = 0;
				mem[(_y+2)*pitch_div_2 + _x-1] = 0;
				mem[(_y+2)*pitch_div_2 + _x+1] = 0;
				mem[(_y+3)*pitch_div_2 + _x] = 0;
			}
		}

		/*		
		// 파티원위치 표시 x
		if(g_pParty->GetSize())
		{
		r = color, g = color-5, b = color-5;
		_color = CDirectDraw::Color(r, g, b);
		for(i = 0; i < g_pParty->GetSize(); i++)
		{
		if(g_pParty->GetMemberInfo(i) != NULL && g_pParty->GetMemberInfo(i)->zoneID == m_zone_id)
		{
		_x = x+m_map_start_point.x + g_pParty->GetMemberInfo(i)->zoneX*map_w/m_map_w;
		_y = y+m_map_start_point.y + g_pParty->GetMemberInfo(i)->zoneY*map_h/m_map_h;
		
		  if(_x > 0 && _x < RESOLUTION_X-1 && _y > 0 && _y < RESOLUTION_Y-1)
		  {
		  mem[(_y)*pitch_div_2 + _x] = _color;
		  mem[(_y-1)*pitch_div_2 + _x-1] = _color;
		  mem[(_y-1)*pitch_div_2 + _x+1] = _color;
		  mem[(_y+1)*pitch_div_2 + _x-1] = _color;
		  mem[(_y+1)*pitch_div_2 + _x+1] = _color;
		  
			mem[(_y-2)*pitch_div_2 + _x-1] = 0;
			mem[(_y-2)*pitch_div_2 + _x+1] = 0;
			mem[(_y-1)*pitch_div_2 + _x-2] = 0;
			mem[(_y-1)*pitch_div_2 + _x] = 0;
			mem[(_y-1)*pitch_div_2 + _x+2] = 0;
			mem[(_y)*pitch_div_2 + _x-1] = 0;
			mem[(_y)*pitch_div_2 + _x+1] = 0;
			mem[(_y+1)*pitch_div_2 + _x-2] = 0;
			mem[(_y+1)*pitch_div_2 + _x] = 0;
			mem[(_y+1)*pitch_div_2 + _x+2] = 0;
			mem[(_y+2)*pitch_div_2 + _x-1] = 0;
			mem[(_y+2)*pitch_div_2 + _x+1] = 0;
			}
			}
			}
			}
			
			  //자기 위치 표시 x
			  _x = x+m_map_start_point.x + m_map_x*map_w/m_map_w;
			  _y = y+m_map_start_point.y + m_map_y*map_h/m_map_h;
			  
				if(_x > 0 && _x < RESOLUTION_X-1 && _y > 0 && _y < RESOLUTION_Y-1)
				{
				mem[(_y)*pitch_div_2 + _x] = 0xffff;
				mem[(_y+1)*pitch_div_2 + _x+1] = 0xffff;
				mem[(_y-1)*pitch_div_2 + _x-1] = 0xffff;
				mem[(_y+1)*pitch_div_2 + _x-1] = 0xffff;
				mem[(_y-1)*pitch_div_2 + _x+1] = 0xffff;
				
				  mem[(_y-2)*pitch_div_2 + _x-1] = 0;
				  mem[(_y-2)*pitch_div_2 + _x+1] = 0;
				  mem[(_y-1)*pitch_div_2 + _x-2] = 0;
				  mem[(_y-1)*pitch_div_2 + _x] = 0;
				  mem[(_y-1)*pitch_div_2 + _x+2] = 0;
				  mem[(_y)*pitch_div_2 + _x-1] = 0;
				  mem[(_y)*pitch_div_2 + _x+1] = 0;
				  mem[(_y+1)*pitch_div_2 + _x-2] = 0;
				  mem[(_y+1)*pitch_div_2 + _x] = 0;
				  mem[(_y+1)*pitch_div_2 + _x+2] = 0;
				  mem[(_y+2)*pitch_div_2 + _x-1] = 0;
				  mem[(_y+2)*pitch_div_2 + _x+1] = 0;
				  }
		*/
		// 파티 위치 표시
		for(i = 0; i < g_pParty->GetSize(); i++)
		{
			if(g_pParty->GetMemberInfo(i) != NULL && g_pParty->GetMemberInfo(i)->zoneID == m_zone_id)
			{
				_x = x+m_map_start_point.x + g_pParty->GetMemberInfo(i)->zoneX*map_w/m_map_w;
				_y = y+m_map_start_point.y + g_pParty->GetMemberInfo(i)->zoneY*map_h/m_map_h;
				//if(_x > 0 && _x < RESOLUTION_X-1 && _y > 0 && _y < RESOLUTION_Y-1)
				if(_x > 0 && _x < g_pUserInformation->iResolution_x-1 && _y > 0 && _y < g_pUserInformation->iResolution_y-1)
					m_pC_minimap_spk->BltLocked(_x-m_pC_minimap_spk->GetWidth(MINIMAP_ICON_PARTY)/2, _y-m_pC_minimap_spk->GetHeight(MINIMAP_ICON_PARTY)/2, MINIMAP_ICON_PARTY);
			}
		}

		// 자기 위치 표시
		if(m_map_w != 0 && m_map_h != 0)
		{
#if __CONTENTS(__GPS_ADD)		
			m_Gps_User_Info.wPos_X					= m_map_x;
			m_Gps_User_Info.wPos_Y					= m_map_y;
			m_Gps_User_Info.wSpkIndex				= GPS_USER_PC_ICON;
			m_Gps_User_Info.S_Gps_Game_Map_Info.wID	= m_zone_id;
			m_Gps_User_Info.S_Gps_Game_Map_Info.wMapSize_Width	= 256;
			m_Gps_User_Info.S_Gps_Game_Map_Info.wMapSize_Height	= 256;

			if(m_zone_id == WORLDMAP_ID_PERONA_NW || m_zone_id == WORLDMAP_ID_PERONA_NE || 
				m_zone_id == WORLDMAP_ID_PERONA_SW || m_zone_id == WORLDMAP_ID_PERONA_SE)
			{
				m_Gps_User_Info.S_Gps_Game_Map_Info.wMapSize_Width = 128;
			}
			gpC_Gps->m_C_GpsManager.SetGpsUserInfo(m_Gps_User_Info);
#endif //__GPS_ADD

			_x = x+m_map_start_point.x + m_map_x*map_w/m_map_w;
			_y = y+m_map_start_point.y + m_map_y*map_h/m_map_h;
			
			//if(_x > 0 && _x < RESOLUTION_X-1 && _y > 0 && _y < RESOLUTION_Y-1)
			if(_x > 0 && _x < g_pUserInformation->iResolution_x-1 && _y > 0 && _y < g_pUserInformation->iResolution_y-1)
				m_pC_minimap_spk->BltLocked(_x-m_pC_minimap_spk->GetWidth(MINIMAP_ICON_SELF)/2, _y-m_pC_minimap_spk->GetHeight(MINIMAP_ICON_SELF)/2, MINIMAP_ICON_SELF);
		}
		
		m_pC_button_group->Show();
		gpC_base->m_p_DDSurface_back->Unlock();
	}
	
	g_FL2_GetDC();
	g_PrintColorStr(x+w/2-g_GetStringWidth(m_zone_name.c_str(), gpC_base->m_info_pi.hfont)/2, y+8, m_zone_name.c_str(), gpC_base->m_info_pi, RGB_WHITE);
	char sz_temp[5];
	wsprintf(sz_temp, "%d", m_map_x);
	g_PrintColorStr(x+m_board_x+19, y+m_board_y+6, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
	wsprintf(sz_temp, "%d", m_map_y);
	g_PrintColorStr(x+m_board_x+19, y+m_board_y+21, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);

	//g_PrintColorStr(x+m_board_x+19-6, y+m_board_y+21+40, "밈", gpC_base->m_info_pi, RGB_WHITE);

	m_pC_button_group->ShowDescription();
	g_FL2_ReleaseDC();	
}

//-----------------------------------------------------------------------------
// Start
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_MINIMAP::Start()
{
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::MINIMAP));
	AttrAutoHide(gpC_vs_ui_window_manager->GetAutoHide(C_VS_UI_WINDOW_MANAGER::MINIMAP));
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::MINIMAP);
	if(rect.w != -1)
	{
//		x = rect.x;
//		y = rect.y;
	}
	
	PI_Processor::Start();
#if __CONTENTS(__GPS_ADD)
//	gpC_Gps->Start();
#endif //__GPS_ADD
	m_pC_button_group->Init();

	WindowEventReceiver(EVENT_WINDOW_MOVE);
	
	gpC_window_manager->AppearWindow(this);
}

void C_VS_UI_MINIMAP::Finish()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::MINIMAP, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::MINIMAP, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::MINIMAP, Rect(x, y, w, h));
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);	
}

//-----------------------------------------------------------------------------
// Process
//
// 
//-----------------------------------------------------------------------------
void C_VS_UI_MINIMAP::Process()
{
	m_pC_button_group->Process();
	
	bool bl_alpha = GetAttributes()->alpha;
	if(bl_alpha)
	{
		AttrAlpha(false);
	}
	//if(x <= 0 || x+w >= RESOLUTION_X)
	if(x <= 0 || x+w >= g_pUserInformation->iResolution_x)
		ProcessHide(-4, bl_alpha);
	else
		ProcessHide(0, bl_alpha);
	if(bl_alpha)
	{
		AttrAlpha(true);
	}
	
}

void C_VS_UI_MINIMAP::SetZone(int zone_id)
{
	m_bl_refresh = true;
	
	//	int spk_id[zone_id_size] = 
	//	{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,//필드
	//	12, 13, 14, 13, 15, 21, 40, 45, //던젼&마을
	//	39, 28, 29, 30, 31, 32,//바토리던젼
	//	41, 42, 43, 44, //라센성
	//	20, 16, 17, 18, 19,//군인길드
	//	20, 22, 23, 24, 19,//성직자길드
	//	20, 25, 26, 27, 19,//무사길드
	//	19, 20, 21, 22, 23, 25,//튜토리얼
	//	33, 34,					//튜토리얼
	//	-1, -1, -1};//클라이언트용
	
	//	bool bl_statch = (x+w >= RESOLUTION_X-1);
	//	int statch_w = w;
	
	m_zone_id = zone_id;
	m_zone_name = g_pZoneTable->Get(zone_id)->Name.GetString();
	
	//-------------------------------------------------------------------
	//
	// 필요한 minimap sprite를 하나 읽어오기 위해서.
	//
	//-------------------------------------------------------------------
	// by sigi 2001.9.5
	CSpritePack	minimapSPK;
	minimapSPK.Init( 1 );		// 임시로 1개만 loading.. - -;;
	
	bool re = minimapSPK.LoadFromFileData( 0, g_pZoneTable->Get(zone_id)->MinimapSpriteID, SPK_MINIMAP, SPKI_MINIMAP );
//	assert(re && "Minimap Not Load");

	m_bMiniMapDisableZone = (
		m_zone_id == 1212 || m_zone_id == 1222 || m_zone_id == 1232 ||
		m_zone_id == 1242 || m_zone_id == 1252 || m_zone_id == 1262
	);
#if __CONTENTS(__GPS_ADD)	
	gpC_Gps->DesableZone(m_bMiniMapDisableZone);
#endif //__GPS_ADD
	
	//-------------------------------------------------------------------
	// 화면에 출력
	//-------------------------------------------------------------------
	if(re)
	{
		m_surface_w = minimapSPK[0].GetWidth();
		m_surface_h = minimapSPK[0].GetHeight();
		
		POINT point = {0, 0};
		DeleteNew(m_p_minimap_surface);
		m_p_minimap_surface = new CSpriteSurface;
		m_p_minimap_surface->InitOffsurface(m_surface_w, m_surface_h, DDSCAPS_SYSTEMMEMORY);
		m_p_minimap_surface->SetTransparency( 0xffff );
		m_p_minimap_surface->FillSurface(0x0000);
		
		m_p_minimap_surface->Lock();
		m_p_minimap_surface->BltSprite(&point, &minimapSPK[0]);
		m_p_minimap_surface->Unlock();
		
		int map_minus_w = 200-m_surface_w;
		//if(x+w == RESOLUTION_X)
		if(x+w == g_pUserInformation->iResolution_x)
			x -= m_pC_minimap_spk->GetWidth(MINIMAP_MAIN)+m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT)-map_minus_w-w;
		w = m_pC_minimap_spk->GetWidth(MINIMAP_MAIN)+m_pC_minimap_spk->GetWidth(MINIMAP_RIGHT)-map_minus_w;
		
		int map_minus_h = 100-m_surface_h;
		//if(x+h == RESOLUTION_Y)
		if(x+h == g_pUserInformation->iResolution_y)
			y -= m_pC_minimap_spk->GetHeight(MINIMAP_MAIN)-map_minus_h-h;
		h = m_pC_minimap_spk->GetHeight(MINIMAP_MAIN)-map_minus_h;
	}
	
	m_portal.clear();
	m_portal_zone_id.clear();
	m_npc.clear();
	m_shrine.clear();
	m_Block.clear();
	m_Flag.clear();
}


void C_VS_UI_MINIMAP::SetBlock(int x, int y)
{
	POINT pt;

	pt.x = x;
	pt.y = y;

	m_Block.push_back(pt);
}


void	C_VS_UI_MINIMAP::SetFlagArea(POINT pt)
{
	m_p_minimap_surface->Lock();
	WORD *mem = (WORD *)m_p_minimap_surface->GetSurfacePointer();
	int pitch = m_p_minimap_surface->GetSurfacePitch();
		
	int remainy = (pt.y+9) % m_map_h;
	int remainx = (pt.x+9) % m_map_w;

	if(remainy)
		remainy = 1;
	else remainy = 0;

	if(remainx)
		remainx = 1;
	else remainx = 0;

	if(m_map_w && m_map_h)
	{
		for(int y = pt.y*m_surface_h/m_map_h ; 
		y <= (pt.y+9)*m_surface_h/m_map_h; y++)
		{
			for(int x = pt.x*m_surface_w/m_map_w; 
			x <= (pt.x+9)*m_surface_w/m_map_w; x++)
			{
				mem[y*pitch/2+x] = mem[y*pitch/2+x] & CDirectDraw::Get_R_Bitmask();
			}
		}
	}
		
	m_p_minimap_surface->Unlock();
}

//-----------------------------------------------------------------------------
// SetSafetyZone
//
// 안전지대 설정
//-----------------------------------------------------------------------------
void C_VS_UI_MINIMAP::SetSafetyZone(RECT rect, bool my_zone)
{
	m_bl_refresh = true;
	
	m_p_minimap_surface->Lock();
	WORD *mem = (WORD *)m_p_minimap_surface->GetSurfacePointer();
	int pitch = m_p_minimap_surface->GetSurfacePitch();
	
	//int map_w = m_surface_w, map_h = m_surface_h;
	//	if(m_map_w != m_map_h)
	//	{
	//		if(m_map_w > m_map_h)map_h = map_h * m_map_h / m_map_w;
	//		if(m_map_h > m_map_w)map_w = map_w * m_map_w / m_map_h;
	//	}
	
	int remainy = rect.bottom % m_map_h;
	int remainx = rect.right % m_map_w;

	if(remainy)
		remainy = 1;
	else remainy = 0;

	if(remainx)
		remainx = 1;
	else remainx = 0;

	if(m_map_w && m_map_h)
	{
		for(int y = rect.top*m_surface_h/m_map_h ; 
		y <= min((remainy+rect.bottom)*m_surface_h/m_map_h ,m_surface_h-1); y++)
		{
			for(int x = rect.left*m_surface_w/m_map_w; 
			x <= min((remainx+rect.right)*m_surface_w/m_map_w ,m_surface_w-1); x++)
			{
				if(my_zone)
					mem[y*pitch/2+x] = mem[y*pitch/2+x] & CDirectDraw::Get_G_Bitmask();
				else
					mem[y*pitch/2+x] = mem[y*pitch/2+x] & CDirectDraw::Get_R_Bitmask();
			}
		}
	}
	
	/*if(m_map_w && m_map_h)
	{
		for(int y = rect.top*map_h/m_map_h + (m_surface_h - map_h)/2; 
		y <= min(remainy+rect.bottom*map_h/m_map_h + (m_surface_h - map_h)/2,m_surface_h-1); y++)
		{
			for(int x = rect.left*map_w/m_map_w + (m_surface_w - map_w)/2; 
			x <= min(remainx+rect.right*map_w/m_map_w + (m_surface_w - map_w)/2,m_surface_w-1); x++)
			{
				if(my_zone)
					mem[y*pitch/2+x] = mem[y*pitch/2+x] & CDirectDraw::Get_G_Bitmask();
				else
					mem[y*pitch/2+x] = mem[y*pitch/2+x] & CDirectDraw::Get_R_Bitmask();
			}
		}
	}*/
	
	m_p_minimap_surface->Unlock();
}

//-----------------------------------------------------------------------------
// SetNPC
//
// NPC 설정
//-----------------------------------------------------------------------------
void C_VS_UI_MINIMAP::SetNPC(MINIMAP_NPC npc)
{
	if(npc.id >= 560 && npc.id <= 563)	// 성 상징물 받침대
	{
		for(int i = 0; i < m_shrine.size(); i++)
		{
			if(npc.id == m_shrine[i].id)break;
		}
		
		if(i == m_shrine.size())
		{
			MINIMAP_SHRINE shrine;
			shrine.x = npc.x;
			shrine.y = npc.y;
			shrine.id = npc.id;
			shrine.name = npc.name;
			shrine.type = 0;
			m_shrine.push_back(shrine);
		}
	}
	else if(npc.id >= 526 && npc.id <= 537)	// 수호성단
	{
		for(int i = 0; i < m_shrine.size(); i++)
		{
			if(npc.id == m_shrine[i].id)break;
		}
		
		if(i == m_shrine.size())
		{
			MINIMAP_SHRINE shrine;
			shrine.x = npc.x;
			shrine.y = npc.y;
			shrine.id = npc.id;
			shrine.name = npc.name;
			shrine.type = 1;
			m_shrine.push_back(shrine);
		}
	}
	else if(npc.id >= 538 && npc.id <= 549)	// 성지 성단
	{
		for(int i = 0; i < m_shrine.size(); i++)
		{
			if(npc.id == m_shrine[i].id)break;
		}
		
		if(i == m_shrine.size())
		{
			MINIMAP_SHRINE shrine;
			shrine.x = npc.x;
			shrine.y = npc.y;
			shrine.id = npc.id;
			shrine.name = npc.name;
			shrine.type = 2;
			m_shrine.push_back(shrine);
		}
	}
	else if(npc.id == 670)
	{
		m_Flag.push_back(npc);

		POINT pt={npc.x,npc.y};

		SetFlagArea( pt );
	}
	else
	{
		for(int i = 0; i < m_npc.size(); i++)
		{
			if(npc.id == m_npc[i].id && npc.id != 659 && npc.id != 672 && npc.id != 673 )break; // 돼지 정령은 생까쟈
		}
		
		if(i == m_npc.size())
		{
			m_npc.push_back(npc);
		}
	}
}

//-----------------------------------------------------------------------------
// SetPortal
//
// 포탈 설정
//-----------------------------------------------------------------------------
void C_VS_UI_MINIMAP::SetPortal(RECT rect, int id)
{
//	extern std::map<int, bool> g_mapPremiumZone;
	if(//g_pUserInformation->IsNetmarble && g_mapPremiumZone.find(id) != g_mapPremiumZone.end()
		/*|| */!g_pSystemAvailableManager->ZoneFiltering( id ) )
		return;
	
	for(int i = 0; i < m_portal.size(); i++)
	{
		if(m_portal_zone_id[i] == id &&
			m_portal[i].top <= rect.bottom +5 &&
			m_portal[i].bottom +5>= rect.top &&
			m_portal[i].left <= rect.right +5 &&
			m_portal[i].right +5 >= rect.left
			)
		{
			m_portal[i].left = min(m_portal[i].left, rect.left);
			m_portal[i].right = max(m_portal[i].right, rect.right);
			m_portal[i].top = min(m_portal[i].top, rect.top);
			m_portal[i].bottom = max(m_portal[i].bottom, rect.bottom);
			break;
		}
	}
	
	if(i == m_portal.size())
	{
		//		if(rect.top > 4 && rect.bottom < m_map_h -1 && rect.left > 0 && rect.right < m_map_w)
		{
			m_portal.push_back(rect);
			m_portal_zone_id.push_back(id);
		}
		
	}
}


//-----------------------------------------------------------------------------
// Timer
//
//-----------------------------------------------------------------------------
bool C_VS_UI_MINIMAP::TimerMinimap()
{
	if(m_dw_minimap_prev_tickcount+m_dw_minimap_millisec <= GetTickCount())
	{
		m_dw_minimap_prev_tickcount = GetTickCount();
		return true;
	}
	
	return false;
}




C_VS_UI_WINDOW_MANAGER *gpC_vs_ui_window_manager;

C_VS_UI_WINDOW_MANAGER::C_VS_UI_WINDOW_MANAGER()
{
	SetDefault();
}

C_VS_UI_WINDOW_MANAGER::~C_VS_UI_WINDOW_MANAGER()
{
}

void C_VS_UI_WINDOW_MANAGER::SetDefault()
{
	int i = 0, j = 0;
	
	for (i=0; i < C_VS_UI_SKILL::HOTKEY_MAX; i++)
		for(j=0; j < C_VS_UI_SKILL::GRADE_MAX; j++)
			m_skill_hotkey_buf[i][j] = NOT_SELECTED;

	for (i=0; i < C_VS_UI_SKILL::HOTKEY_MAX; i++)
		m_QuickSlot_hotkey_buf[i] = NOT_SELECTED;

	//InitDefaultQuickSlot() ; 

		
	for(i = 0; i < CLD_TOTAL; i++)
		SetFilter((CHAT_LINE_CONDITION)i, true);
		
	for( i = 0; i < WINDOW_TOTAL; i++)
	{
		SetAlpha((WINDOW_ID)i, false);
		SetAutoHide((WINDOW_ID)i, Window::ATTRIBUTES_HIDE_NOT);
		SetRect((WINDOW_ID)i, Rect(-1, -1, -1, -1));
	}
		
	m_bl_hpbar_small = false;
	m_bl_hpbar_height = false;
	m_bl_quickitemslot_height = false;
	m_bl_effectstatus_height = false;

	m_i_main_menu = 0;

	// effectstatus는 숨겨뇌芩
	SetAutoHide(EFFECT_STATUS, Window::ATTRIBUTES_HIDE_HEIGHT);		

	// 2004, 6, 4, sobeit add start
	memset(m_SMS_MyNum, 0, 12);
	// 2004, 6, 4, sobeit add end 
}

void  C_VS_UI_WINDOW_MANAGER::InitDefaultQuickSlot()
{
	BYTE	hotkeyQuickSlotNum = C_VS_UI_SKILL::HOTKEY_MAX ;

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			for(int iHotKeyTypeCnt = 0; iHotKeyTypeCnt < hotkeyQuickSlotNum; iHotKeyTypeCnt++)
			{
				if(iHotKeyTypeCnt < 8)
				{
					m_QuickSlot_hotkey_buf[iHotKeyTypeCnt] = 	iHotKeyTypeCnt ; 
					m_HotKey_Type[iHotKeyTypeCnt] = C_VS_UI_TRIBE::QUICKITEM_TYPE ;
				}
				else
				{
					m_QuickSlot_hotkey_buf[iHotKeyTypeCnt] = -1 ;
					
					if(m_HotKey_Type[iHotKeyTypeCnt] != C_VS_UI_TRIBE::SKILL_TYPE)
						m_HotKey_Type[iHotKeyTypeCnt] = C_VS_UI_TRIBE::NOT_SELECT_TYPE ; 
					
				}
			}
        }    
		break;

	case RACE_VAMPIRE:
		 {
			for(int iHotKeyTypeCnt = 0; iHotKeyTypeCnt < hotkeyQuickSlotNum; iHotKeyTypeCnt++)
			{
				m_QuickSlot_hotkey_buf[iHotKeyTypeCnt] = -1 ;
				if(m_HotKey_Type[iHotKeyTypeCnt] != C_VS_UI_TRIBE::SKILL_TYPE)
					m_HotKey_Type[iHotKeyTypeCnt] = C_VS_UI_TRIBE::NOT_SELECT_TYPE ; 
			
			}
         }    

		break;

	case RACE_OUSTERS:
		 { 
			for(int iHotKeyTypeCnt = 0; iHotKeyTypeCnt < hotkeyQuickSlotNum ; iHotKeyTypeCnt++)
			{
				if(iHotKeyTypeCnt < 6)
				{
				   m_QuickSlot_hotkey_buf[iHotKeyTypeCnt] = 	iHotKeyTypeCnt ;
				   m_HotKey_Type[iHotKeyTypeCnt] = C_VS_UI_TRIBE::QUICKITEM_TYPE ; 
				}
				else
				{
					m_QuickSlot_hotkey_buf[iHotKeyTypeCnt] = -1 ; 
					if(m_HotKey_Type[iHotKeyTypeCnt] != C_VS_UI_TRIBE::SKILL_TYPE)
						m_HotKey_Type[iHotKeyTypeCnt] = C_VS_UI_TRIBE::NOT_SELECT_TYPE ; 
				}
			}
		 } 
		break;	
	}
}

void  C_VS_UI_WINDOW_MANAGER::SetWindowStatus(const char* key, const WindowStatus* winStatus)
{
	m_WindowStatusMap[key] = *winStatus;
}

const WindowStatus*	C_VS_UI_WINDOW_MANAGER::GetWindowStatus(const char* key)
{
	WINDOWSTATUS_MAP::iterator pos = m_WindowStatusMap.find(key);

	if(pos != m_WindowStatusMap.end())
		return &pos->second;

	return NULL;
}

void  C_VS_UI_WINDOW_MANAGER::RemoveWindowStatus(const char* key)
{
	m_WindowStatusMap.erase(key);
}

void  C_VS_UI_WINDOW_MANAGER::ClearWindowStatus()
{
	m_WindowStatusMap.clear();
}

void C_VS_UI_WINDOW_MANAGER::SetFilter(CHAT_LINE_CONDITION filter, bool set)
{
	m_filter[filter] = set;
}

void C_VS_UI_WINDOW_MANAGER::SetAlpha(WINDOW_ID id, bool bl_alpha)
{
	m_alpha[id] = bl_alpha;
}

void C_VS_UI_WINDOW_MANAGER::SetAutoHide(WINDOW_ID id, Window::ATTRIBUTES_HIDE hide)
{
	m_autohide[id] = hide;
}

void C_VS_UI_WINDOW_MANAGER::SetRect(WINDOW_ID id, Rect rect)
{
	m_rect[id] = rect;
}

void C_VS_UI_WINDOW_MANAGER::SetHotKey(int **hotkey)
{
	if(hotkey)
	{
		memcpy(m_skill_hotkey_buf, hotkey, C_VS_UI_SKILL::HOTKEY_MAX*C_VS_UI_SKILL::GRADE_MAX*sizeof(int));
	}
}

void C_VS_UI_WINDOW_MANAGER::SetQuickSlotHotkey(int *hotkey)
{
	if(hotkey)
	{
		memcpy(m_QuickSlot_hotkey_buf, hotkey, C_VS_UI_SKILL::HOTKEY_MAX*sizeof(int));
	}
}

void C_VS_UI_WINDOW_MANAGER::SetHotkeyType(int *hotkey)
{
	if(hotkey)
	{
		memcpy(m_HotKey_Type, hotkey, C_VS_UI_SKILL::HOTKEY_MAX*sizeof(int));
	}
}

void C_VS_UI_WINDOW_MANAGER::SaveToFile(std::ofstream &file)
{
	int i = 0, j = 0;
	
	DWORD flag = 1 ; //0;
	file.write((const char *)&flag, sizeof(DWORD));
	
	BYTE hotkey_num = C_VS_UI_SKILL::HOTKEY_MAX, grade_num = C_VS_UI_SKILL::GRADE_MAX;
	file.write((const char *)&hotkey_num, sizeof(BYTE));
	file.write((const char *)&grade_num, sizeof(BYTE));
	for(i = 0; i < hotkey_num; i++)
	{
		for(j = 0; j < grade_num; j++)
		{
			file.write((const char *)&m_skill_hotkey_buf[i][j], sizeof(int));
		}
	}
	
	if(flag == 1)
	{
		BYTE	hotkeyQuickSlotNum = C_VS_UI_SKILL::HOTKEY_MAX ;
		file.write((char *)&hotkeyQuickSlotNum , sizeof(BYTE))  ;
		
		for(int iQuickSlotCnt = 0; iQuickSlotCnt < hotkeyQuickSlotNum; iQuickSlotCnt++)
		{
			file.write((char *)&m_QuickSlot_hotkey_buf[iQuickSlotCnt], sizeof(int));
		}
		
		for(int iHotKeyTypeCnt = 0; iHotKeyTypeCnt < hotkeyQuickSlotNum; iHotKeyTypeCnt++)
		{
			file.write((char *)&m_HotKey_Type[iHotKeyTypeCnt], sizeof(int));
		}
	}
	

	BYTE filter_num = CLD_TOTAL;
	file.write((const char *)&filter_num, sizeof(BYTE));
	for(i = 0; i < filter_num; i++)
	{
		file.write((const char *)&m_filter[i], sizeof(bool));
	}
	
	int window_num = QUEST_STATUS_WINDOW;
	file.write((const char *)&window_num, sizeof(int));
	for(i = 0; i < window_num; i++)
	{
		file.write((const char *)&m_alpha[i], sizeof(bool));
		file.write((const char *)&m_autohide[i], sizeof(Window::ATTRIBUTES_HIDE));
		//file.write((const char *)&m_rect[i], sizeof(Rect));
		if(i == MAINMENU)
		{
			//if(g_pUserInformation->IsResolution1024)	
				m_rect[i].Set( -1, -1, -g_pUserInformation->iResolution_x, -g_pUserInformation->iResolution_y);
			//else
			//	m_rect[i].Set(-1 , -1 , -1 , -1) ;
		}
		file.write((const char *)&m_rect[i], sizeof(Rect));
	}
	
	file.write((const char *)&m_bl_hpbar_height, sizeof(bool));
	file.write((const char *)&m_bl_hpbar_small, sizeof(bool));
	file.write((const char *)&m_bl_quickitemslot_height, sizeof(bool));
	file.write((const char *)&m_bl_effectstatus_height, sizeof(bool));
	file.write((const char *)&m_i_main_menu,sizeof(int));

	for( i = QUEST_STATUS_WINDOW; i < WINDOW_TOTAL; i++ )
	{
		file.write((const char *)&m_alpha[i], sizeof(bool));
		file.write((const char *)&m_autohide[i], sizeof(Window::ATTRIBUTES_HIDE));
		file.write((const char *)&m_rect[i], sizeof(Rect));
	}
	// 2004, 6, 4, sobeit add start
	file.write((const char *)&m_SMS_MyNum, 11);
	// 2004, 6, 4, sobeit add end
	file.write((const char *)&m_bl_bloodburst_height, sizeof(bool));
}

void C_VS_UI_WINDOW_MANAGER::LoadFromFile(ivfstream &file)
{
	// 각각 개수가 늘거나 줄었을때에 큱E?처리는.... 귀찮으니콅E나중에 하픸E.-;
	int i = 0, j = 0;
	
	bool bConvert = false ; 

	DWORD flag = 0;
	file.read((char *)&flag, sizeof(DWORD));
	
/*	BYTE hotkey_num = C_VS_UI_SKILL::HOTKEY_MAX, grade_num = C_VS_UI_SKILL::GRADE_MAX;
	file.read((char *)&hotkey_num, sizeof(BYTE));
	file.read((char *)&grade_num, sizeof(BYTE));

	for(i = 0; i < hotkey_num; i++)
	{
		for(j = 0; j < grade_num; j++)
		{
			file.read((char *)&m_skill_hotkey_buf[i][j], sizeof(int));
		}

		if((m_skill_hotkey_buf[i][0] != NOT_SELECTED) && (flag == 0))
		{
			m_HotKey_Type[i] = C_VS_UI_TRIBE::SKILL_TYPE ;	
		}

	}*/
	
	if(flag == 1)
	{

		BYTE hotkey_num = C_VS_UI_SKILL::HOTKEY_MAX, grade_num = C_VS_UI_SKILL::GRADE_MAX;
		file.read((char *)&hotkey_num, sizeof(BYTE));
		file.read((char *)&grade_num, sizeof(BYTE));

		for(i = 0; i < hotkey_num; i++)
		{
			for(j = 0; j < grade_num; j++)
			{
				file.read((char *)&m_skill_hotkey_buf[i][j], sizeof(int));
			}

			if((m_skill_hotkey_buf[i][0] != NOT_SELECTED) && (flag == 0))
			{
				m_HotKey_Type[i] = C_VS_UI_TRIBE::SKILL_TYPE ;	
			}

		}

		BYTE	hotkeyQuickSlotNum = C_VS_UI_SKILL::HOTKEY_MAX ;
		file.read((char *)&hotkeyQuickSlotNum , sizeof(BYTE))  ;
		
		for(int iQuickSlotCnt = 0; iQuickSlotCnt < hotkeyQuickSlotNum; iQuickSlotCnt++)
		{
			file.read((char *)&m_QuickSlot_hotkey_buf[iQuickSlotCnt], sizeof(int));
		}

		for(int iHotKeyTypeCnt = 0; iHotKeyTypeCnt < hotkeyQuickSlotNum; iHotKeyTypeCnt++)
		{
			file.read((char *)&m_HotKey_Type[iHotKeyTypeCnt], sizeof(int));
		}
	}
	else if(flag == 0 )
	{

		BYTE hotkey_num = C_VS_UI_SKILL::HOTKEY_MAX - 4 , grade_num = C_VS_UI_SKILL::GRADE_MAX;
		file.read((char *)&hotkey_num, sizeof(BYTE));
		file.read((char *)&grade_num, sizeof(BYTE));
		
		int	skill_hotkey_buf[8][4];

		for(i = 0; i < hotkey_num; i++)
		{
			for(j = 0; j < grade_num; j++)
			{
				file.read((char *)&skill_hotkey_buf[i][j], sizeof(int));
				m_skill_hotkey_buf[i][j] = NOT_SELECTED ; 
			}
		}

		hotkey_num = C_VS_UI_SKILL::HOTKEY_MAX, grade_num = C_VS_UI_SKILL::GRADE_MAX ;
		
		for(i = 0; i < hotkey_num; i++)
		{
			for(j = 0; j < grade_num; j++)
			{
				if(skill_hotkey_buf[i][0] != NOT_SELECTED) 
				{
					if(i < 4)
					{
						m_skill_hotkey_buf[i+8][j] =  skill_hotkey_buf[i][j] ; 
					}
					else if(i < 8)
					{
						m_skill_hotkey_buf[i][j] =  skill_hotkey_buf[i][j] ; 
					}

				}
			}
			
			if((m_skill_hotkey_buf[i][0] != NOT_SELECTED) && (flag == 0))
			{
				m_HotKey_Type[i] = C_VS_UI_TRIBE::SKILL_TYPE ;	
			}
		}

		InitDefaultQuickSlot() ;  

		/*BYTE	hotkeyQuickSlotNum = C_VS_UI_SKILL::HOTKEY_MAX ;

		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			{
				for(int iHotKeyTypeCnt = 0; iHotKeyTypeCnt < hotkeyQuickSlotNum; iHotKeyTypeCnt++)
				{
					if(iHotKeyTypeCnt < 8)
					{
						m_QuickSlot_hotkey_buf[iHotKeyTypeCnt] = 	iHotKeyTypeCnt ; 
						m_HotKey_Type[iHotKeyTypeCnt] = C_VS_UI_TRIBE::QUICKITEM_TYPE ;
					}
					else
					{
						m_QuickSlot_hotkey_buf[iHotKeyTypeCnt] = -1 ;
						
						if(m_HotKey_Type[iHotKeyTypeCnt] != C_VS_UI_TRIBE::SKILL_TYPE)
							m_HotKey_Type[iHotKeyTypeCnt] = C_VS_UI_TRIBE::NOT_SELECT_TYPE ; 
						
					}
				}
            }    
			break;

		case RACE_VAMPIRE:
			 {
				for(int iHotKeyTypeCnt = 0; iHotKeyTypeCnt < hotkeyQuickSlotNum; iHotKeyTypeCnt++)
				{
					m_QuickSlot_hotkey_buf[iHotKeyTypeCnt] = -1 ;
					if(m_HotKey_Type[iHotKeyTypeCnt] != C_VS_UI_TRIBE::SKILL_TYPE)
						m_HotKey_Type[iHotKeyTypeCnt] = C_VS_UI_TRIBE::NOT_SELECT_TYPE ; 
				
				}
             }    

			break;

		case RACE_OUSTERS:
			 { 
				for(int iHotKeyTypeCnt = 0; iHotKeyTypeCnt < hotkeyQuickSlotNum ; iHotKeyTypeCnt++)
				{
					if(iHotKeyTypeCnt < 4)
					{
					   m_QuickSlot_hotkey_buf[iHotKeyTypeCnt] = 	iHotKeyTypeCnt ;
					   m_HotKey_Type[iHotKeyTypeCnt] = C_VS_UI_TRIBE::QUICKITEM_TYPE ; 
					}
					else
					{
						m_QuickSlot_hotkey_buf[iHotKeyTypeCnt] = -1 ; 
						if(m_HotKey_Type[iHotKeyTypeCnt] != C_VS_UI_TRIBE::SKILL_TYPE)
							m_HotKey_Type[iHotKeyTypeCnt] = C_VS_UI_TRIBE::NOT_SELECT_TYPE ; 
					}
				}
			 } 
			break;	
		}*/
	}



	BYTE filter_num = CLD_TOTAL;
	file.read((char *)&filter_num, sizeof(BYTE));
	for(i = 0; i < filter_num; i++)
	{
		file.read((char *)&m_filter[i], sizeof(bool));
	}
	
	int window_num = QUEST_STATUS_WINDOW;
	file.read((char *)&window_num, sizeof(int));
	for(i = 0; i < window_num; i++)
	{
		file.read((char *)&m_alpha[i], sizeof(bool));
		file.read((char *)&m_autohide[i], sizeof(Window::ATTRIBUTES_HIDE));
		file.read((char *)&m_rect[i], sizeof(Rect));

		// 메인 메뉴의 위치를 보고 이전 해상도를 알 수 있다.
		if(i == MAINMENU)
		{
			if(m_rect[i].x  == -1 && m_rect[i].y == -1)
				bConvert  = g_pUserInformation->iResolution_x != -m_rect[i].w ||
							g_pUserInformation->iResolution_y != -m_rect[i].h; 
			
			m_rect[i].Set(-1 , -1 , -1 , -1) ;
		}
	}
	
	file.read((char *)&m_bl_hpbar_height, sizeof(bool));
	file.read((char *)&m_bl_hpbar_small, sizeof(bool));
	file.read((char *)&m_bl_quickitemslot_height, sizeof(bool));
	file.read((char *)&m_bl_effectstatus_height, sizeof(bool));
	file.read((char *)&m_i_main_menu,sizeof(int));

	for( i = QUEST_STATUS_WINDOW; i < WINDOW_TOTAL; i++ )
	{
		file.read((char *)&m_alpha[i], sizeof(bool));
		file.read((char *)&m_autohide[i], sizeof(Window::ATTRIBUTES_HIDE));
		file.read((char *)&m_rect[i], sizeof(Rect));
	}
	// 2004, 6, 4, sobeit add start
	file.read((char *)&m_SMS_MyNum, 11);
	file.read((char *)&m_bl_bloodburst_height, sizeof(bool));

	if(bConvert)
	{
		for( i = 0; i < WINDOW_TOTAL; i++)
		{
			SetAlpha((WINDOW_ID)i, false);
			SetAutoHide((WINDOW_ID)i, Window::ATTRIBUTES_HIDE_NOT);
			SetRect((WINDOW_ID)i, Rect(-1, -1, -1, -1));
		}
	}
	// 2004, 6, 4, sobeit add end
	


//	gC_vs_ui.SetSelectMainTab(tab);
}	
// 2004, 6, 4, sobeit add start
void C_VS_UI_WINDOW_MANAGER::SetSMSMynum(char* str)
{
	int len = strlen(str);
	if(len>0 && len<12)
	{
		strcpy(m_SMS_MyNum, str);
		m_SMS_MyNum[len] = '\0';
	}
}


// 2004, 6, 4, sobeit add end
C_VS_UI_TEAM_LIST::C_VS_UI_TEAM_LIST(bool ready, bool IsUnion)
{
	m_bl_ready = ready;
	
	g_RegisterWindow(this);
	
	AttrTopmost(true);
	AttrKeyboardControl(true);

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_guild_spk.Open(SPK_SLAYER_TEAM);
		break;

	case RACE_VAMPIRE:
		m_guild_spk.Open(SPK_VAMPIRE_TEAM);
		break;

	case  RACE_OUSTERS:
		m_guild_spk.Open(SPK_OUSTERS_TEAM);
		break;
	}	
	
	
	//Set(RESOLUTION_X/2-m_guild_spk.GetWidth(0)/2, RESOLUTION_Y/2 - m_guild_spk.GetHeight(0)/2, m_guild_spk.GetWidth(0), m_guild_spk.GetHeight(0));
	Set(g_pUserInformation->iResolution_x/2-m_guild_spk.GetWidth(0)/2, g_pUserInformation->iResolution_y/2 - m_guild_spk.GetHeight(0)/2, m_guild_spk.GetWidth(0), m_guild_spk.GetHeight(0));
	
	// set button
	m_pC_button_group = new ButtonGroup(this);
	
	if(g_eRaceInterface != RACE_SLAYER)
	{
		m_vampire_point.x = 17;
		m_vampire_point.y = 0;
	}
	else
	{
		m_vampire_point.x = 0;
		m_vampire_point.y = 0;
	}
	
	int help_x = 353, x_x = 367, button_y = 2;
	const int scroll_x = 365+m_vampire_point.x, scroll_up_y = 96+m_vampire_point.y, scroll_down_y = 312+m_vampire_point.y;
	
	//	int print_x[4], print_y = y+123, print_gap = 23;
	int scroll_tag_x = 365+m_vampire_point.x, scroll_tag_y = y+108+m_vampire_point.y, scroll_tag_height = 198;
	
	m_print_x[0] = x+95+m_vampire_point.x;	//team
	m_print_x[1] = x+180+m_vampire_point.x;	//leader
	m_print_x[2] = x+256+m_vampire_point.x;	//members
	m_print_x[3] = x+325+m_vampire_point.x;	//ranking
	m_print_y = y+123+m_vampire_point.y;
	m_print_gap = 23;

	if(g_eRaceInterface != RACE_SLAYER)
	{
		button_y = 20;
		help_x+=20; x_x+=20;
	}	
	
	//help, x버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + help_x, y + button_y, m_guild_spk.GetWidth(HELP_BUTTON), m_guild_spk.GetHeight(HELP_BUTTON), HELP_ID, this, HELP_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + x_x, y + button_y, m_guild_spk.GetWidth(X_BUTTON), m_guild_spk.GetHeight(X_BUTTON), X_ID, this, X_BUTTON));
	
	//scroll up, down 버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + scroll_x, y + scroll_up_y, m_guild_spk.GetWidth(SCROLL_UP_BUTTON), m_guild_spk.GetHeight(SCROLL_UP_BUTTON), SCROLL_UP_ID, this, SCROLL_UP_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + scroll_x, y + scroll_down_y, m_guild_spk.GetWidth(SCROLL_DOWN_BUTTON), m_guild_spk.GetHeight(SCROLL_DOWN_BUTTON), SCROLL_DOWN_ID, this, SCROLL_DOWN_BUTTON));
	
	//team_list 버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + w/2-m_guild_spk.GetWidth(TITLE_TEAM_LIST)/2, y + 50, m_guild_spk.GetWidth(TITLE_TEAM_LIST), m_guild_spk.GetHeight(TITLE_TEAM_LIST), TEAM_LIST_ID, this, TITLE_TEAM_LIST));
	
	//index버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(m_print_x[0] - m_guild_spk.GetWidth(INDEX_TEAM)/2-10, m_print_y+m_print_gap*-1, m_guild_spk.GetWidth(INDEX_TEAM), m_guild_spk.GetHeight(INDEX_TEAM), INDEX_TEAM_ID, this, INDEX_TEAM));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(m_print_x[1] - m_guild_spk.GetWidth(INDEX_LEADER)/2, m_print_y+m_print_gap*-1, m_guild_spk.GetWidth(INDEX_LEADER), m_guild_spk.GetHeight(INDEX_LEADER), INDEX_LEADER_ID, this, INDEX_LEADER));
	if(m_bl_ready)
	{
		//		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(m_print_x[2] - m_guild_spk.GetWidth(INDEX_EXPIREDATE)/2, m_print_y+m_print_gap*-1, m_guild_spk.GetWidth(INDEX_EXPIREDATE), m_guild_spk.GetHeight(INDEX_EXPIREDATE), INDEX_EXPIREDATE_ID, this, INDEX_EXPIREDATE));
		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(m_print_x[3] - m_guild_spk.GetWidth(INDEX_MEMBERS)/2, m_print_y+m_print_gap*-1, m_guild_spk.GetWidth(INDEX_MEMBERS), m_guild_spk.GetHeight(INDEX_MEMBERS), INDEX_MEMBERS_ID, this, INDEX_MEMBERS));
	}
	else
	{
		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(m_print_x[2] - m_guild_spk.GetWidth(INDEX_MEMBERS)/2, m_print_y+m_print_gap*-1, m_guild_spk.GetWidth(INDEX_MEMBERS), m_guild_spk.GetHeight(INDEX_MEMBERS), INDEX_MEMBERS_ID, this, INDEX_MEMBERS));
		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(m_print_x[3] - m_guild_spk.GetWidth(INDEX_RANKING)/2, m_print_y+m_print_gap*-1, m_guild_spk.GetWidth(INDEX_RANKING), m_guild_spk.GetHeight(INDEX_RANKING), INDEX_RANKING_ID, this, INDEX_RANKING));
	}
	
	//search버튼
	int search_x, search_x2, search_y;
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		search_x = x+54;
		search_x2 = x+268;
		search_y = y+h-49;
		break;
		
	case RACE_VAMPIRE:
		search_x = x+54+19;
		search_x2 = x+268+18;
		search_y = y+h-79;
		break;
		
	case RACE_OUSTERS:
		search_x = x+54+19;
		search_x2 = x+268+18;
		search_y = y+h-79;
		break;
	}

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(search_x, search_y, m_guild_spk.GetWidth(SEARCH_NAME), m_guild_spk.GetHeight(SEARCH_NAME), SEARCH_TYPE_ID, this, SEARCH_NAME));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(search_x2, search_y, m_guild_spk.GetWidth(SEARCH_SEARCH), m_guild_spk.GetHeight(SEARCH_SEARCH), SEARCH_ID, this, SEARCH_SEARCH));
	
	//CLOSE버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-14, y+h-49, m_guild_spk.GetWidth(CLOSE_BUTTON), m_guild_spk.GetHeight(CLOSE_BUTTON), CLOSE_ID, this, CLOSE_BUTTON));
	
	m_scroll = 0;
	m_bl_scrolling = false;
	
	m_iFocus = -1;
	m_last_sort_type = 0;
	
	m_search_type = SEARCH_NAME;
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_lev_search.SetPosition(x+w/2-m_guild_spk.GetWidth(BAR_SEARCH)/2+2, y+h-50+4);
		break;
		
	case RACE_VAMPIRE:
		m_lev_search.SetPosition(x+w/2-m_guild_spk.GetWidth(BAR_SEARCH)/2+2, y+h-80+4);
		break;
		
	case RACE_OUSTERS:
		m_lev_search.SetPosition(x+w/2-m_guild_spk.GetWidth(BAR_SEARCH)/2+2, y+h-80+4);
		break;
	}
	m_lev_search.SetByteLimit(16);
	
	Attach(&m_lev_search);

	m_bIsUnion = IsUnion;
	
}

C_VS_UI_TEAM_LIST::~C_VS_UI_TEAM_LIST()
{
	g_UnregisterWindow(this);
	
	m_lev_search.Unacquire();
	
	gC_vs_ui.AcquireChatting();
	
	DeleteNew( m_pC_button_group );
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_LIST::Process
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_LIST::Process()
{
	m_pC_button_group->Process();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_LIST::UnacquireMouseFocus
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_LIST::UnacquireMouseFocus()
{
	m_pC_button_group->UnacquireMouseFocus();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_LIST::Start
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_LIST::Start()
{
	PI_Processor::Start();
	m_pC_button_group->Init();
	
	AttrTopmost(true);
	AttrKeyboardControl(true);
	gpC_window_manager->AppearWindow(this);
	
	m_lev_search.Acquire();
	m_lev_search.EraseAll();
	
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_LIST::Finish
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_LIST::Finish()
{
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_LIST::Show 
//
//
//-----------------------------------------------------------------------------
void C_VS_UI_TEAM_LIST::Show()
{
	int scroll_tag_x = x+365+m_vampire_point.x, scroll_tag_y = y+108+m_vampire_point.y, scroll_tag_height = 198;
	
	// Lock 부분 모으기~
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_guild_spk.BltLocked(x, y);

		int search_y;
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			search_y = y+h-50;
			break;
			
		case RACE_VAMPIRE:
			search_y = y+h-80;
			break;
			
		case RACE_OUSTERS:
			search_y = y+h-80;
			break;
		}

		m_guild_spk.BltLocked(x+w/2-m_guild_spk.GetWidth(BAR_SEARCH)/2, search_y, BAR_SEARCH);

		m_guild_spk.BltLocked(scroll_tag_x-2, m_print_y-6+m_print_gap*-1, SCROLL_BAR);
		m_guild_spk.BltLocked(m_print_x[0]-71, m_print_y-5+m_print_gap*-1,BAR_DARKEN);	
		if(m_iFocus != -1)
			m_guild_spk.BltLocked(m_print_x[0]-71, m_print_y-5+m_print_gap*m_iFocus, BAR_HILIGHTED);
		//스크롤TAG찍기
		int list_size_search=m_bl_ready ? m_v_ready_team_search_list.size() : m_v_regist_team_search_list.size() ;
		int list_size=m_bl_ready ? m_v_ready_team_list.size() : m_v_regist_team_list.size() ;
		if(list_size_search)
		{
			if(list_size_search > 9)	// 스크롤이 생기는 경우에만
			{
				if(m_bl_scrolling)
					m_guild_spk.BltLocked(scroll_tag_x, min(max(gpC_mouse_pointer->GetY(), scroll_tag_y), scroll_tag_y+scroll_tag_height), SCROLL_TAG);
				else
					m_guild_spk.BltLocked(scroll_tag_x, scroll_tag_y+scroll_tag_height*m_scroll/(list_size_search-9), SCROLL_TAG);
			}
		}
		else
		if(list_size > 9)	// 스크롤이 생기는 경우에만
		{
			if(m_bl_scrolling)
				m_guild_spk.BltLocked(scroll_tag_x, min(max(gpC_mouse_pointer->GetY(), scroll_tag_y), scroll_tag_y+scroll_tag_height), SCROLL_TAG);
			else
				m_guild_spk.BltLocked(scroll_tag_x, scroll_tag_y+scroll_tag_height*m_scroll/(list_size-9), SCROLL_TAG);
		}
		m_pC_button_group->Show();
		gpC_base->m_p_DDSurface_back->Unlock();
	}
	
	m_lev_search.Show();	
	
	gpC_base->m_p_DDSurface_back->HLine(m_print_x[0]-72, m_print_y-6+m_print_gap*-1, 334, 0);
	gpC_base->m_p_DDSurface_back->HLine(m_print_x[0]-72, m_print_y-6+m_print_gap*0, 334, 0);	
	
	gpC_base->m_p_DDSurface_back->VLine(m_print_x[0]-72, m_print_y-6+m_print_gap*-1, m_print_gap*10, 0);
	gpC_base->m_p_DDSurface_back->VLine(m_print_x[0]-49, m_print_y-6, m_print_gap*9, 0);
	gpC_base->m_p_DDSurface_back->VLine(m_print_x[0]+48, m_print_y-6+m_print_gap*-1, m_print_gap*10, 0);
	gpC_base->m_p_DDSurface_back->VLine(m_print_x[1]+37, m_print_y-6+m_print_gap*-1, m_print_gap*10, 0);
	gpC_base->m_p_DDSurface_back->VLine(m_print_x[2]+35, m_print_y-6+m_print_gap*-1, m_print_gap*10, 0);
	gpC_base->m_p_DDSurface_back->VLine(m_print_x[3]+32, m_print_y-6+m_print_gap*-1, m_print_gap*10+1, 0);	
	
	if(m_bl_ready)	// 대기 list
	{
		for(int i = 0; i < 9; i++)
		{
			gpC_base->m_p_DDSurface_back->HLine(m_print_x[0]-72, m_print_y+(i+1)*m_print_gap-6, 334, 0);

			if(m_v_ready_team_search_list.size() && m_scroll+i >= m_v_ready_team_search_list.size() || m_scroll+i >= m_v_ready_team_list.size())
				continue;
			const char *string;
			
			READY_TEAM_LIST *info;
			if(m_v_ready_team_search_list.size())
				info = &m_v_ready_team_search_list[i+m_scroll];
			else
				info = &m_v_ready_team_list[i+m_scroll];

			string = info->TEAM_NAME.c_str();
			g_PrintColorStr(m_print_x[0]-g_GetStringWidth(string, gpC_base->m_chatting_pi.hfont)/2, m_print_y+i*m_print_gap, string, gpC_base->m_chatting_pi, RGB_BLACK);
			// 대기 리스트인경우 길드 마크 대신 빈 박스를 출력할라다 걍 출력-ㅅ-
			RECT rect;
			rect.left = m_print_x[0]-70;
			rect.right = rect.left +20;
			rect.top = m_print_y+i*m_print_gap-4;
			rect.bottom = rect.top+20;
			
			// 길드 마크 출력
			CSprite *p_guild_mark;
			p_guild_mark=g_pGuildMarkManager->GetGuildMarkSmall(info->guild_id);

			if(p_guild_mark==NULL)
			{
				g_pGuildMarkManager->LoadGuildMark(info->guild_id);
				p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(info->guild_id);
			}
			POINT guild_point = { rect.left,rect.top };
			if(p_guild_mark != NULL)	// 악!! CSprite직접 쓸때는 Lock할것!! by 쑥갓
			{
				if(gpC_base->m_p_DDSurface_back->Lock())
				{
					gpC_base->m_p_DDSurface_back->BltSprite(&guild_point, p_guild_mark);
					gpC_base->m_p_DDSurface_back->Unlock();
				}
			}
			else
			{
				RECT rt={rect.left,rect.top,rect.left+20,rect.top+20};
				DrawAlphaBox(&rt, 255, 255, 255, 15);
			}
			
			g_FL2_GetDC();
			string = info->LEADER_NAME.c_str();
			g_PrintColorStr(m_print_x[1]-g_GetStringWidth(string, gpC_base->m_chatting_pi.hfont)/2, m_print_y+i*m_print_gap, string, gpC_base->m_chatting_pi, RGB_BLACK);
			//			string = info->EXPIRE_DATE.c_str();
			//			g_PrintColorStr(m_print_x[2]-g_GetStringWidth(string, gpC_base->m_small_pi.hfont)/2, m_print_y+i*m_print_gap, string, gpC_base->m_small_pi, RGB_BLACK);
			
			char sz_temp[100];
			wsprintf(sz_temp, "%d/%d", info->MEMBERS, info->MEMBERS_MAX);
			g_PrintColorStr(m_print_x[3]-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, m_print_y+i*m_print_gap, sz_temp, gpC_base->m_chatting_pi, RGB_BLACK);
			g_FL2_ReleaseDC();
		}
	}
	else	//등록된 list
	{
		for(int i = 0; i < 9; i++)
		{
			gpC_base->m_p_DDSurface_back->HLine(m_print_x[0]-72, m_print_y+(i+1)*m_print_gap-6, 334, 0);
			
			if(m_v_regist_team_search_list.size() && m_scroll+i >= m_v_regist_team_search_list.size() || m_scroll+i >= m_v_regist_team_list.size())
				continue;
			
			const char *string;
			
			REGIST_TEAM_LIST *info;
			if(m_v_regist_team_search_list.size())
				info = &m_v_regist_team_search_list[i+m_scroll];
			else
				info = &m_v_regist_team_list[i+m_scroll];
			
			string = info->TEAM_NAME.c_str();
			g_PrintColorStr(m_print_x[0]-g_GetStringWidth(string, gpC_base->m_chatting_pi.hfont)/2, m_print_y+i*m_print_gap, string, gpC_base->m_chatting_pi, RGB_BLACK);
			RECT rect;
			rect.left = m_print_x[0]-70;
			//			rect.right = rect.left +20;
			rect.top = m_print_y+i*m_print_gap-4;
			//			rect.bottom = rect.top+20;
			
			// 길드 마크 출력
			CSprite *p_guild_mark;
			p_guild_mark=g_pGuildMarkManager->GetGuildMarkSmall(info->guild_id);
			if(p_guild_mark==NULL)
			{
				g_pGuildMarkManager->LoadGuildMark(info->guild_id);
				p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(info->guild_id);			
			}
			POINT guild_point = { rect.left,rect.top };
			if(p_guild_mark != NULL)	// 악!! CSprite직접 쓸때는 Lock할것!! by 쑥갓
			{
				if(gpC_base->m_p_DDSurface_back->Lock())
				{
					gpC_base->m_p_DDSurface_back->BltSprite(&guild_point, p_guild_mark);
					gpC_base->m_p_DDSurface_back->Unlock();
				}
			}
			else
			{
				RECT rt={rect.left,rect.top,rect.left+20,rect.top+20};
				DrawAlphaBox(&rt, 255, 255, 255, 15);
			}
			
			g_FL2_GetDC();
			string = info->LEADER_NAME.c_str();
			g_PrintColorStr(m_print_x[1]-g_GetStringWidth(string, gpC_base->m_chatting_pi.hfont)/2, m_print_y+i*m_print_gap, string, gpC_base->m_chatting_pi, RGB_BLACK);
			
			char sz_temp[100];
			wsprintf(sz_temp, "%d", info->MEMBERS);
			g_PrintColorStr(m_print_x[2]-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, m_print_y+i*m_print_gap, sz_temp, gpC_base->m_chatting_pi, RGB_BLACK);
			
			wsprintf(sz_temp, "%d", info->RANKING);
			g_PrintColorStr(m_print_x[3]-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2, m_print_y+i*m_print_gap, sz_temp, gpC_base->m_chatting_pi, RGB_BLACK);
			g_FL2_ReleaseDC();
		}
	}	
	m_pC_button_group->ShowDescription();
	
	SHOW_WINDOW_ATTR;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_LIST::ShowButtonDescription
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_LIST::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	const static char*	m_help_string[EXEC_MAX] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_REGIST].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_LIST_UP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_LIST_DOWN].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_REFRESH_LIST].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SORT_TEAM_NAME].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SORT_LEADER_NAME].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SORT_EXPIRE_DATE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SORT_NUMBER_MEMBER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SORT_RANKING].GetString(),
			
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CHANGE_FIND_MODE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_FIND].GetString(),
	};
	
	if (!m_bl_scrolling)
		g_descriptor_manager.Set(DID_INFO, p_button->x, p_button->y, (void *)m_help_string[p_button->GetID()],0,0);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_LIST::ShowButtonWidget
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_LIST::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	assert(p_button);	
	switch(p_button->GetID())
	{
	case X_ID:
	case HELP_ID:
	case SCROLL_UP_ID:
	case SCROLL_DOWN_ID:
		if(p_button->GetFocusState() && p_button->GetPressState())
			m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index+1);
		else
			m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index);
		break;
		
	case TEAM_LIST_ID:
	case INDEX_TEAM_ID:
	case INDEX_LEADER_ID:
		//	case INDEX_EXPIREDATE_ID:
	case INDEX_MEMBERS_ID:
	case INDEX_RANKING_ID:
	case CLOSE_ID:
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_guild_spk.BltLocked(p_button->x, p_button->y+2, p_button->m_image_index+1);
			else
				m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index+1);
		}
		else
			m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index);
		break;
		
	case SEARCH_TYPE_ID:
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_guild_spk.BltLocked(p_button->x, p_button->y, m_search_type+2);
			else
				m_guild_spk.BltLocked(p_button->x, p_button->y, m_search_type+1);
		}
		else
			m_guild_spk.BltLocked(p_button->x, p_button->y, m_search_type);
		break;
		
	case SEARCH_ID:
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index+2);
			else
				m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index+1);
		}
		else
			m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index);
		break;
		
	}
	
}

//-----------------------------------------------------------------------------
//
// keyboard
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_LIST::KeyboardControl(UINT message, UINT key, long extra)
{
	
	Window::KeyboardControl(message, key, extra);
	
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_RETURN:
			Run(SEARCH_ID);
			break;
			
		case VK_ESCAPE: 
			gpC_base->SendMessage(UI_CLOSE_TEAM_LIST);
			break;
		}
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_LIST::MouseControl
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_TEAM_LIST::MouseControl(UINT message, int _x, int _y)
{
	if(!m_lev_search.IsAcquire())
		m_lev_search.Acquire();
	
	int scroll_tag_x = x+365+m_vampire_point.x, scroll_tag_y = y+108+m_vampire_point.y, scroll_tag_height = 198;
	
	Window::MouseControl(message, _x, _y);
	
	switch(message)
	{
	case M_MOVING:
		if(m_bl_scrolling)
		{
			if(m_bl_ready)
			{
				if(m_v_ready_team_search_list.size())
					m_scroll = min(m_v_ready_team_search_list.size()-9, (m_v_ready_team_search_list.size()-9)*(max(_y, scroll_tag_y) - scroll_tag_y + scroll_tag_height/(m_v_ready_team_search_list.size()-9)/2)/scroll_tag_height);
				else
					m_scroll = min(m_v_ready_team_list.size()-9, (m_v_ready_team_list.size()-9)*(max(_y, scroll_tag_y) - scroll_tag_y + scroll_tag_height/(m_v_ready_team_list.size()-9)/2)/scroll_tag_height);
			}
			else
			{
				if(m_v_regist_team_search_list.size())
					m_scroll = min(m_v_regist_team_search_list.size()-9, (m_v_regist_team_search_list.size()-9)*(max(_y, scroll_tag_y) - scroll_tag_y + scroll_tag_height/(m_v_regist_team_search_list.size()-9)/2)/scroll_tag_height);
				else
					m_scroll = min(m_v_regist_team_list.size()-9, (m_v_regist_team_list.size()-9)*(max(_y, scroll_tag_y) - scroll_tag_y + scroll_tag_height/(m_v_regist_team_list.size()-9)/2)/scroll_tag_height);
			}
		}
		else
		{
			if(_x > m_print_x[0]-72 && _x < m_print_x[0]-72+334 && _y > m_print_y-5 && _y < m_print_y-7+m_print_gap*9)
			{
				if(m_iFocus != (_y - (m_print_y-6))/m_print_gap)
				{
					if(gpC_Imm)
						gpC_Imm->ForceUI(CImm::FORCE_UI_GRID);
					m_iFocus = (_y - (m_print_y-6))/m_print_gap;
				}
			}
			else
			{
				if(m_iFocus != -1)
				{
					if(gpC_Imm)
						gpC_Imm->ForceUI(CImm::FORCE_UI_GRID);
					m_iFocus = -1;
				}
			}
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if(_x >= scroll_tag_x && _x <= scroll_tag_x+m_guild_spk.GetWidth(SCROLL_BAR) && _y >= scroll_tag_y && _y <= scroll_tag_y+scroll_tag_height)
		{
			if(m_bl_ready)
			{
				if(m_v_ready_team_search_list.size() > 9)
				{
					m_bl_scrolling = true;
					m_scroll = (m_v_ready_team_search_list.size()-9)*(_y - scroll_tag_y + scroll_tag_height/(m_v_ready_team_search_list.size()-9)/2)/scroll_tag_height;
				}
				else
					if(m_v_ready_team_list.size() > 9)	// 스크롤이 생기는 경우에만
					{
						m_bl_scrolling = true;
						m_scroll = (m_v_ready_team_list.size()-9)*(_y - scroll_tag_y + scroll_tag_height/(m_v_ready_team_list.size()-9)/2)/scroll_tag_height;
					}
			}
			else
			{
				if(m_v_regist_team_search_list.size() > 9)	// 스크롤이 생기는 경우에만
				{
					m_bl_scrolling = true;
					m_scroll = (m_v_regist_team_search_list.size()-9)*(_y - scroll_tag_y + scroll_tag_height/(m_v_regist_team_search_list.size()-9)/2)/scroll_tag_height;
				}
				else
					if(m_v_regist_team_list.size() > 9)	// 스크롤이 생기는 경우에만
					{
						m_bl_scrolling = true;
						m_scroll = (m_v_regist_team_list.size()-9)*(_y - scroll_tag_y + scroll_tag_height/(m_v_regist_team_list.size()-9)/2)/scroll_tag_height;
					}
			}
		}
		else if(m_iFocus != -1)
		{
			if(m_bl_ready)
			{
				if(m_v_ready_team_search_list.size())
				{
					if(m_v_ready_team_search_list.size() > m_iFocus + m_scroll)
						gpC_base->SendMessage(UI_SELECT_READY_TEAM_LIST, m_v_ready_team_search_list[m_iFocus + m_scroll].guild_id, 0, (void *)m_v_ready_team_search_list[m_iFocus + m_scroll].TEAM_NAME.c_str());
				}
				else
					if(m_v_ready_team_list.size())
					{
						if(m_v_ready_team_list.size() > m_iFocus + m_scroll)
							gpC_base->SendMessage(UI_SELECT_READY_TEAM_LIST, m_v_ready_team_list[m_iFocus + m_scroll].guild_id, 0, (void *)m_v_ready_team_list[m_iFocus + m_scroll].TEAM_NAME.c_str());
					}
			}
			else
			{
				if(m_v_regist_team_search_list.size())
				{
					if(m_v_regist_team_search_list.size() > m_iFocus + m_scroll)
						gpC_base->SendMessage(UI_SELECT_REGIST_TEAM_LIST, m_v_regist_team_search_list[m_iFocus + m_scroll].guild_id, 0, (void *)m_v_regist_team_search_list[m_iFocus + m_scroll].TEAM_NAME.c_str());
				}
				else
				if(m_v_regist_team_list.size())
				{
					if(m_v_regist_team_list.size() > m_iFocus + m_scroll)
						gpC_base->SendMessage(UI_SELECT_REGIST_TEAM_LIST, m_v_regist_team_list[m_iFocus + m_scroll].guild_id, 0, (void *)m_v_regist_team_list[m_iFocus + m_scroll].TEAM_NAME.c_str());
				}
			}
		}
		break;
		
	case M_LEFTBUTTON_UP:
		if(m_bl_scrolling)
		{
			m_bl_scrolling = false;
		}
		break;
		
	case M_WHEEL_UP:
		Run(SCROLL_UP_ID);
		break;
		
	case M_WHEEL_DOWN:
		Run(SCROLL_DOWN_ID);
		break;
	}
	
	m_pC_button_group->MouseControl(message, _x, _y);
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_LIST::IsPixel
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_TEAM_LIST::IsPixel(int _x, int _y)
{
	bool re = m_guild_spk.IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y));
	
	if(re == false)
	{
		if(m_guild_spk.IsPixel(_x - (x+w-14), _y - (y+h-49), CLOSE_BUTTON))
			re = true;
	}
	
	return re;
}


//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::C_VS_UI_TEAM_MEMBER_LIST
//
//
//-----------------------------------------------------------------------------
C_VS_UI_TEAM_MEMBER_LIST::C_VS_UI_TEAM_MEMBER_LIST()
{
#ifndef _LIB
	g_pUserInformation->GuildGrade = 1;
#endif
	g_RegisterWindow(this);
	
	AttrTopmost(true);
	AttrKeyboardControl(true);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_guild_member_list_spk.Open(SPK_VAMPIRE_TEAM_MEMBER);
		break;
		
	case RACE_VAMPIRE:
		m_guild_member_list_spk.Open(SPK_SLAYER_TEAM_MEMBER);
		break;
		
	case RACE_OUSTERS:
		m_guild_member_list_spk.Open(SPK_SLAYER_TEAM_MEMBER);
		break;
	}
	
	//Set(400-300/2, 100, 300, 330);
	Set(200, 100, 400, 360);
	
	
	
	// set button
	m_pC_button_group = new ButtonGroup(this);
	
	const int help_x = 353, x_x = 367, button_y = 2;
	
	m_print_x[0] = 30;	//team
	//m_print_x[1] = 180;	//leader
	m_print_x[1] = 280;	//leader
	m_print_y = 31;
	m_print_gap = 23;
	
	m_pC_scroll_bar = new C_VS_UI_SCROLL_BAR(0, Rect(w-25, m_print_y+15, -1, m_print_gap*12-30));
	m_pC_scroll_bar->SetPosMax(0);
	//CLOSE버튼
	//m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(196, h-35, m_guild_member_list_spk.GetWidth(BUTTON_CLOSE), m_guild_member_list_spk.GetHeight(BUTTON_CLOSE), CLOSE_ID, this, BUTTON_CLOSE));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(296, h-35, m_guild_member_list_spk.GetWidth(BUTTON_CLOSE), m_guild_member_list_spk.GetHeight(BUTTON_CLOSE), CLOSE_ID, this, BUTTON_CLOSE));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(10, m_print_y-2, 110, m_print_gap, SORT_ID, this, IMAGE_NULL));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(121, m_print_y-2, 140 , m_print_gap, SORT_SERVER, this, IMAGE_NULL));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(262, m_print_y-2, 100, m_print_gap, SORT_GRADE, this, IMAGE_NULL));
	
	m_focus = -1;
	m_SortFlag_Id = false;
	m_SortFlag_Server = false;
	m_SortFlag_Grade = false;
	m_ButtonFlag[0] = 0;
	m_ButtonFlag[1] = 0;
	m_ButtonFlag[2] = 0;

	m_bAvailableRecall = 0;
}

C_VS_UI_TEAM_MEMBER_LIST::~C_VS_UI_TEAM_MEMBER_LIST()
{
	g_UnregisterWindow(this);
	
	DeleteNew( m_pC_button_group );
	DeleteNew( m_pC_scroll_bar);
	DeleteNew( m_pC_button_group );
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::Process
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_LIST::Process()
{
	m_pC_button_group->Process();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::UnacquireMouseFocus
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_LIST::UnacquireMouseFocus()
{
	m_pC_button_group->UnacquireMouseFocus();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::Start
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_LIST::Start()
{
	PI_Processor::Start();
	m_pC_button_group->Init();
	
	AttrTopmost(true);
	AttrKeyboardControl(true);
	gpC_window_manager->AppearWindow(this);
	
	//gpC_base->SendMessage(UI_REQUEST_GUILD_MEMBER_LIST);
	
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::Finish
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_LIST::Finish()
{
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::Show
//
//
//-----------------------------------------------------------------------------
void C_VS_UI_TEAM_MEMBER_LIST::Show()
{
	const static char* grade_string[4] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_GRADE_MEMBER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_GRADE_MASTER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_GRADE_SUB_MASTER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_GRADE_WAIT].GetString(),		
	};

	const static char* menu_string[3] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_LIST_ID].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_LIST_SERVER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GUILD_LIST_GRADE].GetString(),		
	};
	
	gpC_global_resource->DrawDialog2(x, y, w, h, GetAttributes()->alpha);
	gpC_global_resource->DrawOutBox(x+10, y+m_print_y-2, w-40, m_print_gap*12+5);
	
	
	int i = 0;
	
	
	// 선긋기
	for(i = 1; i < 12; i++)
	{
		gpC_base->m_p_DDSurface_back->HLine(x+10, y+m_print_y+m_print_gap*i, w-40, 0);
	}	
	for( i = 0; i< 2; i++)
	{
		gpC_base->m_p_DDSurface_back->VLine(x+120 + i*140, y+m_print_y-2, h-80, 0);
	}
	int guildNameY = 6;
	if(g_eRaceInterface == RACE_OUSTERS)
	{
		guildNameY = 8;
	}

	// 길드마크 출력 부분
	CSprite *p_guild_mark;
	p_guild_mark=g_pGuildMarkManager->GetGuildMarkSmall(g_char_slot_ingame.GUILD_ID);
	if(p_guild_mark==NULL)
	{
		g_pGuildMarkManager->LoadGuildMark(g_char_slot_ingame.GUILD_ID);
		p_guild_mark=g_pGuildMarkManager->GetGuildMarkSmall(g_char_slot_ingame.GUILD_ID);			
	}
	POINT guild_mark_position={x+2,y+2};
	if(g_eRaceInterface == RACE_OUSTERS)
	{
		guild_mark_position.x += 3;
		guild_mark_position.y += 3;
	}

	if(p_guild_mark!=NULL)
		gpC_base->m_p_DDSurface_back->BltSprite(&guild_mark_position,p_guild_mark);
	else
	{
		RECT rect={guild_mark_position.x,guild_mark_position.y,guild_mark_position.x+20,guild_mark_position.y+20};
		DrawAlphaBox(&rect,255,255,255,15);
	}
	
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_pC_button_group->Show();
		gpC_base->m_p_DDSurface_back->Unlock();
	}	
	

	g_FL2_GetDC();
	g_PrintColorStr(x+w/2-g_GetStringWidth(g_char_slot_ingame.sz_guild_name.c_str(), gpC_base->m_info_pi.hfont), y+guildNameY, g_char_slot_ingame.sz_guild_name.c_str(), gpC_base->m_info_pi, RGB_WHITE);

//	
//	g_PrintColorStr(x+m_print_x[0], y+m_print_y+8, menu_string[0], gpC_base->m_chatting_pi, RGB_YELLOW);
//	g_PrintColorStr(x+m_print_x[1]-150, y+m_print_y+8, menu_string[1], gpC_base->m_chatting_pi, RGB_YELLOW);

	for(i = 0; i<3; i++)
	{
		int TempValue = 30;
		if(i == 2)
			TempValue = 60;
		if(m_ButtonFlag[i] == 0)
			g_PrintColorStr(x+TempValue+i*110, y+m_print_y+8, menu_string[i], gpC_base->m_chatting_pi, RGB_WHITE);
		else if(m_ButtonFlag[i] == 1)
			g_PrintColorStr(x+TempValue+i*110, y+m_print_y+9, menu_string[i], gpC_base->m_chatting_pi, RGB_GRAY);
		else if(m_ButtonFlag[i] == 2)
			g_PrintColorStr(x+TempValue+i*110, y+m_print_y+8, menu_string[i], gpC_base->m_chatting_pi, RGB_GRAY);
	}
	char TempString[128];
	int ScrollPos = m_pC_scroll_bar->GetScrollPos();
//	if(ScrollPos < 0)
//		ScrollPos = -1;
	for(i = 0; i < min(m_v_member_list.size()-ScrollPos, 11); i++)
	{
		// 정렬 1 2 0 3
		// 0 : normal
		// 1 : master
		// 2 : sub master
		// 3 : wait
		// 4 : deny
		
		if(m_focus == i+ScrollPos)
		{
			// 길드원 로그온인가?
		//	if(m_v_member_list[i+m_pC_scroll_bar->GetScrollPos()].bLogOn)
		//		g_PrintColorStr(x+m_print_x[0]-10, y+m_print_y+m_print_gap*i+8, "*", gpC_base->m_chatting_pi, RGB_YELLOW);
			
			// 2004, 10, 8, sobeit add start
			if(m_v_member_list[i+ScrollPos].bLogOn)
			{
				const char* TempServer = m_v_member_list[i+ScrollPos].SERVER_NAME.c_str();
				if(strlen(TempServer))
				{
					sprintf(TempString, "- %s", TempServer);
					g_PrintColorStr(x+m_print_x[1]-150, y+m_print_y+m_print_gap*(i+1)+8, TempString, gpC_base->m_chatting_pi, RGB_YELLOW);
				}
			}
			else
			{
				sprintf(TempString, "- %s", (*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_LOGINED].GetString());
				g_PrintColorStr(x+m_print_x[1]-150, y+m_print_y+m_print_gap*(i+1)+8, TempString, gpC_base->m_chatting_pi, RGB_YELLOW);
			}
			sprintf(TempString, "%s", m_v_member_list[i+ScrollPos].MEMBER_NAME.c_str());
			g_PrintColorStr(x+m_print_x[0], y+m_print_y+m_print_gap*(i+1)+8, TempString, gpC_base->m_chatting_pi, RGB_YELLOW);
			//g_PrintColorStr(x+m_print_x[0], y+m_print_y+m_print_gap*(i+1)+8, m_v_member_list[i+ScrollPos].MEMBER_NAME.c_str(), gpC_base->m_chatting_pi, RGB_YELLOW);
			// 2004, 10, 8, sobeit add end
			if(i+ScrollPos < m_v_member_list.size())
			{
				//if(m_v_member_list[i+ScrollPos].member_grade != 0 && m_v_member_list[i+ScrollPos].member_grade < 4)
				if(m_v_member_list[i+ScrollPos].member_grade >= 0 && m_v_member_list[i+ScrollPos].member_grade < 4)
					g_PrintColorStr(x+m_print_x[1], y+m_print_y+m_print_gap*(i+1)+8, grade_string[m_v_member_list[i+ScrollPos].member_grade], gpC_base->m_chatting_pi, RGB_YELLOW);
			}
			
		}
		else
		{
		//	if(m_v_member_list[i+ScrollPos].bLogOn)
		//		g_PrintColorStr(x+m_print_x[0]-10, y+m_print_y+m_print_gap*(i+1)+8, "*", gpC_base->m_chatting_pi, RGB_WHITE);
			if(i+ScrollPos < m_v_member_list.size())
			{
				// 2004, 10, 8, sobeit add start
				if(m_v_member_list[i+ScrollPos].bLogOn)
				{
					const char* TempServer = m_v_member_list[i+ScrollPos].SERVER_NAME.c_str();
					if(strlen(TempServer))
					{
						sprintf(TempString, "- %s", TempServer);
						g_PrintColorStr(x+m_print_x[1]-150, y+m_print_y+m_print_gap*(i+1)+8, TempString, gpC_base->m_chatting_pi, RGB_GREEN);
					}
				}
				else
				{
					sprintf(TempString, "- %s", (*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_LOGINED].GetString());
					g_PrintColorStr(x+m_print_x[1]-150, y+m_print_y+m_print_gap*(i+1)+8, TempString, gpC_base->m_chatting_pi, RGB_RED);
				}
				sprintf(TempString, "%s", m_v_member_list[i+ScrollPos].MEMBER_NAME.c_str());
				g_PrintColorStr(x+m_print_x[0], y+m_print_y+m_print_gap*(i+1)+8, TempString, gpC_base->m_chatting_pi, RGB_WHITE);
				
				//g_PrintColorStr(x+m_print_x[0], y+m_print_y+m_print_gap*(i+1)+8, m_v_member_list[i+ScrollPos].MEMBER_NAME.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
				// 2004, 10, 8, sobeit add end
			}

			if(i+ScrollPos < m_v_member_list.size())
			{
				//if(m_v_member_list[i+ScrollPos].member_grade != 0 && m_v_member_list[i+ScrollPos].member_grade < 4)
				if(m_v_member_list[i+ScrollPos].member_grade >= 0 && m_v_member_list[i+ScrollPos].member_grade < 4)
					g_PrintColorStr(x+m_print_x[1], y+m_print_y+m_print_gap*(i+1)+8, grade_string[m_v_member_list[i+ScrollPos].member_grade], gpC_base->m_chatting_pi, RGB_WHITE);
			}
		}
		
	}
	g_FL2_ReleaseDC();
	

	//	char sz_temp[100];
	//	wsprintf(sz_temp, "%d", m_focus);
	//	g_PrintColorStr(x, y, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
	
	if(m_pC_scroll_bar != NULL)
		m_pC_scroll_bar->Show(x, y);
	
	SHOW_WINDOW_ATTR;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::ShowButtonWidget
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_LIST::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	switch(p_button->GetID())
	{
		case SORT_ID:
		case SORT_SERVER:
		case SORT_GRADE:
			if(p_button->GetFocusState())
			{
				if(p_button->GetPressState())
					m_ButtonFlag[p_button->GetID()-1] = 1;
				else
					m_ButtonFlag[p_button->GetID()-1] = 2;
			}
			else
				m_ButtonFlag[p_button->GetID()-1] = 0;
		break;
		case CLOSE_ID:
			if(p_button->GetFocusState())
			{
				if(p_button->GetPressState())
					m_guild_member_list_spk.BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+2);
				else
					m_guild_member_list_spk.BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+1);
			}
			else
				m_guild_member_list_spk.BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
		break;

	}

}


class CTeamMember_By_Id
{
public:
	bool operator()(const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& p, const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& q) const
	{
		return stricmp(q.MEMBER_NAME.c_str(), p.MEMBER_NAME.c_str())>0;
	}
};
class _CTeamMember_By_Id
{
public:
	bool operator()(const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& p, const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& q) const
	{
		return stricmp(q.MEMBER_NAME.c_str(), p.MEMBER_NAME.c_str())<0;
	}
};
class CTeamMember_By_Server
{
public:
	bool operator()(const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& p, const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& q) const
	{
		return stricmp(q.SERVER_NAME.c_str(), p.SERVER_NAME.c_str())>0;
	}
};
class _CTeamMember_By_Server
{
public:
	bool operator()(const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& p, const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& q) const
	{
		return stricmp(q.SERVER_NAME.c_str(), p.SERVER_NAME.c_str())<0;
	}
};
class CTeamMember_By_Grade
{
public:
	bool operator()(const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& p, const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& q) const
	{
		return (q.member_grade - p.member_grade)>0;
	}
};
class _CTeamMember_By_Grade
{
public:
	bool operator()(const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& p, const C_VS_UI_TEAM_MEMBER_LIST::TEAM_MEMBER_LIST& q) const
	{
		return (q.member_grade - p.member_grade)<0;
	}
};
void C_VS_UI_TEAM_MEMBER_LIST::_Sort(int nSort)
{
	int nSize = m_v_member_list.size();
	if(nSize < 2) return;

	if(nSort == SORT_ID)
	{
		m_SortFlag_Id = !m_SortFlag_Id;
		if(m_SortFlag_Id)
			std::sort(m_v_member_list.begin(), m_v_member_list.end(), CTeamMember_By_Id());
		else
			std::sort(m_v_member_list.begin(), m_v_member_list.end(), _CTeamMember_By_Id());
	}
	else if( nSort == SORT_SERVER)
	{
		m_SortFlag_Server =!m_SortFlag_Server;
		if(m_SortFlag_Server)
			std::sort(m_v_member_list.begin(), m_v_member_list.end(), CTeamMember_By_Server());
		else
			std::sort(m_v_member_list.begin(), m_v_member_list.end(), _CTeamMember_By_Server());
	}
	else if( nSort == SORT_GRADE)
	{
		m_SortFlag_Grade =!m_SortFlag_Grade;
		if(m_SortFlag_Grade)
			std::sort(m_v_member_list.begin(), m_v_member_list.end(), CTeamMember_By_Grade());
		else
			std::sort(m_v_member_list.begin(), m_v_member_list.end(), _CTeamMember_By_Grade());
	}
	else
		return;
	m_pC_scroll_bar->SetScrollPos(0);
	m_pC_scroll_bar->SetPosMax(max(0,m_v_member_list.size()-1));
	m_focus = -1;

}
//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::Run
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_LIST::Run(id_t id)
{
	switch(id)
	{
	case CLOSE_ID:
		gpC_base->SendMessage(UI_CLOSE_TEAM_MEMBER_LIST, 0, 0, NULL);
		break;
		
	case SORT_ID:
	case SORT_SERVER:
	case SORT_GRADE:
		_Sort(id);
		break;
	}
}


//-----------------------------------------------------------------------------
//
// keyboard
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_LIST::KeyboardControl(UINT message, UINT key, long extra)
{
	Window::KeyboardControl(message, key, extra);
	
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_RETURN:
			break;
			
		case VK_ESCAPE: 
			gpC_base->SendMessage(UI_CLOSE_TEAM_MEMBER_LIST);
			break;
		}
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::MouseControl
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_TEAM_MEMBER_LIST::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	
	_x-=x; _y-=y;
	
	m_pC_button_group->MouseControl(message, _x, _y);
	m_pC_scroll_bar->MouseControl(message, _x, _y);
	
	switch(message)
	{
	case M_MOVING:
		m_focus = -1;
		if(_x > 10 && _x < w-40&&_y>53)
		{
			m_focus = (_y - m_print_y - m_print_gap)/m_print_gap;
			if(m_focus < 0 || m_focus > 10)
			{
				m_focus = -1;
				break;
			}
			
			m_focus += m_pC_scroll_bar->GetScrollPos();			
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if(m_focus >= 0 && m_focus < m_v_member_list.size())// && (g_pUserInformation->GuildGrade == 1 || g_pUserInformation->GuildGrade == 2))
		{
			if(GetAvailableRecall() && g_pUserInformation->GuildGrade == 1)
			{
				strcpy(m_SelectedID, m_v_member_list[m_focus].MEMBER_NAME.c_str());
				if(strlen(m_SelectedID)>0)
				{
					sprintf(m_AskingMessage, (*g_pGameStringTable)[UI_STRING_MESSAGE_ASKING_RECALL].GetString(), m_SelectedID);
					g_StartAskingRecall(-1,-1, m_AskingMessage);
				}
			}
			else {
				gpC_base->SendMessage(UI_SELECT_TEAM_MEMBER_LIST, 0, 0, 
				(void *)m_v_member_list[m_focus].MEMBER_NAME.c_str());
			}
		}
		break;
		
	case M_LEFTBUTTON_UP:
		break;
		
	case M_WHEEL_UP:
		m_pC_scroll_bar->ScrollUp();
		EMPTY_MOVE;
		break;
		
	case M_WHEEL_DOWN:
		m_pC_scroll_bar->ScrollDown();
		EMPTY_MOVE;
		break;
	}
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::IsPixel
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_TEAM_MEMBER_LIST::IsPixel(int _x, int _y)
{
	return IsInRect(_x, _y);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_LIST::IsPixel
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_LIST::AddMemberList(const TEAM_MEMBER_LIST &member_list, BYTE bType)
{
	int convert_table[5] = { 2, 0, 1, 3, 4 }; // 우선순위
	
	if(m_v_member_list.empty())
		m_v_member_list.push_back(member_list);
	else
	{
		for(int i = 0; i < m_v_member_list.size(); i++)
		{
			if(convert_table[member_list.member_grade] < convert_table[m_v_member_list[i].member_grade])
			{
				m_v_member_list.insert(&m_v_member_list[i], member_list);
				break;
			}
		}
		if(i == m_v_member_list.size())
			m_v_member_list.push_back(member_list);
	}
	
	// 스크롤바 세팅해주기
	//m_pC_scroll_bar->SetPosMax(max(0, m_v_member_list.size() - 11 +1));
	m_pC_scroll_bar->SetPosMax(max(0,m_v_member_list.size()-1));
	m_pC_scroll_bar->SetScrollPos(0);
	
	SetAvailableRecall(bType); // 이게 0이 아니면 길원 리스트 볼때 내가 길마면 recall 을 해야한다.
	///////////////////////////////////////////////////////////////
	//
	// 마스터, 서브마스터, 회원, 대기자 순으로 정렬하는 테이블 생성
	// 좀 무식하지만-_-;; 
	// 1 2 0 3	
	// focus 참조할때나 순서 대로 출력할때 참조
	//
}



class CTeamTeamLess
{
public:
	bool operator()(const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& p, const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& q) const
	{
		return strcmp(p.TEAM_NAME.c_str(), q.TEAM_NAME.c_str())>0;
	}
};

class CTeamTeamGreater
{
public:
	bool operator()(const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& p, const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& q) const
	{
		int re = strcmp(p.TEAM_NAME.c_str(), q.TEAM_NAME.c_str());
		return strcmp(p.TEAM_NAME.c_str(), q.TEAM_NAME.c_str())<0;
	}
};

class CTeamLeaderLess
{
public:
	bool operator()(const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& p, const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& q) const
	{
		return strcmp(p.LEADER_NAME.c_str(), q.LEADER_NAME.c_str())>0;
	}
};

class CTeamLeaderGreater
{
public:
	bool operator()(const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& p, const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& q) const
	{
		return strcmp(p.LEADER_NAME.c_str(), q.LEADER_NAME.c_str())<0;
	}
};

class CReadyTeamExpireLess
{
public:
	bool operator()(const C_VS_UI_TEAM_LIST::READY_TEAM_LIST& p, const C_VS_UI_TEAM_LIST::READY_TEAM_LIST& q) const
	{
		return strcmp(p.EXPIRE_DATE.c_str(), q.EXPIRE_DATE.c_str())>0;
	}
};

class CReadyTeamExpireGreater
{
public:
	bool operator()(const C_VS_UI_TEAM_LIST::READY_TEAM_LIST& p, const C_VS_UI_TEAM_LIST::READY_TEAM_LIST& q) const
	{
		return strcmp(p.EXPIRE_DATE.c_str(), q.EXPIRE_DATE.c_str())<0;
	}
};

class CTeamMembersLess
{
public:
	bool operator()(const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& p, const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& q) const
	{
		return p.MEMBERS > q.MEMBERS;
	}
};

class CTeamMembersGreater
{
public:
	bool operator()(const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& p, const C_VS_UI_TEAM_LIST::TEAM_LIST_BASE& q) const
	{
		return p.MEMBERS < q.MEMBERS;
	}
};

class CTeamRankingLess
{
public:
	bool operator()(const C_VS_UI_TEAM_LIST::REGIST_TEAM_LIST& p, const C_VS_UI_TEAM_LIST::REGIST_TEAM_LIST& q) const
	{
		return p.RANKING > q.RANKING;
	}
};

class CTeamRankingGreater
{
public:
	bool operator()(const C_VS_UI_TEAM_LIST::REGIST_TEAM_LIST& p, const C_VS_UI_TEAM_LIST::REGIST_TEAM_LIST& q) const
	{
		return p.RANKING < q.RANKING;
	}
};

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_LIST::Run
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_LIST::Run(id_t id)
{
	switch (id)
	{
	case X_ID:
	case CLOSE_ID:
		gpC_base->SendMessage(UI_CLOSE_TEAM_LIST);
		break;
		
	case SCROLL_UP_ID:
		if(m_scroll > 0)
			m_scroll--;
		break;
		
	case SCROLL_DOWN_ID:
		if(m_bl_ready)
		{
			if(m_v_ready_team_search_list.size())
			{
				if(m_scroll+9 < m_v_ready_team_search_list.size())
					m_scroll++;
			}
			else
				if(m_scroll+9 < m_v_ready_team_list.size())
					m_scroll++;
		}
		else
		{
			if(m_v_regist_team_search_list.size())
			{
				if(m_scroll+9 < m_v_regist_team_search_list.size())
					m_scroll++;
			}
			else
				if(m_scroll+9 < m_v_regist_team_list.size())
					m_scroll++;
		}
		break;
		
	case TEAM_LIST_ID:
		m_scroll = 0;
		if(m_bl_ready)
		{
			m_v_ready_team_search_list.clear();
		}
		else
		{
			m_v_regist_team_search_list.clear();
		}
		break;
		
	case INDEX_TEAM_ID:
		m_scroll = 0;
		if(m_bl_ready)
		{
			if(m_v_ready_team_search_list.empty())
			{
				if(m_last_sort_type == INDEX_TEAM_ID)
				{
					std::sort(m_v_ready_team_list.begin(), m_v_ready_team_list.end(), CTeamTeamLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_ready_team_list.begin(), m_v_ready_team_list.end(), CTeamTeamGreater());
					m_last_sort_type = INDEX_TEAM_ID;
				}
			}
			else
			{
				if(m_last_sort_type == INDEX_TEAM_ID)
				{
					std::sort(m_v_ready_team_search_list.begin(), m_v_ready_team_search_list.end(), CTeamTeamLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_ready_team_search_list.begin(), m_v_ready_team_search_list.end(), CTeamTeamGreater());
					m_last_sort_type = INDEX_TEAM_ID;
				}
			}
		}
		else
		{
			if(m_v_regist_team_search_list.empty())
			{
				if(m_last_sort_type == INDEX_TEAM_ID)
				{
					std::sort(m_v_regist_team_list.begin(), m_v_regist_team_list.end(), CTeamTeamLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_regist_team_list.begin(), m_v_regist_team_list.end(), CTeamTeamGreater());
					m_last_sort_type = INDEX_TEAM_ID;
				}
			}
			else
			{
				if(m_last_sort_type == INDEX_TEAM_ID)
				{
					std::sort(m_v_regist_team_search_list.begin(), m_v_regist_team_search_list.end(), CTeamTeamLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_regist_team_search_list.begin(), m_v_regist_team_search_list.end(), CTeamTeamGreater());
					m_last_sort_type = INDEX_TEAM_ID;
				}
			}
		}
		break;
		
	case INDEX_LEADER_ID:
		m_scroll = 0;
		if(m_bl_ready)
		{
			if(m_v_ready_team_search_list.empty())
			{
				if(m_last_sort_type == INDEX_LEADER_ID)
				{
					std::sort(m_v_ready_team_list.begin(), m_v_ready_team_list.end(), CTeamLeaderLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_ready_team_list.begin(), m_v_ready_team_list.end(), CTeamLeaderGreater());
					m_last_sort_type = INDEX_LEADER_ID;
				}
			}
			else
			{
				if(m_last_sort_type == INDEX_LEADER_ID)
				{
					std::sort(m_v_ready_team_search_list.begin(), m_v_ready_team_search_list.end(), CTeamLeaderLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_ready_team_search_list.begin(), m_v_ready_team_search_list.end(), CTeamLeaderGreater());
					m_last_sort_type = INDEX_LEADER_ID;
				}
			}
		}
		else
		{
			if(m_v_regist_team_search_list.empty())
			{
				if(m_last_sort_type == INDEX_LEADER_ID)
				{
					std::sort(m_v_regist_team_list.begin(), m_v_regist_team_list.end(), CTeamLeaderLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_regist_team_list.begin(), m_v_regist_team_list.end(), CTeamLeaderGreater());
					m_last_sort_type = INDEX_LEADER_ID;
				}
			}
			else
			{
				if(m_last_sort_type == INDEX_LEADER_ID)
				{
					std::sort(m_v_regist_team_search_list.begin(), m_v_regist_team_search_list.end(), CTeamLeaderLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_regist_team_search_list.begin(), m_v_regist_team_search_list.end(), CTeamLeaderGreater());
					m_last_sort_type = INDEX_LEADER_ID;
				}
			}
		}
		break;
		
		//	case INDEX_EXPIREDATE_ID:
		//		m_scroll = 0;
		//		if(m_bl_ready)
		//		{
		//			if(m_v_ready_team_search_list.empty())
		//			{
		//				if(m_last_sort_type == INDEX_EXPIREDATE_ID)
		//				{
		//					std::sort(m_v_ready_team_list.begin(), m_v_ready_team_list.end(), CReadyTeamExpireLess());
		//					m_last_sort_type = 0;
		//				}
		//				else
		//				{
		//					std::sort(m_v_ready_team_list.begin(), m_v_ready_team_list.end(), CReadyTeamExpireGreater());
		//					m_last_sort_type = INDEX_EXPIREDATE_ID;
		//				}
		//			}
		//			else
		//			{
		//				if(m_last_sort_type == INDEX_EXPIREDATE_ID)
		//				{
		//					std::sort(m_v_ready_team_search_list.begin(), m_v_ready_team_search_list.end(), CReadyTeamExpireLess());
		//					m_last_sort_type = 0;
		//				}
		//				else
		//				{
		//					std::sort(m_v_ready_team_search_list.begin(), m_v_ready_team_search_list.end(), CReadyTeamExpireGreater());
		//					m_last_sort_type = INDEX_EXPIREDATE_ID;
		//				}
		//			}
		//		}
		//		break;
		
	case INDEX_MEMBERS_ID:
		m_scroll = 0;
		if(m_bl_ready)
		{
			if(m_v_ready_team_search_list.empty())
			{
				if(m_last_sort_type == INDEX_MEMBERS_ID)
				{
					std::sort(m_v_ready_team_list.begin(), m_v_ready_team_list.end(), CTeamMembersLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_ready_team_list.begin(), m_v_ready_team_list.end(), CTeamMembersGreater());
					m_last_sort_type = INDEX_MEMBERS_ID;
				}
			}
			else
			{
				if(m_last_sort_type == INDEX_MEMBERS_ID)
				{
					std::sort(m_v_ready_team_search_list.begin(), m_v_ready_team_search_list.end(), CTeamMembersLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_ready_team_search_list.begin(), m_v_ready_team_search_list.end(), CTeamMembersGreater());
					m_last_sort_type = INDEX_MEMBERS_ID;
				}
			}
		}
		else
		{
			if(m_v_regist_team_search_list.empty())
			{
				if(m_last_sort_type == INDEX_MEMBERS_ID)
				{
					std::sort(m_v_regist_team_list.begin(), m_v_regist_team_list.end(), CTeamMembersLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_regist_team_list.begin(), m_v_regist_team_list.end(), CTeamMembersGreater());
					m_last_sort_type = INDEX_MEMBERS_ID;
				}
			}
			else
			{
				if(m_last_sort_type == INDEX_MEMBERS_ID)
				{
					std::sort(m_v_regist_team_search_list.begin(), m_v_regist_team_search_list.end(), CTeamMembersLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_regist_team_search_list.begin(), m_v_regist_team_search_list.end(), CTeamMembersGreater());
					m_last_sort_type = INDEX_MEMBERS_ID;
				}
			}
		}
		break;
		
	case INDEX_RANKING_ID:
		m_scroll = 0;
		if(m_bl_ready)
		{
		}
		else
		{
			if(m_v_regist_team_search_list.empty())
			{
				if(m_last_sort_type == INDEX_RANKING_ID)
				{
					std::sort(m_v_regist_team_list.begin(), m_v_regist_team_list.end(), CTeamRankingLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_regist_team_list.begin(), m_v_regist_team_list.end(), CTeamRankingGreater());
					m_last_sort_type = INDEX_RANKING_ID;
				}
			}
			else
			{
				if(m_last_sort_type == INDEX_RANKING_ID)
				{
					std::sort(m_v_regist_team_search_list.begin(), m_v_regist_team_search_list.end(), CTeamRankingLess());
					m_last_sort_type = 0;
				}
				else
				{
					std::sort(m_v_regist_team_search_list.begin(), m_v_regist_team_search_list.end(), CTeamRankingGreater());
					m_last_sort_type = INDEX_RANKING_ID;
				}
			}
		}
		break;
		
	case SEARCH_TYPE_ID:
		if(m_search_type >= SEARCH_ALL)
			m_search_type = SEARCH_NAME;
		else
			m_search_type += 3;
		break;
		
	case SEARCH_ID:
		{
			//어쩌구 저쩌구
			m_scroll = 0;
			char * p_temp = NULL;
			g_Convert_DBCS_Ascii2SingleByte(m_lev_search.GetString(), m_lev_search.Size(), p_temp);
			
			if(p_temp == NULL)
			{
				Run(TEAM_LIST_ID);
				return;
			}
			
			if(m_bl_ready)
			{
				m_v_ready_team_search_list.clear();
				std::vector<READY_TEAM_LIST>::iterator itr = m_v_ready_team_list.begin();
				
				while(itr != m_v_ready_team_list.end())
				{
					switch(m_search_type)
					{
					case SEARCH_NAME:
						if(strstr(itr->TEAM_NAME.c_str(), p_temp))
							m_v_ready_team_search_list.push_back(*itr);
						break;
						
					case SEARCH_LEADER:
						if(strstr(itr->LEADER_NAME.c_str(), p_temp))
							m_v_ready_team_search_list.push_back(*itr);
						break;
						
					case SEARCH_ALL:
						// 대기중인 팀 리스트는 Members, Ranking 이 없다.
						if(strstr(itr->TEAM_NAME.c_str(), p_temp) || strstr(itr->LEADER_NAME.c_str(), p_temp))
							m_v_ready_team_search_list.push_back(*itr);
						
						break;
					}
					itr++;
				}
			}
			else
			{
				m_v_regist_team_search_list.clear();
				std::vector<REGIST_TEAM_LIST>::iterator itr = m_v_regist_team_list.begin();
				int numTemp;
				numTemp=atoi(p_temp);
				
				while(itr != m_v_regist_team_list.end())
				{
					switch(m_search_type)
					{
					case SEARCH_NAME:
						if(strstr(itr->TEAM_NAME.c_str(), p_temp))
							m_v_regist_team_search_list.push_back(*itr);
						break;
						
					case SEARCH_LEADER:
						if(strstr(itr->LEADER_NAME.c_str(), p_temp))
							m_v_regist_team_search_list.push_back(*itr);
						break;
						
					case SEARCH_ALL:					
						if(strstr(itr->TEAM_NAME.c_str(), p_temp) || strstr(itr->LEADER_NAME.c_str(), p_temp))
							m_v_regist_team_search_list.push_back(*itr);
						else 
							if(numTemp)
							{
								if(itr->MEMBERS == numTemp || itr->RANKING == numTemp)
									m_v_regist_team_search_list.push_back(*itr);
							}
							break;
					}
					itr++;
				}
			}
			
			DeleteNewArray(p_temp);
			
			if(m_v_ready_team_search_list.empty() && m_v_regist_team_search_list.empty())
			{
				gC_vs_ui.RunNoSearchResult();
			}
			
			m_lev_search.EraseAll();
		}
		break;
		
	case HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::GUILD);
		break;
		
	}
}

void	C_VS_UI_TEAM_LIST::AddReadyTeamList(const C_VS_UI_TEAM_LIST::READY_TEAM_LIST &team_info)
{
	m_v_ready_team_list.push_back(team_info);
}

void	C_VS_UI_TEAM_LIST::AddRegistTeamList(const C_VS_UI_TEAM_LIST::REGIST_TEAM_LIST &team_info)
{
	m_v_regist_team_list.push_back(team_info);
}

///----------------------------------------------------------------------------
C_VS_UI_TEAM_INFO::C_VS_UI_TEAM_INFO(bool ready, void *info, bool IsUnion)
{
	m_bl_ready = ready;
	m_IsUnion = IsUnion;
	m_master = false;
	
	g_RegisterWindow(this);
	
	AttrTopmost(true);
	AttrKeyboardControl(true);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_guild_spk.Open(SPK_SLAYER_TEAM);
		break;

	case RACE_VAMPIRE:
		m_guild_spk.Open(SPK_VAMPIRE_TEAM);
		break;

	case RACE_OUSTERS:
		m_guild_spk.Open(SPK_OUSTERS_TEAM);
		break;
	}
	
	//Set(RESOLUTION_X/2-m_guild_spk.GetWidth(INFO_WINDOW)/2, RESOLUTION_Y/2 - m_guild_spk.GetHeight(INFO_WINDOW)/2, m_guild_spk.GetWidth(INFO_WINDOW), m_guild_spk.GetHeight(INFO_WINDOW));
	Set(g_pUserInformation->iResolution_x/2-m_guild_spk.GetWidth(INFO_WINDOW)/2, g_pUserInformation->iResolution_y/2 - m_guild_spk.GetHeight(INFO_WINDOW)/2, m_guild_spk.GetWidth(INFO_WINDOW), m_guild_spk.GetHeight(INFO_WINDOW));
	
	// set button
	m_pC_button_group = new ButtonGroup(this);
	
	const int help_x = 257, x_x = 257+14, button_y = 6;
	const int scroll_x = w-28, scroll_up_y = 96-20, scroll_down_y = 312-20;
	
	const int scroll_tag_x = x+w-28, scroll_tag_y = y+108-20, scroll_tag_height = 198;
	
	
	
	//help, x버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + help_x, y + button_y, m_guild_spk.GetWidth(HELP_BUTTON), m_guild_spk.GetHeight(HELP_BUTTON), HELP_ID, this, HELP_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + x_x, y + button_y, m_guild_spk.GetWidth(X_BUTTON), m_guild_spk.GetHeight(X_BUTTON), X_ID, this, X_BUTTON));
	
	//scroll up, down 버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + scroll_x, y + scroll_up_y, m_guild_spk.GetWidth(SCROLL_UP_BUTTON), m_guild_spk.GetHeight(SCROLL_UP_BUTTON), SCROLL_UP_ID, this, SCROLL_UP_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + scroll_x, y + scroll_down_y, m_guild_spk.GetWidth(SCROLL_DOWN_BUTTON), m_guild_spk.GetHeight(SCROLL_DOWN_BUTTON), SCROLL_DOWN_ID, this, SCROLL_DOWN_BUTTON));
	
	
	m_scroll = 0;
	m_scroll_max = 5;
	m_bl_scrolling = false;

	m_pC_dialog = NULL;
	if(m_bl_ready)
	{
		m_ready_info = *(READY_TEAM_INFO *)info;
		
	}
	else
	{
		m_regist_info = *(REGIST_TEAM_INFO *)info;
	}
	
	if(g_pUserInformation->GuildName.GetLength() > 0)		// 팀에 등록 되어 있으면
	{
		const char *team_name = m_bl_ready ? m_ready_info.TEAM_NAME.c_str() : m_regist_info.TEAM_NAME.c_str();
		const char *leader_name = m_bl_ready ? m_ready_info.LEADER_NAME.c_str() : m_regist_info.LEADER_NAME.c_str();

		if(team_name !=NULL )
		{
			if(!strcmp(team_name,g_pUserInformation->GuildName.GetString()))
			{
				if(g_pUserInformation->GuildGrade == 1)// && !strcmp(leader_name,g_pUserInformation->)
					// 일단 등록된 팀으로 한정해두자.
					if(!m_bl_ready)
					{
						m_master = true;
						// Modify 버튼. 길드 이름이 같으면서 등급이 0이면 
					}
			}
			else // 우리 길드가 아닐때
			{
				if(!m_bl_ready && g_pUserInformation->GuildGrade == 1)// 내가 마스터 이면
				{
					if(g_pUserInformation->dwUnionID == 0 ) //연합 중이 아니면
						m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-200, m_guild_spk.GetWidth(INDEX_UNITED_JOIN), m_guild_spk.GetHeight(INDEX_UNITED_JOIN), UNITED_JOIN_ID, this, INDEX_UNITED_JOIN));	
					else
					{
						if(m_IsUnion && g_pUserInformation->bUnionGrade == 0 ) //연합 마스터 추방가능 탈퇴 불가
							m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-140, m_guild_spk.GetWidth(INDEX_UNITED_EXPEL), m_guild_spk.GetHeight(INDEX_UNITED_EXPEL), UNUTED_EXPEL_ID, this, INDEX_UNITED_EXPEL));	
					//	else // 탈퇴 가능 추방 불가
					//		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-170, m_guild_spk.GetWidth(INDEX_UNITED_WITHDRAWAL), m_guild_spk.GetHeight(INDEX_UNITED_WITHDRAWAL), UNITED_WITHDRAWAL_ID, this, INDEX_UNITED_WITHDRAWAL));	
					}
				}
			}
		}
		if(m_master) // 우리 길드고 내가 마스터 일떄
		{
			m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2,y+h-49-30,m_guild_spk.GetWidth(MODIFY_BUTTON), m_guild_spk.GetHeight(MODIFY_BUTTON),MODIFY_ID, this, MODIFY_BUTTON));
			if(m_IsUnion && g_pUserInformation->dwUnionID != 0 && g_pUserInformation->bUnionGrade != 0 ) //연합 중이고 연합마스터가 아닐
			{
				m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-170, m_guild_spk.GetWidth(INDEX_UNITED_WITHDRAWAL), m_guild_spk.GetHeight(INDEX_UNITED_WITHDRAWAL), UNITED_WITHDRAWAL_ID, this, INDEX_UNITED_WITHDRAWAL));	
			}

		}
	} 
	else		// 어떠한 팀에도 등록되어 있지 않으면.
		if(g_pUserInformation->GuildName.GetLength() == 0)
			m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-49-30, m_guild_spk.GetWidth(JOIN_BUTTON), m_guild_spk.GetHeight(JOIN_BUTTON), JOIN_ID, this, JOIN_BUTTON));

	
	//JOIN, CLOSE버튼	
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-49, m_guild_spk.GetWidth(CLOSE_BUTTON), m_guild_spk.GetHeight(CLOSE_BUTTON), CLOSE_ID, this, CLOSE_BUTTON));

//	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-200, m_guild_spk.GetWidth(INDEX_UNITED_JOIN), m_guild_spk.GetHeight(INDEX_UNITED_JOIN), UNITED_JOIN_ID, this, INDEX_UNITED_JOIN));	
//	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-170, m_guild_spk.GetWidth(INDEX_UNITED_WITHDRAWAL), m_guild_spk.GetHeight(INDEX_UNITED_WITHDRAWAL), UNITED_WITHDRAWAL_ID, this, INDEX_UNITED_WITHDRAWAL));	
//	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-140, m_guild_spk.GetWidth(INDEX_UNITED_EXPEL), m_guild_spk.GetHeight(INDEX_UNITED_EXPEL), UNUTED_EXPEL_ID, this, INDEX_UNITED_EXPEL));	
	



	if(!m_bl_ready)
	{
		int m_print_x = x+30;
		int m_print_y = y+60;
		int m_print_gap = 20;
		
		m_lev_intro.SetPosition(m_print_x, m_print_y+m_print_gap*5);
		//m_lev_intro.SetEditorMode(m_print_gap, 9);
		m_lev_intro.SetEditorMode(20, 10);
		m_lev_intro.SetPrintInfo(gpC_base->m_chatting_pi);
		//m_lev_intro.SetByteLimit(30*10);
		m_lev_intro.SetByteLimit(255);
		m_lev_intro.SetAbsWidth(w - (m_print_x - x)-30);
		m_lev_intro.SetInputStringColor(RGB_BLACK);
		m_lev_intro.SetCursorColor(RGB_BLACK);
		m_lev_intro.AddString(m_regist_info.INTRODUCTION.c_str());
		
		Attach(&m_lev_intro);
	}	
	
	
}

C_VS_UI_TEAM_INFO::~C_VS_UI_TEAM_INFO()
{
	g_UnregisterWindow(this);

	m_lev_intro.Unacquire();
	gC_vs_ui.AcquireChatting();
	
	DeleteNew( m_pC_button_group );
	if(m_pC_dialog != NULL)
		DeleteNew(m_pC_dialog);

}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_INFO::Process
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_INFO::Process()
{
	m_pC_button_group->Process();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_INFO::UnacquireMouseFocus
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_INFO::UnacquireMouseFocus()
{
	m_pC_button_group->UnacquireMouseFocus();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_INFO::Start
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_INFO::Start()
{
	PI_Processor::Start();
	m_pC_button_group->Init();
	
	if(m_master)
		m_lev_intro.Acquire();

	AttrTopmost(true);

	gpC_window_manager->AppearWindow(this);
}



//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_INFO::Finish
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_INFO::Finish()
{
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_INFO::Show
//
//
//-----------------------------------------------------------------------------
void C_VS_UI_TEAM_INFO::Show()
{
	POINT guild_point = { x+29, y+15 };
	
	const int scroll_tag_x = x+w-28, scroll_tag_y = y+108-20, scroll_tag_height = 198;
	const int print_x = x+30, print_y = y+60, print_gap = 20, line_gap = 12;
	
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_guild_spk.BltLocked(x, y, INFO_WINDOW);		
		m_guild_spk.BltLocked(x+w/2-m_guild_spk.GetWidth(TITLE_TEAM_INFO)/2, y+20, TITLE_TEAM_INFO);		
		m_guild_spk.BltLocked(x+w-30, print_y-6+print_gap*1, SCROLL_BAR);
		if(m_bl_scrolling)
			m_guild_spk.BltLocked(scroll_tag_x, min(max(gpC_mouse_pointer->GetY(), scroll_tag_y), scroll_tag_y+scroll_tag_height), SCROLL_TAG);
		else
			m_guild_spk.BltLocked(scroll_tag_x, scroll_tag_y+scroll_tag_height*m_scroll/(m_scroll_max), SCROLL_TAG);
		
		m_pC_button_group->Show();
		gpC_base->m_p_DDSurface_back->Unlock();
	}
	char sz_string[512];
	int py = print_y, vx, i;
	
	if(m_bl_ready)
	{	
		//		if(m_scroll < 3)
		//		{
		//			wsprintf(sz_string, "Registered : %s", m_ready_info.REGISTERD_DATE.c_str());
		//			g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		//			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		//			py += print_gap;
		//		}
		
		//		if(m_scroll < 3)
		//		{
		//			wsprintf(sz_string, "Expired : %s", m_ready_info.EXPIRE_DATE.c_str());
		//			g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		//			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		//			py += print_gap;
		//		}
		
		if(m_scroll < 1)
		{
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_NAME].GetString(), m_ready_info.TEAM_NAME.c_str());
			g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}
		
		if(m_scroll < 2)
		{
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_LEADER].GetString(), m_ready_info.LEADER_NAME.c_str());
			g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}
		
		if(m_scroll < 3)
		{
			// 숫자사이에 ,넣기
			wsprintf(sz_string, "%d", m_ready_info.REG_FEE);
			std::string sstr = sz_string;
			for(i = 3; i <= 13; i += 4)
				if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
				
				wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_REG_FEE].GetString(), sstr.c_str());
				g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
				gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
				py += print_gap;
		}
		
		wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_MEMBERS].GetString());
		vx = g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		const int old_vx = vx;
		bool b_member_num = false;
		
		gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		for(i = 0; i < m_ready_info.MEMBERS_NAME.size(); i++)
		{
			if(g_GetStringWidth(m_ready_info.MEMBERS_NAME[i].c_str(), gpC_base->m_chatting_pi.hfont)+vx > x+w-30)
			{
				vx = old_vx;
				py += print_gap;
				gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
				
				wsprintf(sz_string, "(%d/%d)", m_ready_info.MEMBERS, m_ready_info.MEMBERS_MAX);
				g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
				b_member_num = true;
			}
			vx = g_PrintColorStr(vx, py, m_ready_info.MEMBERS_NAME[i].c_str(), gpC_base->m_chatting_pi, RGB_BLACK);
			if(i != m_ready_info.MEMBERS_NAME.size()-1)
				vx = g_PrintColorStr(vx, py, ", ", gpC_base->m_chatting_pi, RGB_BLACK);
		}
		
		if(b_member_num == false)
		{
			wsprintf(sz_string, "(%d/%d)", m_ready_info.MEMBERS, m_ready_info.MEMBERS_MAX);
			if(g_GetStringWidth(sz_string, gpC_base->m_chatting_pi.hfont)+vx > x+w-30)
			{
				py+=print_gap;
				gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
				g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
			}
			else
			{
				g_PrintColorStr(vx, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
			}
		}
		py += print_gap;
		
		int next = 0;
		
		wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_INTRODUCTION].GetString());//, m_ready_info.INTRODUCTION.c_str());
		vx = g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		
		const int char_width = g_GetStringWidth("a", gpC_base->m_chatting_pi.hfont);
		
		while(m_ready_info.INTRODUCTION.size()>next && py < y+h-print_gap*2)
		{
			strcpy(sz_string, m_ready_info.INTRODUCTION.c_str()+next);
			
			char *sz_string2 = sz_string;
			
			while(*sz_string2 == ' ')		// 앞의 공백제거
			{
				sz_string2++;
				next++;
			}
			
			int cut_pos = (x+w-30 -vx)/char_width;
			if(!g_PossibleStringCut(sz_string2, cut_pos))
				cut_pos--;
			sz_string2[cut_pos] = NULL;
			
			char *return_char = NULL;
			if((return_char = strchr(sz_string2, '\n')) != NULL)	// return 처리
			{
				cut_pos = return_char - sz_string2+1;
				sz_string2[cut_pos-1] = NULL;
			}
			
			g_PrintColorStr(vx, py, sz_string2, gpC_base->m_chatting_pi, RGB_BLACK);
			next += cut_pos;
			vx = print_x;
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}
		
		if(!strlen(m_ready_info.INTRODUCTION.c_str()))
		{
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}
		
		while(py < y+h-print_gap*2)
		{
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}
		
		// 대기팀은 길드마크 안찍음
		//		RECT rect={guild_point.x,guild_point.y,guild_point.x+40,guild_point.y+40};
		//		SetRect(&rect, guild_point.x-2,guild_point.y-2,guild_point.x+42,guild_point.y+42);
		//		DrawAlphaBox(&rect, 255, 255, 255, 15);
		//		gpC_global_resource->DrawOutBox(rect.left,rect.top,rect.right-rect.left,rect.bottom-rect.top);
	}
	else	// regist team
	{				
		if(m_scroll < 1)
		{
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_NAME].GetString(), m_regist_info.TEAM_NAME.c_str());
			g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}
		
		if(m_scroll < 2)
		{
			wsprintf(sz_string,(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_LEADER].GetString(), m_regist_info.LEADER_NAME.c_str());
			g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}
		
		/*		if(m_scroll < 3)
		{
		wsprintf(sz_string, "Registered : %s", m_regist_info.REGISTERED_DATE.c_str());
		g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		py += print_gap;
		}
		*/		
		//		if(m_scroll < 3)
		//		{
		//			// 숫자사이에 ,넣기
		//			wsprintf(sz_string, "%d", m_regist_info.REG_FEE);
		//			std::string sstr = sz_string;
		//			for(int i = 3; i <= 13; i += 4)
		//				if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
		//				
		//			wsprintf(sz_string, "Reg. Fee : $%s", sstr.c_str());
		//			g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		//			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		//			py += print_gap;
		//		}
		if(m_scroll < 3)
		{
			wsprintf(sz_string, "%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_MEMBERS].GetString(), m_regist_info.MEMBERS);
			g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}
		
		if(m_scroll < 4)
		{
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_RANKING].GetString(), m_regist_info.RANKING);
			g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}
		
		int next = 0;
		
		if(m_scroll < 5)
		{
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_INTRODUCTION].GetString());//, m_ready_info.INTRODUCTION.c_str());
			vx = g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		}
			
		const int char_width = g_GetStringWidth("a", gpC_base->m_chatting_pi.hfont);

		/*char *sz_intro;		
		g_Convert_DBCS_Ascii2SingleByte(m_lev_intro.GetString(), m_lev_intro.Size(), sz_intro);
		m_regist_info.INTRODUCTION = sz_intro;
		DeleteNew(sz_intro);
		while(m_regist_info.INTRODUCTION.size()>next && py < y+h-print_gap*2)
		{
			strcpy(sz_string, m_regist_info.INTRODUCTION.c_str()+next);
			
			char *sz_string2 = sz_string;
			
			while(*sz_string2 == ' ')		// 앞의 공백제거
			{
				sz_string2++;
				next++;
			}
			
			int cut_pos = (x+w-30 -vx)/char_width;
			if(!g_PossibleStringCut(sz_string2, cut_pos))
				cut_pos--;			
			sz_string2[cut_pos] = NULL;
			
			char *return_char = NULL;
			if((return_char = strchr(sz_string2, '\n')) != NULL)	// return 처리
			{
				cut_pos = return_char - sz_string2+1;
				sz_string2[cut_pos-1] = NULL;
			}
			
			g_PrintColorStr(vx, py, sz_string2, gpC_base->m_chatting_pi, RGB_BLACK);
			next += cut_pos;
			vx = print_x;
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}*/
		m_lev_intro.SetPosition(x+30, y+60+20*(5-m_scroll));
		m_lev_intro.SetEditorMode(20,8+m_scroll);
		m_lev_intro.Show();
		
		
		if(!strlen(m_regist_info.INTRODUCTION.c_str()))
		{
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}
		
		while(py < y+h-print_gap*2)
		{
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
			py += print_gap;
		}

		if(g_eRaceInterface == RACE_VAMPIRE)
			gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		
		CSprite *p_guild_mark;
		p_guild_mark=g_pGuildMarkManager->GetGuildMark(m_regist_info.guild_id);
		if(p_guild_mark==NULL)
		{
			g_pGuildMarkManager->LoadGuildMark(m_regist_info.guild_id);
			p_guild_mark=g_pGuildMarkManager->GetGuildMark(m_regist_info.guild_id);			
		}		
		
		if(p_guild_mark!=NULL)
		{
			RECT rect;
			SetRect(&rect, guild_point.x-2,guild_point.y-2,guild_point.x+42,guild_point.y+42);
			//			DrawAlphaBox(&rect, 0, 0, 0, 20);
			gpC_global_resource->DrawOutBox(rect.left,rect.top,rect.right-rect.left,rect.bottom-rect.top);
			gpC_base->m_p_DDSurface_back->BltSprite(&guild_point, p_guild_mark);
		}
	}
	m_pC_button_group->ShowDescription();
	
	SHOW_WINDOW_ATTR;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_INFO::ShowButtonWidget
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_INFO::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	const static char*	m_help_string[EXEC_MAX] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_JOIN].GetString(),
			
		(*g_pGameStringTable)[UI_STRING_MESSAGE_UP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DOWN].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MODIFY_INFO].GetString(),

		(*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_DESC1].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_DESC2].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_DESC3].GetString()

};
	
	if (!m_bl_scrolling)
		g_descriptor_manager.Set(DID_INFO, p_button->x, p_button->y, (void *)m_help_string[p_button->GetID()],0,0);
}


//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_INFO::ShowButtonWidget
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_INFO::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	assert(p_button);
	
	//	ShowButtonDescription(p_button);
	
	switch(p_button->GetID())
	{
	case X_ID:
	case HELP_ID:
	case SCROLL_UP_ID:
	case SCROLL_DOWN_ID:
		if(p_button->GetFocusState() && p_button->GetPressState())
			m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index+1);
		else
			m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index);
		break;
		
	case MODIFY_ID :
	case JOIN_ID:
	case CLOSE_ID:
	case UNITED_JOIN_ID:
	case UNITED_WITHDRAWAL_ID:
	case UNUTED_EXPEL_ID:

		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_guild_spk.BltLocked(p_button->x, p_button->y+2, p_button->m_image_index+1);
			else
				m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index+1);
		}
		else
			m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index);
		break;
	}
	
}

//-----------------------------------------------------------------------------
//
// keyboard
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_INFO::KeyboardControl(UINT message, UINT key, long extra)
{
	Window::KeyboardControl(message, key, extra);
	
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_ESCAPE: 
			gpC_base->SendMessage(UI_CLOSE_TEAM_INFO);
			break;
		}
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_INFO::MouseControl
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_TEAM_INFO::MouseControl(UINT message, int _x, int _y)
{
	if(!m_lev_intro.IsAcquire()&&m_master)
		m_lev_intro.Acquire();

	const int scroll_tag_x = x+w-28, scroll_tag_y = y+108-20, scroll_tag_height = 198;
	
	Window::MouseControl(message, _x, _y);
	
	switch(message)
	{
	case M_MOVING:
		if(m_bl_scrolling)
		{
			m_scroll = min(m_scroll_max, (m_scroll_max)*(max(_y, scroll_tag_y) - scroll_tag_y + scroll_tag_height/(m_scroll_max)/2)/scroll_tag_height);
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if(_x >= scroll_tag_x && _x <= scroll_tag_x+m_guild_spk.GetWidth(SCROLL_BAR) && _y >= scroll_tag_y && _y <= scroll_tag_y+scroll_tag_height)
		{
			//			if(m_v_ready_team_list.size() > 9)	// 스크롤이 생기는 경우에만
			{
				m_bl_scrolling = true;
				m_scroll = (m_scroll_max)*(_y - scroll_tag_y + scroll_tag_height/(m_scroll_max)/2)/scroll_tag_height;
			}
		}
		break;
		
	case M_LEFTBUTTON_UP:
		if(m_bl_scrolling)
		{
			m_bl_scrolling = false;
		}
		break;
		
	case M_WHEEL_UP:
		Run(SCROLL_UP_ID);
		break;
		
	case M_WHEEL_DOWN:
		Run(SCROLL_DOWN_ID);
		break;
	}
	
	m_pC_button_group->MouseControl(message, _x, _y);
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_INFO::IsPixel
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_TEAM_INFO::IsPixel(int _x, int _y)
{
	bool re = m_guild_spk.IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y), INFO_WINDOW);
	
	if(re == false)
	{
		if(m_guild_spk.IsPixel(_x - (x+w-2), _y - (y+h-49), CLOSE_BUTTON) ||
			m_guild_spk.IsPixel(_x - (x+w-2), _y - (y+h-49-30), JOIN_BUTTON) || 
			m_guild_spk.IsPixel(_x - (x+w-2), _y - (y+h-200), INDEX_UNITED_JOIN) ||
			m_guild_spk.IsPixel(_x - (x+w-2), _y - (y+h-170), INDEX_UNITED_WITHDRAWAL) ||
			m_guild_spk.IsPixel(_x - (x+w-2), _y - (y+h-140), INDEX_UNITED_EXPEL) )
			re = true;
	}
	
	return re;
}

C_VS_UI_TEAM_INFO::REGIST_TEAM_INFO		C_VS_UI_TEAM_INFO::m_regist_info;
void ExecF_united(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	if(id == 0)
		gpC_base->SendMessage(UI_REQUEST_UNION, C_VS_UI_TEAM_INFO::GetGuildId(), 0); // 연합길드 신청 
}

void ExecF_united_draw(C_VS_UI_DIALOG * p_this_dialog, id_t id) 
{
	C_VS_UI_POPUP_MESSAGE::PopupWindowStyle style;
	style.Style = C_VS_UI_POPUP_MESSAGE::STYLE_OK_BUTTON | C_VS_UI_POPUP_MESSAGE::STYLE_CANCEL_BUTTON;
	style.WindowX = 500;
	style.WindowY = 200;
	style.Type = C_VS_UI_POPUP_MESSAGE::POPUP_NORMAL;
	
	if(id == 0)
	{
			style.str = (*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_LEAVE_OK].GetString();
			gC_vs_ui.RunPopupMessage( style );
	}

	if(id == 1)
	{
			style.str = (*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_LEAVE_CANCEL].GetString();
			gC_vs_ui.RunPopupMessage( style );
	}
}

void ExecF_united_exper(C_VS_UI_DIALOG * p_this_dialog, id_t id)
{
	if(id == 0)
		gpC_base->SendMessage(UI_REQUEST_UNION_EXPERGUILD, C_VS_UI_TEAM_INFO::GetGuildId(), 0); // 연합길드 신청 
}


//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_INFO::Run
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_INFO::Run(id_t id)
{


	
	DIALOG_MENU d_menu[] = {	{"예", 0},
								{"아니오", DIALOG_EXECID_EXIT},
	};

	DIALOG_MENU d_menu2[] = {	{(*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_LEAVE_MSG].GetString(), 0},
								{(*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_LEAVE_MSG2].GetString(), 1},
								{"아니오", DIALOG_EXECID_EXIT},
	};
	
	static char * pp_dmsg_union[] = { (*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_JOIN_ASK].GetString() };
	static char * pp_dmsg_draw[] = { (*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_LEAVE_ASK].GetString() };
	static char * pp_dmsg_exper[] = { (*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_DEPORT_ASK].GetString() };


	switch (id)
	{
	case X_ID:
	case CLOSE_ID:
		gpC_base->SendMessage(UI_CLOSE_TEAM_INFO);
		break;
		
	case SCROLL_UP_ID:
		if(m_scroll > 0)
			m_scroll--;
		break;
		
	case SCROLL_DOWN_ID:
		if(m_scroll < m_scroll_max)
			m_scroll++;
		break;
		
	case JOIN_ID:
		if(m_bl_ready)
		{
			gpC_base->SendMessage(UI_JOIN_READY_TEAM, m_ready_info.guild_id, 0, (void *)m_ready_info.TEAM_NAME.c_str());
		}
		else
		{
			gpC_base->SendMessage(UI_JOIN_REGIST_TEAM, m_regist_info.guild_id, 0, (void *)m_regist_info.TEAM_NAME.c_str());
		}
		break;
		
	case HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::GUILD);
		break;
	
	case MODIFY_ID :		
		{
			char *sz_intro = NULL;

			g_Convert_DBCS_Ascii2SingleByte(m_lev_intro.GetString(), m_lev_intro.Size(), sz_intro);

			if(sz_intro != NULL)
			{
				m_regist_info.INTRODUCTION = sz_intro;
				
				gpC_base->SendMessage(UI_MODIFY_TEAM_INFO, m_regist_info.guild_id, 0, (void *)m_regist_info.INTRODUCTION.c_str());								
				DeleteNew(sz_intro);
			}			
		}
		break;
	case UNITED_JOIN_ID:
		m_pC_dialog = new C_VS_UI_NPC_DIALOG(ExecF_united, NULL, NULL, 500, 250);
		m_pC_dialog->SetMenu(d_menu, 2, false);
		m_pC_dialog->SetMessage(pp_dmsg_union,sizeof(pp_dmsg_union)/sizeof(char *));//, SMO_NOFIT);
		m_pC_dialog->Start();
		break;
	case UNITED_WITHDRAWAL_ID:
		m_pC_dialog = new C_VS_UI_NPC_DIALOG(ExecF_united_draw, NULL, NULL, 500, 250);
		m_pC_dialog->SetMenu(d_menu2, 3, false);
		m_pC_dialog->SetMessage(pp_dmsg_draw, sizeof(pp_dmsg_draw)/sizeof(char *));//, SMO_NOFIT);
		m_pC_dialog->Start();
		break;
	case UNUTED_EXPEL_ID:
		m_pC_dialog = new C_VS_UI_NPC_DIALOG(ExecF_united_exper, NULL, NULL, 500, 250);
		m_pC_dialog->SetMenu(d_menu, 2, false);
		m_pC_dialog->SetMessage(pp_dmsg_exper, sizeof(pp_dmsg_exper)/sizeof(char *));//, SMO_NOFIT);
		m_pC_dialog->Start();
		break;
	}
}

void	C_VS_UI_TEAM_INFO::CloseTeamInfoDialogBox()
{
	if(NULL != m_pC_dialog)
		DeleteNew( m_pC_dialog );
}
//----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_INFO::C_VS_UI_TEAM_MEMBER_INFO
// 
//
//----------------------------------------------------------------------------
C_VS_UI_TEAM_MEMBER_INFO::C_VS_UI_TEAM_MEMBER_INFO(MEMBER_INFO *info)
{
	m_own_info = false;
	g_RegisterWindow(this);
	
	AttrTopmost(true);
	AttrKeyboardControl(true);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_guild_member_spk.Open(SPK_SLAYER_TEAM);
		break;
		
	case RACE_VAMPIRE:
		m_guild_member_spk.Open(SPK_VAMPIRE_TEAM);
		break;
		
	case RACE_OUSTERS:
		m_guild_member_spk.Open(SPK_OUSTERS_TEAM);
		break;
	}
	
	//Set(RESOLUTION_X/2-m_guild_member_spk.GetWidth(INFO_WINDOW)/2, RESOLUTION_Y/2 - m_guild_member_spk.GetHeight(INFO_WINDOW)/2, m_guild_member_spk.GetWidth(INFO_WINDOW), m_guild_member_spk.GetHeight(INFO_WINDOW));
	Set(g_pUserInformation->iResolution_x/2-m_guild_member_spk.GetWidth(INFO_WINDOW)/2, g_pUserInformation->iResolution_y/2 - m_guild_member_spk.GetHeight(INFO_WINDOW)/2, m_guild_member_spk.GetWidth(INFO_WINDOW), m_guild_member_spk.GetHeight(INFO_WINDOW));
	
	// set button
	m_pC_button_group = new ButtonGroup(this);
	
	const int help_x = 257, x_x = 257+14, button_y = 6;
	const int scroll_x = w-28, scroll_up_y = 96-20, scroll_down_y = 312-20;
	
	const int scroll_tag_x = x+w-28, scroll_tag_y = y+108-20, scroll_tag_height = 198;
	
	
	
	//help, x버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + help_x, y + button_y, m_guild_member_spk.GetWidth(HELP_BUTTON), m_guild_member_spk.GetHeight(HELP_BUTTON), HELP_ID, this, HELP_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + x_x, y + button_y, m_guild_member_spk.GetWidth(X_BUTTON), m_guild_member_spk.GetHeight(X_BUTTON), X_ID, this, X_BUTTON));
	
	//scroll up, down 버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + scroll_x, y + scroll_up_y, m_guild_member_spk.GetWidth(SCROLL_UP_BUTTON), m_guild_member_spk.GetHeight(SCROLL_UP_BUTTON), SCROLL_UP_ID, this, SCROLL_UP_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + scroll_x, y + scroll_down_y, m_guild_member_spk.GetWidth(SCROLL_DOWN_BUTTON), m_guild_member_spk.GetHeight(SCROLL_DOWN_BUTTON), SCROLL_DOWN_ID, this, SCROLL_DOWN_BUTTON));
	
	//JOIN, CLOSE버튼
	//	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-49-30, m_guild_member_spk.GetWidth(JOIN_BUTTON), m_guild_member_spk.GetHeight(JOIN_BUTTON), JOIN_ID, this, JOIN_BUTTON));
	// 내가 길마이면
	if(g_pUserInformation->GuildGrade == 1 || g_pUserInformation->GuildGrade == 2)
	{
		if(info->GRADE == 3)	// 대기자인경우
		{
			m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-49-60, m_guild_member_spk.GetWidth(ACCEPT_BUTTON), m_guild_member_spk.GetHeight(ACCEPT_BUTTON), ACCEPT_ID, this, ACCEPT_BUTTON));
			
			if(g_pUserInformation->GuildGrade == 1)	// deny도 마스터만 된다
				m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-49-90, m_guild_member_spk.GetWidth(DENY_BUTTON), m_guild_member_spk.GetHeight(DENY_BUTTON), DENY_ID, this, DENY_BUTTON));
		}
		else if(info->GRADE != 1 && g_pUserInformation->GuildGrade == 1)	// 추방은 마스터만 된다
		{
			m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-49-60, m_guild_member_spk.GetWidth(EXPEL_BUTTON), m_guild_member_spk.GetHeight(EXPEL_BUTTON), EXPEL_ID, this, EXPEL_BUTTON));

			if(info->GRADE != 2) // 서브마스터가 아니면 임명 버튼
				m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-49-90, m_guild_member_spk.GetWidth(INDEX_GUILD_APPOINT), m_guild_member_spk.GetHeight(INDEX_GUILD_APPOINT), APPOINT_ID, this, INDEX_GUILD_APPOINT));

			// 권한 이임 버튼
			int nDelegationOfPowerW	= m_guild_member_spk.GetWidth(INDEX_GUILD_DELEGATION_OF_POWER);
			int nDelegationOfPowerH	= m_guild_member_spk.GetHeight(INDEX_GUILD_DELEGATION_OF_POWER);
			m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x-nDelegationOfPowerW+2, y+100, nDelegationOfPowerW, nDelegationOfPowerH, DELEGATION_OF_POWER_ID, this, INDEX_GUILD_DELEGATION_OF_POWER));
		}
	}
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-49, m_guild_member_spk.GetWidth(CLOSE_BUTTON), m_guild_member_spk.GetHeight(CLOSE_BUTTON), CLOSE_ID, this, CLOSE_BUTTON));	
	
	m_scroll = 0;
	m_scroll_max = 5;
	m_bl_scrolling = false;
	
	m_member_info = *info;
	
	// 캐릭터 이름과 선택한 정보의 이름이 같으면 자기 자신 정보이다.
	if(!strcmp(m_member_info.NAME.c_str(),g_char_slot_ingame.sz_name.c_str()))
		m_own_info = true;

	if(m_own_info)
	{
		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-2, y+h-49-30, m_guild_member_spk.GetWidth(MODIFY_BUTTON), m_guild_member_spk.GetHeight(MODIFY_BUTTON), MODIFY_ID, this, MODIFY_BUTTON));		
	}
	
	int m_print_x = x+30;
	int m_print_y = y+60;
	int m_print_gap = 20;
	
	m_lev_intro.SetPosition(m_print_x, m_print_y+m_print_gap*3);
	m_lev_intro.SetEditorMode(20, 10);
	m_lev_intro.SetPrintInfo(gpC_base->m_chatting_pi);
	//m_lev_intro.SetByteLimit(30*10);
	m_lev_intro.SetByteLimit(255);
	m_lev_intro.SetAbsWidth(w - (m_print_x - x)-30);
	m_lev_intro.SetInputStringColor(RGB_BLACK);
	m_lev_intro.SetCursorColor(RGB_BLACK);
	m_lev_intro.AddString(m_member_info.INTRODUCTION.c_str());
	
	Attach(&m_lev_intro);
}

C_VS_UI_TEAM_MEMBER_INFO::~C_VS_UI_TEAM_MEMBER_INFO()
{
	g_UnregisterWindow(this);
	m_lev_intro.Unacquire();	
	gC_vs_ui.AcquireChatting();
	DeleteNew( m_pC_button_group );
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_INFO::Process
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_INFO::Process()
{
	m_pC_button_group->Process();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_INFO::UnacquireMouseFocus
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_INFO::UnacquireMouseFocus()
{
	m_pC_button_group->UnacquireMouseFocus();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_INFO::Start
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_INFO::Start()
{
	PI_Processor::Start();
	m_pC_button_group->Init();
	
	AttrTopmost(true);
	gpC_window_manager->AppearWindow(this);

	if(m_own_info)
		m_lev_intro.Acquire();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_INFO::Finish
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_INFO::Finish()
{
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_INFO::Show
//
//
//-----------------------------------------------------------------------------
void C_VS_UI_TEAM_MEMBER_INFO::Show()
{
	const int scroll_tag_x = x+w-28, scroll_tag_y = y+108-20, scroll_tag_height = 198;
	const int print_x = x+30, print_y = y+60, print_gap = 20, line_gap = 12;
	
	
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_guild_member_spk.BltLocked(x, y, INFO_WINDOW);
		m_guild_member_spk.BltLocked(x+w/2-m_guild_member_spk.GetWidth(TITLE_MEMBER_INFO)/2, y+20, TITLE_MEMBER_INFO);
		m_guild_member_spk.BltLocked(x+w-30, print_y-6+print_gap*1, SCROLL_BAR);
		if(m_bl_scrolling)
			m_guild_member_spk.BltLocked(scroll_tag_x, min(max(gpC_mouse_pointer->GetY(), scroll_tag_y), scroll_tag_y+scroll_tag_height), SCROLL_TAG);
		else
			m_guild_member_spk.BltLocked(scroll_tag_x, scroll_tag_y+scroll_tag_height*m_scroll/(m_scroll_max), SCROLL_TAG);
		
		m_pC_button_group->Show();
		gpC_base->m_p_DDSurface_back->Unlock();
	}
	
	char sz_string[512];
	int py = print_y, vx;
	
	if(m_scroll < 1)
	{
		wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_NAME].GetString(), m_member_info.NAME.c_str());
		g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		py += print_gap;
	}
	
	if(m_scroll < 2)
	{
		const static char* grade_string[4] = 
		{
			(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_GRADE_MEMBER].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_GRADE_MASTER].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_GRADE_SUB_MASTER].GetString(),
			(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_GRADE_WAIT].GetString(),
		};
		wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_GRADE].GetString(), grade_string[m_member_info.GRADE]);
		g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		py += print_gap;
	}
	
	//	py += print_gap;
	
	int next = 0;
	
	if(m_scroll < 3)
	{
		wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_INTRODUCTION].GetString());//, m_member_info.INTRODUCTION.c_str());
		vx = g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
	}
	gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
	
	const int char_width = g_GetStringWidth("a", gpC_base->m_chatting_pi.hfont);
	
	/*
	while(m_member_info.INTRODUCTION.size()>next && py < y+h-print_gap*2)
	{
		strcpy(sz_string, m_member_info.INTRODUCTION.c_str()+next);
		
		char *sz_string2 = sz_string;
		
		while(*sz_string2 == ' ')		// 앞의 공백제거
		{
			sz_string2++;
			next++;
		}
		
		int cut_pos = (x+w-30 -vx)/char_width;

		if(!g_PossibleStringCut(sz_string2, cut_pos))
			cut_pos--;
		sz_string2[cut_pos] = NULL;
		
		char *return_char = NULL;
		if((return_char = strchr(sz_string2, '\n')) != NULL)	// return 처리
		{
			cut_pos = return_char - sz_string2+1;
			sz_string2[cut_pos-1] = NULL;
		}
		
		g_PrintColorStr(vx, py, sz_string2, gpC_base->m_chatting_pi, RGB_BLACK);
		next += cut_pos;
		vx = print_x;
		gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		py += print_gap;
	}*/
	m_lev_intro.SetPosition(x+30, y+60+20*max(0,(3-m_scroll)));
	m_lev_intro.SetEditorMode(20,10+m_scroll);

	m_lev_intro.Show();
	
	if(!strlen(m_member_info.INTRODUCTION.c_str()))
	{
		gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		py += print_gap;
	}
	
	while(py < y+h-print_gap*2)
	{
		gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, w - (print_x - x) -30, 0);
		py += print_gap;
	}
	m_pC_button_group->ShowDescription();
	/*					 길드 멤버 정보에 길드마크 x
	// 길드 마크 출력
	CSprite *p_guild_mark;
	p_guild_mark=g_pGuildMarkManager->GetGuildMark(m_member_info.guild_id);
	if(p_guild_mark==NULL)
	{
	g_pGuildMarkManager->LoadGuildMark(m_member_info.guild_id);
	p_guild_mark=g_pGuildMarkManager->GetGuildMark(m_member_info.guild_id);			
	}
	RECT rect={x,y,0,0};
	POINT guild_point = { rect.left,rect.top };
	if(p_guild_mark!=NULL)
	gpC_base->m_p_DDSurface_back->BltSprite(&guild_point, p_guild_mark);	
	*/
	
	SHOW_WINDOW_ATTR;
}

void	C_VS_UI_TEAM_MEMBER_INFO::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	const static char*	m_help_string[EXEC_MAX] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
			
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_EXPEL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_JOIN_ACCEPT].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_JOIN_DENY].GetString(),
			
		(*g_pGameStringTable)[UI_STRING_MESSAGE_UP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DOWN].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_MODIFY_INFO].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_APPOINT_SUBMASTER].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_DELEGATION_OF_POWER_DESC].GetString(),
	};
	
	if (!m_bl_scrolling)
		g_descriptor_manager.Set(DID_INFO, p_button->x, p_button->y, (void *)m_help_string[p_button->GetID()],0,0);
}
//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_INFO::ShowButtonWidget
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_INFO::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	assert(p_button);
	
	switch(p_button->GetID())
	{
	case X_ID:
	case HELP_ID:
	case SCROLL_UP_ID:
	case SCROLL_DOWN_ID:
		if(p_button->GetFocusState() && p_button->GetPressState())
			m_guild_member_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index+1);
		else
			m_guild_member_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index);
		break;


	default:
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_guild_member_spk.BltLocked(p_button->x, p_button->y+2, p_button->m_image_index+1);
			else
				m_guild_member_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index+1);
		}
		else
			m_guild_member_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index);
		break;
		
		
	}
	
}

//-----------------------------------------------------------------------------
//
// keyboard
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_INFO::KeyboardControl(UINT message, UINT key, long extra)
{
	Window::KeyboardControl(message, key, extra);
	
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_ESCAPE: 
			gpC_base->SendMessage(UI_CLOSE_TEAM_MEMBER_INFO);
			break;
		}
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_INFO::MouseControl
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_TEAM_MEMBER_INFO::MouseControl(UINT message, int _x, int _y)
{
	if(!m_lev_intro.IsAcquire()&&m_own_info)
		m_lev_intro.Acquire();

	const int scroll_tag_x = x+w-28, scroll_tag_y = y+108-20, scroll_tag_height = 198;
	
	Window::MouseControl(message, _x, _y);
		
	switch(message)
	{
	case M_MOVING:
		if(m_bl_scrolling)
		{
			m_scroll = min(m_scroll_max, (m_scroll_max)*(max(_y, scroll_tag_y) - scroll_tag_y + scroll_tag_height/(m_scroll_max)/2)/scroll_tag_height);
		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if(_x >= scroll_tag_x && _x <= scroll_tag_x+m_guild_member_spk.GetWidth(SCROLL_BAR) && _y >= scroll_tag_y && _y <= scroll_tag_y+scroll_tag_height)
		{
			m_bl_scrolling = true;
			m_scroll = (m_scroll_max)*(_y - scroll_tag_y + scroll_tag_height/(m_scroll_max)/2)/scroll_tag_height;
		}
		break;
		
	case M_LEFTBUTTON_UP:
		if(m_bl_scrolling)
		{
			m_bl_scrolling = false;
		}
		break;
		
	case M_WHEEL_UP:
		Run(SCROLL_UP_ID);
		break;
		
	case M_WHEEL_DOWN:
		Run(SCROLL_DOWN_ID);
		break;
	}
	
	m_pC_button_group->MouseControl(message, _x, _y);		
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_INFO::IsPixel
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_TEAM_MEMBER_INFO::IsPixel(int _x, int _y)
{
	bool re = m_guild_member_spk.IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y), INFO_WINDOW);
	
	if(re == false)
	{
		if(m_guild_member_spk.IsPixel(_x - (x+w-2), _y - (y+h-49), CLOSE_BUTTON))// ||
			re = true;
	}
	if(re == false && g_pUserInformation->GuildGrade == 1 || g_pUserInformation->GuildGrade == 2)
	{
		if(m_member_info.GRADE == 3)	// 대기자일때
		{
			if(m_guild_member_spk.IsPixel(_x - (x+w-2), _y - (y+h-49-60), ACCEPT_BUTTON) ||
				m_guild_member_spk.IsPixel(_x - (x+w-2), _y - (y+h-49-90), DENY_BUTTON))
			re = true;
		}
		else if(m_member_info.GRADE != 1 && g_pUserInformation->GuildGrade == 1) // 내가 마스터 일때만 추방
		{
			// 추방 버튼
			if(m_guild_member_spk.IsPixel(_x - (x+w-2), _y - (y+h-49-60), EXPEL_BUTTON))// ||
				re = true;
			if(m_member_info.GRADE != 2) // 서브마스터가 아니면 임명 버튼
				if(m_guild_member_spk.IsPixel(_x - (x+w-2), _y - (y+h-49-90), INDEX_GUILD_APPOINT))// ||
					re = true; 
			if(m_guild_member_spk.IsPixel(_x - (x-m_guild_member_spk.GetWidth(INDEX_GUILD_DELEGATION_OF_POWER)+2), _y - (y+100), INDEX_GUILD_DELEGATION_OF_POWER))
				re = true;
		}
		
	}
	if(m_own_info)
	{
		if(m_guild_member_spk.IsPixel( _x - (x+w-2),_y-(y+h-49-30), MODIFY_BUTTON))
			re = true;
	}
	
	return re;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_MEMBER_INFO::Run
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_MEMBER_INFO::Run(id_t id)
{
	switch (id)
	{
	case MODIFY_ID :
		{
			char *sz_intro = NULL;
			g_Convert_DBCS_Ascii2SingleByte(m_lev_intro.GetString(),m_lev_intro.Size(),sz_intro);
			if(sz_intro != NULL)
			{
				m_member_info.INTRODUCTION = sz_intro;
				DeleteNew(sz_intro);
				gpC_base->SendMessage(UI_MODIFY_GUILD_MEMBER_INTRO,0,0,(void *)m_member_info.INTRODUCTION.c_str());
			}
		}
		break;

	case X_ID:
	case CLOSE_ID:
		gpC_base->SendMessage(UI_CLOSE_TEAM_MEMBER_INFO);
		break;
		
	case ACCEPT_ID:
		gpC_base->SendMessage(UI_MODIFY_GUILD_MEMBER, m_member_info.guild_id, 0, (void *)m_member_info.NAME.c_str());
		break;
		
	case DENY_ID:
	case EXPEL_ID:
		gpC_base->SendMessage(UI_MODIFY_GUILD_MEMBER, m_member_info.guild_id, 4, (void *)m_member_info.NAME.c_str());
		break;

	
	case SCROLL_UP_ID:
		if(m_scroll > 0)
			m_scroll--;
		break;
		
	case SCROLL_DOWN_ID:
		if(m_scroll < m_scroll_max)
			m_scroll++;
		break;
		
	case HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::GUILD);
		break;

	case APPOINT_ID:
		gpC_base->SendMessage(UI_APPOINT_SUBMASTER, m_member_info.guild_id, 0, (void *)m_member_info.NAME.c_str());
		break;

	case DELEGATION_OF_POWER_ID:
		gC_vs_ui.RunDelegation_Of_Power(m_member_info.NAME.c_str());
		//g_char_slot_ingame.sz_guild_name.c_str()
		break;
	}
}


//----------------------------------------------------------------------------
// C_VS_UI_TEAM_REGIST::C_VS_UI_TEAM_REGIST
//
//
//----------------------------------------------------------------------------
C_VS_UI_TEAM_REGIST::C_VS_UI_TEAM_REGIST(bool member, int reg_fee, int rank, char *date, char *team_name, int guild_id)
{
	m_guild_id = guild_id;
	m_bl_member = member;
	
	if(team_name)
		m_team_name = team_name;
	
	if(date)
		m_date = date;

	m_rank = rank;
	m_reg_fee = reg_fee;
	
	g_RegisterWindow(this);
	
	AttrTopmost(true);
	AttrKeyboardControl(true);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_guild_spk.Open(SPK_SLAYER_TEAM);
		break;
		
	case RACE_VAMPIRE:
		m_guild_spk.Open(SPK_VAMPIRE_TEAM);
		break;
		
	case RACE_OUSTERS:
		m_guild_spk.Open(SPK_OUSTERS_TEAM);
		break;
	}
	
	if(g_eRaceInterface == RACE_VAMPIRE && member == false)
	{
		m_vampire_point.x = 17;
		m_vampire_point.y = 0;
	}
	else
	{
		m_vampire_point.x = 0;
		m_vampire_point.y = 0;
	}
	
	m_guild_mark = NULL;
	
	int help_x, x_x, button_y;
	int button_x, regist_y, close_y;
	
	if(m_bl_member)
	{
		//Set(RESOLUTION_X/2-m_guild_spk.GetWidth(INFO_WINDOW)/2, RESOLUTION_Y/2 - m_guild_spk.GetHeight(INFO_WINDOW)/2, m_guild_spk.GetWidth(INFO_WINDOW), m_guild_spk.GetHeight(INFO_WINDOW));
		Set(g_pUserInformation->iResolution_x/2-m_guild_spk.GetWidth(INFO_WINDOW)/2, g_pUserInformation->iResolution_y/2 - m_guild_spk.GetHeight(INFO_WINDOW)/2, m_guild_spk.GetWidth(INFO_WINDOW), m_guild_spk.GetHeight(INFO_WINDOW));
		m_print_x = x+30;
		m_print_y = y+60;
		m_print_gap = 20;
		help_x = 257;
		x_x = 257+14;
		if(g_eRaceInterface == RACE_OUSTERS)
			x_x += 1;
		button_y = 6;
		button_x = x+w-2;
	}
	else
	{
		//Set(RESOLUTION_X/2-m_guild_spk.GetWidth()/2, RESOLUTION_Y/2 - m_guild_spk.GetHeight()/2, m_guild_spk.GetWidth(), m_guild_spk.GetHeight());
		Set(g_pUserInformation->iResolution_x/2-m_guild_spk.GetWidth()/2, g_pUserInformation->iResolution_y/2 - m_guild_spk.GetHeight()/2, m_guild_spk.GetWidth(), m_guild_spk.GetHeight());
		m_print_x = x+30+m_vampire_point.x;
		m_print_y = y+90+m_vampire_point.y;
		m_print_gap = 20;
		help_x = 353;
		x_x = 367;
		if(g_eRaceInterface == RACE_VAMPIRE)
		{
			help_x+=20; x_x+=20;
		}
		button_y = 2;
		button_x = x+w-14;
		m_mark_x = 40+m_vampire_point.x;
		m_mark_y = 50+m_vampire_point.y+7;
	}
	
	regist_y = y+h-49-30;
	close_y = y+h-49;
	
	// set button
	m_pC_button_group = new ButtonGroup(this);
	
	
	//help, x버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + help_x, y + button_y, m_guild_spk.GetWidth(HELP_BUTTON), m_guild_spk.GetHeight(HELP_BUTTON), HELP_ID, this, HELP_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + x_x, y + button_y, m_guild_spk.GetWidth(X_BUTTON), m_guild_spk.GetHeight(X_BUTTON), X_ID, this, X_BUTTON));
	
	//REGIST, CLOSE버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(button_x, regist_y, m_guild_spk.GetWidth(REGISTER_BUTTON), m_guild_spk.GetHeight(REGISTER_BUTTON), REGIST_ID, this, REGISTER_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(button_x, close_y, m_guild_spk.GetWidth(CLOSE_BUTTON), m_guild_spk.GetHeight(CLOSE_BUTTON), CLOSE_ID, this, CLOSE_BUTTON));
	
	m_scroll = 0;
	m_bl_scrolling = false;
	
	if(!m_bl_member)
	{
		int TempPosition = 0;
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			TempPosition = m_print_x+130;
			break;
		case RACE_VAMPIRE:
			TempPosition = m_print_x+140;
			break;
		case RACE_OUSTERS:
			TempPosition = m_print_x+70;
			break;
		}
	
		m_lev_team_name.SetPosition(TempPosition, m_print_y+m_print_gap*2);
		m_lev_team_name.SetPrintInfo(gpC_base->m_chatting_pi);
		m_lev_team_name.SetByteLimit(16);
		m_lev_team_name.SetInputStringColor(RGB_BLACK);
		m_lev_team_name.SetCursorColor(RGB_BLACK);
	}
	
	m_lev_intro.SetEditorMode(m_print_gap, 10);
	if(m_bl_member)
	{
		if(m_reg_fee == 0)
			m_lev_intro.SetPosition(m_print_x, m_print_y+m_print_gap*3);
		else
		{
			m_lev_intro.SetPosition(m_print_x, m_print_y+m_print_gap*4);
			m_lev_intro.SetEditorMode(m_print_gap, 9);
		}
	}
	else
		m_lev_intro.SetPosition(m_print_x, m_print_y+m_print_gap*4);
	m_lev_intro.SetPrintInfo(gpC_base->m_chatting_pi);
	//m_lev_intro.SetByteLimit(30*10);
	m_lev_intro.SetByteLimit(255);
	m_lev_intro.SetAbsWidth(w - (m_print_x - x)-30);
	m_lev_intro.SetInputStringColor(RGB_BLACK);
	m_lev_intro.SetCursorColor(RGB_BLACK);		
	Attach(&m_lev_intro);
}

C_VS_UI_TEAM_REGIST::~C_VS_UI_TEAM_REGIST()
{
	g_UnregisterWindow(this);
	
	m_lev_intro.Unacquire();
	if(!m_bl_member)
		gC_vs_ui.AcquireChatting();
	
	if(m_guild_mark)
		DeleteNew(m_guild_mark);
	DeleteNew( m_pC_button_group );
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_REGIST::Process
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_REGIST::Process()
{
	m_pC_button_group->Process();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_REGIST::UnacquireMouseFocus
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_REGIST::UnacquireMouseFocus()
{
	m_pC_button_group->UnacquireMouseFocus();
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_REGIST::Start
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_REGIST::Start()
{
	PI_Processor::Start();
	m_pC_button_group->Init();
	
	if(m_bl_member)
	{
		m_lev_intro.Acquire();
	}
	else
	{
		m_lev_team_name.Acquire();
	}
	
	AttrTopmost(true);
	gpC_window_manager->AppearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_REGIST::Finish
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_REGIST::Finish()
{
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_REGIST::Show
//
//
//-----------------------------------------------------------------------------
void C_VS_UI_TEAM_REGIST::Show()
{
	const int scroll_tag_x = x+365+m_vampire_point.x, scroll_tag_y = y+108+m_vampire_point.y, scroll_tag_height = 198;
	const int line_gap = 12;
	
	
	char sz_string[256];
	int py = m_print_y;
	
	if(m_bl_member)	//member regist
	{
		if(gpC_base->m_p_DDSurface_back->Lock())
		{
			m_guild_spk.BltLocked(x, y, INFO_WINDOW);
			m_guild_spk.BltLocked(x+w/2-m_guild_spk.GetWidth(TITLE_MEMBER_REGISTRATION)/2, y+20, TITLE_MEMBER_REGISTRATION);
			m_pC_button_group->Show();			
			gpC_base->m_p_DDSurface_back->Unlock();
		}
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_TEAM_NAME].GetString(), m_team_name.c_str());
			break;
			
		case RACE_VAMPIRE:
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_CLAN_NAME].GetString(), m_team_name.c_str());
			break;
			
		case RACE_OUSTERS:
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_GUILD_NAME].GetString(), m_team_name.c_str());
			break;
		}

		g_PrintColorStr(m_print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30, 0);
		py += m_print_gap;
		
		wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_NAME].GetString(), g_char_slot_ingame.sz_name.c_str());
		g_PrintColorStr(m_print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30, 0);
		py += m_print_gap;
		
		// 숫자사이에 ,넣기
		if(m_reg_fee != 0)
		{
			wsprintf(sz_string, "%d", m_reg_fee);
			std::string sstr = sz_string;
			for(int i = 3; i <= 13; i += 4)
				if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
				
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_REGISTRATION_FEE].GetString(), sstr.c_str());
			g_PrintColorStr(m_print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
			gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30, 0);
			py += m_print_gap;
		}
		
		wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_SELF_INTRODUCTION].GetString());
		g_PrintColorStr(m_print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		m_pC_button_group->ShowDescription();
		
		gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30, 0);
		py += m_print_gap;
		
		while(py <= y+h-m_print_gap*2)
		{
			gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30, 0);
			py += m_print_gap;
		}
		
		//		wsprintf(sz_string, "date : %s", m_date.c_str());
		//		int print_x = x+w - 30 - g_GetStringWidth(sz_string, gpC_base->m_chatting_pi.hfont);
		
		//		g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		//		gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, x+w - print_x -30, 0);
		//		py += m_print_gap;
	}
	else	// team regist
	{
		//파일 받아오기
		//		if(gC_vs_ui.GetFileName())
		//		{
		//			m_guild_mark = new CDirectDrawSurface;
		//
		//			m_guild_mark->InitFromBMP(gC_vs_ui.GetFileName());
		//			if(m_guild_mark->GetWidth() != 20 || m_guild_mark->GetHeight() != 20)
		//			{
		//				m_guild_mark->ReleaseSurface();
		//				DeleteNew(m_guild_mark);
		//				m_guild_mark = NULL;
		//			}
		//			gC_vs_ui.CloseFileDialog();
		//		}
		//
		if(gpC_base->m_p_DDSurface_back->Lock())
		{
			m_guild_spk.BltLocked(x, y);
			m_guild_spk.BltLocked(x+w/2-m_guild_spk.GetWidth(TITLE_TEAM_REGISTRATION)/2, y+50, TITLE_TEAM_REGISTRATION);
			
			m_pC_button_group->Show();
			gpC_base->m_p_DDSurface_back->Unlock();
		}
		
		// 길드 마크 찍기
		//		if(m_guild_mark == NULL)
		//		{
		//			RECT rect;
		//			rect.left = x+m_mark_x;
		//			rect.right = rect.left + 20;
		//			rect.top = y+m_mark_y;
		//			rect.bottom = rect.top + 20;
		//			DrawAlphaBox(&rect, 255, 255, 255, 20);
		//		}
		//		else
		//		{
		//			RECT rect = {0, 0, 20, 20};
		//			POINT point = {x+m_mark_x, y+m_mark_y};
		//			gpC_base->m_p_DDSurface_back->BltNoColorkey(&point, m_guild_mark, &rect);
		//		}
		
		int vampire_width = 0;
		if(g_eRaceInterface == RACE_VAMPIRE)
		{
			vampire_width = -20;
		}
		wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_NAME].GetString(), g_char_slot_ingame.sz_name.c_str());
		g_PrintColorStr(m_print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30+vampire_width, 0);
		py += m_print_gap;
		
		// 숫자사이에 ,넣기
		wsprintf(sz_string, "%d", m_reg_fee);
		std::string sstr = sz_string;
		for(int i = 3; i <= 13; i += 4)
			if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
			
		wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_REGISTRATION_FEE].GetString(), sstr.c_str());
		g_PrintColorStr(m_print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30+vampire_width, 0);
		py += m_print_gap;
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_TEAM_NAME].GetString(), "");
			break;
			
		case RACE_VAMPIRE:
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_CLAN_NAME].GetString(), "");
			break;
			
		case RACE_OUSTERS:
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_GUILD_NAME].GetString(), "");
			break;
		}
	
		g_PrintColorStr(m_print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30+vampire_width, 0);
		py += m_print_gap;
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_TEAM_INTRODUCTION].GetString());
			break;
			
		case RACE_VAMPIRE:
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_CLAN_INTRODUCTION].GetString());
			break;
			
		case RACE_OUSTERS:
			wsprintf(sz_string, (*g_pGameStringTable)[UI_STRING_MESSAGE_TEAM_INFO_GUILD_INTRODUCTION].GetString());
			break;
		}
		
		g_PrintColorStr(m_print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30+vampire_width, 0);
		py += m_print_gap;
		m_pC_button_group->ShowDescription();
		
		while(py < y+h-m_print_gap*3)
		{
			gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30+vampire_width, 0);
			py += m_print_gap;
		}
		// 슬레이어가 한줄 모자르더라 .-_-
		if(g_eRaceInterface == RACE_SLAYER)
		{
			gpC_base->m_p_DDSurface_back->HLine(m_print_x, py+line_gap, w - (m_print_x - x) -30+vampire_width, 0);
			py += m_print_gap;
		}
		//		wsprintf(sz_string, "date : %s", m_date.c_str());
		//		int print_x = x+w - 30+vampire_width - g_GetStringWidth(sz_string, gpC_base->m_chatting_pi.hfont);
		
		//		g_PrintColorStr(print_x, py, sz_string, gpC_base->m_chatting_pi, RGB_BLACK);
		//		gpC_base->m_p_DDSurface_back->HLine(print_x, py+line_gap, x+w - print_x -30+vampire_width, 0);
		//		py += m_print_gap;
	}
	
	//	m_guild_spk.Blt(x+w-30, m_print_y-6+m_print_gap*-1, SCROLL_BAR);
	m_lev_intro.Show();
	m_lev_team_name.Show();
	
	
	SHOW_WINDOW_ATTR;
}

void	C_VS_UI_TEAM_REGIST::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	const static char*	m_help_string[EXEC_MAX] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_REGIST].GetString(),
	};
	
	if (!m_bl_scrolling)
		g_descriptor_manager.Set(DID_INFO, p_button->x, p_button->y, (void *)m_help_string[p_button->GetID()],0,0);	
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_REGIST::ShowButtonWidget
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_REGIST::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
//	assert(p_button); // <- warning C4305 때문에 
	if(p_button<=0)
	{
		MessageBox(NULL, "Error-String-2008.08.22-3:19", "BUTTON ERROR", MB_OK);
	}	
	
	switch(p_button->GetID())
	{
	case X_ID:
	case HELP_ID:
		if(p_button->GetFocusState() && p_button->GetPressState())
			m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index+1);
		else
			m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index);
		break;
		
	case REGIST_ID:
	case CLOSE_ID:
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				m_guild_spk.BltLocked(p_button->x, p_button->y+2, p_button->m_image_index+1);
			else
				m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index+1);
		}
		else
			m_guild_spk.BltLocked(p_button->x, p_button->y, p_button->m_image_index);
		break;
	}
}

//-----------------------------------------------------------------------------
//
// keyboard
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_REGIST::KeyboardControl(UINT message, UINT key, long extra)
{
	Window::KeyboardControl(message, key, extra);
	
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_TAB:
			if(!m_bl_member)
			{
				if(m_lev_team_name.IsAcquire())
					m_lev_intro.Acquire();
				else
					m_lev_team_name.Acquire();
			}
			break;
			
		case VK_RETURN:
			if(!m_bl_member)
			{
				if(m_lev_team_name.IsAcquire())
					m_lev_intro.Acquire();
			}
			break;
			
		case VK_ESCAPE: 
			gpC_base->SendMessage(UI_CLOSE_TEAM_REGIST);
			break;
		}
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_REGIST::MouseControl
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_TEAM_REGIST::MouseControl(UINT message, int _x, int _y)
{
	int scroll_tag_x = x+365, scroll_tag_y = y+108, scroll_tag_height = 198;
	
	Window::MouseControl(message, _x, _y);
	
	switch(message)
	{
	case M_MOVING:
		//		if(m_bl_scrolling)
		//		{
		//			if(m_bl_ready)
		//			{
		//				if(m_v_ready_team_search_list.size())
		//					m_scroll = min(m_v_ready_team_search_list.size()-9, (m_v_ready_team_search_list.size()-9)*(max(_y, scroll_tag_y) - scroll_tag_y + scroll_tag_height/(m_v_ready_team_search_list.size()-9)/2)/scroll_tag_height);
		//				else
		//					m_scroll = min(m_v_ready_team_list.size()-9, (m_v_ready_team_list.size()-9)*(max(_y, scroll_tag_y) - scroll_tag_y + scroll_tag_height/(m_v_ready_team_list.size()-9)/2)/scroll_tag_height);
		//			}
		//		}
		break;
		
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		//		if(_x >= scroll_tag_x && _x <= scroll_tag_x+m_guild_spk.GetWidth(SCROLL_BAR) && _y >= scroll_tag_y && _y <= scroll_tag_y+scroll_tag_height)
		//		{
		//			if(m_bl_ready)
		//			{
		//				if(m_v_ready_team_list.size() > 9)	// 스크롤이 생기는 경우에만
		//				{
		//					m_bl_scrolling = true;
		//					m_scroll = (m_v_ready_team_list.size()-9)*(_y - scroll_tag_y + scroll_tag_height/(m_v_ready_team_list.size()-9)/2)/scroll_tag_height;
		//				}
		//			}
		//		}
		//		if(_x > x+m_mark_x && _x < x+m_mark_x+20 && _y > y+m_mark_y && _y < y+m_mark_y+20)
		//		{
		//			gC_vs_ui.RunFileDialog(".bmp");
		//		}
		break;
		
	case M_LEFTBUTTON_UP:
		if(m_bl_scrolling)
		{
			m_bl_scrolling = false;
		}
		break;
	}
	
	m_pC_button_group->MouseControl(message, _x, _y);
	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_REGIST::IsPixel
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_TEAM_REGIST::IsPixel(int _x, int _y)
{
	bool re;
	if(m_bl_member)
	{
		re = m_guild_spk.IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y), INFO_WINDOW);
		if(re == false)
		{
			if(m_guild_spk.IsPixel(_x - (x+w-2), _y - (y+h-49), CLOSE_BUTTON) ||
				m_guild_spk.IsPixel(_x - (x+w-2), _y - (y+h-49-30), JOIN_BUTTON))
				re = true;
		}
	}
	else
	{
		re = m_guild_spk.IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y));
		if(re == false)
		{
			if(m_guild_spk.IsPixel(_x - (x+w-14), _y - (y+h-49), CLOSE_BUTTON) ||
				m_guild_spk.IsPixel(_x - (x+w-14), _y - (y+h-49-30), JOIN_BUTTON))
				re = true;
		}
	}
	return re;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TEAM_REGIST::Run
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TEAM_REGIST::Run(id_t id)
{
	switch (id)
	{
	case X_ID:
	case CLOSE_ID:
		gpC_base->SendMessage(UI_CLOSE_TEAM_REGIST);
		break;
		
	case REGIST_ID:
		if(m_bl_member)
		{			
			char *sz_intro = NULL;
			g_Convert_DBCS_Ascii2SingleByte(m_lev_intro.GetString(), m_lev_intro.Size(), sz_intro);

			if(sz_intro!=NULL)
			{
				m_introduction = sz_intro;
				gpC_base->SendMessage(UI_REGIST_GUILD_MEMBER, m_guild_id, m_rank, (void *)m_introduction.c_str());
				
				DeleteNew(sz_intro);
			}
		}
		else
		{
			char *sz_intro = NULL, *sz_team_name = NULL;			
			
			g_Convert_DBCS_Ascii2SingleByte(m_lev_team_name.GetString(), m_lev_team_name.Size(), sz_team_name);
			g_Convert_DBCS_Ascii2SingleByte(m_lev_intro.GetString(), m_lev_intro.Size(), sz_intro);

			if(sz_intro != NULL && sz_team_name != NULL)
			{
				m_introduction = sz_intro;
				m_team_name = sz_team_name;
				
				gpC_base->SendMessage(UI_REGIST_GUILD_TEAM, (int)m_team_name.c_str(), 0, (void *)m_introduction.c_str());
				
				DeleteNew(sz_intro);
				DeleteNew(sz_team_name);
			}
		}
		break;
		
	case HELP_ID:
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::GUILD);
		break;
	}
}


void C_VS_UI_OTHER_INFO::PLAYER_INFO::Init()
{
	PLAYER_NAME.clear();
	ZeroMemory(&DOMAINLEVEL, sizeof(int) * 5);
	GRADE = LEVEL = FAME = 0;
	ALIGNMENT = 0;
	STR_CUR = DEX_CUR = INT_CUR = 0;
	STR_PURE = DEX_PURE = INT_PURE = 0;
	guild_id = 0;
	face_type = 0;
	bl_female = false;
	Origin_ServerIdx = 0;
	PLAYER_OLDNAME.clear();
	contributePoint =0;
}


//-----------------------------------------------------------------------------
// C_VS_UI_OTHER_INFO::C_VS_UI_OTHER_INFO
//
//
//-----------------------------------------------------------------------------
C_VS_UI_OTHER_INFO::C_VS_UI_OTHER_INFO()
{
	static PETINFO petInfo;
	m_pPetInfo = &petInfo;
	m_pPetInfo->EXIST = false;

	g_RegisterWindow(this);
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_petButtonSpk.Open(SPK_PET_BUTTON_SLAYER);
		//if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
		//	Set(RESOLUTION_X/2 - 210/2, RESOLUTION_Y/2 - 255/2, 210, 285);
		//else
		//	Set(RESOLUTION_X/2 - 210/2, RESOLUTION_Y/2 - 255/2, 210, 255);
		//break;
		
		if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
			Set(g_pUserInformation->iResolution_x/2 - 210/2, g_pUserInformation->iResolution_y/2 - 255/2, 210, 305);
		else
			Set(g_pUserInformation->iResolution_x/2 - 210/2, g_pUserInformation->iResolution_y/2 - 255/2, 210, 275);
		break;

		
	case RACE_VAMPIRE:
		m_petButtonSpk.Open(SPK_PET_BUTTON_VAMPIRE);
		//if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
		//	Set(RESOLUTION_X/2 - 210/2, RESOLUTION_Y/2 - 242/2, 210, 272);
		//else
		//	Set(RESOLUTION_X/2 - 210/2, RESOLUTION_Y/2 - 242/2, 210, 242);
		//break;

		if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
			Set(g_pUserInformation->iResolution_x/2 - 210/2, g_pUserInformation->iResolution_y/2 - 242/2, 210, 292);
		else
			Set(g_pUserInformation->iResolution_x/2 - 210/2, g_pUserInformation->iResolution_y/2 - 242/2, 210, 262);
		break;
		
	case RACE_OUSTERS:
		m_petButtonSpk.Open(SPK_PET_BUTTON_OUSTERS);
		//if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
		//	Set(RESOLUTION_X/2 - 210/2, RESOLUTION_Y/2 - 242/2, 210, 272);
		//else
		//	Set(RESOLUTION_X/2 - 210/2, RESOLUTION_Y/2 - 242/2, 210, 242);
		//break;

		if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
			Set(g_pUserInformation->iResolution_x/2 - 210/2, g_pUserInformation->iResolution_y/2 - 242/2, 210, 292);
		else
			Set(g_pUserInformation->iResolution_x/2 - 210/2, g_pUserInformation->iResolution_y/2 - 242/2, 210, 262);
		break;
	}
	//m_pC_info_spk=C_VS_UI_INFO::m_pC_info_spk;
	
	AttrPin(true);
	
	AttrTopmost(false);
	
	g_RegisterWindow(this);
#if __CONTENTS(__080405_FIREST_UI_UPDATE)
	// 버튼 좌표 세팅
	int close_x = w-37, close_y = h-37;
	int help_x = w-37-26, help_y = h-37;		
	int alpha_x = w-37-26-26, alpha_y = h-37;

	if(g_eRaceInterface == RACE_OUSTERS)
	{
		close_x -= 7;
		close_y -= 13;
		help_x -= 7;
		help_y -= 13;
		alpha_x -= 7;
		alpha_y -= 13;
	}
	
	//공통버튼
	m_pC_button_group = new ButtonGroup(this);
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_x, alpha_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(help_x, help_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION), HELP_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(close_x, close_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_X), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_X), CLOSE_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_X));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(0, 0, 0, 0, PET_INFO_ID, this, 0));
#else
	//close버튼 좌표 세팅
	int close_x = w-24, close_y = h-19;
	int help_x = w-24-20, help_y = h-19;		
	int alpha_x = 6, alpha_y = h-21;
	if(g_eRaceInterface == RACE_VAMPIRE)

	{
		close_x -= 5;
		close_y -= 7;
		help_x -=5;
		help_y -= 7;
		alpha_x += 5;
		alpha_y -= 5;
	}

	//공통버튼
	m_pC_button_group = new ButtonGroup(this);
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(close_x, close_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::BUTTON_CLOSE), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::BUTTON_CLOSE), CLOSE_ID, this, C_GLOBAL_RESOURCE::BUTTON_CLOSE));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(help_x, help_y, gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::BUTTON_HELP), gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::BUTTON_HELP), HELP_ID, this, C_GLOBAL_RESOURCE::BUTTON_HELP));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_x, alpha_y, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(0, 0, 0, 0, PET_INFO_ID, this, 0));
#endif //__080405_FIREST_UI_UPDATE

	m_player_info.Init();

	// profile
	m_p_face = NULL;
	
	RefreshImage();
//	m_p_face_spk=NULL;
//	m_p_face_spk = new C_SPRITE_PACK(SPK_FACE);
	
//	IsRunning=false;
	m_p_guild_mark = NULL;
	
//	RefreshImage();

}

void	C_VS_UI_OTHER_INFO::SetPetInfo(PETINFO *pPetInfo)
{
	if(pPetInfo == NULL)
	{
		m_pPetInfo->EXIST = false;
		return;
	}

	*m_pPetInfo = *pPetInfo;
	m_pPetInfo->EXIST = true;

	C_VS_UI_EVENT_BUTTON *pButton = m_pC_button_group->GetButton(PET_INFO_ID);
	if(pButton != NULL)
	{
		int pet_x = 0, pet_y = 0;

		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			pet_x = w-10;
			pet_y = 29;
			break;

		case RACE_VAMPIRE:
			pet_x = w-10;
			pet_y = 30;
			break;

		case RACE_OUSTERS:
			pet_x = w-22;
			pet_y = 45;
			break;
		}
		int petButtonIndex = 0;
		switch(m_pPetInfo->ITEM_TYPE) 
		{
		case 1:
		case 2:
			petButtonIndex = 0;
			break;

		case 3:
			petButtonIndex = 1;
			break;

		case 4:
			petButtonIndex = 2;
			break;

		case 5:
			petButtonIndex = 3;
			break;

		case 6:
			petButtonIndex = 4;
			pet_x += 5;
			break;
		case 7:
			petButtonIndex = 5;	//밀리터리베어
//			pet_x += 5;
			break;
		case 8:
			petButtonIndex = 6;	//가고일
//			pet_x += 5;
			break;
#if __CONTENTS(__NEW_PET_FIRE_ELEMENTAL)
		case 9:
			petButtonIndex = 7;	//파이어 엘레멘탈
			pet_x -= 3;
			break;
#endif //__NEW_PET_FIRE_ELEMENTAL
#if __CONTENTS(__2008_OCTOBER_MAKETITEM)
		case 10:
			petButtonIndex = 8;	//파이어 엘레멘탈
			pet_x -= 3;
			break;
#endif //__2008_OCTOBER_MAKETITEM
#if __CONTENTS(__NEW_PET_INCUBUS)
		case 11:
			petButtonIndex = 9;	//인큐버스
			pet_x -= 3;
			break;
#endif //__NEW_PET_INCUBUS
#if __CONTENTS(__PET_MASHIMARO)
		case 12:
			petButtonIndex = 10;	//마시마로
			pet_x -= 3;
			break;
#endif //__PET_MASHIMARO
#if __CONTENTS(__PET_CATS)
		case 13:
			petButtonIndex = 11;	//태비 캣
			pet_x -= 3;
			break;
		case 14:
			petButtonIndex = 12;	//웰시 캣
			pet_x -= 3;
			break;
		case 15:
			petButtonIndex = 13;	//샤밍 캣
			pet_x -= 3;
			break;
#endif //__PET_CATS
#if __CONTENTS(__PET_CATS_UPGRADED)
		case 16:
			petButtonIndex = 14;	//카라, 델라 태비 캣 얼굴
			pet_x -= 3;
			break;
		case 17:
			petButtonIndex = 15;	//카라, 델라 웰시 캣 얼굴
			pet_x -= 3;
			break;
		case 18:	case 19:	case 20:	case 21:	case 22:	case 23:
			petButtonIndex = 16;	//카라, 델라 샤밍 캣 얼굴
			pet_x -= 3;
			break;
#endif //__PET_CATS_UPGRADED
/*#if __CONTENTS(__UPGRADE_MONSTER_PET)
		case 28:	case 29:	case 34:	case 35:
			petButtonIndex = 9;	//카라, 델라 인큐버스 얼굴
			pet_x -= 3;
			break;
		case 30:	case 31:	case 36:	case 37:
			petButtonIndex = 8;	//카라, 델라 서큐버스 얼굴
			pet_x -= 3;
			break;
		case 32:	case 33:	case 38:	case 39:
			petButtonIndex = 6;	//카라, 델라 가고일 얼굴
			pet_x -= 3;
			break;
#endif //__PET_CATS */

		}
		pButton->Set(pet_x, pet_y, m_petButtonSpk.GetWidth(petButtonIndex*2), m_petButtonSpk.GetHeight(petButtonIndex*2));
		pButton->m_image_index = petButtonIndex*2;
	}
}
//-----------------------------------------------------------------------------
// C_VS_UI_OTHER_INFO::~C_VS_UI_OTHER_INFO
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_OTHER_INFO::~C_VS_UI_OTHER_INFO()
{
	m_p_guild_mark = NULL;
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::OTHER_INFO, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::OTHER_INFO, Rect(x, y, w, h));
	
	g_UnregisterWindow(this);
	//C_VS_UI_INFO::m_pC_info_spk
	//m_pC_info_spk=NULL;
//	DeleteNew(m_p_face_spk);
	DeleteNew(m_p_face);
	DeleteNew(m_pC_button_group);	
}

//-----------------------------------------------------------------------------
// C_VS_UI_OTHER_INFO::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_OTHER_INFO::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	static char* m_other_info_button_string[5]=
	{		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP].GetString(),		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_PET_INFO_WINDOW].GetString(),
	};
	switch(p_button->GetID())
	{
	case PET_INFO_ID:
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[4],0,0);
		break;

	case CLOSE_ID :
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[2],0,0);
		break;
	case HELP_ID :
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[1],0,0);
		break;
	case ALPHA_ID :
		if(GetAttributes()->alpha)
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[3],0,0);
		else
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[0],0,0);
		break;
	}	
}


//-----------------------------------------------------------------------------
// C_VS_UI_OTHER_INFO::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_OTHER_INFO::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(p_button->GetID() == PET_INFO_ID && m_pPetInfo->EXIST == true)
	{
		int iPushedPlus = 0, iFocusedPlus = 0;
		
		if(p_button->GetFocusState())
			iFocusedPlus = 1;

		if(p_button->GetPressState())
			iPushedPlus = 1;

		int petButtonIndex = p_button->m_image_index;

		m_petButtonSpk.BltLocked(p_button->x+x, p_button->y+y+iPushedPlus, petButtonIndex+iFocusedPlus);
	}
#if __CONTENTS(__080405_FIREST_UI_UPDATE)
	else if(p_button->GetID() == ALPHA_ID)
	{
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED_NEW);
	}
	else if(p_button->GetID() == HELP_ID || p_button->GetID() == CLOSE_ID)
	{
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_PUSHED_OFFSET);
			else
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_HILIGHTED_OFFSET);
		}
		else
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
		}		
	}
#else
	else if(p_button->GetID() == ALPHA_ID)
	{
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED);
	}
	//Close버튼
	else if(p_button->GetID() == CLOSE_ID || p_button->GetID() == HELP_ID)
	{
		gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x-5, y+p_button->y-5, C_GLOBAL_RESOURCE::BUTTON_CLOSE_BACK);
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+3);
			else
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+2);
		}
		else
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+1);
			else
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
		}		
	}
#endif //__080405_FIREST_UI_UPDATE
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_OTHER_INFO::WindowEventReceiver(id_t event)
{
}


//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_OTHER_INFO::Run(id_t id)
{
//	DEBUG_ADD("[ OtherInfo ] Run");
	switch (id)
	{
	case CLOSE_ID:
		gpC_base->SendMessage(UI_CLOSE_OTHER_INFO);
		break;
		
	case HELP_ID:		
		gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::OTHER_INFO);
		EMPTY_MOVE;
		break;
		
	case ALPHA_ID:
		AttrAlpha(!GetAttributes()->alpha);
		EMPTY_MOVE;
		break;
		
	case PET_INFO_ID:
		if(m_pPetInfo->EXIST == true)
			gC_vs_ui.RunPetInfo(m_pPetInfo);
		break;
	}
//	DEBUG_ADD("[ OtherInfo ] Run End");
}

//-----------------------------------------------------------------------------
// MouseControl
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_OTHER_INFO::MouseControl(UINT message, int _x, int _y)
{
	RECT grade_rect={124+9,30,40+124+9,30+40};
	RECT guildmark_rect={22+55+9,30,22+55+9+40,30+40};

	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	bool re = m_pC_button_group->MouseControl(message, _x, _y);
	
	switch(message)
	{
	case M_MOVING:
		{
			static char temp_str[2][100];
			const static char* str_g[2] = {
				temp_str[0],
				NULL,
			};			
			str_g[1]=NULL;					

			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				{
					const static char* grade[20] = 
					{
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PIVATE].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_SERENT].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FEACEL].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LITENA].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KAINEL].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GENEAL].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FORE_GENEAL].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MAJORIS_GENEAL].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CLOEL_GENEAL].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARSHAL].GetString(),
						"의裂제좆",
						"괭裂제좆",
						"襟裂제좆",
						"빪裂제좆",
						"斤嵐裂제",
						"覩제寧뿐바",
						"累逃",
						"댕낵",
						"累낀",
						"悧잿",
					};

					if(_x>guildmark_rect.left && _x < guildmark_rect.right && _y > guildmark_rect.top && _y < guildmark_rect.bottom)
					{
						//if(m_player_info.TEAM_NAME.size()>0)
						//if(!m_player_info.TEAM_NAME.empty())
						//if( g_pGuildInfoMapper->IsExistGuildName( m_player_info.guild_id ) )
						if( g_pGuildInfoMapper->IsExistGuildName( m_player_info.guild_id ) )
						{
							wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_TEAM_NAME].GetString(),
								g_pGuildInfoMapper->GetGuildName( m_player_info.guild_id ) );
							g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void *)str_g,1);
						}
					} 
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
					else if(_x > 22 && _y > 97 && _x < 184 && _y < 177)
#else
					else if(_x > 22 && _y > 97 && _x < 184 && _y < 157)
#endif //__CONTRIBUTE_SYSTEM
					{
						static char temp_str[2][100];
						const static char* str[2] = {
							temp_str[0],	
							NULL,
						};

						str[0]=temp_str[0];				
						str[1]=NULL;
						
						int num=(_y-97)/20;
						switch(num)
						{
						case 0 : // grade
	//						DEBUG_ADD("[ OtherInfo ] MouseControl - Grade [S]");
							if(m_player_info.GRADE > 0 && m_player_info.GRADE <= GRADE_MARK_MAX )						
							{
								wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NAME].GetString(),grade[(m_player_info.GRADE-1)/5]);
								wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LEVEL].GetString(),m_player_info.GRADE);
								str[1]=temp_str[1];							
							} else
							{
								str[0] =NULL;
							}
							break;
						case 1 : // team
							{
								//if(m_player_info.TEAM_NAME.size()>0)
	//							DEBUG_ADD("[ OtherInfo ] MouseControl - Team [S]");
//								if(!m_player_info.TEAM_NAME.empty())
								if( g_pGuildInfoMapper->IsExistGuildName( m_player_info.guild_id ) )
								{
									wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_TEAM_NAME].GetString(),
										g_pGuildInfoMapper->GetGuildName( m_player_info.guild_id ));
								}
								else
									wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_TEAM_NAME].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_JOIN_ANY_TEAM].GetString());
							}
							break;
#if __CONTENTS(__CONTRIBUTE_SYSTEM)							
						case 2 : // 기여도
							{
								int contributeGrade = 7 - countContributeGrade(m_player_info.contributePoint);
								if (contributeGrade >= 0 || contributeGrade < 8)
								{
									wsprintf(temp_str[0],"%s : %d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CONTRIBUTE].GetString(),m_player_info.contributePoint);
									wsprintf(temp_str[1],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_SLAYER_CONTRIBUTENAME_7+contributeGrade].GetString());
									str[1]=temp_str[1];
								}
							}
							break;
#endif //__CONTRIBUTE_SYSTEM
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
						case 3 : //level
#else
						case 2 : //level

#endif //__CONTRIBUTE_SYSTEM
							{
								//DEBUG_ADD("[ OtherInfo ] MouseControl - Level [S]");
								const static char *SlayerJob[5] = {
									(*g_pGameStringTable)[UI_STRING_MESSAGE_ENG_DOMAIN_BLADE2].GetString(),
									(*g_pGameStringTable)[UI_STRING_MESSAGE_ENG_DOMAIN_SWORD2].GetString(),
									(*g_pGameStringTable)[UI_STRING_MESSAGE_ENG_DOMAIN_GUN2].GetString(),
									(*g_pGameStringTable)[UI_STRING_MESSAGE_ENG_DOMAIN_HEAL2].GetString(),
									(*g_pGameStringTable)[UI_STRING_MESSAGE_ENG_DOMAIN_ENCHANT2].GetString(),
								};
						
								if(TopDomain>=0&&TopDomain<5)
									wsprintf(temp_str[0],"%s: %s %s %d",(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_LEVEL].GetString(),SlayerJob[TopDomain],
									(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_CLASS2].GetString(),
									m_player_info.DOMAINLEVEL[TopDomain]);
								else
									wsprintf(temp_str[0],"%s: ",(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_LEVEL].GetString());
							}
							break;
						default :
							str[0]= NULL;
							break;
						}
						if(str[0]!=NULL)
						{
							if(str[1]!=NULL)
								g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,2);
							else
								g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,1);
						}
					} else
					if(_x>86 && _y>79 && _x < 184 && _y < 94)
					{
						// 캐릭터 이름
	//					DEBUG_ADD("[ OtherInfo ] MouseControl - Character Name [S]");
						static char name[50];
						wsprintf(name,"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_NAME].GetString(),m_player_info.PLAYER_NAME.c_str());
						const static char* str[1] = {
							name,
						};
						g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,1);
					} else
					if(_x>grade_rect.left && _x < grade_rect.right && _y > grade_rect.top && _y < grade_rect.bottom && 
						m_player_info.GRADE > 0 && m_player_info.GRADE <= GRADE_MARK_MAX )					
					{			
						
	//					DEBUG_ADD("[ OtherInfo ] MouseControl - GradeMarkRect [S]");
						static char temp_str[2][100];
						wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NAME].GetString(),grade[(m_player_info.GRADE-1)/5]);
						wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LEVEL].GetString(),m_player_info.GRADE);
						const static char* str[2] = {
							temp_str[0],						
							temp_str[1],
						};
						g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,2);
						
					} else
					/*if(_x>120&&_y>175&&_x<186&&_y<215)
					{
						static char temp_str[20];
						// 음수 여부 판단해서 + 를 출력하지 않게 해준다.
						if(m_player_info.ALIGNMENT_NUM > 0 )
							wsprintf(temp_str, "(+%d)",m_player_info.ALIGNMENT_NUM);
						else
							wsprintf(temp_str, "(%d)",m_player_info.ALIGNMENT_NUM);
						
						const static char* str[3]={
							(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGNMENT].GetString(),
							NULL,
							temp_str,
						};
						g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)str,0,0);
					}else*/
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
					if(_x>20&&_x<102&&_y>198&&_y<258)
					{	
						//DEBUG_ADD("[ OtherInfo ] MouseControl - STRDEXINT [S]");
						static char temp_str[2][50];
						int num=(_y-198)/20;
#else
					if(_x>20&&_x<102&&_y>178&&_y<238)
					{	
						//DEBUG_ADD("[ OtherInfo ] MouseControl - STRDEXINT [S]");
						static char temp_str[2][50];
						int num=(_y-178)/20;
#endif //__CONTRIBUTE_SYSTEM

						switch(num)
						{
						case 0 :			// str
							wsprintf(temp_str[0],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_STR_PURE].GetString(),m_player_info.STR_PURE);
							wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_STR_CUR].GetString(),m_player_info.STR_CUR);
							break;
						case 1 :			// dex
							wsprintf(temp_str[0],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_DEX_PURE].GetString(),m_player_info.DEX_PURE);
							wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_DEX_CUR].GetString(),m_player_info.DEX_CUR);
							break;
						case 2 :				// int
							wsprintf(temp_str[0],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_INT_PURE].GetString(),m_player_info.INT_PURE);
							wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_INT_CUR].GetString(),m_player_info.INT_CUR);
							break;
						//default :
						//	temp_str[0]=NULL;
						}

						const static char* str[2] = {
							temp_str[0],
							temp_str[1],						
						};

						if(temp_str[0]!=NULL)
							g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,2);
					}
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
					else if(_x>54&&_x<183&&_y>180&&_y<194)
#else
					else if(_x>54&&_x<183&&_y>160&&_y<174)
#endif //__CONTRIBUTE_SYSTEM
					{
	//					DEBUG_ADD("[ OtherInfo ] MouseControl - Fame [S]");
						static char tempstring[100];
						char sz_temp[50];
						const static char *str[1] = {tempstring};
						
						wsprintf(sz_temp, "%d", m_player_info.FAME);
						
						std::string sstr = sz_temp;
						for(int i = 3; i <= 13; i += 4)
							if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
							
						sprintf(tempstring,"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_FAME].GetString(),sstr.c_str());
							
						g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,1);
					}
				}
				break;

			case RACE_OUSTERS :
			case RACE_VAMPIRE:
				{
					// 뱀파이어 계급
					const static char* grade[20] = 
					{
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_RITTER].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_REICHSRITTER].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BARONET].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PREYHER].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GRAF].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARKGRAF].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PFALZGRAF].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FURST].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HERZOG].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LANDESHER].GetString(),
						"랗된븜얽",
						"寧된븜얽",
						"쥴寮",
						"朞뒨븜",
						"무얽",
						"댕무얽",
						"항珙",
						"뇨엌",
						"沂뽈",
						"열힁",
					};
					
					const char* ousters_grade[20] = 
					{
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MALCHUT].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_YESOD].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HOD].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NETRETH].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_TIPHRETH].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GEBURAH].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHESED].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BINAH].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHOKMA].GetString(),
						(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KEATHER].GetString(),
						"첨景윗",
						"속겟죗",
						"윗爾랑",
						"벗쳄랑",
						"쵠瀁잇",
						"엥찝랑",
						"힉샘랑",
						"른샘랑",
						"윗폡랑",
						"첨檢景징",
					};
					// 계급, 길드, 레벨부분 Description
					if(_x>guildmark_rect.left && _x < guildmark_rect.right && _y > guildmark_rect.top && _y < guildmark_rect.bottom)
					{
						// 팀 이름이 비지 않았으면.
						//if(m_player_info.TEAM_NAME.size()>0)###@@@
						if( g_pGuildInfoMapper->IsExistGuildName( m_player_info.guild_id ) )
						{
							if(g_eRaceInterface == RACE_OUSTERS)
								wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_GUILD_NAME].GetString(),
								g_pGuildInfoMapper->GetGuildName( m_player_info.guild_id ));
							else
								wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_CLAN_NAME].GetString(),
								g_pGuildInfoMapper->GetGuildName( m_player_info.guild_id ));
							g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void *)str_g,1);
						}

					}
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
					else if(_x > 22 && _y > 97 && _x < 184 && _y < 177)
#else
					else if(_x > 22 && _y > 97 && _x < 184 && _y < 157)
#endif //__CONTRIBUTE_SYSTEM
					{					
						int num=(_y-97)/20;
						switch(num)
						{
						case 0 : // grade
	//						DEBUG_ADD("[ OtherInfo ] MouseControl - Grade");
							if(m_player_info.GRADE > 0 && m_player_info.GRADE <= GRADE_MARK_MAX )
							{
								wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NAME].GetString(),g_eRaceInterface == RACE_OUSTERS ? ousters_grade[(m_player_info.GRADE-1)/5] : grade[(m_player_info.GRADE-1)/5]);
								wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LEVEL].GetString(),m_player_info.GRADE);
								str_g[1]=temp_str[1];							
							} else
							{
								//str[0] = NULL;
							}
							break;
						case 1 : // team
							{
	//							DEBUG_ADD("[ OtherInfo ] MouseControl - Team");
								//if(m_player_info.TEAM_NAME.size()>0)###@@@
								if( g_pGuildInfoMapper->IsExistGuildName( m_player_info.guild_id ) )
								{
									if(g_eRaceInterface == RACE_OUSTERS)
										wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_GUILD_NAME].GetString(),
										g_pGuildInfoMapper->GetGuildName( m_player_info.guild_id ));								
									else
										wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_CLAN_NAME].GetString(),
										g_pGuildInfoMapper->GetGuildName( m_player_info.guild_id ));								
								}
								else
								{
									if(g_eRaceInterface == RACE_OUSTERS)
										wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_CLAN_NAME].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_JOIN_ANY_GUILD].GetString());
									else
										wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_CLAN_NAME].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_JOIN_ANY_CLAN].GetString());
								}
							}
							break;
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
						case 2 : // 기여도
							{
								int contributeGrade = 7 - countContributeGrade(m_player_info.contributePoint);
								if (contributeGrade >= 0 || contributeGrade < 8)
								{
									wsprintf(temp_str[0],"%s : %d",(*g_pGameStringTable)[UI_STRING_MESSAGE_CONTRIBUTE].GetString(),m_player_info.contributePoint);
									if(g_eRaceInterface == RACE_OUSTERS)
										wsprintf(temp_str[1],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_OUSTERS_CONTRIBUTENAME_7+contributeGrade].GetString());
									else
										wsprintf(temp_str[1],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_VAMPIRE_CONTRIBUTENAME_7+contributeGrade].GetString());
									str_g[1]=temp_str[1];	
								}
							}
							break;
#endif //__CONTRIBUTE_SYSTEM
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
						case 3 : // level
#else
						case 2 : // level
#endif //__CONTRIBUTE_SYSTEM
							{
	//							DEBUG_ADD("[ OtherInfo ] MouseControl - Level");
								// -_- 삑싸리. 툴팁 옆부부분 나가길래 임시로 막아놓음... 아래 str 쪽으로 빼자.
								if(_x > 101)
									return true;
								wsprintf(temp_str[0],"%s: %d",(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_LEVEL].GetString(),m_player_info.LEVEL);
							}
							break;
						default :
							str_g[0] = NULL;
						}
						// 두번째줄이 NULL 이 아니면 두줄을 출력하도록 한다.
						if(str_g[0] != NULL)
						{
							if(str_g[1]!=NULL)
								g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str_g,2);
							else
								g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str_g,1);
						}

					} else			// 캐릭터 이름.
					if(_x>86 && _y>79 && _x < 184 && _y < 94)
					{
						// 캐릭터 이름 
						static char name[30];
	//					DEBUG_ADD("[ OtherInfo ] MouseControl - CharacterName");
						wsprintf(name,"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_CHAR_MANAGER_NAME].GetString(),m_player_info.PLAYER_NAME.c_str());
						const static char* str[1] = {
							name,
						};
						g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str,1);
					} else				// 계급 마크
					if(_x>grade_rect.left && _x < grade_rect.right && _y > grade_rect.top && _y < grade_rect.bottom && 
						m_player_info.GRADE > 0 && m_player_info.GRADE <= GRADE_MARK_MAX )
						
					{
						static char temp_str[2][100];
	//					DEBUG_ADD("[ OtherInfo ] MouseControl - GradeMarkRect");
						
						wsprintf(temp_str[0],"%s%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NAME].GetString(),g_eRaceInterface == RACE_OUSTERS ? ousters_grade[(m_player_info.GRADE-1)/5] : grade[(m_player_info.GRADE-1)/5]);
						wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LEVEL].GetString(),m_player_info.GRADE);

						const static char* str_s[2] = {
							temp_str[0],					
							temp_str[1],
						};
						g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str_s,2);
					} /*else				// 성향
					if(_x>120&&_y>145&&_x<186&&_y<175)
					{
						static char temp_str[20];					
						// 음수 여부 판단해서 + 를 출력하지 않게 해준다.
						if(m_player_info.ALIGNMENT_NUM>0)
							wsprintf(temp_str, "(+%d)",m_player_info.ALIGNMENT_NUM);
						else
							wsprintf(temp_str, "(%d)",m_player_info.ALIGNMENT_NUM);
						const static char* str[3]={
							(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGNMENT].GetString(),
								NULL,
								temp_str
						};
						g_descriptor_manager.Set(DID_HELP, x+_x, y+_y, (void *)str,0,0);
					}*/ else			// str dex int
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
					if(_x>20&&_x<102&&_y>177&&_y<237)
					{					
						static char temp_str[2][50];
						int num=(_y-177)/20;
#else
					if(_x>20&&_x<102&&_y>157&&_y<217)
					{					
						static char temp_str[2][50];
						int num=(_y-157)/20;
#endif //__CONTRIBUTE_SYSTEM
						switch(num)
						{
						case 0 :			// str
							wsprintf(temp_str[0],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_STR_PURE].GetString(),m_player_info.STR_PURE);
							wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_STR_CUR].GetString(),m_player_info.STR_CUR);
							break;
						case 1 :			// dex
							wsprintf(temp_str[0],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_DEX_PURE].GetString(),m_player_info.DEX_PURE);
							wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_DEX_CUR].GetString(),m_player_info.DEX_CUR);
							break;
						case 2 :				// int
							wsprintf(temp_str[0],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_INT_PURE].GetString(),m_player_info.INT_PURE);
							wsprintf(temp_str[1],"%s%d",(*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_INFO_INT_CUR].GetString(),m_player_info.INT_CUR);
							break;
						}
						const static char* str_s[2] = {
							temp_str[0],
							temp_str[1],						
						};					
						g_descriptor_manager.Set(DID_STRINGS, x+_x, y+_y, (void *)str_s,2);
					} 
				}
				break;

			}
		}
		break;
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (gpC_mouse_pointer->GetPickUpItem()==FALSE && re)
		{
			MoveReady();
			SetOrigin(_x, _y);
		}
		break;
	}
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_OTHER_INFO
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_OTHER_INFO::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_KEYDOWN && key == VK_ESCAPE)
	{
		//		Run(CLOSE_ID);
	}
}

//-----------------------------------------------------------------------------
// Show
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_OTHER_INFO::Show()
{
	//m_pC_info_spk=C_VS_UI_INFO::m_pC_info_spk;
	
//	assert(m_pC_info_spk);
	const int field_x=22,field_gap=20;

	RECT face_rect={x+field_x,y+25,x+field_x+55,y+25+70};
	RECT grade_rect={x+124+9,y+30,x+40+124+9,y+30+40};
	RECT guildmark_rect={x+field_x+55+9,y+30,x+field_x+55+9+40,y+30+40};
	Rect grade_rect_t(grade_rect.left-2,grade_rect.top-2,44,44);
	RECT field_rect;

	char sz_temp[100];
	int i;

	const static char* align_temp[5] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_VERY_BAD].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_BAD].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_NORMAL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_GOOD].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_ALIGN_VERY_GOOD].GetString(),
	};	

	const static char* Origin_Server[5] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SERVERNAME_MOLDAVIA].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SERVERNAME_TRANSILVANIA].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SERVERNAME_WALAKIA].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SERVERNAME_HISTRIA].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SERVERNAME_NEWWOLRD].GetString(),
	};	
	
	
	gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);
	// grade mark
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		{
			const static char* grade[20] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PIVATE].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_SERENT].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FEACEL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LITENA].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KAINEL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GENEAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FORE_GENEAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MAJORIS_GENEAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CLOEL_GENEAL].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARSHAL].GetString(),
				"의裂제좆",
				"괭裂제좆",
				"襟裂제좆",
				"빪裂제좆",
				"斤嵐裂제",
				"覩제寧뿐바",
				"累逃",
				"댕낵",
				"累낀",
				"悧잿",
			};
			
			int field_y = 100;
			int bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);	
			int bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),x_gap_from_image=30;
			// 이름 GRADE,TEAM,LEVEL,FAME부분
			
			field_rect.left=x+field_x+x_gap_from_image;
			field_rect.right=field_rect.left+bar_width;
			field_rect.top=y+field_y-3;		
			
			for(i=0; i < 4; i++)
			{			
				field_rect.bottom=field_rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
				field_rect.top+=field_gap;
			}

#if	__CONTENTS(__CONTRIBUTE_SYSTEM)
			field_rect.bottom=field_rect.top+bar_height;
			gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
			field_rect.top+=field_gap;
#endif	//__CONTRIBUTE_SYSTEM



			// STR,DEX,INT 부분
			bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SMALL_BAR2);	
			bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR2);
			field_rect.right=field_rect.left+bar_width-19;
			
			for(i=0; i < 3; i++)
			{	
				field_rect.bottom=field_rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
				field_rect.top+=field_gap;
			}

		
			// align
			field_rect.left=x+92+x_gap_from_image;
			field_rect.right=field_rect.left+bar_width-8;
			field_rect.top-=field_gap*2;
			field_rect.bottom=field_rect.top+bar_height;
			gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);
			
			// 서버 정보 2005.12.23  SJHEON
			if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
			{
				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);	
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),x_gap_from_image=30;


				field_rect.left=x+field_x+x_gap_from_image;
				field_rect.right=field_rect.left+bar_width;
				field_rect.top+=(field_gap << 1) ;

				
				//for(i=0; i < 2; i++)
				//{			
				field_rect.bottom=field_rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
				field_rect.top+=field_gap;
				//}

				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SMALL_BAR2);	
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR2);
			
			}

			// name
			field_rect.left=x+85;
			field_rect.right=field_rect.left+102;
			field_rect.top=y+field_y-field_gap;
			field_rect.bottom=field_rect.top+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);
			gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);

			




			// 모아서
			if(gpC_base->m_p_DDSurface_back->Lock())
			{	
	//			DEBUG_ADD("[ OtherInfo ] Show Slayer Face");
				// 얼굴 
	//			if(m_p_face)
				{
					Rect Face_rect(face_rect.left-2,face_rect.top-2,59,74);
					gpC_global_resource->m_pC_info_spk->BltLocked(face_rect.left-1,face_rect.top-1, C_GLOBAL_RESOURCE::CHAR_BOX);
					
					//얼굴 찍기
					POINT point = {face_rect.left,face_rect.top};
					
					if(m_p_face && m_p_face->GetSize() > 0)
					{
						gpC_base->m_p_DDSurface_back->BltSprite(&point, &(*m_p_face)[0]);
					}
				}

				POINT grade_point={grade_rect.left,grade_rect.top};
				CSprite* GradeMark=NULL;

				// Grade mark
				if(m_player_info.GRADE > 0 && m_player_info.GRADE <= GRADE_MARK_MAX )		
				{
					GradeMark=g_pGuildMarkManager->GetGradeMark(m_player_info.GRADE-1,g_eRaceInterface);				
					if(GradeMark!=NULL)
					{
	/*					gpC_base->m_p_DDSurface_back->Unlock();
						gpC_base->m_p_DDSurface_back->HLine(grade_point.x-1,grade_point.y-1,42,GRAY);
						gpC_base->m_p_DDSurface_back->HLine(grade_point.x,grade_point.y+40,41,DARKGRAY);
						gpC_base->m_p_DDSurface_back->VLine(grade_point.x-1,grade_point.y-1,42,GRAY);
						gpC_base->m_p_DDSurface_back->VLine(grade_point.x+40,grade_point.y,40,DARKGRAY);
						gpC_base->m_p_DDSurface_back->Lock();*/
						gpC_base->m_p_DDSurface_back->BltSprite(&grade_point, GradeMark);
					}		
				}

				POINT guild_point={guildmark_rect.left,guildmark_rect.top};
				RECT guild_rect={guildmark_rect.left,guildmark_rect.top,guildmark_rect.left+40,guildmark_rect.top+40};
				
				DrawAlphaBox(&guild_rect,0,0,2,16);
				
				/*gpC_base->m_p_DDSurface_back->Unlock();
				gpC_base->m_p_DDSurface_back->HLine(guild_point.x-1,guild_point.y-1,42,GRAY);
				gpC_base->m_p_DDSurface_back->HLine(guild_point.x,guild_point.y+40,41,DARKGRAY);
				gpC_base->m_p_DDSurface_back->VLine(guild_point.x-1,guild_point.y-1,42,GRAY);
				gpC_base->m_p_DDSurface_back->VLine(guild_point.x+40,guild_point.y,40,DARKGRAY);
				gpC_base->m_p_DDSurface_back->Lock();
	*/
				// 길드 마크 출력. 길드 마크는 SetOtherInfo 에서 미리 읽어옴.
				if(m_p_guild_mark!=NULL)
					gpC_base->m_p_DDSurface_back->BltSprite(&guild_point, m_p_guild_mark);

				Rect clip_name(0,0,102,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
				
				field_y-=field_gap;			
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +85, y+field_y-3,clip_name, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x-2, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_GRADE);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;

//zzi - Team 이미지 출력 위치가.. 한글용 이미지에 최적화된 하드코딩. 이에 대응하여, 글로벌 서비스용 이미지에 최적화? 시킨 하드코딩 추가. ㅠㅠ
#if __CONTENTS (__INTERNATIONAL_UI)				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+6-10, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_TEAM);
#else
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+6, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_TEAM);
#endif
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;

#if __CONTENTS(__CONTRIBUTE_SYSTEM)
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x, y+field_y+2, C_GLOBAL_RESOURCE::SLAYER_CONTRIBUTE);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;
#endif //__CONTRIBUTE_SYSTEM
				
//zzi - Level 이미지 출력 위치가.. 한글용 이미지에 최적화된 하드코딩. 이에 대응하여, 글로벌 서비스용 이미지에 최적화? 시킨 하드코딩 추가. ㅠㅠ
#if __CONTENTS (__INTERNATIONAL_UI)				
				clip_name.Set(41,0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL)-27,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL));
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field_x-43, y+field_y+2,clip_name, C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL);
#else
				// LEVEL 은 DomainLevel 에서 Cut 해서 찍는다. 흐흐-.-
				clip_name.Set(27,0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL)-27,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL));
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field_x-28, y+field_y+2,clip_name, C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL);
#endif
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_FAME);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;

				clip_name.Set(0,0,bar_width-22,bar_height);
				
				for(i=0; i < 3; i++)
				{
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_STR+i);				
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field_x+x_gap_from_image, y+field_y-3, clip_name,C_GLOBAL_RESOURCE::LARGE_BAR);				
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+bar_width-22, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					field_y+=field_gap;			
				}

				field_y-=field_gap*3;
				clip_name.Set(0,0,bar_width-8,bar_height);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+92+x_gap_from_image+3,y+field_y+2,C_GLOBAL_RESOURCE::TITLE_ALIGN);
				field_y+=field_gap;
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +92+x_gap_from_image, y+field_y-3, clip_name,C_GLOBAL_RESOURCE::LARGE_BAR);				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +92+x_gap_from_image+bar_width-8, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				
				// 서버 정보 2005.12.23 Add
				if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
				{
					field_y+=field_gap*2;

					//clip_name.Set(27,0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYER_ORIGIN) - 27,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYER_ORIGIN));
					//gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field_x-28, y+field_y+2,clip_name, 112);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x - 7, y+field_y+2, C_GLOBAL_RESOURCE::ADVANCEMENT_SLAYER_ORIGIN);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					field_y+=field_gap;
					field_y-=field_gap*3;
				}
				//clip_name.Set(27,0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL)-27,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL));
				//gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field_x-28, y+field_y+2,clip_name, C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL);
				//gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
				//gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				//field_y+=field_gap;

				
				// 서버 정보 2005.12.23 End 



				m_pC_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();

				// Lock 해도 상관없나?-_- 일단 Unlock 상태에서 해줘야 하기 때문에 뒤로 빼놓음.
				// 길드마크 테두리

				if(m_p_guild_mark!=NULL)
				{
					gpC_base->m_p_DDSurface_back->HLine(guild_point.x-1,guild_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->HLine(guild_point.x,guild_point.y+40,41,DARKGRAY);
					gpC_base->m_p_DDSurface_back->VLine(guild_point.x-1,guild_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->VLine(guild_point.x+40,guild_point.y,40,DARKGRAY);
				}

				// 계급 마크 테두리
				if(GradeMark!=NULL)
				{
					gpC_base->m_p_DDSurface_back->HLine(grade_point.x-1,grade_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->HLine(grade_point.x,grade_point.y+40,41,DARKGRAY);
					gpC_base->m_p_DDSurface_back->VLine(grade_point.x-1,grade_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->VLine(grade_point.x+40,grade_point.y,40,DARKGRAY);
				}			
			}
			g_FL2_GetDC();
			// Text
			// Align

			if(m_player_info.ALIGNMENT>=0 && m_player_info.ALIGNMENT < 5)
				g_PrintColorStr(x+92+x_gap_from_image+4, y+field_y+1,align_temp[m_player_info.ALIGNMENT], gpC_base->m_chatting_pi, RGB_WHITE);	

			field_y=80;			
			
			// 이름
			//if(m_player_info.PLAYER_NAME.size()>0)###@@@
			if(!m_player_info.PLAYER_NAME.empty())
				g_PrintColorStr(x+85+3,y+field_y+1,m_player_info.PLAYER_NAME.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
			
			field_y+=field_gap;
			
			// 계급은 1부터 50까지의 값이 들어오므로 계산시 -1해주기.
			// Grade
			if(m_player_info.GRADE > 0 && m_player_info.GRADE <= GRADE_MARK_MAX )		
				g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,grade[(m_player_info.GRADE-1)/5], gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			// Team Name
			//if(m_player_info.TEAM_NAME.size() > 0)
			if( g_pGuildInfoMapper->IsExistGuildName( m_player_info.guild_id ) )
				g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,
				g_pGuildInfoMapper->GetGuildName( m_player_info.guild_id ), gpC_base->m_chatting_pi, RGB_WHITE);
			else
				g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_JOIN_ANY_TEAM].GetString(), gpC_base->m_chatting_pi, RGB_WHITE);

#if __CONTENTS(__CONTRIBUTE_SYSTEM)
			field_y+=field_gap;
			int contributeGrade = countContributeGrade(m_player_info.contributePoint);	
			if (contributeGrade >= 0 || contributeGrade < 8)
			{
				wsprintf(sz_temp, "%d/%d%s %s", m_player_info.contributePoint, contributeGrade, (*g_pGameStringTable)[UI_STRING_CONTRIBUTE_GRADE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_SLAYER_CONTRIBUTENAME_7+(7-contributeGrade)].GetString());
				g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp,gpC_base->m_chatting_pi,RGB_WHITE);
			}
		
#endif //__CONTRIBUTE_SYSTEM	
			
			field_y+=field_gap;
			
			// SkillDef.h 에 정의되어있는 enum 순서대로.
			// Level
			const static char *SlayerJob[5] = {
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ENG_DOMAIN_BLADE2].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ENG_DOMAIN_SWORD2].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ENG_DOMAIN_GUN2].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ENG_DOMAIN_HEAL2].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_ENG_DOMAIN_ENCHANT2].GetString(),
			};
			
			// 제일 높은 도메인. skilldef.h 에 정의되어 있는 순서대로임

			if(TopDomain>=0 && TopDomain<5)
			{
				sprintf(sz_temp,"%s %s %d",SlayerJob[TopDomain],
					(*g_pGameStringTable)[UI_STRING_MESSAGE_DESC_CLASS2].GetString(),
					m_player_info.DOMAINLEVEL[TopDomain]);
				g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			}
			field_y+=field_gap;
			
			// 성향
			sprintf(sz_temp,"%d",m_player_info.FAME);
			
			std::string sstr = sz_temp;
			for(int i = 3; i <= 13; i += 4)
				if(sstr.size() > i)sstr.insert(sstr.size()-i, ",");
				
			g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sstr.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			sprintf(sz_temp,"%d/%d",m_player_info.STR_PURE,m_player_info.STR_CUR);
			g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			sprintf(sz_temp,"%d/%d",m_player_info.DEX_PURE,m_player_info.DEX_CUR);
			g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			sprintf(sz_temp,"%d/%d",m_player_info.INT_PURE,m_player_info.INT_CUR);
			g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			// 2005.12.26 Sjheon Add
			if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
			{
				if(m_player_info.Origin_ServerIdx>=1 && m_player_info.Origin_ServerIdx <=5)
					g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,Origin_Server[m_player_info.Origin_ServerIdx - 1] , gpC_base->m_chatting_pi, RGB_WHITE);
				field_y+=field_gap;
			}
			//g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,m_player_info.PLAYER_OLDNAME.c_str()  , gpC_base->m_chatting_pi, RGB_WHITE);
			//field_y+=field_gap;
			// 2005.12.26 Sjheon End

			m_pC_button_group->ShowDescription();
			g_FL2_ReleaseDC();
		}		
		break;
		
	case RACE_VAMPIRE:
		{	
			const static char* grade[20] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_RITTER].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_REICHSRITTER].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BARONET].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PREYHER].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GRAF].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MARKGRAF].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_PFALZGRAF].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_FURST].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HERZOG].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_LANDESHER].GetString(),
				"랗된븜얽",
				"寧된븜얽",
				"쥴寮",
				"朞뒨븜",
				"무얽",
				"댕무얽",
				"항珙",
				"뇨엌",
				"沂뽈",
				"열힁",
			};
			
			int field_y = 100;
			int bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);	
			int bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),x_gap_from_image=30;
			// 이름 GRADE,TEAM,LEVEL,FAME부분
			
			field_rect.left=x+field_x+x_gap_from_image;
			field_rect.right=field_rect.left+bar_width;
			field_rect.top=y+field_y-3;
			
			for(i=0;i<2;i++)
			{			
				field_rect.bottom=field_rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
				field_rect.top+=field_gap;
			}


#if	__CONTENTS(__CONTRIBUTE_SYSTEM)
			field_rect.bottom=field_rect.top+bar_height;
			gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
			field_rect.top+=field_gap;
#endif	//__CONTRIBUTE_SYSTEM

			// STR,DEX,INT 부분
			bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SMALL_BAR2);	
			bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR2);
			field_rect.right=field_rect.left+bar_width-19;		
			for(i=0;i<4;i++)
			{	
				field_rect.bottom=field_rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
				field_rect.top+=field_gap;
			}


			// align
			field_rect.left=x+92+x_gap_from_image;
			field_rect.right=field_rect.left+bar_width-8;
			field_rect.top-=field_gap*3;
			field_rect.bottom=field_rect.top+bar_height;
			gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);



			/// 서버 정보 2005.12.23  SJHEON
			if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
			{
				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);	
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),x_gap_from_image=30;


				field_rect.left=x+field_x+x_gap_from_image;
				field_rect.right=field_rect.left+bar_width;
				field_rect.top+=(field_gap * 3) ;

				
				//for(i=0; i < 2; i++)
				//{			
				field_rect.bottom=field_rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
				field_rect.top+=field_gap;
				//}

				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SMALL_BAR2);	
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR2);
			}
			


			
			// name
			field_rect.left=x+85;
			field_rect.right=field_rect.left+102;
			field_rect.top=y+field_y-field_gap;
			field_rect.bottom=field_rect.top+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);
			gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);
			
			if(gpC_base->m_p_DDSurface_back->Lock())
			{				
				POINT guild_point={guildmark_rect.left,guildmark_rect.top};
				RECT guild_rect={guildmark_rect.left,guildmark_rect.top,guildmark_rect.left+40,guildmark_rect.top+40};

	//			DEBUG_ADD("[ OtherInfo ] Show Vampire Face");
				// 얼굴 
				//			if(m_p_face)
				{
					Rect Face_rect(face_rect.left-2,face_rect.top-2,59,74);
					gpC_global_resource->m_pC_info_spk->BltLocked(face_rect.left-1,face_rect.top-1, C_GLOBAL_RESOURCE::CHAR_BOX);
					
					//얼굴 찍기
					POINT point = {face_rect.left,face_rect.top};
					
					if(m_p_face && m_p_face->GetSize() > 0)
					{
						gpC_base->m_p_DDSurface_back->BltSprite(&point, &(*m_p_face)[0]);
					}
				}
	//			DEBUG_ADD("[ OtherInfo ] Show Vampire Grade");
				POINT grade_point={grade_rect.left,grade_rect.top};
				CSprite* GradeMark=NULL;
				// Grade mark
				if(m_player_info.GRADE > 0 && m_player_info.GRADE <= GRADE_MARK_MAX )		
				{
					GradeMark=g_pGuildMarkManager->GetGradeMark(m_player_info.GRADE-1,g_eRaceInterface);			
					
					if(GradeMark!=NULL)
					{						
				/*		gpC_base->m_p_DDSurface_back->Unlock();
						gpC_base->m_p_DDSurface_back->HLine(grade_point.x-1,grade_point.y-1,42,GRAY);
						gpC_base->m_p_DDSurface_back->HLine(grade_point.x,grade_point.y+40,41,DARKGRAY);
						gpC_base->m_p_DDSurface_back->VLine(grade_point.x-1,grade_point.y-1,42,GRAY);
						gpC_base->m_p_DDSurface_back->VLine(grade_point.x+40,grade_point.y,40,DARKGRAY);
						
						gpC_base->m_p_DDSurface_back->Lock();*/
						gpC_base->m_p_DDSurface_back->BltSprite(&grade_point, GradeMark);
					}		
				}
				
				DrawAlphaBox(&guild_rect,0,0,2,16);
			/*	gpC_base->m_p_DDSurface_back->Unlock();
				gpC_base->m_p_DDSurface_back->HLine(guild_point.x-1,guild_point.y-1,42,GRAY);
				gpC_base->m_p_DDSurface_back->HLine(guild_point.x,guild_point.y+40,41,DARKGRAY);
				gpC_base->m_p_DDSurface_back->VLine(guild_point.x-1,guild_point.y-1,42,GRAY);
				gpC_base->m_p_DDSurface_back->VLine(guild_point.x+40,guild_point.y,40,DARKGRAY);
				gpC_base->m_p_DDSurface_back->Lock();*/
				// 길드 마크 찍기. 길드 마크는 SetOtherInfo 에서 미리 읽어 온다.
	//			DEBUG_ADD("[ OtherInfo ] Show Vampire Guild");
				if(m_p_guild_mark != NULL)
					gpC_base->m_p_DDSurface_back->BltSprite(&guild_point, m_p_guild_mark);

				Rect clip_name(0,0,102,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
				
				field_y-=field_gap;
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +85, y+field_y-3,clip_name, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);			
				field_y+=field_gap;
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x-2, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_GRADE2);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_CLAN);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;
				clip_name.Set(0,0,bar_width-22,bar_height);

#if __CONTENTS(__CONTRIBUTE_SYSTEM)
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x, y+field_y+2, C_GLOBAL_RESOURCE::VAMPIRE_CONTRIBUTE);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;
#endif //__CONTRIBUTE_SYSTEM
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_LEVEL);				
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field_x+x_gap_from_image, y+field_y-3, clip_name,C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+bar_width-22, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;
				
				for(i=0;i<3;i++)
				{
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_STR+i);				
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field_x+x_gap_from_image, y+field_y-3, clip_name,C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+bar_width-22, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					field_y+=field_gap;			
				}
				
				field_y-=field_gap*4;
				clip_name.Set(0,0,bar_width-8,bar_height);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+92+x_gap_from_image,y+field_y+2,C_GLOBAL_RESOURCE::TITLE_ALIGN);
				field_y+=field_gap;
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +92+x_gap_from_image, y+field_y-3, clip_name ,C_GLOBAL_RESOURCE::LARGE_BAR);				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +92+x_gap_from_image+bar_width-8, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);


				// 서버 정보 2005.12.23 Add
				if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
				{
					field_y+=field_gap*3;

					//clip_name.Set(27,0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL)-27,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL));
					//gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x-2, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_GRADE2);
					
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x - 7, y+field_y+2, C_GLOBAL_RESOURCE::ADVANCEMENT_VAMPIRE_ORIGIN);

					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					//field_y+=field_gap;
					
					//clip_name.Set(27,0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL)-27,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::TITLE_DOMAINLEVEL));
					//gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x-2, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_GRADE2);
					//gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
					//gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					//field_y+=field_gap;

					field_y-=field_gap*3;
				}
				// 서버 정보 2005.12.23 End 
				

				m_pC_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();

				// Lock 해도 상관없나?-_- 일단 Unlock 상태에서 해줘야 하기 때문에 뒤로 빼놓음.
				// 길드마크 테두리
				if(m_p_guild_mark != NULL)
				{
					gpC_base->m_p_DDSurface_back->HLine(guild_point.x-1,guild_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->HLine(guild_point.x,guild_point.y+40,41,DARKGRAY);
					gpC_base->m_p_DDSurface_back->VLine(guild_point.x-1,guild_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->VLine(guild_point.x+40,guild_point.y,40,DARKGRAY);
				}
				// 계급마크 테두리			
				if(GradeMark != NULL)
				{
					gpC_base->m_p_DDSurface_back->HLine(grade_point.x-1,grade_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->HLine(grade_point.x,grade_point.y+40,41,DARKGRAY);
					gpC_base->m_p_DDSurface_back->VLine(grade_point.x-1,grade_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->VLine(grade_point.x+40,grade_point.y,40,DARKGRAY);
				}
			}		
			
			g_FL2_GetDC();
			// Text
			// align
			if(m_player_info.ALIGNMENT>=0&&m_player_info.ALIGNMENT<5)
				g_PrintColorStr(x+92+x_gap_from_image+4, y+field_y+1,align_temp[m_player_info.ALIGNMENT], gpC_base->m_chatting_pi, RGB_WHITE);
			
			field_y=80;			
			
			//if(m_player_info.PLAYER_NAME.size()>0)
			if(!m_player_info.PLAYER_NAME.empty())
				g_PrintColorStr(x+85+3,y+field_y+1,m_player_info.PLAYER_NAME.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);		
			field_y+=field_gap;		
			
			// Grade 는 0부터 49까지 들어오는게 아니라 1 부터 50까지 들어오므로 계산시에는 1을 빼서 계산을 해주도록!
			if(m_player_info.GRADE > 0 && m_player_info.GRADE <= GRADE_MARK_MAX )
				g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,grade[((m_player_info.GRADE-1)/5)], gpC_base->m_chatting_pi, RGB_WHITE);
			
			field_y+=field_gap;		
			// 팀이름이 없으면 가입된 길드가 없고, 있으면, 팀 이름 찍어줌
			//if(m_player_info.TEAM_NAME.size()>0)
			if( g_pGuildInfoMapper->IsExistGuildName( m_player_info.guild_id ) )
				g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,
				g_pGuildInfoMapper->GetGuildName( m_player_info.guild_id ), gpC_base->m_chatting_pi, RGB_WHITE);
			else
				g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_JOIN_ANY_CLAN].GetString(), gpC_base->m_chatting_pi, RGB_WHITE);

#if __CONTENTS(__CONTRIBUTE_SYSTEM)
			field_y+=field_gap;
			int contributeGrade = countContributeGrade(m_player_info.contributePoint);
			if (contributeGrade >= 0 || contributeGrade < 8)
			{
				wsprintf(sz_temp, "%d/%d%s %s", m_player_info.contributePoint, contributeGrade, (*g_pGameStringTable)[UI_STRING_CONTRIBUTE_GRADE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_VAMPIRE_CONTRIBUTENAME_7+(7-contributeGrade)].GetString());
				g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp,gpC_base->m_chatting_pi,RGB_WHITE);
			}
		
#endif //__CONTRIBUTE_SYSTEM	

			field_y+=field_gap;
			
			sprintf(sz_temp,"%d",m_player_info.LEVEL);
			g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			sprintf(sz_temp,"%d/%d",m_player_info.STR_PURE,m_player_info.STR_CUR);
			g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			sprintf(sz_temp,"%d/%d",m_player_info.DEX_PURE,m_player_info.DEX_CUR);
			g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			sprintf(sz_temp,"%d/%d",m_player_info.INT_PURE,m_player_info.INT_CUR);
			g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			//// 2005.12.26 Sjheon Add
			if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
			{
				if(m_player_info.Origin_ServerIdx>=1 && m_player_info.Origin_ServerIdx <=5)
					g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,Origin_Server[m_player_info.Origin_ServerIdx - 1] , gpC_base->m_chatting_pi, RGB_WHITE);
				field_y+=field_gap;
			}
			//g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,m_player_info.PLAYER_OLDNAME.c_str()  , gpC_base->m_chatting_pi, RGB_WHITE);
			//field_y+=field_gap;
			// 2005.12.26 Sjheon End

			m_pC_button_group->ShowDescription();
			g_FL2_ReleaseDC();
		}
		break;
		
	case RACE_OUSTERS:
		{	
			const static char* grade[20] = 
			{
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_MALCHUT].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_YESOD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_HOD].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_NETRETH].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_TIPHRETH].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_GEBURAH].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHESED].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_BINAH].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_CHOKMA].GetString(),
				(*g_pGameStringTable)[UI_STRING_MESSAGE_GRADE_KEATHER].GetString(),
				"첨景윗",
				"속겟죗",
				"윗爾랑",
				"벗쳄랑",
				"쵠瀁잇",
				"엥찝랑",
				"힉샘랑",
				"른샘랑",
				"윗폡랑",
				"첨檢景징",
			};
			
			int field_y = 100;
			int bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);	
			int bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),x_gap_from_image=30;
			// 이름 GRADE,TEAM,LEVEL,FAME부분
			
			field_rect.left=x+field_x+x_gap_from_image+3;
			field_rect.right=field_rect.left+bar_width-3;
			field_rect.top=y+field_y-3;
			
			for(i=0;i<2;i++)
			{			
				field_rect.bottom=field_rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
				field_rect.top+=field_gap;
			}

#if	__CONTENTS(__CONTRIBUTE_SYSTEM)
			field_rect.bottom=field_rect.top+bar_height;
			gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
			field_rect.top+=field_gap;
#endif	//__CONTRIBUTE_SYSTEM

			// STR,DEX,INT 부분
			bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SMALL_BAR2);	
			bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR2);
			field_rect.right=field_rect.left+bar_width-19;		

			for(i=0;i<4;i++)
			{	
				field_rect.bottom=field_rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
				field_rect.top+=field_gap;
			}
			


			// align
			field_rect.left=x+92+x_gap_from_image;
			field_rect.right=field_rect.left+bar_width-8;
			field_rect.top-=field_gap*3;
			field_rect.bottom=field_rect.top+bar_height;
			gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);
			
			// 서버 정보 2005.12.23  SJHEON
			if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
			{
				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);	
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR),x_gap_from_image=30;


				field_rect.left=x+field_x+x_gap_from_image+3;
				field_rect.right=field_rect.left+bar_width-3;
				field_rect.top+=(field_gap * 3) ;

				
				//for(i=0; i < 2; i++)
				//{			
				field_rect.bottom=field_rect.top+bar_height;
				gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);			
				field_rect.top+=field_gap;
				//}

				bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::SMALL_BAR2);	
				bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::SMALL_BAR2);		
			}
			

			// name
			field_rect.left=x+85;
			field_rect.right=field_rect.left+102;
			field_rect.top=y+field_y-field_gap;
			field_rect.bottom=field_rect.top+gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR);
			gpC_base->m_p_DDSurface_back->FillRect(&field_rect, 0);
			
			if(gpC_base->m_p_DDSurface_back->Lock())
			{				
				POINT guild_point={guildmark_rect.left,guildmark_rect.top};
				RECT guild_rect={guildmark_rect.left,guildmark_rect.top,guildmark_rect.left+40,guildmark_rect.top+40};

	//			DEBUG_ADD("[ OtherInfo ] Show Vampire Face");
				// 얼굴 
				//			if(m_p_face)
				{
					Rect Face_rect(face_rect.left-2,face_rect.top-2,59,74);
					gpC_global_resource->m_pC_info_spk->BltLocked(face_rect.left-1,face_rect.top-1, C_GLOBAL_RESOURCE::CHAR_BOX);
					
					//얼굴 찍기
					POINT point = {face_rect.left,face_rect.top};
					
					if(m_p_face && m_p_face->GetSize() > 0)
					{
						gpC_base->m_p_DDSurface_back->BltSprite(&point, &(*m_p_face)[0]);
					}
				}
	//			DEBUG_ADD("[ OtherInfo ] Show Vampire Grade");
				POINT grade_point={grade_rect.left,grade_rect.top};
				CSprite* GradeMark=NULL;
				// Grade mark
				if(m_player_info.GRADE > 0 && m_player_info.GRADE <= GRADE_MARK_MAX )		
				{
					GradeMark=g_pGuildMarkManager->GetGradeMark(m_player_info.GRADE-1,g_eRaceInterface);			
					
					if(GradeMark!=NULL)
					{						
				/*		gpC_base->m_p_DDSurface_back->Unlock();
						gpC_base->m_p_DDSurface_back->HLine(grade_point.x-1,grade_point.y-1,42,GRAY);
						gpC_base->m_p_DDSurface_back->HLine(grade_point.x,grade_point.y+40,41,DARKGRAY);
						gpC_base->m_p_DDSurface_back->VLine(grade_point.x-1,grade_point.y-1,42,GRAY);
						gpC_base->m_p_DDSurface_back->VLine(grade_point.x+40,grade_point.y,40,DARKGRAY);
						
						gpC_base->m_p_DDSurface_back->Lock();*/
						gpC_base->m_p_DDSurface_back->BltSprite(&grade_point, GradeMark);
					}		
				}
				
				DrawAlphaBox(&guild_rect,0,0,2,16);
			/*	gpC_base->m_p_DDSurface_back->Unlock();
				gpC_base->m_p_DDSurface_back->HLine(guild_point.x-1,guild_point.y-1,42,GRAY);
				gpC_base->m_p_DDSurface_back->HLine(guild_point.x,guild_point.y+40,41,DARKGRAY);
				gpC_base->m_p_DDSurface_back->VLine(guild_point.x-1,guild_point.y-1,42,GRAY);
				gpC_base->m_p_DDSurface_back->VLine(guild_point.x+40,guild_point.y,40,DARKGRAY);
				gpC_base->m_p_DDSurface_back->Lock();*/
				// 길드 마크 찍기. 길드 마크는 SetOtherInfo 에서 미리 읽어 온다.
	//			DEBUG_ADD("[ OtherInfo ] Show Vampire Guild");
				if(m_p_guild_mark != NULL)
					gpC_base->m_p_DDSurface_back->BltSprite(&guild_point, m_p_guild_mark);

				field_rect.left=x+field_x+x_gap_from_image+3;
				field_rect.right=field_rect.left+bar_width-3;
				field_rect.top=y+field_y-3;

				Rect clip_name(0,0,102,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
				field_y-=field_gap;
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +85, y+field_y-3,clip_name, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;
				
				clip_name.Set(0,0, 
					gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-3, 
					gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
				
				for(i=0;i<2;i++)
				{
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x-2, y+field_y+2, C_GLOBAL_RESOURCE::OUSTERS_TITLE_GRADE2+i);
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field_x+x_gap_from_image+3, y+field_y-3,clip_name, C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+3+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-3, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					field_y+=field_gap;
				}
#if __CONTENTS(__CONTRIBUTE_SYSTEM)
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x, y+field_y+2, C_GLOBAL_RESOURCE::OUSTERS_CONTRIBUTE);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;
#endif //__CONTRIBUTE_SYSTEM

				clip_name.Set(0,0,bar_width-22,bar_height);
				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_LEVEL);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +field_x+x_gap_from_image+3, y+field_y-3, clip_name,C_GLOBAL_RESOURCE::LARGE_BAR);
				gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+bar_width-19, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
				field_y+=field_gap;			
				
				for(i=0;i<3;i++)
				{
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x, y+field_y+2, C_GLOBAL_RESOURCE::TITLE_STR+i);				
					gpC_global_resource->m_pC_info_spk->BltLockedClip(field_rect.left, y+field_y-3, clip_name,C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(field_rect.left+bar_width-22, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					field_y+=field_gap;			
				}

			
				field_y-=field_gap*4;
				clip_name.Set(0,0,bar_width-8,bar_height);
				gpC_global_resource->m_pC_info_spk->BltLocked(x+92+x_gap_from_image,y+field_y+2,C_GLOBAL_RESOURCE::TITLE_ALIGN);
				field_y+=field_gap;
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x +92+x_gap_from_image, y+field_y-3, clip_name ,C_GLOBAL_RESOURCE::LARGE_BAR);				
				gpC_global_resource->m_pC_info_spk->BltLocked(x +92+x_gap_from_image+bar_width-8, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);


				// 서버 정보 2005.12.23 Add
				if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
				{
					field_y+=field_gap*3;

					//clip_name.Set(27,0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-27,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
					gpC_global_resource->m_pC_info_spk->BltLocked(x+ field_x - 7 ,y+field_y+2,C_GLOBAL_RESOURCE::ADVANCEMENT_OUSTERS_ORIGIN);

					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+3, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
					gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image-3+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					//field_y+=field_gap;
					
					//clip_name.Set(27,0,gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR)-27,gpC_global_resource->m_pC_info_spk->GetHeight(C_GLOBAL_RESOURCE::LARGE_BAR));
					//gpC_global_resource->m_pC_info_spk->BltLocked(x+ field_x ,y+field_y+2,C_GLOBAL_RESOURCE::TITLE_ALIGN);
					//g/pC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image+3, y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR);
					//gpC_global_resource->m_pC_info_spk->BltLocked(x +field_x+x_gap_from_image-3+gpC_global_resource->m_pC_info_spk->GetWidth(C_GLOBAL_RESOURCE::LARGE_BAR), y+field_y-3, C_GLOBAL_RESOURCE::LARGE_BAR_RIGHT);
					//field_y+=field_gap;

					field_y-=field_gap*3;
					// 서버 정보 2005.12.23 End 
				}

				
				m_pC_button_group->Show();
				gpC_base->m_p_DDSurface_back->Unlock();

				// Lock 해도 상관없나?-_- 일단 Unlock 상태에서 해줘야 하기 때문에 뒤로 빼놓음.
				// 길드마크 테두리
				if(m_p_guild_mark != NULL)
				{
					gpC_base->m_p_DDSurface_back->HLine(guild_point.x-1,guild_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->HLine(guild_point.x,guild_point.y+40,41,DARKGRAY);
					gpC_base->m_p_DDSurface_back->VLine(guild_point.x-1,guild_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->VLine(guild_point.x+40,guild_point.y,40,DARKGRAY);
				}
				// 계급마크 테두리			
				if(GradeMark != NULL)
				{
					gpC_base->m_p_DDSurface_back->HLine(grade_point.x-1,grade_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->HLine(grade_point.x,grade_point.y+40,41,DARKGRAY);
					gpC_base->m_p_DDSurface_back->VLine(grade_point.x-1,grade_point.y-1,42,GRAY);
					gpC_base->m_p_DDSurface_back->VLine(grade_point.x+40,grade_point.y,40,DARKGRAY);
				}
			}		

			field_rect.left=x+field_x+x_gap_from_image+3;
			field_rect.right=field_rect.left+bar_width-3;
			field_rect.top=y+field_y-3;
						
			g_FL2_GetDC();
			// Text
			// align
			if(m_player_info.ALIGNMENT>=0&&m_player_info.ALIGNMENT<5)
				g_PrintColorStr(x+92+x_gap_from_image+4, y+field_y+1,align_temp[m_player_info.ALIGNMENT], gpC_base->m_chatting_pi, RGB_WHITE);
			
			field_y=80;			
			
			//if(m_player_info.PLAYER_NAME.size()>0)
			if(!m_player_info.PLAYER_NAME.empty())
				g_PrintColorStr(x+85+3,y+field_y+1,m_player_info.PLAYER_NAME.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);		
			field_y+=field_gap;		
			
			// Grade 는 0부터 49까지 들어오는게 아니라 1 부터 50까지 들어오므로 계산시에는 1을 빼서 계산을 해주도록!
			if(m_player_info.GRADE > 0 && m_player_info.GRADE <= GRADE_MARK_MAX )
				g_PrintColorStr(field_rect.left+3,y+field_y+1,grade[((m_player_info.GRADE-1)/5)], gpC_base->m_chatting_pi, RGB_WHITE);
			
			field_y+=field_gap;		
			// 팀이름이 없으면 가입된 길드가 없고, 있으면, 팀 이름 찍어줌
			//if(m_player_info.TEAM_NAME.size()>0)
			if( g_pGuildInfoMapper->IsExistGuildName( m_player_info.guild_id ) )
				g_PrintColorStr(field_rect.left+3,y+field_y+1,
				g_pGuildInfoMapper->GetGuildName( m_player_info.guild_id ), gpC_base->m_chatting_pi, RGB_WHITE);
			else
				g_PrintColorStr(field_rect.left+3,y+field_y+1,(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_JOIN_ANY_GUILD].GetString(), gpC_base->m_chatting_pi, RGB_WHITE);

#if __CONTENTS(__CONTRIBUTE_SYSTEM)
			field_y+=field_gap;
			int contributeGrade = countContributeGrade(m_player_info.contributePoint);
			if (contributeGrade >= 0 || contributeGrade < 8)
			{
				wsprintf(sz_temp, "%d/%d%s %s", m_player_info.contributePoint, contributeGrade, (*g_pGameStringTable)[UI_STRING_CONTRIBUTE_GRADE].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_OUSTERS_CONTRIBUTENAME_7+(7-contributeGrade)].GetString());
				g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,sz_temp,gpC_base->m_chatting_pi,RGB_WHITE);
			}
#endif //__CONTRIBUTE_SYSTEM			
			
			field_y+=field_gap;
			sprintf(sz_temp,"%d",m_player_info.LEVEL);
			g_PrintColorStr(field_rect.left+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			sprintf(sz_temp,"%d/%d",m_player_info.STR_PURE,m_player_info.STR_CUR);
			g_PrintColorStr(field_rect.left+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			sprintf(sz_temp,"%d/%d",m_player_info.DEX_PURE,m_player_info.DEX_CUR);
			g_PrintColorStr(field_rect.left+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			sprintf(sz_temp,"%d/%d",m_player_info.INT_PURE,m_player_info.INT_CUR);
			g_PrintColorStr(field_rect.left+3,y+field_y+1,sz_temp, gpC_base->m_chatting_pi, RGB_WHITE);
			field_y+=field_gap;
			
			// 2005.12.26 Sjheon Add
			if(!g_pUserInformation->IsNetmarble && !g_pUserInformation->IsTestServer)
			{
				if(m_player_info.Origin_ServerIdx>=1 && m_player_info.Origin_ServerIdx <=5)
					g_PrintColorStr(field_rect.left+3,y+field_y+1,Origin_Server[m_player_info.Origin_ServerIdx - 1] , gpC_base->m_chatting_pi, RGB_WHITE);
				field_y+=field_gap;
			}
			//g_PrintColorStr(x+field_x+x_gap_from_image+3,y+field_y+1,m_player_info.PLAYER_OLDNAME.c_str()  , gpC_base->m_chatting_pi, RGB_WHITE);
			//field_y+=field_gap;
			// 2005.12.26 Sjheon End

			m_pC_button_group->ShowDescription();
			g_FL2_ReleaseDC();
		}
		break;
	}
}

const char*		C_VS_UI_OTHER_INFO::GetCurrentOtherInfoName()
{
	//if(m_player_info.PLAYER_NAME.size()>0)
	if(!m_player_info.PLAYER_NAME.empty())
		return m_player_info.PLAYER_NAME.c_str();
	
	return NULL;
}
//-----------------------------------------------------------------------------
// Start
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_OTHER_INFO::Start()
{
	gC_vs_ui.ClosePetInfo();
	//IsRunning=true;
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::OTHER_INFO));
	
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::OTHER_INFO);
	if(rect.w != -1)
	{
		x = rect.x;
		y = rect.y;
	}
	
	PI_Processor::Start();
	m_pC_button_group->Init();	
	gpC_window_manager->AppearWindow(this);
	
	m_player_info.Init();
//	m_player_info.TEAM_NAME="";
	m_player_info.PLAYER_NAME="";
	
	TopDomain=0;
	m_p_guild_mark = NULL;
	
	EMPTY_MOVE;
}

void	C_VS_UI_OTHER_INFO::Finish()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::OTHER_INFO, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::OTHER_INFO, Rect(x, y, w, h));
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);	
}

//-----------------------------------------------------------------------------
// Process
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_OTHER_INFO::Process()
{
	m_pC_button_group->Process();
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_OTHER_INFO::IsPixel(int _x, int _y)
{
	bool re = IsInRect(_x, _y);
	if(re == false && m_pPetInfo->EXIST == true)
	{
		C_VS_UI_EVENT_BUTTON *pButton = m_pC_button_group->GetButton(PET_INFO_ID);
		if(pButton != NULL)
		{
			int petButtonIndex = pButton->m_image_index;
			re = m_petButtonSpk.IsPixel(_x-x-pButton->x, _y-y-pButton->y, petButtonIndex);
		}
	}
	return re;	
}

void	C_VS_UI_OTHER_INFO::SetOtherInfo(PLAYER_INFO &info)
{	
	m_player_info = info;
	TopDomain = 0;

	m_p_guild_mark = NULL;

	// 제일 높은 도메인을 찾는다.
	for( int i = 0 ; i < 5; i++ )
	{
		if(m_player_info.DOMAINLEVEL[TopDomain] < m_player_info.DOMAINLEVEL[i])
			TopDomain = i;
	}
	m_p_guild_mark = g_pGuildMarkManager->GetGuildMark(m_player_info.guild_id);
	
	if(m_p_guild_mark == NULL)
	{
		g_pGuildMarkManager->LoadGuildMark( m_player_info.guild_id );
		m_p_guild_mark = g_pGuildMarkManager->GetGuildMark( m_player_info.guild_id );
	}	
	RefreshImage();
}

void	C_VS_UI_OTHER_INFO::RefreshImage()
{
	if(m_p_face)
		DeleteNew(m_p_face);
	
	m_p_face = new CSpritePack;
	m_p_face->Init(1);
	
	if(g_pProfileManager->HasProfile(m_player_info.PLAYER_NAME.c_str()))
	{
		const char *filename = g_pProfileManager->GetFilename(m_player_info.PLAYER_NAME.c_str());
		char filenamei[256];
		
		strcpy(filenamei, filename);
		strcat(filenamei, "i");
		
		if(!m_p_face->LoadFromFileData(0, 1, filename, filenamei ))
		{
			delete m_p_face;
			m_p_face = NULL;
		}
	}
	else
	{
		// face spk
		// portrait
		const int _VAMPIRE_OFFSET = 6;
		const int _WOMAN_OFFSET = 3;
		const int _OUSTERS_OFFSET = 8;
		int spriteID;
		
		switch(g_eRaceInterface)
		{
		case RACE_SLAYER:
			if (m_player_info.bl_female) // 3 4 5
				spriteID = max(3,min(m_player_info.face_type-M_FACE1+_WOMAN_OFFSET,5));
			else
				spriteID = max(0,min(m_player_info.face_type-M_FACE1,2));
			break;
			
		case RACE_VAMPIRE:
			if(m_player_info.bl_female)
				spriteID = _VAMPIRE_OFFSET+1;
			else
				spriteID = _VAMPIRE_OFFSET;
			break;
			
		case RACE_OUSTERS:
			spriteID = _OUSTERS_OFFSET;
			break;
		}
		
		if(!m_p_face->LoadFromFileData(0, spriteID, SPK_FACE, SPKI_FACE))
		{
			delete m_p_face;
			m_p_face = NULL;
		}
	}		
}


//-----------------------------------------------------------------------------
// C_VS_UI_TRACE::C_VS_UI_TRACE
//
//
//-----------------------------------------------------------------------------
C_VS_UI_TRACE::C_VS_UI_TRACE()
{
	status = false;
	m_pC_trace_spk = NULL;
	m_pC_trace_spk = new C_SPRITE_PACK(SPK_SOUL_CHAIN);
	
	//Set(RESOLUTION_X/2 - 210/2, RESOLUTION_Y/2 - 242/2, m_pC_trace_spk->GetWidth(MAIN_WINDOW), m_pC_trace_spk->GetHeight(MAIN_WINDOW));
	Set(g_pUserInformation->iResolution_x/2 - 210/2, g_pUserInformation->iResolution_y/2 - 242/2, m_pC_trace_spk->GetWidth(MAIN_WINDOW), m_pC_trace_spk->GetHeight(MAIN_WINDOW));
	
	g_RegisterWindow(this);

	AttrTopmost(true);
	AttrKeyboardControl(true);
	
	//공통버튼
	m_pC_button_group = new ButtonGroup(this);
	
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(17, 227, m_pC_trace_spk->GetWidth(TRACE_START), 
		m_pC_trace_spk->GetHeight(TRACE_START), OK_ID, this, TRACE_START));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(128, 227, m_pC_trace_spk->GetWidth(TRACE_CANCEL),
		m_pC_trace_spk->GetHeight(TRACE_CANCEL), CLOSE_ID, this, TRACE_CANCEL));
//	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(180,249, gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION),	
//		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION),HELP_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION));
	//m_lev_name.SetEditorMode(20);
	m_lev_name.SetPosition(x+30,y+30);
	m_lev_name.SetPrintInfo(gpC_base->m_chatting_pi);
	m_lev_name.SetByteLimit(11); //by viva +1
	m_lev_name.SetAbsWidth(90);
	m_lev_name.SetInputStringColor(RGB_WHITE);
	m_lev_name.SetCursorColor(RGB_WHITE);

	Attach(&m_lev_name);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRACE::~C_VS_UI_TRACE
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_TRACE::~C_VS_UI_TRACE()
{
	g_UnregisterWindow(this);
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW, Rect(x, y, w, h));	
	
	if(m_lev_name.IsAcquire())
		m_lev_name.Unacquire();
	gC_vs_ui.AcquireChatting();

	DeleteNew(m_pC_trace_spk);
	DeleteNew(m_pC_button_group);
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRACE::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRACE::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	static char* m_trace_window_button_string[2] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_START_TRACE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CANCEL_TRACE].GetString(),
	};

	switch(p_button->GetID())
	{
	case CLOSE_ID :
		g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,(void *)m_trace_window_button_string[1],0,0);
		break;
	case OK_ID :
		g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,(void *)m_trace_window_button_string[0],0,0);
		break;		
	}
	
}


//-----------------------------------------------------------------------------
// C_VS_UI_TRACE_WINDOW::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRACE::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	switch(p_button->GetID())
	{
	case OK_ID :
		if(status == false)
		{
			if(p_button->GetFocusState())
			{
				if(p_button->GetPressState())
					m_pC_trace_spk->Blt(x+p_button->x,y+p_button->y,p_button->m_image_index+2);
				else
					m_pC_trace_spk->Blt(x+p_button->x,y+p_button->y,p_button->m_image_index+1);
			} else
				m_pC_trace_spk->Blt(x+p_button->x,y+p_button->y,p_button->m_image_index);
		} else
		{
			// 활성화 상태가 아님
			POINT dark = {x+p_button->x,y+p_button->y};
			m_pC_trace_spk->BltDarkness(dark,p_button->m_image_index,1);
		}
		break;
	case CLOSE_ID :
		if(status == false)
		{
			if(p_button->GetFocusState())
			{
				if(p_button->GetPressState())
					m_pC_trace_spk->Blt(x+p_button->x,y+p_button->y,p_button->m_image_index+2);
				else
					m_pC_trace_spk->Blt(x+p_button->x,y+p_button->y,p_button->m_image_index+1);
			} else
				m_pC_trace_spk->Blt(x+p_button->x,y+p_button->y,p_button->m_image_index);
		} else
		{
			POINT dark = {x+p_button->x,y+p_button->y};
			m_pC_trace_spk->BltDarkness(dark,p_button->m_image_index,1);
		}
		break;
	case HELP_ID :
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
			{
				Rect rect(0,1,gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_PUSHED_OFFSET),
					gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_PUSHED_OFFSET)-1);
				gpC_global_resource->m_pC_assemble_box_button_spk->BltClip(p_button->x+x, p_button->y+y, rect,p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_PUSHED_OFFSET);
			}
			else
				gpC_global_resource->m_pC_assemble_box_button_spk->Blt(p_button->x+x, p_button->y+y, p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_HILIGHTED_OFFSET);
		} else
			gpC_global_resource->m_pC_assemble_box_button_spk->Blt(p_button->x+x, p_button->y+y, p_button->m_image_index);
		break;
	}
	
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRACE::WindowEventReceiver(id_t event)
{
}


//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRACE::Run(id_t id)
{
	// 버튼이 비활성상태이면 리턴!
	if(status == true) return;

	switch (id)
	{
	case OK_ID:		
		{
			char *str=NULL;
			g_Convert_DBCS_Ascii2SingleByte(m_lev_name.GetString(),m_lev_name.Size(),str);
			if(str!=NULL&&status==false)
			{
				m_lev_name.Unacquire();
				m_lev_name.SetInputStringColor(RGB_GRAY);
				status = true;
				name = str;
				char temp[100];
				wsprintf(temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_TRACE].GetString(),name.c_str());
				m_status_msg = temp;
				gpC_base->SendMessage(UI_SEND_NAME_FOR_SOUL_CHAIN,0,0,(void*)name.c_str());				
			}
			DeleteNew(str);
		}
		break;
		
	case CLOSE_ID:
		gpC_base->SendMessage(UI_CLOSE_TRACE_WINDOW);
		EMPTY_MOVE;
		break;
	case HELP_ID :
		//gC_vs_ui.RunDescDialog(DID_HELP, (void *)C_VS_UI_DESC_DIALOG::OTHER_INFO);		
		break;	
	}
}

//-----------------------------------------------------------------------------
// MouseControl
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_TRACE::MouseControl(UINT message, int _x, int _y)
{
	if(!m_lev_name.IsAcquire()&&status==false)
		m_lev_name.Acquire();

	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	bool re = m_pC_button_group->MouseControl(message, _x, _y);
	
	switch(message)
	{
	case M_MOVING:
		break;
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (gpC_mouse_pointer->GetPickUpItem()==FALSE && re)
		{
			MoveReady();
			SetOrigin(_x, _y);
		}
		break;
	}
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_TRACE
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRACE::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_CHAR)
	{
		if (isdigit(key) && m_lev_name.Size() == 0)
			return;
		
		char ignore_char[] = {'~', '`', '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '-', '_',
			'+', '=', '\\', '|', '[', ']', '{', '}', ';', ':', '\"', '\'', ',', '<', '.', '>',
			'/', '?', ' '};
		
		for (int i=0; i<sizeof(ignore_char); i++)
			if ((char)key == ignore_char[i])
				return;
	}

	Window::KeyboardControl(message, key, extra);

	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_ESCAPE: 
			Run(CLOSE_ID);
			break;

		case VK_RETURN :
			Run(OK_ID);
			break;
		}
	}
}

//-----------------------------------------------------------------------------
// Show
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_TRACE::Show()
{
//	gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);
	m_pC_trace_spk->Blt(x,y,MAIN_WINDOW);
	m_lev_name.SetPosition(x+93,y+208);
	m_lev_name.Show();
	m_pC_button_group->Show();
	if(!m_status_msg.empty())
	{
		g_PrintColorStr(x+17,y+255,
			m_status_msg.c_str(), gpC_base->m_chatting_pi, RGB_WHITE);
	}
//	m_pC_button_group->ShowDescription();
	SHOW_WINDOW_ATTR;
}

//-----------------------------------------------------------------------------
// Start
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRACE::Start()
{
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW));	
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW);
	if(rect.w != -1)
	{
		x = rect.x;
		y = rect.y;
	}	
	PI_Processor::Start();

	m_pC_button_group->Init();
	AttrTopmost(true);
	gpC_window_manager->AppearWindow(this);	
	
	m_lev_name.Acquire();
	m_lev_name.EraseAll();
}

void	C_VS_UI_TRACE::Finish()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW, Rect(x, y, w, h));
	
	PI_Processor::Finish();	
	gpC_window_manager->DisappearWindow(this);
	m_lev_name.Unacquire();
	gC_vs_ui.AcquireChatting();
}

//-----------------------------------------------------------------------------
// Process
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_TRACE::Process()
{
	m_pC_button_group->Process();	
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_TRACE::IsPixel(int _x, int _y)
{
	//m_pC_monitor_spk->IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y), MONITOR_WINDOW);
	return m_pC_trace_spk->IsPixel(SCR2WIN_X(_x),SCR2WIN_Y(_y),MAIN_WINDOW);	
}

bool	C_VS_UI_TRACE::IsStartTrace()
{
	return status;
}

void	C_VS_UI_TRACE::SetCannotTrace()
{
	status = false;
	char temp[100];
	wsprintf(temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_CANNOT_TRACE].GetString(),name.c_str());
	m_status_msg = temp;
	m_lev_name.Acquire();
	m_lev_name.SetInputStringColor(RGB_WHITE);
}



//-----------------------------------------------------------------------------
// C_VS_UI_XMAS_CARD::C_VS_UI_XMAS_CARD
//
//
//-----------------------------------------------------------------------------
C_VS_UI_XMAS_CARD::C_VS_UI_XMAS_CARD(const MItem *pItem)
{
	if(pItem == NULL)
		return;

	m_pItem = (MItem *)pItem;
	
	status = false;
	m_pC_card_spk = NULL;
	m_pC_card_spk = new C_SPRITE_PACK(SPK_XMAS_CARD);
	

	//Set(RESOLUTION_X/2 - m_pC_card_spk->GetWidth(MAIN_WINDOW)/2, RESOLUTION_Y/2 - m_pC_card_spk->GetHeight(MAIN_WINDOW)/2, m_pC_card_spk->GetWidth(MAIN_WINDOW), m_pC_card_spk->GetHeight(MAIN_WINDOW));
	Set(g_pUserInformation->iResolution_x/2 - m_pC_card_spk->GetWidth(MAIN_WINDOW)/2, g_pUserInformation->iResolution_y/2 - m_pC_card_spk->GetHeight(MAIN_WINDOW)/2, m_pC_card_spk->GetWidth(MAIN_WINDOW), m_pC_card_spk->GetHeight(MAIN_WINDOW));
	
	g_RegisterWindow(this);

	AttrTopmost(true);
	AttrKeyboardControl(true);
	
	//공통버튼
	m_pC_button_group = new ButtonGroup(this);
	
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(130, 146, m_pC_card_spk->GetWidth(BUTTON_OK), 
		m_pC_card_spk->GetHeight(BUTTON_OK), OK_ID, this, BUTTON_OK));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(165, 146, m_pC_card_spk->GetWidth(BUTTON_CANCEL),
		m_pC_card_spk->GetHeight(BUTTON_CANCEL), CANCEL_ID, this, BUTTON_CANCEL));
	
	m_lev_to.SetByteLimit(14);
	m_lev_to.SetPosition(x+85,y+58);
	m_lev_to.SetPrintInfo(gpC_base->m_chatting_pi);
	m_lev_to.SetInputStringColor(RGB(0, 150, 0));
	m_lev_to.SetCursorColor(RGB_BLACK);
//	Attach(&m_lev_to);	

	m_lev_message.SetEditorMode(18, 2);
	m_lev_message.SetPosition(x+55,y+80);
	m_lev_message.SetPrintInfo(gpC_base->m_chatting_pi);
	m_lev_message.SetByteLimit(40);
	m_lev_message.SetAbsWidth(115);
	m_lev_message.SetInputStringColor(RGB(0, 0, 150));
	m_lev_message.SetCursorColor(RGB_BLACK);
//	Attach(&m_lev_message);	

//	m_lev_from.SetByteLimit(14);
//	m_lev_from.SetPosition(x+115,y+123);
//	m_lev_from.SetPrintInfo(gpC_base->m_chatting_pi);
//	m_lev_from.SetCursorColor(RGB_BLACK);
//	m_lev_from.SetInputStringColor(RGB(0, 150, 0));
//	Attach(&m_lev_from);	
}

//-----------------------------------------------------------------------------
// C_VS_UI_XMAS_CARD::~C_VS_UI_XMAS_CARD
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_XMAS_CARD::~C_VS_UI_XMAS_CARD()
{
	g_UnregisterWindow(this);
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW, Rect(x, y, w, h));	
	
	m_lev_to.Unacquire();
	m_lev_message.Unacquire();
//	m_lev_from.Unacquire();
	gC_vs_ui.AcquireChatting();

	DeleteNew(m_pC_card_spk);
	DeleteNew(m_pC_button_group);
}

//-----------------------------------------------------------------------------
// C_VS_UI_XMAS_CARD::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_XMAS_CARD::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	static char* m_trace_window_button_string[2] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TREE_OK].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_TREE_CANCEL].GetString(),
	};

	switch(p_button->GetID())
	{
	case CANCEL_ID :
		g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,(void *)m_trace_window_button_string[1],0,0);
		break;
	case OK_ID :
		g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,(void *)m_trace_window_button_string[0],0,0);
		break;		
	}
	
}


//-----------------------------------------------------------------------------
// C_VS_UI_XMAS_CARD_WINDOW::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_XMAS_CARD::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(p_button->GetFocusState())
	{
		if(p_button->GetPressState())
			m_pC_card_spk->Blt(x+p_button->x,y+p_button->y,p_button->m_image_index+2);
		else
			m_pC_card_spk->Blt(x+p_button->x,y+p_button->y,p_button->m_image_index+1);
	} else
		m_pC_card_spk->Blt(x+p_button->x,y+p_button->y,p_button->m_image_index);
	
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_XMAS_CARD::WindowEventReceiver(id_t event)
{
}


//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_XMAS_CARD::Run(id_t id)
{
	// 버튼이 비활성상태이면 리턴!
	if(status == true) return;

	switch (id)
	{
	case OK_ID:		
		{
			char *psz_to = NULL, *psz_msg = NULL, *psz_from = NULL;

			g_Convert_DBCS_Ascii2SingleByte(m_lev_to.GetString(), m_lev_to.Size(), psz_to);
			g_Convert_DBCS_Ascii2SingleByte(m_lev_message.GetString(), m_lev_message.Size(), psz_msg);
		//	g_Convert_DBCS_Ascii2SingleByte(m_lev_from.GetString(), m_lev_from.Size(), psz_from);

			psz_from = (char*)g_char_slot_ingame.sz_name.c_str();
			if(psz_to != NULL && psz_msg != NULL && psz_from != NULL)
			{
				m_szTreeMessage = "";
				
				m_szTreeMessage += psz_to;
				m_szTreeMessage += "%";

				char *find;
				do{
					find = strrchr(psz_msg, '\n');
					if(find != NULL && *(find+1) == '\0')
						*find = '\0';
				}while(find != NULL && *find == '\0');

				m_szTreeMessage += psz_msg;

				m_szTreeMessage += "%";
				m_szTreeMessage += psz_from;
				
				gpC_base->SendMessage(UI_USE_XMAS_TREE, (int)m_pItem, 0, (void*)m_szTreeMessage.c_str());

				DeleteNew(psz_to);
				DeleteNew(psz_msg);
				//DeleteNew(psz_from);
			}
			else
			{
				// 빈항목이 있습니다.
				gpC_base->SendMessage(UI_USE_XMAS_TREE, (int)m_pItem, 0, NULL);
			}
		}
		break;
		
	case CANCEL_ID:
		gpC_base->SendMessage(UI_CLOSE_XMAS_CARD_WINDOW);
		EMPTY_MOVE;
		break;

	}
}

//-----------------------------------------------------------------------------
// MouseControl
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_XMAS_CARD::MouseControl(UINT message, int _x, int _y)
{
//	if(!m_lev_message.IsAcquire())
//		m_lev_message.Acquire();

	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	bool re = m_pC_button_group->MouseControl(message, _x, _y);
	
	switch(message)
	{
	case M_MOVING:
		break;
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if(_x >= 57 && _x <= 172 && _y >= 58 && _y <= 70)
		{
			m_lev_message.Unacquire();
		//	m_lev_from.Unacquire();
			m_lev_to.Acquire();
		}
		else if(_x >= 35 && _x <= 200 && _y >= 73 && _y <= 120)
		{
			m_lev_to.Unacquire();
			//m_lev_from.Unacquire();
			m_lev_message.Acquire();
		}
//		else if(_x >= 77 && _x <= 200 && _y >= 121 && _y <= 140)
//		{
//			m_lev_to.Unacquire();
//			m_lev_message.Unacquire();
//			m_lev_from.Acquire();
//		}
		else if (gpC_mouse_pointer->GetPickUpItem()==FALSE && re)
		{
			MoveReady();
			SetOrigin(_x, _y);
		}
		break;
	}
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_XMAS_CARD
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_XMAS_CARD::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_CHAR)
	{
//		if (isdigit(key) && m_lev_name.Size() == 0)
//			return;
		
			char ignore_char[] = {'%', '\\', '\"', '\''};
//			char ignore_char[] = {'%'};//'~', '`', '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '-', '_',
//			'+', '=', '\\', '|', '[', ']', '{', '}', ';', ':', '\"', '\'', ',', '<', '.', '>',
//			'/', '?', ' '};
//		
//		if(m_lev_message.GetLineCount() > 2)
//			return;
		
		for (int i=0; i<sizeof(ignore_char); i++)
			if ((char)key == ignore_char[i])
				return;
	}

	Window::KeyboardControl(message, key, extra);

	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_ESCAPE:
			Run(CANCEL_ID);
			break;

		case VK_RETURN :
			if(m_lev_to.IsAcquire())
			{
				m_lev_to.Unacquire();
				m_lev_message.Acquire();
			}
			else if(m_lev_message.IsAcquire() && m_lev_message.GetLineCount() > 1)
			{
				m_lev_message.Unacquire();
				m_lev_to.Acquire();
//				m_lev_message.EraseCharacterFrontCursor();
			}
			break;

		case VK_BACK:
			if(m_lev_to.IsAcquire() && m_lev_to.Size() == 0)
			{
				m_lev_to.Unacquire();
				m_lev_message.Acquire();
			}
			else if(m_lev_message.IsAcquire() && m_lev_message.Size() == 0)
			{
				m_lev_message.Unacquire();
				m_lev_to.Acquire();
			}
			break;

		case VK_UP:
//			if(m_lev_from.IsAcquire())
//			{
//				m_lev_from.Unacquire();
//				m_lev_message.Acquire();
//				m_lev_message.EndCursor();
//			}
//			else 
			if(m_lev_message.IsAcquire())
			{
				m_lev_message.Unacquire();
				m_lev_to.Acquire();
			}
			break;

		case VK_DOWN:
		case VK_TAB:
			if(m_lev_to.IsAcquire())
			{
				m_lev_to.Unacquire();
				m_lev_message.Acquire();
				m_lev_message.HomeCursor();
			}
			else if(m_lev_message.IsAcquire())
			{
				m_lev_message.Unacquire();
				m_lev_to.Acquire();
			}
//			else if(m_lev_from.IsAcquire())
//			{
//				m_lev_from.Unacquire();
//				m_lev_to.Acquire();
//			}
			break;
		}
	}
}

//-----------------------------------------------------------------------------
// Show
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_XMAS_CARD::Show()
{
//	gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);
	m_pC_card_spk->Blt(x,y,MAIN_WINDOW);

	g_FL2_GetDC();

	g_PrintColorStr(x+57, y+58, "Dear.", gpC_base->m_chatting_pi, RGB(0, 150, 0));
	g_PrintColorStr(x+80, y+123, "From.", gpC_base->m_chatting_pi, RGB(0, 150, 0));

	g_FL2_ReleaseDC();

	gpC_base->m_p_DDSurface_back->HLine(x+57, y+58+13, 115, CDirectDraw::Color(100>>3, 200>>3, 100>>3));
	gpC_base->m_p_DDSurface_back->HLine(x+80, y+123+13, 115, CDirectDraw::Color(100>>3, 200>>3, 100>>3));

	gpC_base->m_p_DDSurface_back->HLine(x+50, y+80+13, 121, CDirectDraw::Color(100>>3, 100>>3, 200>>3));
	gpC_base->m_p_DDSurface_back->HLine(x+50, y+80+13+18, 121, CDirectDraw::Color(100>>3, 100>>3, 200>>3));

	m_lev_to.SetPosition(x+85,y+58);
	m_lev_to.Show();
	m_lev_message.SetPosition(x+50,y+80);
	m_lev_message.Show();
//	m_lev_from.SetPosition(x+110,y+123);
//	m_lev_from.Show();

	g_PrintColorStr(x+110, y+123, g_char_slot_ingame.sz_name.c_str(), gpC_base->m_chatting_pi, RGB(0, 150, 0));
	

	m_pC_button_group->Show();

	m_pC_button_group->ShowDescription();
	SHOW_WINDOW_ATTR;
}

//-----------------------------------------------------------------------------
// Start
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_XMAS_CARD::Start()
{
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW));	
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW);
	if(rect.w != -1)
	{
		x = rect.x;
		y = rect.y;
	}	
	PI_Processor::Start();

	m_pC_button_group->Init();
	AttrTopmost(true);
	gpC_window_manager->AppearWindow(this);	
	
	m_lev_to.Acquire();
	m_lev_to.EraseAll();
	m_lev_message.EraseAll();
//	m_lev_from.EraseAll();
}

void	C_VS_UI_XMAS_CARD::Finish()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::TRACE_WINDOW, Rect(x, y, w, h));
	
	PI_Processor::Finish();	
	gpC_window_manager->DisappearWindow(this);
 	m_lev_to.Unacquire();
 	m_lev_message.Unacquire();
 //	m_lev_from.Unacquire();
	gC_vs_ui.AcquireChatting();
}

//-----------------------------------------------------------------------------
// Process
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_XMAS_CARD::Process()
{
	m_pC_button_group->Process();	
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_XMAS_CARD::IsPixel(int _x, int _y)
{
	//m_pC_monitor_spk->IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y), MONITOR_WINDOW);
	return m_pC_card_spk->IsPixel(SCR2WIN_X(_x),SCR2WIN_Y(_y),MAIN_WINDOW)
		|| m_pC_card_spk->IsPixel(SCR2WIN_X(_x)-130, SCR2WIN_Y(_y)-146, BUTTON_OK)
		|| m_pC_card_spk->IsPixel(SCR2WIN_X(_x)-165, SCR2WIN_Y(_y)-146, BUTTON_CANCEL);	
}

//------------------------------------------------------------------------------
// C_VS_UI_BRING_FEE
//
// 성지에서 세금을 가져온다.
//------------------------------------------------------------------------------
C_VS_UI_BRING_FEE::C_VS_UI_BRING_FEE(UINT totalfee, UINT bringfee)
{	
	SetTotalFee(totalfee);
	SetBringFee(bringfee);
	
	
	//Set(RESOLUTION_X/2 - 340/2, RESOLUTION_Y/2 - 200/2, 340, 200);
	Set(g_pUserInformation->iResolution_x/2 - 340/2, g_pUserInformation->iResolution_y/2 - 200/2, 340, 200);

	int ok_x = 160,ok_y = h-44;
	int cancel_x=236,cancel_y=h-44;
	m_money_x=135;
	m_money_y=h-75;


	m_pC_button_group = new ButtonGroup(this);
	

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(ok_x,ok_y,
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_OK),
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_OK),
		OK_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_OK));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(cancel_x,cancel_y,
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_CANCEL),
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_CANCEL),
		CANCEL_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_CANCEL));
	
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(m_money_x, m_money_y, 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_MONEY), 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_MONEY), 
		MONEY_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_MONEY));

	g_RegisterWindow(this);
	AttrTopmost(true);

	m_pC_dialog_bring_fee = NULL;
}

C_VS_UI_BRING_FEE::~C_VS_UI_BRING_FEE()
{
	DeleteNew(m_pC_dialog_bring_fee);
	DeleteNew(m_pC_button_group);
}

void	C_VS_UI_BRING_FEE::Start()
{
	PI_Processor::Start();
	gpC_window_manager->AppearWindow(this);
	m_pC_button_group->Init();
	AttrTopmost(true);
}

void	C_VS_UI_BRING_FEE::Finish()
{
	PI_Processor::Finish();
	gpC_window_manager->DisappearWindow(this);
}

void	C_VS_UI_BRING_FEE::Show()
{
	int total_fee_x = x+35,total_fee_y = y+m_money_y+3-30;
	int bring_fee_x = x+35,bring_fee_y = y+m_money_y+3;
	
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		gpC_global_resource->DrawDialogLocked(x,y,w,h,false);
		gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(total_fee_x+130,total_fee_y-3,C_GLOBAL_RESOURCE::AB_MONEY_BAR);
		gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(total_fee_x+130,total_fee_y-3 + 30,C_GLOBAL_RESOURCE::AB_MONEY_BAR);
	
		m_pC_button_group->Show();	
		
		gpC_base->m_p_DDSurface_back->Unlock();
	}
/*	RECT rect = {total_fee_x+100,total_fee_y - 4,total_fee_x+160+100,total_fee_y+20 - 4};		
	gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
	gpC_global_resource->DrawOutBox(total_fee_x+100 - 1,total_fee_y -4 - 1,160 + 2,20 + 2);

	rect.top += 30;
	rect.bottom += 30;
	gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
	gpC_global_resource->DrawOutBox(total_fee_x+100 - 1,rect.top ,160 + 2,20 + 2);
*/	
	if(g_FL2_GetDC())
	{		
		// show money
		char money_buf[100];
		wsprintf(money_buf, "%d", m_TotalFee);
		std::string sstr = money_buf;
		
		for(int i = 3; i <= 13; i += 4)
			if(sstr.size() > i)
				sstr.insert(sstr.size()-i, ",");
			
		sprintf(money_buf, "$%s", sstr.c_str());
		//g_Print(x+m_money_button_offset_x+30, y+m_money_button_offset_y+4, money_buf, &gpC_base->m_money_pi);

		int len = max(0,160 - g_GetStringWidth(money_buf,gpC_base->m_money_pi.hfont));

		g_PrintColorStrShadow(total_fee_x,total_fee_y,(*g_pGameStringTable)[UI_STRING_MESSAGE_HOLY_LAND_TOTAL_FEE].GetString(),
			gpC_base->m_dialog_msg_pi,RGB(255,255,255),RGB(20,20,20));

		g_Print(total_fee_x+88 + len,total_fee_y,money_buf,&gpC_base->m_money_pi);

		g_PrintColorStrShadow(bring_fee_x,bring_fee_y,(*g_pGameStringTable)[UI_STRING_MESSAGE_HOLY_LAND_CAN_BRING_FEE].GetString(),
			gpC_base->m_dialog_msg_pi,RGB(255,255,255),RGB(20,20,20));

		money_buf[100];
		wsprintf(money_buf, "%d", m_BringFee);
		sstr = money_buf;
		
		for(i = 3; i <= 13; i += 4)
			if(sstr.size() > i)
				sstr.insert(sstr.size()-i, ",");
			
		sprintf(money_buf, "$%s", sstr.c_str());

		len = max(0,160 - g_GetStringWidth(money_buf,gpC_base->m_money_pi.hfont));

		g_Print(bring_fee_x+88 + len,bring_fee_y,money_buf,&gpC_base->m_money_pi);

		std::string str;

		str = (*g_pGameStringTable)[UI_STRING_MESSAGE_BRING_FEE_MSG].GetString();

		int next=0;
		char sz_string[512];

		int print_x=30+x,vx;
		int py = 40+y;
		const int print_gap = 20;
		const int char_width = g_GetStringWidth("a", gpC_base->m_chatting_pi.hfont);

		vx = print_x;

		while(str.size() > next)
		{
			strcpy(sz_string, str.c_str()+next);
			
			char *sz_string2 = sz_string;
			
			while(*sz_string2 == ' ')		// 앞의 공백제거
			{
				sz_string2++;
				next++;
			}
			
			int cut_pos = (x+w-30 -vx)/char_width;
			
			if(!g_PossibleStringCut(sz_string2, cut_pos))
				cut_pos--;
			sz_string2[cut_pos] = NULL;
			
			char *return_char = NULL;
			if((return_char = strchr(sz_string2, '\n')) != NULL)	// return 처리
			{
				cut_pos = return_char - sz_string2+1;
				sz_string2[cut_pos-1] = NULL;
			}
			
			g_PrintColorStr(vx, py, sz_string2, gpC_base->m_chatting_pi, RGB_WHITE);
			next += cut_pos;
			vx = print_x;
			py += print_gap;
		}

		g_FL2_ReleaseDC();
	}

	m_pC_button_group->ShowDescription();
}

bool	C_VS_UI_BRING_FEE::MouseControl(UINT message, int _x, int _y)
{
	/*char *m_bring_fee_msg[2] = {
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HOLY_LAND_TOTAL_FEE_DESC].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HOLY_LAND_CLICK_INPUT_FEE].GetString(),
	};*/
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	bool re = m_pC_button_group->MouseControl(message, _x, _y);

	return true;
}

void	C_VS_UI_BRING_FEE::KeyboardControl(UINT message, UINT key, long extra)	

{
	Window::KeyboardControl(message, key, extra);
	
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_ESCAPE :
			gpC_base->SendMessage(UI_CLOSE_BRING_FEE_WINDOW);
			break;		
		}
	}
}

bool	C_VS_UI_BRING_FEE::IsPixel(int _x,int _y)
{
	return IsInRect(_x, _y);
}

void	C_VS_UI_BRING_FEE::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(p_button->GetFocusState())
	{
		if(p_button->GetPressState())
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_PUSHED_OFFSET);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_HILIGHTED_OFFSET);
	} else
		gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index);
}

void	C_VS_UI_BRING_FEE::ShowButtonDescription(C_VS_UI_EVENT_BUTTON *p_button)
{
	char* m_bring_fee_msg[3] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HOLY_LAND_OK].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CANCEL].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_HOLY_LAND_CLICK_INPUT_FEE].GetString(),
	};
	
	switch(p_button->GetID())
	{
	case OK_ID :
		g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,
			(void *)m_bring_fee_msg[0],0,0);		
		break;
	case CANCEL_ID :
		g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,
			(void *)m_bring_fee_msg[1],0,0);		
		break;
	case MONEY_ID :
		g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,
			(void *)m_bring_fee_msg[2],0,0);		
		break;
	}
}

void	C_VS_UI_BRING_FEE::WindowEventReceiver(id_t event)
{
}

void	C_VS_UI_BRING_FEE::Run(id_t id)
{
	switch(id)
	{
	case OK_ID :
		if(m_BringFee <= m_TotalFee && m_BringFee >0)
			gpC_base->SendMessage(UI_SEND_BRING_FEE,(int)m_BringFee);
		break;
	case CANCEL_ID :
		gpC_base->SendMessage(UI_CLOSE_BRING_FEE_WINDOW);
		break;		
	case MONEY_ID :
		m_pC_dialog_bring_fee = new C_VS_UI_MONEY_DIALOG(x+m_money_x, 
			y+m_money_y+gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_CHANGE_MONEY), 
			2, 0, Execf_BringFee, DIALOG_OK|DIALOG_CANCEL, 10, 
			C_VS_UI_MONEY_DIALOG::MONEY_BRING_FEE);																						
		m_pC_dialog_bring_fee->Start();
		break;
	}
}

void	C_VS_UI_BRING_FEE::Process()
{
	m_pC_button_group->Process();
}

C_VS_UI_WAR_LIST::C_VS_UI_WAR_LIST()
{
	g_RegisterWindow(this);
	
	AttrTopmost(true);
	AttrKeyboardControl(true);

	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		m_guild_spk.Open(SPK_SLAYER_TEAM);
		break;

	case RACE_VAMPIRE:
		m_guild_spk.Open(SPK_VAMPIRE_TEAM);
		break;

	case RACE_OUSTERS:
		m_guild_spk.Open(SPK_OUSTERS_TEAM);
		break;		
	}	
	
	//Set(RESOLUTION_X/2-m_guild_spk.GetWidth(0)/2, RESOLUTION_Y/2 - m_guild_spk.GetHeight(0)/2, m_guild_spk.GetWidth(0), m_guild_spk.GetHeight(0));
	Set(g_pUserInformation->iResolution_x/2-m_guild_spk.GetWidth(0)/2, g_pUserInformation->iResolution_y/2 - m_guild_spk.GetHeight(0)/2, m_guild_spk.GetWidth(0), m_guild_spk.GetHeight(0));
	
	m_vampire_point.x= 0;
	m_vampire_point.y= 0;

	// set button
	m_pC_button_group = new ButtonGroup(this);
	
	
	int help_x = 353, x_x = 367, button_y = 2;
	
	if(g_eRaceInterface != RACE_SLAYER)
	{
		button_y = 20;
		help_x+=20; x_x+=20;
		m_vampire_point.x = 17;
		m_vampire_point.y = 6;
		if(g_eRaceInterface == RACE_OUSTERS)
			m_vampire_point.x -= 3;
	}	

	m_scroll = 0;
	m_bl_scrolling = false;

	int scroll_x,scroll_up_y,scroll_down_y;

	scroll_x= 20+240+93+m_vampire_point.x+7;
	scroll_up_y = 94+m_vampire_point.y+2;
	scroll_down_y = 94+m_vampire_point.y + 218;
	
	
	//help, x버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + help_x, y + button_y, m_guild_spk.GetWidth(HELP_BUTTON), 
		m_guild_spk.GetHeight(HELP_BUTTON), HELP_ID, this, HELP_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + x_x, y + button_y, m_guild_spk.GetWidth(X_BUTTON), m_guild_spk.GetHeight(X_BUTTON), X_ID, this, X_BUTTON));
			
	//CLOSE버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+w-14, y+h-49, m_guild_spk.GetWidth(CLOSE_BUTTON), m_guild_spk.GetHeight(CLOSE_BUTTON), CLOSE_ID, this, CLOSE_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x+129+m_vampire_point.x,y+49+m_vampire_point.y,m_guild_spk.GetWidth(TITLE_WAR_LIST),m_guild_spk.GetHeight(TITLE_WAR_LIST),
		WAR_LIST_ID, this, TITLE_WAR_LIST));

	//scroll up, down 버튼
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + scroll_x, 23+ y + scroll_up_y, m_guild_spk.GetWidth(SCROLL_UP_BUTTON), m_guild_spk.GetHeight(SCROLL_UP_BUTTON), SCROLL_UP_ID, this, SCROLL_UP_BUTTON));
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(x + scroll_x, 23+ y + scroll_down_y, m_guild_spk.GetWidth(SCROLL_DOWN_BUTTON), m_guild_spk.GetHeight(SCROLL_DOWN_BUTTON), SCROLL_DOWN_ID, this, SCROLL_DOWN_BUTTON));
}

C_VS_UI_WAR_LIST::~C_VS_UI_WAR_LIST()
{
	g_UnregisterWindow(this);
	
	DeleteNew( m_pC_button_group );
	
}

//-----------------------------------------------------------------------------
// C_VS_UI_WAR_LIST::Process
//
//-----------------------------------------------------------------------------
void	C_VS_UI_WAR_LIST::Process()
{
	m_pC_button_group->Process();
}

//-----------------------------------------------------------------------------
// C_VS_UI_WAR_LIST::UnacquireMouseFocus
//
//-----------------------------------------------------------------------------
void	C_VS_UI_WAR_LIST::UnacquireMouseFocus()
{
	m_pC_button_group->UnacquireMouseFocus();
}

//-----------------------------------------------------------------------------
// C_VS_UI_WAR_LIST::Start
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_WAR_LIST::Start()
{
	PI_Processor::Start();
	m_pC_button_group->Init();
	
	AttrTopmost(true);
	gpC_window_manager->AppearWindow(this);	
}

//-----------------------------------------------------------------------------
// C_VS_UI_WAR_LIST::Finish
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_WAR_LIST::Finish()
{
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);
}

//-----------------------------------------------------------------------------
// C_VS_UI_WAR_LIST::Show 
//
//
//-----------------------------------------------------------------------------
void C_VS_UI_WAR_LIST::Show()
{
	
	const int print_list = 10;
	int tab_y[3];
	int tab_x[3];
	
	int temp_x = 8;

	if(m_v_war_list.size() > 10)
		temp_x = 0;
	
	tab_x[0] = 20 + m_vampire_point.x + temp_x;
	tab_x[1] = tab_x[0]+220;
	tab_x[2] = tab_x[1]+113;

	int tab_x_len = tab_x[2] - tab_x[0]+1;

	tab_y[0] = 94 + m_vampire_point.y;
	tab_y[1] = tab_y[0] + 23;
	tab_y[2] = tab_y[1] + 207+23;
	// Lock 부분 모으기~

	int scroll_tag_x = x+tab_x[2]+5, scroll_tag_y = y+tab_y[0]+14, scroll_tag_height = 198;
	int gap;



	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_guild_spk.BltLocked(x, y);
		m_guild_spk.BltLocked(x+tab_x[0], y+tab_y[0]+1,BAR_DARKEN);
		m_guild_spk.BltLocked(x+tab_x[0]+(tab_x[1] - tab_x[0])/2-m_guild_spk.GetWidth(INDEX_WAR_CHALLENGER)/2,y+tab_y[0]+6,INDEX_WAR_CHALLENGER);
		m_guild_spk.BltLocked(x+tab_x[1]+(tab_x[2] - tab_x[1])/2-m_guild_spk.GetWidth(INDEX_WAR_DATE)/2,y+tab_y[0]+6,INDEX_WAR_DATE);		
				
		if(m_v_war_list.size()>print_list)
		{			
			m_guild_spk.BltLocked(x+tab_x[2] + 5, y+tab_y[0] + 23 , SCROLL_BAR);
			m_guild_spk.BltLocked(scroll_tag_x+2,scroll_tag_y + 23 +
				max(0, min(scroll_tag_height,m_scroll)),SCROLL_TAG);
		}
		
		m_pC_button_group->Show();
		gpC_base->m_p_DDSurface_back->Unlock();
	}
	
	if(!m_v_war_list.empty())
	{
		int list = (m_v_war_list.size()-print_list) * m_scroll / scroll_tag_height;
		
		gap = 0;
		std::vector<_WarList>::const_iterator		itr;

		itr = m_v_war_list.begin();
		
		while(itr != m_v_war_list.end() && list > -(print_list))
		{
			list--;
			
			if(list >= 0) {
				itr ++;
				continue;
			}
			if(itr->warType == 0) // 동족간				
			{
				// 길드 마크 출력
				CSprite *p_guild_mark;
				p_guild_mark=g_pGuildMarkManager->GetGuildMarkSmall(itr->challengerGuildID);
				if(p_guild_mark==NULL)
				{
					g_pGuildMarkManager->LoadGuildMark(itr->challengerGuildID);
					p_guild_mark = g_pGuildMarkManager->GetGuildMarkSmall(itr->challengerGuildID);
				}
				POINT guild_point = { x+tab_x[0]+2, y+tab_y[1]+gap+2 };
				if(p_guild_mark != NULL)	// 악!! CSprite직접 쓸때는 Lock할것!! by 쑥갓
				{
					if(gpC_base->m_p_DDSurface_back->Lock())
					{
						gpC_base->m_p_DDSurface_back->BltSprite(&guild_point, p_guild_mark);
						gpC_base->m_p_DDSurface_back->Unlock();
					}
				}
				else
				{
					RECT rt={guild_point.x,guild_point.y,guild_point.x+20,guild_point.y+20};
					DrawAlphaBox(&rt, 255, 255, 255, 15);
				}

				g_FL2_GetDC();
				g_PrintColorStr(x+ tab_x[0] + 21 + (tab_x[1] - 21 - tab_x[0])/2 - g_GetStringWidth(itr->challengerGuildName.c_str())/2, y+tab_y[1] + gap + 6, itr->challengerGuildName.c_str(),gpC_base->m_chatting_pi,RGB_BLACK);
				char date[100];
				sprintf(date,"%d/%d/%d %d:00",itr->year,itr->month,itr->day,itr->hour);
				g_PrintColorStr(x+ tab_x[1] + (tab_x[2] - tab_x[1])/2 - g_GetStringWidth(date)/2, y+tab_y[1] + gap + 6, date,gpC_base->m_chatting_pi,RGB_BLACK);				
				g_FL2_ReleaseDC();
			} else
			{
				// 종족간 BAR_HILIGHTED		

				std::string challenger = (*g_pGameStringTable)[UI_STRING_MESSAGE_RACE_WAR].GetString();
				m_guild_spk.BltAlpha(x + tab_x[0] , y + tab_y[1] + gap + 1, BAR_HILIGHTED,12);

				g_FL2_GetDC();
				g_PrintColorStr(x+ tab_x[0] + 21 + (tab_x[1] - 21 - tab_x[0])/2 - g_GetStringWidth(challenger.c_str())/2, y+tab_y[1] + gap + 6, challenger.c_str(),gpC_base->m_chatting_pi,RGB_BLACK);
				char date[100];
				sprintf(date,"%d/%d/%d %d:00",itr->year,itr->month,itr->day,itr->hour);
				g_PrintColorStr(x+ tab_x[1] + (tab_x[2] - tab_x[1])/2 - g_GetStringWidth(date)/2, y+tab_y[1] + gap + 6, date,gpC_base->m_chatting_pi,RGB_BLACK);
				g_FL2_ReleaseDC();				
			}			
			gap+=23;
			itr++;			
		}
	}

	// 
	gpC_base->m_p_DDSurface_back->HLine(x+tab_x[0], y+tab_y[0],tab_x_len,0);
	gpC_base->m_p_DDSurface_back->HLine(x+tab_x[0], y+tab_y[1],tab_x_len,0);
	gpC_base->m_p_DDSurface_back->HLine(x+tab_x[0], y+tab_y[2],tab_x_len,0);

	gpC_base->m_p_DDSurface_back->VLine(x+tab_x[0], y+tab_y[0],tab_y[2] - tab_y[0],0);
	gpC_base->m_p_DDSurface_back->VLine(x+tab_x[1], y+tab_y[0],tab_y[2] - tab_y[0],0);
	gpC_base->m_p_DDSurface_back->VLine(x+tab_x[2], y+tab_y[0],tab_y[2] - tab_y[0],0);
	gpC_base->m_p_DDSurface_back->VLine(x+tab_x[0] + 23, y+tab_y[0] + tab_y[1] - tab_y[0],tab_y[2] - tab_y[0] - (tab_y[1] - tab_y[0]),0);

	gap=23;
	for(int i=0;i<print_list - 1;i++)
	{
		gpC_base->m_p_DDSurface_back->HLine(x+tab_x[0], y+tab_y[1]+gap,tab_x_len,0);		

		gap+=23;
	}

	m_pC_button_group->ShowDescription();
	SHOW_WINDOW_ATTR;
}

//-----------------------------------------------------------------------------
// C_VS_UI_WAR_LIST::ShowButtonDescription
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_WAR_LIST::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	//	g_descriptor_manager.Set(DID_INFO, p_button->x, p_button->y, (void *)m_help_string[p_button->GetID()],0,0);
}

//-----------------------------------------------------------------------------
// C_VS_UI_WAR_LIST::ShowButtonWidget
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_WAR_LIST::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
//	assert(p_button); // <- warning C4305 때문에 
	if(p_button<=0)
	{
		MessageBox(NULL, "Error-String-2008.08.22-3:19", "BUTTON ERROR", MB_OK);
	}

	switch(p_button->GetID())
	{		
	case SCROLL_DOWN_ID :
	case SCROLL_UP_ID :		
		if(m_v_war_list.size() > 10)
		{
			SPRITE_ID SpriteID;

			if(p_button->GetPressState())
				SpriteID = static_cast<SPRITE_ID>(p_button->m_image_index + 1);
			else
				SpriteID = static_cast<SPRITE_ID>(p_button->m_image_index);

			m_guild_spk.BltLocked(p_button->x, p_button->y, SpriteID);
		}
		break;
	case HELP_ID :
	case X_ID :
		{
			SPRITE_ID SpriteID;

			if(p_button->GetPressState())
				SpriteID = static_cast<SPRITE_ID>(p_button->m_image_index + 1);
			else
				SpriteID = static_cast<SPRITE_ID>(p_button->m_image_index);

			m_guild_spk.BltLocked(p_button->x, p_button->y, SpriteID);
		}
		break;
	case WAR_LIST_ID :
		{
			SPRITE_ID SpriteID = static_cast<SPRITE_ID>(p_button->m_image_index + 1);
			m_guild_spk.BltLocked(p_button->x, p_button->y, SpriteID);
		}
		break;
	default :
		{
			SPRITE_ID	SpriteID;
			CPoint		ptButton(p_button->x, p_button->y);

			if(p_button->GetFocusState())
			{
				SpriteID = static_cast<SPRITE_ID>(p_button->m_image_index + 1);
				if(p_button->GetPressState()) ++ptButton.y;
			} else
				SpriteID = static_cast<SPRITE_ID>(p_button->m_image_index);

			m_guild_spk.BltLocked(ptButton.x, ptButton.y, SpriteID);
		}
		break;
	}
}

//-----------------------------------------------------------------------------
//
// keyboard
//
//-----------------------------------------------------------------------------
void	C_VS_UI_WAR_LIST::KeyboardControl(UINT message, UINT key, long extra)
{	
	Window::KeyboardControl(message, key, extra);
	
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_ESCAPE: 
			gpC_base->SendMessage(UI_CLOSE_WAR_LIST_WINDOW);
			break;
		}
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_WAR_LIST::MouseControl
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_WAR_LIST::MouseControl(UINT message, int _x, int _y)
{
	m_pC_button_group->MouseControl(message, _x, _y);

	const int print_list = 9;
	int tab_y[3];
	int tab_x[3];
	
	tab_x[0] = 20 + m_vampire_point.x;
	tab_x[1] = tab_x[0]+240;
	tab_x[2] = tab_x[1]+93;

	int tab_x_len = tab_x[2] - tab_x[0]+1;
	

	tab_y[0] = 94 + m_vampire_point.y;
	tab_y[1] = tab_y[0] + 23;
	tab_y[2] = tab_y[1] + 207;
	// Lock 부분 모으기~

			
	int scroll_tag_x = x+tab_x[2]+5, scroll_tag_y = y+tab_y[0]+14+23, scroll_tag_height = 198;


	switch(message)
	{
	case M_MOVING :
		if(m_bl_scrolling == true)
		{
			int pos = _y - scroll_tag_y;
			
			//m_scroll = (m_v_war_list.size()-9) * pos / scroll_tag_height;
			m_scroll = max(0,min(scroll_tag_height, pos ));
		}		
		break;
	case M_LEFTBUTTON_UP :
		m_bl_scrolling = false;
		break;
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if( _x > scroll_tag_x && _x < scroll_tag_x+m_guild_spk.GetWidth(SCROLL_BAR) &&
			_y > scroll_tag_y && _y < scroll_tag_y+scroll_tag_height && m_v_war_list.size() > 10)
		{
			int pos = _y - scroll_tag_y;
			
			//m_scroll = (m_v_war_list.size()-9) * pos / scroll_tag_height;
			m_scroll = max(0,min(scroll_tag_height, pos ));
			m_bl_scrolling = true;
		}
		break;
	case M_WHEEL_UP:
		Run(SCROLL_UP_ID);
		break;
		
	case M_WHEEL_DOWN:
		Run(SCROLL_DOWN_ID);
		break;
	}

	
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_WAR_LIST::IsPixel
//
//
//-----------------------------------------------------------------------------
bool	C_VS_UI_WAR_LIST::IsPixel(int _x, int _y)
{
	bool re = m_guild_spk.IsPixel(SCR2WIN_X(_x), SCR2WIN_Y(_y));
	if(re == false)
	{
		if(m_guild_spk.IsPixel(_x - (x+w-14), _y - (y+h-49), CLOSE_BUTTON))
			re = true;
	}	
	return re;
}


void	C_VS_UI_WAR_LIST::AddWarList(const WarInfo	&war_info)
{
	if(0 == war_info.warType) // 길드전
	{
		if(war_info.reinforceGuildID != 0)
		{
			_WarList wi;
			wi.warType	= war_info.warType;
			wi.year		= war_info.year;
			wi.month	= war_info.month;
			wi.day		= war_info.day;
			wi.challengerGuildID = war_info.reinforceGuildID;
			wi.challengerGuildName = war_info.reinforceGuildName;
			wi.challengerGuildName += (*g_pGameStringTable)[UI_STRING_MESSAGE_SIEGE_DEFENSE].GetString();
			wi.hour		= war_info.hour;
			
			m_v_war_list.push_back(wi);
		}
		for(int i = 0; i<5; i++)
		{
			if(0 != war_info.challengerGuildID[i])
			{
				_WarList wi;
				wi.warType	= war_info.warType;
				wi.year		= war_info.year;
				wi.month	= war_info.month;
				wi.day		= war_info.day;
				wi.challengerGuildID = war_info.challengerGuildID[i];
				wi.challengerGuildName = war_info.challengerGuildName[i];
				wi.challengerGuildName += (*g_pGameStringTable)[UI_STRING_MESSAGE_SIEGE_ATTACK].GetString();
				wi.hour		= war_info.hour;
				m_v_war_list.push_back(wi);
			}
		}
	}
	else
	{
		_WarList wi;
		wi.warType	= war_info.warType;
		wi.year		= war_info.year;
		wi.month	= war_info.month;
		wi.day		= war_info.day;
		wi.hour		= war_info.hour;
		
		m_v_war_list.push_back(wi);
	}
//	m_v_war_list.push_back(war_info);
}

void	C_VS_UI_WAR_LIST::ClearWarList()
{
	m_v_war_list.clear();
}

void	C_VS_UI_WAR_LIST::Run(id_t id)
{
	int scroll_tag_height = 198;

	switch(id)
	{
	case SCROLL_UP_ID :
		if(m_v_war_list.size()>9)
		{
			int list = (m_v_war_list.size() - 9) * m_scroll / scroll_tag_height;

			if(list > 0)
				m_scroll = scroll_tag_height * (list-1) / (m_v_war_list.size()-9) + 1;			
		}
		break;
	case SCROLL_DOWN_ID :
		if(m_v_war_list.size()>9)
		{
			int list = (m_v_war_list.size() - 9) * m_scroll / scroll_tag_height;

			m_scroll = (scroll_tag_height * min((list+1),m_v_war_list.size()-9)) / (m_v_war_list.size()-9) + 1;
		}
		break;
	case CLOSE_ID :
	case X_ID :
		gpC_base->SendMessage(UI_CLOSE_WAR_LIST_WINDOW);
		break;
	case HELP_ID :		
		break;	
	}
}

//-----------------------------------------------------------------------------
// C_VS_UI_BLOOD_BIBLE_STATUS::C_VS_UI_BLOOD_BIBLE_STATUS
//
//
//-----------------------------------------------------------------------------
C_VS_UI_BLOOD_BIBLE_STATUS::C_VS_UI_BLOOD_BIBLE_STATUS()
{
	m_sec = 0;
	m_tickCount = 0;

	g_RegisterWindow(this);	
	AttrPin(true);	
	AttrTopmost(false);	
	g_RegisterWindow(this);

	int window_w = 100;
	int window_h = 290;

	//Set(RESOLUTION_X/2-window_w/2, RESOLUTION_Y/2 - window_h/2, window_w, window_h);
	Set(g_pUserInformation->iResolution_x/2-window_w/2, g_pUserInformation->iResolution_y/2 - window_h/2, window_w, window_h);
	
	//close버튼 좌표 세팅
	int close_x = w-24, close_y = h-19;
	int help_x = w-24-20, help_y = h-19;
	int alpha_x = 6, alpha_y = h-21;
	if(g_eRaceInterface == RACE_VAMPIRE)
	{
		close_x -= 5;
		close_y -= 7;
		help_x -=5;
		help_y -= 7;
		alpha_x += 5;
		alpha_y -= 5;
	}
	
	//공통버튼
	m_pC_button_group = new ButtonGroup(this);
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(close_x, close_y, 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), 
		PUSHPIN_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN));
#if __CONTENTS(__080405_FIREST_UI_UPDATE)
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_x, alpha_y, 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD), 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD), 
		ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD));	
#else
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_x, alpha_y, 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA), 
		ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA));	
#endif //__080405_FIREST_UI_UPDATE

//	memset(&m_BloodBibleStatus,-1,sizeof(BLOOD_BIBLE_STATUS) * 12 );

	for(int i=0;i<12;i++)
	{
		m_BloodBibleStatus[i].name="";
		m_BloodBibleStatus[i].status = BLOOD_BIBLE_DROP;
		m_BloodBibleStatus[i].x = -1;
		m_BloodBibleStatus[i].y = -1;
		m_BloodBibleStatus[i].zone_id = -1;
	}	
}

//-----------------------------------------------------------------------------
// C_VS_UI_BLOOD_BIBLE_STATUS::~C_VS_UI_BLOOD_BIBLE_STATUS
//
// 
//-----------------------------------------------------------------------------
C_VS_UI_BLOOD_BIBLE_STATUS::~C_VS_UI_BLOOD_BIBLE_STATUS()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::BLOOD_BIBLE_WINDOW, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BIBLE_WINDOW, Rect(x, y, w, h));
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::BLOOD_BIBLE_WINDOW, GetAttributes()->autohide);
	
	
	g_UnregisterWindow(this);
	//C_VS_UI_INFO::m_pC_info_spk
	//m_pC_info_spk=NULL;
	DeleteNew(m_pC_button_group);	
}

//-----------------------------------------------------------------------------
// C_VS_UI_BLOOD_BIBLE_STATUS::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_BLOOD_BIBLE_STATUS::ShowButtonDescription(C_VS_UI_EVENT_BUTTON * p_button)
{
	static char* m_other_info_button_string[6]=
	{		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP].GetString(),		
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_OFF].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_ON].GetString(),		
	};
	switch(p_button->GetID())
	{
	case PUSHPIN_ID :
		if(GetAttributes()->autohide)
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[4],0,0);
		else
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[5],0,0);
		break;
	case CLOSE_ID :
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[2],0,0);
		break;
	case HELP_ID :
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[1],0,0);
		break;
	case ALPHA_ID :
		if(GetAttributes()->alpha)
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[3],0,0);
		else
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[0],0,0);
		break;
	}	
}


//-----------------------------------------------------------------------------
// C_VS_UI_BLOOD_BIBLE_STATUS::ShowButtonWidget
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_BLOOD_BIBLE_STATUS::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(p_button->GetID() == ALPHA_ID)
	{
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_OLD);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED_OLD);
	#else
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED);
	#endif //__080405_FIREST_UI_UPDATE
	} else
	if(p_button->GetID() == CLOSE_ID)
	{
		gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x-5, y+p_button->y-5, C_GLOBAL_RESOURCE::BUTTON_CLOSE_BACK);
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_info_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index+1);
			else
				gpC_global_resource->m_pC_info_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index+2);
		} else
			gpC_global_resource->m_pC_info_spk->BltLocked(p_button->x+x, p_button->y+y, p_button->m_image_index);

	} else
	if(p_button->GetID() == PUSHPIN_ID)
	{
		if(GetAttributes()->autohide)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN_PUSHED);
		
	}
}

//-----------------------------------------------------------------------------
// WindowEventReceiver
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_BLOOD_BIBLE_STATUS::WindowEventReceiver(id_t event)
{
}


//-----------------------------------------------------------------------------
// Run
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_BLOOD_BIBLE_STATUS::Run(id_t id)
{
	switch (id)
	{
	case CLOSE_ID:
		break;
		
	case ALPHA_ID:
		AttrAlpha(!GetAttributes()->alpha);
		EMPTY_MOVE;
		break;
		
	case PUSHPIN_ID :
		if(GetAttributes()->autohide)
			AttrAutoHide(ATTRIBUTES_HIDE_NOT);
		else
		{
			AttrAutoHide(ATTRIBUTES_HIDE_WIDTH);
		}		
		break;		
		
	}
}

//-----------------------------------------------------------------------------
// MouseControl
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_BLOOD_BIBLE_STATUS::MouseControl(UINT message, int _x, int _y)
{
	const int skill_id = 230;
	const int start_x = 13, start_y=20;


	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	bool re = m_pC_button_group->MouseControl(message, _x, _y);
	
	switch(message)
	{
	case M_MOVING:
		if(_x > start_x && _x < start_x + 70 && _y > start_y && _y < start_y + 12*20)
		{
			COLORREF color;
			int count = (_y - start_y) / 20;

			static char temp_str[2][100];
			static LPSTR str[5] = { 
				temp_str[0],
					temp_str[1],
					NULL,
					NULL,
			};
			
			sprintf(temp_str[0],"%s (%s)",(*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_ARMEGA+count].GetString(),(*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_ARMEGA_ENG+count].GetString());
			if(m_BloodBibleStatus[count].zone_id == -1)
			{
				sprintf(temp_str[1],"%s",(*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_NONE].GetString());
				g_descriptor_manager.Set(DID_STRINGS,x+_x,y+_y,(void*)str,2);
				break;
			}
			sprintf(temp_str[1],"%s (%d,%d)",g_pZoneTable->Get(m_BloodBibleStatus[count].zone_id)->Name.GetString(),m_BloodBibleStatus[count].x,m_BloodBibleStatus[count].y);
			//sprintf(temp_str[2],"%s",(*g_pGameStringTable)[STRING_MESSAGE_BLOOD_BIBLE_BONUS_ARMEGA+count].GetString());
			
			str[2] = (*g_pGameStringTable)[STRING_MESSAGE_BLOOD_BIBLE_BONUS_ARMEGA+count].GetString();

			switch(m_BloodBibleStatus[count].status)
			{
			case BLOOD_BIBLE_NONE :
				color = RGB_WHITE;
				str[3] = (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_NONE].GetString();
				break;
			case BLOOD_BIBLE_DROP :
				str[3] = (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_DROP].GetString();
				color = RGB_WHITE;
				break;
			case BLOOD_BIBLE_HAS_SLAYER :
				str[3] = (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_HAS_SLAYER].GetString();
				color = RGB(173,207,255);
				break;
			case BLOOD_BIBLE_HAS_VAMPIRE :
				str[3] = (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_HAS_VAMPIRE].GetString();
				color = RGB(255, 150, 150);
				break;
			case BLOOD_BIBLE_SHRINE_SLAYER :
				str[3] = (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_SLAYER].GetString();
				color = RGB(23,107,255);
				break;
			case BLOOD_BIBLE_SHRINE_VAMPIRE :
				str[3] = (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_VAMPIRE].GetString();
				color = RGB_RED;
				break;
			
			case BLOOD_BIBLE_SHRINE_OUSTERS :				
				str[3] = (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_OUSTERS].GetString();
				color = RGB(23,255,23);
				break;

			case BLOOD_BIBLE_HAS_OUSTERS :
				str[3] = (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_HAS_OUSTERS].GetString();
				color = RGB(100,255,100);
				break;

			default :
				color = RGB_WHITE;
				str[3] = (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_STATUS_NONE].GetString();
				break;			
			}

			if(m_BloodBibleStatus[count].shrine_race == RACE_SLAYER)
				str[4] = (*g_pGameStringTable)[STRING_MESSAGE_SLAYER].GetString();
			else if(m_BloodBibleStatus[count].shrine_race == RACE_VAMPIRE)
				str[4] = (*g_pGameStringTable)[STRING_MESSAGE_VAMPIRE].GetString();
			else str[4] = (*g_pGameStringTable)[STRING_MESSAGE_OUSTERS].GetString();
			
			static S_BLOOD_BIBLE_DESCRIPTION sbl;

			sbl.sz_name = str[0];
			sbl.sz_place = str[1];
			if(m_BloodBibleStatus[count].name.empty())
				sbl.sz_player = NULL;
			else
				sbl.sz_player = (char*)m_BloodBibleStatus[count].name.c_str();
			sbl.sz_option = str[2];
			sbl.sz_status = str[3];
			sbl.sz_shrine = str[4];
			
			g_descriptor_manager.Set(DID_BLOOD_BIBLE_STATUS, _x+x,_y+y, (void *)&sbl,4,(long)color);
		}
		break;
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		if (gpC_mouse_pointer->GetPickUpItem() == false && re)
		{
			MoveReady();
			SetOrigin(_x, _y);
			break;
		}
		break;
	}
	return true;
}

//-----------------------------------------------------------------------------
// C_VS_UI_BLOOD_BIBLE_STATUS
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_BLOOD_BIBLE_STATUS::KeyboardControl(UINT message, UINT key, long extra)
{
	if (message == WM_KEYDOWN && key == VK_ESCAPE)
	{
		//		Run(CLOSE_ID);
	}
}
//-----------------------------------------------------------------------------
// Show
//
//
//-----------------------------------------------------------------------------
void	C_VS_UI_BLOOD_BIBLE_STATUS::Show()
{
	if(m_sec != 0)
	{
		if(m_sec < (timeGetTime() - m_tickCount)/1000)
		{
			gpC_base->SendMessage(UI_CLOSE_BLOOD_BIBLE_STATUS);
			m_sec = 0;
		}
	}

	const int skill_id = 230;
	const int start_x = x+13, start_y=y+20;
	gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);
	
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		m_pC_button_group->Show();

		int i;
		for(i = 0; i < 12; i++)
		{			
			POINT point = {start_x,start_y + i*20 };
			if(C_VS_UI_SKILL::m_C_spk_mini.GetSize() > skill_id + i)
			{
				gpC_base->m_p_DDSurface_back->BltSprite(&point, &C_VS_UI_SKILL::m_C_spk_mini[skill_id + i]);				
			}
		}
		gpC_base->m_p_DDSurface_back->Unlock();

		for(i = 0; i < 12; i++)
		{			
			POINT point = {start_x,start_y + i*20 };

			BYTE r = 0, g = 0, b = 0;
			WORD color = 0;

			if(m_BloodBibleStatus[i].shrine_race == RACE_SLAYER)	// slayer
				b = 255;
			else if( m_BloodBibleStatus[i].shrine_race == RACE_VAMPIRE )
				r = 255;
			else if( m_BloodBibleStatus[i].shrine_race == RACE_OUSTERS )
				g = 255;

			color = CDirectDraw::Color(r, g, b);

			RECT rect = {point.x, point.y, point.x +17, point.y +17};

			gpC_base->m_p_DDSurface_back->DrawRect(&rect, color);
		}

	}
	
//	for(int i=0;i<12;i++)
//	{
//	}

	g_FL2_GetDC();
	for(int i = 0; i < 12; i++)
	{
		if(m_BloodBibleStatus[i].zone_id != -1)
		{
			COLORREF color = RGB_WHITE;

			switch(m_BloodBibleStatus[i].status)
			{
			case BLOOD_BIBLE_NONE :
			case BLOOD_BIBLE_DROP :
				color = RGB_WHITE;
				break;
			case BLOOD_BIBLE_HAS_SLAYER :
				color = RGB(173,207,255);
				break;

			case BLOOD_BIBLE_SHRINE_SLAYER :
				color = RGB(23,107,255);
				break;

			case BLOOD_BIBLE_HAS_VAMPIRE :
				color = RGB(255, 150, 150);
				break;
			
			case BLOOD_BIBLE_HAS_OUSTERS :
				color = RGB(0, 255, 0 );
				break;
				
			case BLOOD_BIBLE_SHRINE_OUSTERS :
				color = RGB(0, 255, 0 );
				break;

			case BLOOD_BIBLE_SHRINE_VAMPIRE :
				color = RGB_RED;
				break;
			}
			g_PrintColorStrShadow( start_x + 22, start_y+4 + i*20,(*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_ARMEGA+i].GetString(),
				gpC_base->m_chatting_pi,color, RGB_BLACK);
		}
		else
			g_PrintColorStrShadow( start_x + 22, start_y + 4 +i*20, (*g_pGameStringTable)[UI_STRING_MESSAGE_BLOOD_BIBLE_ARMEGA+i].GetString(),
				gpC_base->m_chatting_pi,RGB_GRAY, RGB_BLACK);
			
	}
	m_pC_button_group->ShowDescription();
	g_FL2_ReleaseDC();
}

//-----------------------------------------------------------------------------
// Start
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_BLOOD_BIBLE_STATUS::Start()
{
	//IsRunning=true;
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::BLOOD_BIBLE_WINDOW));
	AttrAutoHide(gpC_vs_ui_window_manager->GetAutoHide(C_VS_UI_WINDOW_MANAGER::BLOOD_BIBLE_WINDOW));
	
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BIBLE_WINDOW);
	if(rect.w != -1)
	{
		x = rect.x;
		y = rect.y;
	}
	
	PI_Processor::Start();
	m_pC_button_group->Init();	
	gpC_window_manager->AppearWindow(this);
	
	EMPTY_MOVE;
}

void	C_VS_UI_BLOOD_BIBLE_STATUS::Finish()
{
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::BLOOD_BIBLE_WINDOW, GetAttributes()->alpha);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::BLOOD_BIBLE_WINDOW, Rect(x, y, w, h));
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::BLOOD_BIBLE_WINDOW, GetAttributes()->autohide);
	
	PI_Processor::Finish();
	
	gpC_window_manager->DisappearWindow(this);	
}

//-----------------------------------------------------------------------------
// Process
//
// 
//-----------------------------------------------------------------------------
void	C_VS_UI_BLOOD_BIBLE_STATUS::Process()
{
	m_pC_button_group->Process();
	ProcessHide();
}

//-----------------------------------------------------------------------------
// IsPixel
//
// 
//-----------------------------------------------------------------------------
bool	C_VS_UI_BLOOD_BIBLE_STATUS::IsPixel(int _x, int _y)
{
//	bool re = m_pC_button_group->IsInRect(_x - x,_y - y) != NULL;

//	if(GetAttributes()->alpha)
//		return re;

	return IsInRect(_x, _y);	
}

void	C_VS_UI_BLOOD_BIBLE_STATUS::SetBloodBible(int blood_bible_id, BLOOD_BIBLE_STATUS &blood_bible_status)
{
	if(blood_bible_id < 0 || blood_bible_id >= 12)				// 피의 성서가 아닐 경우
		return;

	m_BloodBibleStatus[blood_bible_id] = blood_bible_status;
}

void	C_VS_UI_BLOOD_BIBLE_STATUS::UnSetBloodBible(int blood_bible_id)
{
	if(blood_bible_id < 0 || blood_bible_id >= 12)
		return;
	m_BloodBibleStatus[blood_bible_id].zone_id = -1;
}

//------------------------------------------------------------------------------
// C_VS_UI_INPUT_NAME
//
// 성지에서 세금을 가져온다.
//------------------------------------------------------------------------------
C_VS_UI_INPUT_NAME::C_VS_UI_INPUT_NAME(INPUT_NAME_MODE_LIST mode)
{	
	m_Mode = mode;
	//Set(RESOLUTION_X/2 - 340/2, RESOLUTION_Y/2 - 267/2, 360, 267);
	Set(g_pUserInformation->iResolution_x/2 - 340/2, g_pUserInformation->iResolution_y/2 - 267/2, 360, 267);

	int ok_x = 160,ok_y = h-44;
	int cancel_x=236,cancel_y=h-44;
	m_name_x=135;
	m_name_y=h-75;


	m_pC_button_group = new ButtonGroup(this);
	

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(ok_x,ok_y,
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_OK),
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_OK),
		OK_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_OK));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(cancel_x,cancel_y,
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_CANCEL),
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_CANCEL),
		CANCEL_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_CANCEL));

	g_RegisterWindow(this);
	AttrTopmost(true);
	AttrKeyboardControl(true);
	


	m_lev_name.SetPosition(x+170,y+193);
	m_lev_name.SetPrintInfo(gpC_base->m_chatting_pi);
	m_lev_name.SetByteLimit(10);
	m_lev_name.SetAbsWidth(90);
	m_lev_name.SetInputStringColor(RGB_WHITE);
	m_lev_name.SetCursorColor(RGB_WHITE);
	Attach(&m_lev_name);	

	
	m_name = "";
	m_status = "";

	m_Status= INPUT_STATUS_NORMAL;
}

C_VS_UI_INPUT_NAME::~C_VS_UI_INPUT_NAME()
{
	DeleteNew(m_pC_button_group);
}

void	C_VS_UI_INPUT_NAME::Start()
{
	PI_Processor::Start();
	gpC_window_manager->AppearWindow(this);
	m_pC_button_group->Init();
	AttrTopmost(true);
	m_lev_name.Acquire();
	m_lev_name.EraseAll();
}

void	C_VS_UI_INPUT_NAME::Finish()
{
	PI_Processor::Finish();
	gpC_window_manager->DisappearWindow(this);

	if(m_lev_name.IsAcquire())			
		m_lev_name.Unacquire();
	gC_vs_ui.AcquireChatting();
}

void	C_VS_UI_INPUT_NAME::Show()
{
	int box_x = 160+x, box_y = 189+y;
	int name_x =190+x, name_y = 193+y;
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		gpC_global_resource->DrawDialogLocked(x,y,w,h,g_pUserOption->DefaultAlpha == TRUE);
		gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(box_x, box_y,C_GLOBAL_RESOURCE::AB_MONEY_BAR);		
	
		m_pC_button_group->Show();	
		
		gpC_base->m_p_DDSurface_back->Unlock();
	}
	
	if(g_FL2_GetDC())
	{		
		g_PrintColorStr(x+30, name_y, (*g_pGameStringTable)[UI_STRING_MESSAGE_OTHER_PLAYER_NAME].GetString(), gpC_base->m_chatting_pi, RGB_WHITE);
		
		std::string str;

		switch(m_Mode)
		{
		case INPUT_NAME_BREAK_UP :
			if(g_eRaceInterface == RACE_OUSTERS)
				str = (*g_pGameStringTable)[UI_STRING_MESSAGE_OUSTERS_BREAK_UP_COUPLE_MSG].GetString();			
			else
				str = (*g_pGameStringTable)[UI_STRING_MESSAGE_BREAK_UP_COUPLE_MSG].GetString();			
			break;
		case INPUT_NAME_HOPE_COUPLE :
			if(g_eRaceInterface == RACE_OUSTERS)
				str = (*g_pGameStringTable)[UI_STRING_MESSAGE_OUSTERS_HOPE_COUPLE_MSG].GetString();			
			else
				str = (*g_pGameStringTable)[UI_STRING_MESSAGE_HOPE_COUPLE_MSG].GetString();
			break;
		case INPUT_NAME_FORCE_BREAK_UP :
			if(g_eRaceInterface == RACE_OUSTERS)
				str = (*g_pGameStringTable)[UI_STRING_MESSAGE_OUSTERS_FORCE_BREAK_UP_COUPLE].GetString();			
			else
				str = (*g_pGameStringTable)[UI_STRING_MESSAGE_FORCE_BREAK_UP_COUPLE].GetString();
			break;
		default :
			str = "";
			break;
		}		

		int next=0;
		char sz_string[512];

		int print_x=30+x,vx;
		int py = 40+y;
		const int print_gap = 20;
		const int char_width = g_GetStringWidth("a", gpC_base->m_chatting_pi.hfont);

		vx = print_x;

		while(str.size() > next)
		{
			strcpy(sz_string, str.c_str()+next);
			
			char *sz_string2 = sz_string;
			
			while(*sz_string2 == ' ')		// 앞의 공백제거
			{
				sz_string2++;
				next++;
			}
			
			int cut_pos = (x+w-30 -vx)/char_width;
			
			if(!g_PossibleStringCut(sz_string2, cut_pos))
				cut_pos--;
			sz_string2[cut_pos] = NULL;
			
			char *return_char = NULL;
			if((return_char = strchr(sz_string2, '\n')) != NULL)	// return 처리
			{
				cut_pos = return_char - sz_string2+1;
				sz_string2[cut_pos-1] = NULL;
			}
						
			g_PrintColorStr(vx, py, sz_string2, gpC_base->m_chatting_pi, RGB_WHITE);
			next += cut_pos;
			vx = print_x;
			py += print_gap;
		}
		g_FL2_ReleaseDC();
	}

	m_lev_name.SetPosition(name_x,name_y);
	if(m_Status == INPUT_STATUS_NORMAL)
		m_lev_name.SetInputStringColor(RGB_WHITE);
	else
		m_lev_name.SetInputStringColor(RGB_GRAY);
	m_lev_name.Show();


	m_pC_button_group->ShowDescription();

	SHOW_WINDOW_ATTR;
}

bool	C_VS_UI_INPUT_NAME::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	bool re = m_pC_button_group->MouseControl(message, _x, _y);

	if(m_Status == INPUT_STATUS_NORMAL)
	{
		if(!m_lev_name.IsAcquire())
			m_lev_name.Acquire();
	}		
	else
		m_lev_name.Unacquire();

	return true;
}

void	C_VS_UI_INPUT_NAME::KeyboardControl(UINT message, UINT key, long extra)	
{
	if (message == WM_CHAR)
	{
		if (isdigit(key) && m_lev_name.Size() == 0)
			return;
		
		char ignore_char[] = {'~', '`', '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '-', '_',
			'+', '=', '\\', '|', '[', ']', '{', '}', ';', ':', '\"', '\'', ',', '<', '.', '>',
			'/', '?', ' '};
		
		for (int i=0; i<sizeof(ignore_char); i++)
			if ((char)key == ignore_char[i])
				return;
	}

	Window::KeyboardControl(message, key, extra);
	
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_RETURN :
			{			
				char *str=NULL;
				g_Convert_DBCS_Ascii2SingleByte(m_lev_name.GetString(),m_lev_name.Size(),str);
				if(str != NULL && m_Status == INPUT_STATUS_NORMAL)
				{
					m_name = str;
					gpC_base->SendMessage(UI_SEND_NAME_FOR_COUPLE,(int) m_Mode,0,(void*)m_name.c_str());
				}
				DeleteNew(str);
			}
			break;
		case VK_ESCAPE :
			gpC_base->SendMessage(UI_CLOSE_INPUT_NAME);
			break;		
		}
	}
}

bool	C_VS_UI_INPUT_NAME::IsPixel(int _x,int _y)
{
	return IsInRect(_x, _y);
}

void	C_VS_UI_INPUT_NAME::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(p_button->GetID() == OK_ID || p_button->GetID() == CANCEL_ID)
	{
		if(m_Status == INPUT_STATUS_NORMAL)
		{
			if(p_button->GetFocusState())
			{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_PUSHED_OFFSET);
			else
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_HILIGHTED_OFFSET);
			} else
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index);
		} else
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLockedDarkness(x+p_button->x,y+p_button->y,p_button->m_image_index,1);
		}
	} else
	if(p_button->GetFocusState())
	{
		if(p_button->GetPressState())
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_HILIGHTED_OFFSET);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_HILIGHTED_OFFSET);
	} else
		gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index);
}

void	C_VS_UI_INPUT_NAME::ShowButtonDescription(C_VS_UI_EVENT_BUTTON *p_button)
{
	char* m_bring_fee_msg[2] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_COMPLETE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CANCEL].GetString(),
	};
	
	switch(p_button->GetID())
	{
	case OK_ID :
		g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,
			(void *)m_bring_fee_msg[0],0,0);		
		break;
	case CANCEL_ID :
		g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,
			(void *)m_bring_fee_msg[1],0,0);		
		break;
	}
}

void	C_VS_UI_INPUT_NAME::WindowEventReceiver(id_t event)
{
}

void	C_VS_UI_INPUT_NAME::Run(id_t id)
{
	switch(id)
	{
	case OK_ID :
		{			
			char *str=NULL;
			g_Convert_DBCS_Ascii2SingleByte(m_lev_name.GetString(),m_lev_name.Size(),str);
			if(str != NULL && m_Status == INPUT_STATUS_NORMAL)
			{
				m_name = str;
				gpC_base->SendMessage(UI_SEND_NAME_FOR_COUPLE,(int) m_Mode,0,(void*)m_name.c_str());
			}
			DeleteNew(str);
		}
		break;
	case CANCEL_ID :
		gpC_base->SendMessage(UI_CLOSE_INPUT_NAME);
		break;		
	}
}

void	C_VS_UI_INPUT_NAME::Process()
{
	m_pC_button_group->Process();
	
	if(m_Status != INPUT_STATUS_NORMAL )
		m_lev_name.Unacquire();
	else
	{
		if(!m_lev_name.IsAcquire())
			m_lev_name.Acquire();
	}

}


void	C_VS_UI_INPUT_NAME::SetName(const char* name)
{
	if(name != NULL)
	{
		m_name = name;
		m_lev_name.AddString(m_name.c_str());
	}
}

const char* C_VS_UI_INPUT_NAME::GetCurrentName()
{
	char *str=NULL;
	g_Convert_DBCS_Ascii2SingleByte(m_lev_name.GetString(),m_lev_name.Size(),str);
	if(str != NULL)
		m_name = str;
	else
		return NULL;
	 
	DeleteNew(str);

	return m_name.c_str();
}

//------------------------------------------------------------------------------
// C_VS_UI_POPUP_MESSAGE
//
// 팝업창을 띄운다.
//------------------------------------------------------------------------------
C_VS_UI_POPUP_MESSAGE::C_VS_UI_POPUP_MESSAGE(const char *str, POPUP_TYPE type)
{	
	m_Type = type;
	int window_x=-1,window_y=-1;

	AttrTopmost(true);
	CRarFile				PackFile;

	m_SendID = 0xFFFFFFFF;

	switch( m_Type )
	{
	case POPUP_NORMAL :
		window_x = 400;
		window_y = 300;
		m_Str = str;
		break;
	case POPUP_LARGE:
		window_x = 500;
		window_y = 300;
		m_Str = str;
		break;
	case POPUP_WELCOME :
		if( window_x == -1) window_x = 500;
		if( window_y == -1) window_y = 400;
		PackFile.SetRAR(RPK_TUTORIAL_ETC, RPK_PASSWORD);
		if(PackFile.IsSet())
		{
			char temp[4096];
			ZeroMemory(temp,4096);
			PackFile.Open(str);
			PackFile.GetString(temp,4096);
			m_Str = temp;
			
			PackFile.Release();
		} else
		{
			m_Str = "";
		}
		break;
		
	case POPUP_EVENT_QUEST :
		m_Str=str;
		window_x = 480;
		window_y = 350;
		AttrTopmost(true);
		
		PackFile.SetRAR(RPK_TUTORIAL_ETC, RPK_PASSWORD);
		if(PackFile.IsSet())
		{
			char temp[4096];
			ZeroMemory(temp,4096);
			PackFile.Open(str);
			PackFile.GetString(temp,4096);
			m_Str = temp;
			
			PackFile.Release();
		} else
		{
			m_Str = "";
		}		
		break;
	case POPUP_MINI_WINDOW :
		m_Str = str;
		window_x = 200;
		window_y = 200;
		AttrTopmost( false );
		break;
		
//	case POPUP_ASK_BEGINNER_ZONE :
//		m_Str = str;
//		window_x = 420;
//		window_y = 450;
//		
//		AttrTopmost( true );
//		PackFile.SetRAR(RPK_TUTORIAL_ETC, RPK_PASSWORD);
//		if( PackFile.IsSet() )
//		{
//			char temp[4096];
//			ZeroMemory( temp, 4096 );
//			PackFile.Open( str );
//			PackFile.GetString(temp, 4096);
//			m_Str = temp;
//
//			PackFile.Release();
//		} else
//			m_Str = "";
//		break;
	}	
	
	//Set(RESOLUTION_X/2 - window_x/2, RESOLUTION_Y/2 - window_y/2, window_x, window_y);
	Set(g_pUserInformation->iResolution_x/2 - window_x/2, g_pUserInformation->iResolution_y/2 - window_y/2, window_x, window_y);

	int ok_x = w-180,ok_y = h-44;
	int cancel_x=w-100,cancel_y=h-44;
	
	m_pC_button_group = new ButtonGroup(this);
	
 
//	if( m_Type == POPUP_ASK_BEGINNER_ZONE )
//	{
//		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(cancel_x,cancel_y,
//			gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_CANCEL),
//			gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_CANCEL),
//			CANCEL_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_CANCEL));
//
//		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(ok_x,ok_y,
//			gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_OK),
//			gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_OK),
//			OK_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_OK));
//	} else
	{
		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(cancel_x,cancel_y,
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_OK),
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_OK),
		OK_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_OK));
	}

	g_RegisterWindow(this);
}

C_VS_UI_POPUP_MESSAGE::C_VS_UI_POPUP_MESSAGE(PopupWindowStyle &style)
{
	AttrTopmost(true);
//	CRarFile				PackFile;
	
	//Set(RESOLUTION_X/2 - style.WindowX/2, RESOLUTION_Y/2 - style.WindowY/2, style.WindowX, style.WindowY);
	Set(g_pUserInformation->iResolution_x/2 - style.WindowX/2, g_pUserInformation->iResolution_y/2 - style.WindowY/2, style.WindowX, style.WindowY);

	int button_x = w-100, button_y = h-44;

//	int ok_x = w-180,ok_y = h-44;
//	int cancel_x=w-100,cancel_y=h-44;
	
	m_pC_button_group = new ButtonGroup(this);

	if( style.Style & STYLE_OK_BUTTON )
	{
		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(button_x-80,button_y,
			gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ABSENCE),
			gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ABSENCE),
			OK_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_OK));
//		button_x = w-180;
	}


	if( style.Style & STYLE_CANCEL_BUTTON )
	{
		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(button_x,button_y,
			gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ABSENCE),
			gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ABSENCE),
			CANCEL_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_CLOSE));
	}
	
	if( style.Style & STYLE_ABSENCE_BUTTON )
	{
		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(button_x,button_y,
			gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ABSENCE),
			gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ABSENCE),
			CANCEL_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_ABSENCE));

		button_x = w-180;
	}

	if( style.Style & STYLE_JOIN_BUTTON )
	{
		m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(button_x,button_y,
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_JOINING),
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_JOINING),
		OK_ID,this,C_GLOBAL_RESOURCE::AB_BUTTON_JOINING));
	}

	m_SendID = style.SendID;
	m_Type = POPUP_NORMAL;

//	PackFile.SetRAR(RPK_TUTORIAL_ETC, RPK_PASSWORD);
//	if( PackFile.IsSet() )
//	{
//		char temp[4096];
//		ZeroMemory( temp, 4096 );
//		PackFile.Open( m_Str.c_str() );
//		PackFile.GetString(temp, 4096);
//		m_Str = temp;
//		
//		PackFile.Release();
//	} else
//		m_Str = "";

	m_Str		= style.str;

	g_RegisterWindow(this);
}

C_VS_UI_POPUP_MESSAGE::~C_VS_UI_POPUP_MESSAGE()
{
	g_UnregisterWindow(this);
	DeleteNew(m_pC_button_group);
}

void	C_VS_UI_POPUP_MESSAGE::Start()
{
	PI_Processor::Start();
	gpC_window_manager->AppearWindow(this);
	m_pC_button_group->Init();
//	AttrTopmost(true);
}

void	C_VS_UI_POPUP_MESSAGE::Finish()
{
	PI_Processor::Finish();
	gpC_window_manager->DisappearWindow(this);

}

void	C_VS_UI_POPUP_MESSAGE::Show()
{
	int box_x = 160+x, box_y = 189+y;
	int name_x =190+x, name_y = 193+y;

	const int char_width = g_GetStringWidth("a", gpC_base->m_dialog_msg_pi.hfont);
	

	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		gpC_global_resource->DrawDialogLocked(x,y,w,h,g_pUserOption->DefaultAlpha == TRUE);
	
		m_pC_button_group->Show();	
		
		gpC_base->m_p_DDSurface_back->Unlock();
	}
	
	if(g_FL2_GetDC())
	{	
		int next=0;
		char sz_string[2048];
		ZeroMemory(sz_string, 2048);

		int print_x=30+x,vx;
		int py = 40+y;
		const int print_gap = 20;
		

		vx = print_x;

		while(m_Str.size() > next)
		{
			if(m_Str.size() - next > 2048)
			{
				memcpy(sz_string,m_Str.c_str()+next,2047);
				sz_string[2047] = '\0';
			}
			else
				strcpy(sz_string, m_Str.c_str()+next);
			
			char *sz_string2 = sz_string;
			
			while(*sz_string2 == ' ')		// 앞의 공백제거
			{
				sz_string2++;
				next++;
			}
			
			int cut_pos = (x+w-30 -vx)/char_width;			
			
			if(!g_PossibleStringCut(sz_string2, cut_pos))
				cut_pos--;
			
			sz_string2[cut_pos] = NULL;
			
			char *return_char = NULL;
			if((return_char = strstr(sz_string2, "\\n")) != NULL)	// return 처리
			{
				cut_pos = return_char - sz_string2+2;
				sz_string2[cut_pos-2] = NULL;
			}
						
			g_PrintColorStr(vx, py, sz_string2, gpC_base->m_dialog_msg_pi, RGB_WHITE);
			next += cut_pos;
			vx = print_x;
			py += print_gap;
		}
		g_FL2_ReleaseDC();
	}
	
	m_pC_button_group->ShowDescription();

	SHOW_WINDOW_ATTR;
}

bool	C_VS_UI_POPUP_MESSAGE::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);
	_x-=x; _y-=y;
	bool re = m_pC_button_group->MouseControl(message, _x, _y);
	switch(message)
	{
	case M_MOVING:
		break;
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:		
		if( m_Type == POPUP_MINI_WINDOW )
		{
			MoveReady();
			SetOrigin(_x, _y);
		}
		break;
	}
	
	return true;
}

void	C_VS_UI_POPUP_MESSAGE::KeyboardControl(UINT message, UINT key, long extra)	
{	
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_RETURN :
			gpC_base->SendMessage(UI_CLOSE_POPUP_MESSAGE);
			break;
		case VK_ESCAPE :
			gpC_base->SendMessage(UI_CLOSE_POPUP_MESSAGE);
			break;		
		}
	}
}

bool	C_VS_UI_POPUP_MESSAGE::IsPixel(int _x,int _y)
{
	return IsInRect(_x, _y);
}

void	C_VS_UI_POPUP_MESSAGE::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(p_button->GetID() == OK_ID || p_button->GetID() == CANCEL_ID)
	{
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_PUSHED_OFFSET);
			else
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index+C_GLOBAL_RESOURCE::AB_BUTTON_HILIGHTED_OFFSET);
		} else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x,y+p_button->y,p_button->m_image_index);
	}
}

void	C_VS_UI_POPUP_MESSAGE::ShowButtonDescription(C_VS_UI_EVENT_BUTTON *p_button)
{
	char* m_bring_fee_msg[3] = 
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_GO_TO_BEGINNER_ZONE].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_JOIN_LEVEL_WAR].GetString()
	};
	
	switch(p_button->GetID())
	{
	case OK_ID :
		switch(m_SendID)
		{
		case 1:
			g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,  (void *)m_bring_fee_msg[1],0,0);
			break;

		case 2:
		case 3:
			g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,  (void *)m_bring_fee_msg[2],0,0);
			break;

		}
		break;

	case CANCEL_ID :
		g_descriptor_manager.Set(DID_INFO,p_button->x+x,p_button->y+y,
			(void *)m_bring_fee_msg[0],0,0);		
		break;
	}
}

void	C_VS_UI_POPUP_MESSAGE::WindowEventReceiver(id_t event)
{
}

void	C_VS_UI_POPUP_MESSAGE::Run(id_t id)
{
	switch(id)
	{
	case OK_ID :
//		if( m_Type == POPUP_ASK_BEGINNER_ZONE )
//			gpC_base->SendMessage(UI_GO_TO_BEGINNER_ZONE, m_SendID,1);
//		else
			gpC_base->SendMessage(UI_POPUP_MESSAGE_OK, m_SendID);

		// 2004, 5, 6 sobeit add start - 웰컴 창 뜬다음 인터페이스 도움말 메일 발송 ^^
		if(POPUP_WELCOME == m_Type)
			gC_vs_ui.AddHelpMail(HELP_EVENT_INTERFACE);

		// 2004.10.10 연합길드 관련 
		if(m_Str == (*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_LEAVE_OK].GetString())
				gpC_base->SendMessage(UI_REQUEST_UNION_QUIT, C_VS_UI_TEAM_INFO::GetGuildId(), 0); // 연합길드 신청 

		if(m_Str == (*g_pGameStringTable)[UI_STRING_MESSAGE_TOTAL_GUILD_LEAVE_CANCEL].GetString())
				gpC_base->SendMessage(UI_REQUEST_UNION_QUIT, C_VS_UI_TEAM_INFO::GetGuildId(), 1); // 연합길드 신청 
		break;
	
	case CANCEL_ID :
		gpC_base->SendMessage(UI_CLOSE_POPUP_MESSAGE, m_SendID);

		// 2004, 5, 6 sobeit add start - 웰컴 창 뜬다음 인터페이스 도움말 메일 발송 ^^
		if(POPUP_WELCOME == m_Type)
			gC_vs_ui.AddHelpMail(HELP_EVENT_INTERFACE);

			
		break;		
	}
}

void	C_VS_UI_POPUP_MESSAGE::Process()
{
	m_pC_button_group->Process();
}


//------------------------------------------------------------------------------
// C_VS_UI_QUEST
//
// 퀘스트 정보창
//------------------------------------------------------------------------------
C_VS_UI_QUEST_STATUS::C_VS_UI_QUEST_STATUS()
{	
	AttrTopmost(false);
	g_RegisterWindow(this);	
	AttrPin(true);	
	
	int window_w = 170;
	int window_h = 170;
	
	//Set(RESOLUTION_X/2-window_w/2, RESOLUTION_Y/2 - window_h/2, window_w, window_h);
	Set(g_pUserInformation->iResolution_x/2-window_w/2, g_pUserInformation->iResolution_y/2 - window_h/2, window_w, window_h);

	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW));
	AttrAutoHide(gpC_vs_ui_window_manager->GetAutoHide(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW));
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW);
	if(rect.w != -1)
	{ 
		x = rect.x;
		y = rect.y;
	}


	int pin_x = w-24-24, pin_y = h-21;
	int close_x = w-24, close_y = h-19;		
	int alpha_x = 6, alpha_y = h-21;
		
	//공통버튼
	m_pC_button_group = new ButtonGroup(this);
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(pin_x, pin_y, 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN), 
		PUSHPIN_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN));

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(close_x, close_y, 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::BUTTON_CLOSE), 
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::BUTTON_CLOSE), 
		CLOSE_ID, this, C_GLOBAL_RESOURCE::BUTTON_CLOSE));

#if __CONTENTS(__080405_FIREST_UI_UPDATE)
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_x, alpha_y,
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW),
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW),
		ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW));	
#else
	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(alpha_x, alpha_y,
		gpC_global_resource->m_pC_assemble_box_button_spk->GetWidth(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA),
		gpC_global_resource->m_pC_assemble_box_button_spk->GetHeight(C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA),
		ALPHA_ID, this, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA));
#endif //__080405_FIREST_UI_UPDATE	

	//memset( &m_quest_status, 0 ,sizeof( QUEST_STATUS ) );
	m_quest_status.current_point = 0;
	m_quest_status.quest_time = 0;
	m_quest_status.Title = NULL;

	m_bl_active = false;
	m_bl_focus = false;
	m_bl_timeover  = false;
	m_timer = 0;	
	SetQuestStatusInit();
	
	std::string str;

	m_hard_cording.clear();

	str = (*g_pCreatureTable)[5].Name;
	str += ",";
	str += (*g_pCreatureTable)[7].Name;
	str += ",";
	str += (*g_pCreatureTable)[4].Name;
	str += ",";
	str += (*g_pCreatureTable)[6].Name;
// 	str = "터닝데드,터닝소울,데드바디,키드";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[9].Name;
	str += ",";
	str += (*g_pCreatureTable)[8].Name;
	str += ",";
	str += (*g_pCreatureTable)[106].Name;
	str += ",";
	str += (*g_pCreatureTable)[256].Name;
	str += ",";
	str += (*g_pCreatureTable)[107].Name;
	str += ",";
	str += (*g_pCreatureTable)[187].Name;
//	str = "솔져,캡틴,알칸,아이언티쓰,레드아이,뮤탄트";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[218].Name;
	str += ",";
	str += (*g_pCreatureTable)[230].Name;
	str += ",";
	str += (*g_pCreatureTable)[468].Name;
	str += ",";
	str += (*g_pCreatureTable)[473].Name;
	str += ",";
	str += (*g_pCreatureTable)[197].Name;
	str += ",";
	str += (*g_pCreatureTable)[240].Name;
//	str = "모데라스,벤델라이저,더티스트라이더,에스트로이더,위도우스,빅팽";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[165].Name;
	str += ",";
	str = (*g_pCreatureTable)[465].Name;
	str += ",";
	str = (*g_pCreatureTable)[467].Name;
//	str = "호블,블러드워록,골레머";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[166].Name;
	str += ",";
	str = (*g_pCreatureTable)[286].Name;
	str += ",";
	str = (*g_pCreatureTable)[328].Name;
//	str = "쉐도우윙,크림슨슬로터,리퍼";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[476].Name;
	str += ",";
	str = (*g_pCreatureTable)[479].Name;
	str += ",";
	str = (*g_pCreatureTable)[266].Name;
//	str = "카오스나이트,헬위자드,다크스크리머";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[147].Name;
	str += ",";
	str = (*g_pCreatureTable)[338].Name;
//	str = "카오스가디언,헬가디언";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[377].Name;
	str += ",";
	str = (*g_pCreatureTable)[387].Name;
//	str = "다크가디언,로드카오스";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[478].Name;
//	str = "로드다크니스";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[417].Name;
	str += ",";
	str = (*g_pCreatureTable)[407].Name;
	str += ",";
	str = (*g_pCreatureTable)[397].Name;
	str += ",";
	str = (*g_pCreatureTable)[437].Name;
	str += ",";
	str = (*g_pCreatureTable)[438].Name;
	str += ",";
	str = (*g_pCreatureTable)[438].Name;
	str += ",";
	str = (*g_pCreatureTable)[448].Name;
//	str = "다크헤이즈,헬펜드,카오스그리드,던울프아크,멈림몬,샤먼오프";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[604].Name;
	str += ",";
	str = (*g_pCreatureTable)[483].Name;
	str += ",";
	str = (*g_pCreatureTable)[614].Name;
//	str = "딤가고일,다크베리트,볼바메두사";
	m_hard_cording.push_back( str );
	str = (*g_pCreatureTable)[504].Name;
	str += ",";
	str = (*g_pCreatureTable)[624].Name;
	str += ",";
	str = (*g_pCreatureTable)[503].Name;
	str += ",";
	str = (*g_pCreatureTable)[493].Name;
//	str = "자이언트오스,애쉬발록,마운트크래그,리치젤";
	m_hard_cording.push_back( str );

}

C_VS_UI_QUEST_STATUS::~C_VS_UI_QUEST_STATUS()
{
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW, Rect(x, y, w, h));	
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW, GetAttributes()->alpha);

	g_UnregisterWindow(this);
	
	DeleteNew(m_pC_button_group);	
}

void	C_VS_UI_QUEST_STATUS::Start()
{
	AttrAlpha(gpC_vs_ui_window_manager->IsAlpha(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW));
	AttrAutoHide(gpC_vs_ui_window_manager->GetAutoHide(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW));
	Rect &rect = gpC_vs_ui_window_manager->GetRect(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW);
	if(rect.w != -1)
	{ 
		x = rect.x;
		y = rect.y;
	}
	PI_Processor::Start();
	gpC_window_manager->AppearWindow(this);
	m_pC_button_group->Init();
	AttrTopmost(false);	
}

void	C_VS_UI_QUEST_STATUS::Finish()
{
	gpC_vs_ui_window_manager->SetAutoHide(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW, GetAttributes()->autohide);
	gpC_vs_ui_window_manager->SetRect(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW, Rect(x, y, w, h));	
	gpC_vs_ui_window_manager->SetAlpha(C_VS_UI_WINDOW_MANAGER::QUEST_STATUS_WINDOW, GetAttributes()->alpha);

	PI_Processor::Finish();
	gpC_window_manager->DisappearWindow(this);	
}

void	C_VS_UI_QUEST_STATUS::SetQuestStatus(QUEST_STATUS &status)
{	
	if(m_quest_status.current_point < status.current_point)
	{
		Timer(4000);
		m_bl_timeover = false;
	}
	m_bl_active = true;
	m_quest_status = status;
}

void	C_VS_UI_QUEST_STATUS::SetQuestStatusInit()
{
	m_quest_status.QuestID = 0xffffffff;
//	m_quest_status.QuestID = 87;				// 57, 72, 87
	m_quest_status.quest_time = 0;
	m_quest_status.current_point = 0;

	m_bl_timeover = false;
	m_bl_active = false;		
}

void	C_VS_UI_QUEST_STATUS::Show()
{
	static DWORD SECOND_PET_QUEST = 0xffff;
	const int tab_x = 0;
	const int tab_y = 60;
	gpC_global_resource->DrawDialog(x, y, w, h, GetAttributes()->alpha);

	QUEST_INFO *QuestInfo;
	if(m_bl_active)
	{
		QuestInfo = g_pQuestInfoManager->GetInfo( m_quest_status.QuestID );
		if(NULL == QuestInfo)
			return;
	}
	else
	{
		RECT rect = { x+20, y+60, x+20+130, y+60+40 };
		Rect rt( rect.left, rect.top, rect.right - rect.left, rect.bottom - rect.top );

		if(!GetAttributes()->alpha)
		{
			gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
		}

		gpC_global_resource->DrawOutBox(rt);
		ShowDesc(x+25,y+64,(*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_IN_QUEST2].GetString() );
		if ( gpC_base->m_p_DDSurface_back->Lock() )
		{
			m_pC_button_group->Show();
			gpC_base->m_p_DDSurface_back->Unlock();
			m_pC_button_group->ShowDescription();
		}
		return;
	}

	{
		// Draw Title
		RECT rect = {x+15, y+17, x+154, y+77 };
		Rect rt( rect.left, rect.top, rect.right - rect.left, rect.bottom - rect.top );

		if(!GetAttributes()->alpha)
		{
			if( m_bl_focus )
				gpC_base->m_p_DDSurface_back->FillRect(&rect, CDirectDraw::Color(3,3,3));	
			else
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);	
		}

		gpC_global_resource->DrawOutBox(rt);
	}

	int sprite_back, sprite_bar;
	
	switch(g_eRaceInterface)
	{
	case RACE_SLAYER:
		sprite_back = C_GLOBAL_RESOURCE::DOMAIN_BACK;
		sprite_bar  = C_GLOBAL_RESOURCE::DOMAIN_BAR;
		break;
		
	case RACE_VAMPIRE:
		sprite_back = C_GLOBAL_RESOURCE::GRADE_BAR_BACK;
		sprite_bar  = C_GLOBAL_RESOURCE::GRADE_BAR;
		break;
		
	case RACE_OUSTERS:
		sprite_back = C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2_BACK;
		sprite_bar = C_GLOBAL_RESOURCE::OUSTERS_GRADE_BAR2;
		break;
	}

	//도메인바 뒤에 검은색 칠하기
	if( QuestInfo->GetType() == QUEST_INFO_MONSTER_KILL)
	{
		if(m_quest_status.current_point < QuestInfo->GetGoal() || QuestInfo->GetID() != SECOND_PET_QUEST)
		{
			if(!GetAttributes()->alpha)
			{
				RECT rect = {x+34+tab_x, y+38+tab_y, x+34+95+tab_x, y+38+gpC_global_resource->m_pC_info_spk->GetHeight(sprite_bar)+tab_y };
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
				
				rect.top += 35;
				rect.bottom += 35;
				gpC_base->m_p_DDSurface_back->FillRect(&rect, 0);
			}
			
			if(gpC_base->m_p_DDSurface_back->Lock())
			{
				Rect rect;
				
				switch(g_eRaceInterface)
				{
				case RACE_SLAYER:
					{
						int bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(sprite_back);
						int bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(sprite_back);
						
						rect.Set(0, 0, 61, bar_height);
						gpC_global_resource->m_pC_info_spk->BltLockedClip( x+20+tab_x,y+35+tab_y,rect,sprite_back);
						rect.Set(bar_width-61, 0, bar_width, bar_height);
						gpC_global_resource->m_pC_info_spk->BltLockedClip( x+20-60+tab_x,y+35+tab_y,rect,sprite_back);
						rect.Set(0, 0, 61, bar_height);
						gpC_global_resource->m_pC_info_spk->BltLockedClip( x+20+tab_x,y+70+tab_y,rect,sprite_back);
						rect.Set(bar_width-61, 0, bar_width, bar_height);
						gpC_global_resource->m_pC_info_spk->BltLockedClip( x+20-60+tab_x,y+70+tab_y,rect,sprite_back);
					}
					break;

				case RACE_VAMPIRE:
					{
						int bar_width = gpC_global_resource->m_pC_info_spk->GetWidth(sprite_back);
						int bar_height = gpC_global_resource->m_pC_info_spk->GetHeight(sprite_back);
						
						rect.Set(0, 0, 66, bar_height);
						gpC_global_resource->m_pC_info_spk->BltLockedClip( x+15+tab_x,y+35+tab_y,rect,sprite_back);
						rect.Set(bar_width-66, 0, bar_width, bar_height);
						gpC_global_resource->m_pC_info_spk->BltLockedClip( x+15-60+tab_x,y+35+tab_y,rect,sprite_back);
						
						rect.Set(0, 0, 66, bar_height);
						gpC_global_resource->m_pC_info_spk->BltLockedClip( x+15+tab_x,y+70+tab_y,rect,sprite_back);
						rect.Set(bar_width-66, 0, bar_width, bar_height);
						gpC_global_resource->m_pC_info_spk->BltLockedClip( x+15-60+tab_x,y+70+tab_y,rect,sprite_back);
					}
					break;

				case RACE_OUSTERS:
					break;
				}
				int bar_width = 94;
				int bar_x = 34;
				int rate = bar_width * m_quest_status.current_point / QuestInfo->GetGoal();			
				
				rect.Set(0, 0, max(0,min(bar_width,rate)), 10);
				gpC_global_resource->m_pC_info_spk->BltLockedClip(x+bar_x+tab_x, y+38+tab_y, rect, sprite_bar);
				
				if( QuestInfo->GetTimeLimit() > 0 )
				{
					rate = bar_width * (QuestInfo->GetTimeLimit()-(m_quest_status.quest_time-timeGetTime()/1000)) / QuestInfo->GetTimeLimit();//;
					
					rect.Set(0, 0, max(0,min(bar_width,rate)), 10);
					gpC_global_resource->m_pC_info_spk->BltLockedClip(x+bar_x+tab_x, y+73+tab_y, rect, sprite_bar);			
				}
			}		
			gpC_base->m_p_DDSurface_back->Unlock();
		}
	}

	if(gpC_base->m_p_DDSurface_back->Lock())
	{			
		m_pC_button_group->Show();
		gpC_base->m_p_DDSurface_back->Unlock();
	}
		
		
	if(g_FL2_GetDC())
	{
		char sz_temp[100] = {0,};		

		if(SECOND_PET_QUEST == QuestInfo->GetID())
		{
			switch(g_eRaceInterface)
			{
			case RACE_SLAYER:
				sprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_PET_QUEST_SLAYER].GetString(),QuestInfo->GetTimeLimit()/60, QuestInfo->GetName(), QuestInfo->GetGoal());
				break;
			case RACE_VAMPIRE:
				sprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_PET_QUEST_VAMPIRE].GetString(),QuestInfo->GetTimeLimit()/60, QuestInfo->GetName(), QuestInfo->GetGoal());
				break;
			case RACE_OUSTERS:
				sprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_PET_QUEST_OUSTERS].GetString(),QuestInfo->GetTimeLimit()/60, QuestInfo->GetName(), QuestInfo->GetGoal());
				break;
			}
			ShowDesc( x+20,y+20, sz_temp );
		}
		else if( m_quest_status.Title != NULL )
			ShowDesc( x+20,y+20, m_quest_status.Title );

		int time_check = Timer();
	
		// 타이틀 찍히는 부분
		COLORREF ColorTitle = RGB_WHITE, BackTitle = RGB_BLACK;

		if( QuestInfo->GetType() == QUEST_INFO_TYPE_NULL || !m_bl_active )
		{
			//퀘스트중이 아닐때
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_IN_QUEST].GetString() );
		} else
		{
			// 퀘스트 중이면 시간이 다 되었거나, 완료 되었거나, 진행중
			if( m_quest_status.quest_time <= timeGetTime()/1000 && QuestInfo->GetType() == QUEST_INFO_MONSTER_KILL)
			{
				//퀘스트 실패
				if( time_check )
				{
					if( (time_check)/500&0x1)
					{
						ColorTitle = RGB(255,255,60);
						BackTitle = RGB(150,150,60);
					}					
				}
				wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_FAIL_QUEST].GetString() );
			} else
			if( m_quest_status.current_point >= QuestInfo->GetGoal() && QuestInfo->GetType() == QUEST_INFO_MONSTER_KILL) 
			{
				// 목표 달성
				if( time_check )
				{
					if( (time_check)/500&0x1)
					{
						ColorTitle = RGB(148,255,255);
						BackTitle = RGB(24,146,247);
					}				
				}
				wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_COMPLETE_QUEST].GetString() );
				if(SECOND_PET_QUEST == QuestInfo->GetID())
				{// 2차펫 퀘스트 목표 달성 했을 때
					g_PrintColorStrOut( x+20+tab_x, y+20+tab_y, sz_temp, gpC_base->m_chatting_pi, ColorTitle, BackTitle);		
					char* szNpc;
					switch(g_eRaceInterface)
					{
					case RACE_SLAYER:
						szNpc = (*g_pGameStringTable)[UI_STRING_MESSAGE_PET_QUEST_NPC_SLAYER].GetString();
						break;
					case RACE_VAMPIRE:
						szNpc = (*g_pGameStringTable)[UI_STRING_MESSAGE_PET_QUEST_NPC_VAMPIRE].GetString();
						break;
					case RACE_OUSTERS:
						szNpc = (*g_pGameStringTable)[UI_STRING_MESSAGE_PET_QUEST_NPC_OUSTERS].GetString();
						break;
					}
					wsprintf(sz_temp, "[%s]",szNpc );
					g_PrintColorStrOut( x+20+tab_x, y+40+tab_y, sz_temp, gpC_base->m_chatting_pi, ColorTitle, BackTitle);		
					g_PrintColorStrOut( x+20+tab_x, y+60+tab_y, (*g_pGameStringTable)[UI_STRING_MESSAGE_PET_QUEST_CLEAR].GetString(), gpC_base->m_chatting_pi, ColorTitle, BackTitle);		
					m_pC_button_group->ShowDescription();
					g_FL2_ReleaseDC();
					return;
				}
			} else
			{
				// 퀘스트 진행중
				switch(QuestInfo->GetType())
				{
				case QUEST_INFO_MONSTER_KILL:
					wsprintf(sz_temp, "%s", QuestInfo->GetName());
					break;

				case QUEST_INFO_MEET_NPC:
					wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_MEET_NPC].GetString());
					break;

				case QUEST_INFO_GATHER_ITEM:
					wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_GATHER_ITEM].GetString());					
					break;					
				}
			}		
		}
		g_PrintColorStrOut( x+20+tab_x, y+20+tab_y, sz_temp, gpC_base->m_chatting_pi, ColorTitle, BackTitle);		
		
		if( QuestInfo->GetTimeLimit() && QuestInfo->GetType() == QUEST_INFO_MONSTER_KILL)
		{
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_STATUS_LEFT_TIME].GetString());
			g_PrintColorStrOut( x+20+tab_x, y+55+tab_y, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
		}
		// 타이틀 게이지 쪽에 출력되는 부분
		ColorTitle = RGB_WHITE;
		BackTitle = RGB_BLACK;
		if( m_bl_active )
		{
			switch(QuestInfo->GetType())
			{
			case QUEST_INFO_MONSTER_KILL:
				wsprintf(sz_temp, "%d/%d", min(m_quest_status.current_point,QuestInfo->GetGoal()), QuestInfo->GetGoal());
			
				if(time_check)
				{
					if( m_quest_status.current_point <= QuestInfo->GetGoal() && ((time_check) / 500)&0x1 )
					{
						ColorTitle = RGB(40,238,70);
						BackTitle = RGB(14,169,37);
					}				
				}				
				break;

			case QUEST_INFO_MEET_NPC:
				if(m_quest_status.current_point == 0)
					wsprintf(sz_temp, "완료되었습니다");
				else
					wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_MEET_NPC].GetString(), (*g_pCreatureTable)[m_quest_status.current_point].Name.GetString());
				break;

			case QUEST_INFO_GATHER_ITEM:
				if( QuestInfo->GetItemType() == 999 )
					wsprintf(sz_temp,"%s",QuestInfo->GetName());
				else
					wsprintf(sz_temp,"%s",(*g_pItemTable)[QuestInfo->GetItemClass()][QuestInfo->GetItemType()].HName.GetString() );
				break;
			
			case QUEST_INFO_MINI_GAME :
//				if( m_quest_status.current_point > 0 )
//				{
//					wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_SUCCESS_MINIGAME].GetString() );
//				} else
				{
					if( QuestInfo->GetGameType() == MINI_GAME_TYPE_MINE )
						wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_STATUS_CRAZY_MINE].GetString());
					else if (QuestInfo->GetGameType() == MINI_GAME_TYPE_ARROW )
						wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_STATUS_ARROW_TILES].GetString());
					else
						wsprintf(sz_temp,"알 수 없음");
				}
				break;
			}

			g_PrintColorStrOut( x+83-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2+tab_x,
										y+38+tab_y, sz_temp, gpC_base->m_chatting_pi, ColorTitle, BackTitle);
		}

		ColorTitle = RGB_WHITE;
		BackTitle = RGB_BLACK;

		// 시간 표시
		//if( QuestInfo.GetType() != QUEST_INFO_TYPE_NULL && m_bl_active && QuestInfo.GetTimeLimit() ) 
		if( QuestInfo->GetTimeLimit() > 0 && QuestInfo->GetType() == QUEST_INFO_MONSTER_KILL )
		{				
			if( m_quest_status.quest_time > timeGetTime()/1000)	
			{
				char temp_str[100];
				DWORD remain_time = m_quest_status.quest_time - timeGetTime()/1000;
				int hour = remain_time / 3600;
				int minute = (remain_time/60) % 60;
				int second = remain_time % 60;
				bool		bContinue = false;			
				memset( sz_temp, 0 ,sizeof( sz_temp ) );			
				if(hour)
				{
					wsprintf(temp_str, (*g_pGameStringTable)[UI_STRING_MESSAGE_HOUR].GetString(), hour);
					strcat(sz_temp, temp_str);
					wsprintf(temp_str, " ");
					strcat(sz_temp, temp_str);
					bContinue = true;
				}
				if(minute || bContinue)
				{
					wsprintf(temp_str, (*g_pGameStringTable)[UI_STRING_MESSAGE_MINUTE].GetString(), minute);
					strcat(sz_temp, temp_str);
					wsprintf(temp_str, " ");
					strcat(sz_temp, temp_str);
					bContinue = true;
				}
				if(!hour)  
				{
					wsprintf(temp_str, (*g_pGameStringTable)[UI_STRING_MESSAGE_SECOND].GetString(), second);
					strcat(sz_temp, temp_str);
				}
				g_PrintColorStrOut( x+83-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2+tab_x,
					y+73+tab_y, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
			}
			else 
			{
				//제한 시간 초과
				wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_FAIL_TIME_OVER_QUEST].GetString());
				Timer2(6000);
				time_check = Timer2();

				switch(g_eRaceInterface)
				{
				case RACE_SLAYER:
					ColorTitle = RGB_RED;
					BackTitle = RGB_BLACK;
					break;

				case RACE_VAMPIRE:
					ColorTitle = RGB_WHITE;
					BackTitle = RGB_BLACK;
					break;

				case RACE_OUSTERS:
					ColorTitle = RGB_WHITE;
					BackTitle = RGB_BLACK;
					break;					
				}					

				g_PrintColorStrOut( x+83-g_GetStringWidth(sz_temp, gpC_base->m_chatting_pi.hfont)/2 +tab_x, 
					y+73+tab_y, sz_temp, gpC_base->m_chatting_pi, ColorTitle, BackTitle);
			}
		}
	
		m_pC_button_group->ShowDescription();
		g_FL2_ReleaseDC();
	}	
	m_bl_focus = false;
}

void	C_VS_UI_QUEST_STATUS::ShowDesc(int strX,int strY,const char *str)
{
	int vx = strX;
	int py = strY;
	int linenum = 0;
	int next=0;
	const int char_width = g_GetStringWidth("a", gpC_base->m_dialog_msg_pi.hfont);
	const int print_gap = 14;

	std::string sstr = str;
	char sz_string[512] = {0,};
	while(sstr.size() > next)
	{
		if(sstr.size() - next > 2048)
		{
			memcpy(sz_string,sstr.c_str()+next,2047);
			sz_string[2047] = '\0';
		}
		else
			strcpy(sz_string, sstr.c_str()+next);
		
		char *sz_string2 = sz_string;
		
		while(*sz_string2 == ' ')		// 앞의 공백제거
		{
			sz_string2++;
			next++;
		}
		
		int cut_pos = (x+w -vx)/char_width;			
		
		if(!g_PossibleStringCut(sz_string2, cut_pos))
			cut_pos--;
		sz_string2[cut_pos] = NULL;
		
		char *return_char = NULL;
		if((return_char = strstr(sz_string2, "\\n")) != NULL)	// return 처리
		{
			cut_pos = return_char - sz_string2+2;
			sz_string2[cut_pos-2] = NULL;
		}
		
		//g_PrintColorStr(vx, py, sz_string2, gpC_base->m_dialog_msg_pi, RGB_WHITE);
		if(linenum == 0 && str != (*g_pGameStringTable)[UI_STRING_MESSAGE_NOT_IN_QUEST2].GetString() )
			g_PrintColorStrOut( vx,py, sz_string2, gpC_base->m_chatting_pi, RGB_YELLOW, RGB_BLACK);
		else
			g_PrintColorStrOut( vx,py, sz_string2, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
		next += cut_pos;
		vx = strX;
		py += print_gap;
		linenum++;
	}
}


bool	C_VS_UI_QUEST_STATUS::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);

	_x-=x; _y-=y;
	bool re = m_pC_button_group->MouseControl(message, _x, _y);

	static char sz_temp[256];	

	Rect rt(x+15, y+17, 139, 60);
	m_bl_focus = false;

	switch(message)
	{
	case M_MOVING:
		{
			if( !m_bl_active ) break;
			
			Point pt(x+_x,y+_y);
			if( rt.IsInRect(pt) && (m_quest_status.QuestID == 57 || m_quest_status.QuestID == 72 || m_quest_status.QuestID == 87))
			{
				m_bl_focus = true;				
				g_descriptor_manager.Set(DID_INFO, _x+x,_y+y, (void *)(*g_pGameStringTable)[UI_STRING_MESSAGE_CLICK_TO_SHOW_DETIAL].GetString(),0,0);
			}
			ShowQuestDescription(_x,_y);
		}
		break;
	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		{
			Point pt(x+_x,y+_y);
			if( rt.IsInRect(pt) )
				m_bl_focus = true;

			if( m_bl_focus )
			{
				Run(DETAIL_ID);
			}

			MoveReady();
			SetOrigin(_x, _y);
			break;
		}
		break;
	}	
	return true;
}

void	C_VS_UI_QUEST_STATUS::KeyboardControl(UINT message, UINT key, long extra)	
{	
	if (message == WM_KEYDOWN)
	{
		switch (key)
		{		
		case VK_ESCAPE :
			gpC_base->SendMessage(UI_CLOSE_QUEST_STATUS);
			break;		
		}
	}
}

bool	C_VS_UI_QUEST_STATUS::IsPixel(int _x,int _y)
{
	return IsInRect(_x, _y);
}

void	C_VS_UI_QUEST_STATUS::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(p_button->GetID() == ALPHA_ID)
	{
	#if __CONTENTS(__080405_FIREST_UI_UPDATE)
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_NEW);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED_NEW);
	#else
		if(GetAttributes()->alpha)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_ALPHA_PUSHED);
	#endif //__080405_FIREST_UI_UPDATE
	} else
	if(p_button->GetID() == PUSHPIN_ID)
	{
		if(GetAttributes()->autohide)
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN);
		else
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(p_button->x+x, p_button->y+y, C_GLOBAL_RESOURCE::AB_BUTTON_PUSHPIN_PUSHED);
		
	} else
	if(p_button->GetID() == CLOSE_ID)
	{
		gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x-5, y+p_button->y-5, C_GLOBAL_RESOURCE::BUTTON_CLOSE_BACK);
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+3);
			else
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+2);
		}
		else
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index+1);
			else
				gpC_global_resource->m_pC_info_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
		}

	}
	else
	{
		if(p_button->GetFocusState())
		{
			if(p_button->GetPressState())
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+p_button->y, C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION_PUSHED);
			else
				gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+p_button->y, C_GLOBAL_RESOURCE::AB_BUTTON_QUESTION_HILIGHTED);
		}
		else
		{
			gpC_global_resource->m_pC_assemble_box_button_spk->BltLocked(x+p_button->x, y+p_button->y, p_button->m_image_index);
		}
	}
}

void	C_VS_UI_QUEST_STATUS::ShowButtonDescription(C_VS_UI_EVENT_BUTTON *p_button)
{
	char* m_other_info_button_string[7]=
	{
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_HELP].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_CLOSE_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_SHOW_NO_ALPHA_WINDOW].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_OFF].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_AUTO_HIDE_ON].GetString(),
		(*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_RUN].GetString(),
	};

	switch(p_button->GetID())
	{
	case PUSHPIN_ID :
		if(GetAttributes()->autohide)
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[4],0,0);
		else
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[5],0,0);
		break;

	case CLOSE_ID :
#if __CONTENTS(__QUEST_RENEWAL)	//C_VS_UI_QUEST_STATUS::ShowButtonDescription		g_descriptor_manager.Set;
		QUEST_INFO *QuestInfo;
		QuestInfo	= NULL;
		QuestInfo = g_pQuestInfoManager->GetInfo( m_quest_status.QuestID );

		if(!QuestInfo)
		{
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[2],0,0);
			return;
		}
		if( QuestInfo->GetType() != QUEST_INFO_TYPE_NULL || m_bl_active )
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[6],0,0);
		else
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[2],0,0);
			
#else
		g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[2],0,0);
#endif	//
		break;

	case ALPHA_ID :
		if(GetAttributes()->alpha)
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[3],0,0);
		else
			g_descriptor_manager.Set(DID_INFO, p_button->x+x, p_button->y+y, (void *)m_other_info_button_string[0],0,0);
		break;
	}	
}

void	C_VS_UI_QUEST_STATUS::ShowQuestDescription(int _x, int _y)
{		
	const int tab_x = 0;
	const int tab_y = 60;

	static char temp_str[3][100];
	
	static LPSTR str[3] = { 
		temp_str[0],
		temp_str[1],
		temp_str[2],
	};

	str[0] = temp_str[0];
	str[1] = temp_str[1];
	str[2] = temp_str[2];

	Rect rect;
	Point point(_x+x,_y+y);	
	
	// 타이틀 게이지
	rect.Set(x+tab_x,y+38+tab_y,128,10);	
	if(rect.IsInRect(point))
	{
		
		QUEST_INFO* QuestInfo = g_pQuestInfoManager->GetInfo( m_quest_status.QuestID );
		if(NULL == QuestInfo)
			return;
		if( QuestInfo->GetType() != QUEST_INFO_MONSTER_KILL)
			return;
		switch(QuestInfo->GetType())
		{
		case QUEST_INFO_MONSTER_KILL:
			// 몬스터 사냥 퀘스트
			// %s (%d/%d)
			wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_MONSTER_KILL].GetString());
			if( m_quest_status.quest_time < timeGetTime()/1000)	
			{
				wsprintf(temp_str[1], (*g_pGameStringTable)[UI_STRING_MESSAGE_FAIL_TIME_OVER_QUEST].GetString());				
			} else
			if( m_quest_status.current_point >= QuestInfo->GetGoal() )
			{
				wsprintf(temp_str[1], (*g_pGameStringTable)[UI_STRING_MESSAGE_COMPLETE_QUEST].GetString());
			}
			else
				wsprintf(temp_str[1], "%s (%d/%d)", QuestInfo->GetName(), min(m_quest_status.current_point,QuestInfo->GetGoal()), QuestInfo->GetGoal());					
			break;
		case QUEST_INFO_MEET_NPC :
			// NPC 만나기 퀘스트
			// %s
			wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_MEET_NPC].GetString());
			wsprintf(temp_str[1], "%s", (*g_pCreatureTable)[QuestInfo->GetCreatureType()].Name.GetString());
			break;
		case QUEST_INFO_GATHER_ITEM :
			// 아이템 구하기 퀘스트
			// %s
			wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_GATHER_ITEM].GetString());
			wsprintf(temp_str[1], "%s", QuestInfo->GetName());				
			break;
		
		}
		
		str[0] = temp_str[0];
		str[1] = temp_str[1];
		str[2] = NULL;
		g_descriptor_manager.Set(DID_STRINGS, _x+x, _y+y, (void *)str, 2);
	}
	//시간 게이지
	rect.Set(x+tab_x,y+73+tab_y,128,10);
	if(rect.IsInRect(point))
	{
		// 총 제한시간 : %d
		// 경 과 시 간 : %d
		// 남 은 시 간 : %d
		
		QUEST_INFO* QuestInfo = g_pQuestInfoManager->GetInfo( m_quest_status.QuestID );	
		if( NULL == QuestInfo)
			return;

		if( QuestInfo->GetType() != QUEST_INFO_MONSTER_KILL)
			return;

		
		char sz_temp[30];
		int hour, minute, second;
		
		DWORD time_table[3];
		time_table[0] = QuestInfo->GetTimeLimit();
		time_table[1] = QuestInfo->GetTimeLimit() - (m_quest_status.quest_time - timeGetTime()/1000);
		time_table[2] = m_quest_status.quest_time - timeGetTime()/1000;
		
		wsprintf(temp_str[0], (*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_DESCRIPTION_TIME_TOTAL]);
		wsprintf(temp_str[1], (*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_DESCRIPTION_TIME_ELAPSE]);
		wsprintf(temp_str[2], (*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_DESCRIPTION_TIME_REMAIN]);
		
		for(int i=0; i<3; i++)
		{
			if( m_quest_status.quest_time < timeGetTime()/1000 )
			{
				if(i ==1)
				{
					wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_FAIL_TIME_OVER_QUEST].GetString());
					strcat(temp_str[i], sz_temp);
					continue;
				}
				else if(i == 2)
				{
					wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_QUEST_DESCRIPTION_TIME_NO_REMAIN]);
					strcat(temp_str[i], sz_temp);
					continue;
				}
			}					
			
			hour = time_table[i] / 3600;
			minute = (time_table[i]/60) % 60;
			second = time_table[i] % 60;
			
			if(hour)
			{
				wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_HOUR].GetString(), hour);
				strcat(temp_str[i], sz_temp);
				wsprintf(sz_temp, " ");
				strcat(temp_str[i], sz_temp);
			}
			if(minute)
			{
				wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_MINUTE].GetString(), minute);
				strcat(temp_str[i], sz_temp);
				wsprintf(sz_temp, " ");
				strcat(temp_str[i], sz_temp);				
			}
			if(!hour && second)
			{
				wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_SECOND].GetString(), second);
				strcat(temp_str[i], sz_temp);
			}
		}
		
		str[0] = temp_str[0];
		str[1] = temp_str[1];
		str[2] = temp_str[2];
		
		g_descriptor_manager.Set(DID_STRINGS, _x+x, _y+y, (void *)str, 3);
	}
	
}

void	C_VS_UI_QUEST_STATUS::WindowEventReceiver(id_t event)
{
}

std::string C_VS_UI_QUEST_STATUS::GetDetailInfo()
{
	switch( g_eRaceInterface )
	{
	case RACE_SLAYER :
		{
			int sum = g_char_slot_ingame.STR_PURE + g_char_slot_ingame.DEX_PURE + g_char_slot_ingame.INT_PURE -
				(*g_pSkillManager)[SKILLDOMAIN_HEAL].GetDomainLevel() - (*g_pSkillManager)[SKILLDOMAIN_ENCHANT].GetDomainLevel();				
			if(sum >=10&& sum <= 60)
			{
				return m_hard_cording[0].c_str();
			} 
			else if(sum >=61&& sum <= 95)
			{
				return m_hard_cording[1].c_str();
			}
			else if(sum >=96&& sum <= 130)
			{
				return m_hard_cording[2].c_str();
			}
			else if(sum >=131&& sum <= 170)
			{
				return m_hard_cording[4].c_str();
			}
			else if(sum >=171&& sum <= 210)
			{
				return m_hard_cording[5].c_str();
			}
			else if(sum >=211&& sum <= 240)
			{
				return ( m_hard_cording[5] +", "+ m_hard_cording[6]).c_str();
			}
			else if(sum >=241&& sum <= 270)
			{
				return (m_hard_cording[6] + ", "+m_hard_cording[7]).c_str();
			}
			else if(sum >=271&& sum <= 290)
			{
				return (m_hard_cording[7]+ ", " +m_hard_cording[8]).c_str();
			}
			else if(sum >=291&& sum <= 300)
			{
				return m_hard_cording[9].c_str();
			}
			else if(sum >= 301)
			{
				return (m_hard_cording[10] + ", " +m_hard_cording[11]).c_str();
			}
		}
		break;
	case RACE_VAMPIRE :
		{			
			if(g_char_slot_ingame.level >= 1&&g_char_slot_ingame.level <=10	)
			{
				return m_hard_cording[0].c_str();
			} else if(g_char_slot_ingame.level >=	11&&g_char_slot_ingame.level <= 20	)
			{
				return m_hard_cording[1].c_str();
			} else if(g_char_slot_ingame.level >=	21&&g_char_slot_ingame.level <= 30	)
				{
				return m_hard_cording[2].c_str();
			} else if(g_char_slot_ingame.level >=	31&&g_char_slot_ingame.level <= 40	)
			{
				return m_hard_cording[4].c_str();
			} else if(g_char_slot_ingame.level >=	41&&g_char_slot_ingame.level <= 50)
			{
				return (m_hard_cording[6]+ ", " + m_hard_cording[7]).c_str();
			} else if(g_char_slot_ingame.level >=	51&&g_char_slot_ingame.level <= 60	)
			{
				return (m_hard_cording[7]+", "+m_hard_cording[8]).c_str();
			} else if(g_char_slot_ingame.level >=	61&&g_char_slot_ingame.level <= 70	)
												{
				return (m_hard_cording[7] + ", " + m_hard_cording[8]).c_str();
			} else if(g_char_slot_ingame.level >=	71&&g_char_slot_ingame.level <= 80	)
			{
				return m_hard_cording[9].c_str();
			} else if(g_char_slot_ingame.level >=	81&&g_char_slot_ingame.level <= 90	)
			{
				return m_hard_cording[10].c_str();
			} else 	
				return m_hard_cording[11].c_str();
		}
		break;
	case RACE_OUSTERS :
		{
			if( g_char_slot_ingame.level >=1&& g_char_slot_ingame.level <=10	)
			{
				return m_hard_cording[0].c_str();
			}
			else if (g_char_slot_ingame.level >= 	11&& g_char_slot_ingame.level <= 20	)
			{
				return m_hard_cording[1].c_str();
			}
			else  if (g_char_slot_ingame.level >= 	21&& g_char_slot_ingame.level <= 30	)
			{
				return m_hard_cording[2].c_str();
			}
			else  if (g_char_slot_ingame.level >= 	31&& g_char_slot_ingame.level <= 40	)
			{
				return m_hard_cording[4].c_str();
			}
			else  if (g_char_slot_ingame.level >= 	41&& g_char_slot_ingame.level <= 50	)
			{
				return m_hard_cording[5].c_str();
			}
			else  if (g_char_slot_ingame.level >= 	51&& g_char_slot_ingame.level <= 60	)
			{
				return (m_hard_cording[5]+ ", "+m_hard_cording[6]).c_str();
			}
			else  if (g_char_slot_ingame.level >= 	61&& g_char_slot_ingame.level <= 70	)
			{
				return (m_hard_cording[6]+ ", "+m_hard_cording[7]).c_str();
			}
			else  if (g_char_slot_ingame.level >= 	71&& g_char_slot_ingame.level <= 80	)
			{
				return (m_hard_cording[7] + ", " + m_hard_cording[8]).c_str();
			}
			else  if (g_char_slot_ingame.level >= 	81&& g_char_slot_ingame.level <= 90	)
			{
				return m_hard_cording[9].c_str();
			}
			else 
				return (m_hard_cording[10]+ ", "+m_hard_cording[11]).c_str();	
		}
		break;
	}
	return "";
}

void	C_VS_UI_QUEST_STATUS::Run(id_t id)
{
	switch (id)
	{
	case CLOSE_ID:

#if __CONTENTS(__QUEST_RENEWAL)	//C_VS_UI_QUEST_STATUS::Run		Finish();
		QUEST_INFO *QuestInfo;
		QuestInfo	= NULL;
		QuestInfo	= g_pQuestInfoManager->GetInfo( m_quest_status.QuestID );
		
		if(!QuestInfo)
		{
			Finish();	// 종료 버튼 클릭시 종료가 되게 하더니 왜 퀘스트 목록을 보여주는지 모르겠다.
			return;
		}
		
		if( QuestInfo->GetType() == QUEST_INFO_TYPE_NULL || !m_bl_active )
			Finish();	// 종료 버튼 클릭시 종료가 되게 하더니 왜 퀘스트 목록을 보여주는지 모르겠다.
		else
			gC_vs_ui.HotKey_Quest();
		
#else
//		Finish();
		gC_vs_ui.HotKey_Quest();
		break;
#endif
		
	case ALPHA_ID:
		AttrAlpha(!GetAttributes()->alpha);
		EMPTY_MOVE;
		break;
		
	case PUSHPIN_ID :
		if(GetAttributes()->autohide)
			AttrAutoHide(ATTRIBUTES_HIDE_NOT);
		else
		{
			AttrAutoHide(ATTRIBUTES_HIDE_WIDTH);
		}		
		break;
	case DETAIL_ID :
		if( m_quest_status.QuestID == 57 || m_quest_status.QuestID == 72 || m_quest_status.QuestID ==  87 )
		{
			// 5단계 퀘스트일경우에만
			std::string		detail_info = "몬스터 : ";
			detail_info+=GetDetailInfo();
			
			gC_vs_ui.RunPopupMessage( detail_info.c_str(), C_VS_UI_POPUP_MESSAGE::POPUP_MINI_WINDOW);
		}
		break;		
	}
}

void	C_VS_UI_QUEST_STATUS::Process()
{
	m_pC_button_group->Process();
	ProcessHide();
}

void	C_VS_UI_QUEST_STATUS::ToggleWindow()
{
	if(GetAttributes()->autohide) Run(PUSHPIN_ID);	
}

int		C_VS_UI_QUEST_STATUS::Timer( int timer )
{
	DWORD current_time = timeGetTime();

	if( timer > 0 )
	{
		// 타이머를 세팅해준다.
		m_timer = current_time + timer;
	}

	int result = 0;
	
	if( m_timer < current_time )
	{
		result = -1;
	} else
	{
		result = m_timer - current_time;
	}

	return result;
}

int		C_VS_UI_QUEST_STATUS::Timer2( int timer )
{
	DWORD current_time = timeGetTime();

	if( timer > 0 && m_bl_timeover == false)
	{
		// 타이머를 세팅해준다.
		Timer(4000);
		m_timer2 =  current_time + timer;
		m_bl_timeover = true;
	}

	int result = 0;
	
	if( m_timer2 < current_time )
	{
		result = -1;
	} else
	{
		result = m_timer2 - current_time;
	}

	if(m_bl_timeover)
	{
		if( current_time > m_timer2)
		{
			if( current_time - m_timer2 > 10000)
				SetQuestStatusInit();
		}
	}

	return result;
}



//------------------------------------------------------------------------------
// C_VS_UI_LOTTERY_CARD
//
// 복권
//------------------------------------------------------------------------------

class EventGiftInfo
{
public :
	EventGiftInfo() { m_bActive = 1; m_Step = 1; m_Name = "";}
	~EventGiftInfo(){}
	void LoadFromFile(ivfstream &file)	{ file.read((char*)&m_ID, sizeof(DWORD) );file.read((char*)&m_bActive, sizeof(char) );		file.read((char*)&m_Step, sizeof( DWORD ) );		m_Name.LoadFromFile( file );	}
	void SaveToFile(std::ofstream &file)	{ file.write((const char*)&m_ID, sizeof(DWORD) );file.write((const char*)&m_bActive, sizeof(char) );		file.write((const char*)&m_Step, sizeof( int ) );		m_Name.SaveToFile( file );	}
	char	m_bActive;	DWORD		m_Step;	MString	m_Name; DWORD m_ID;
};
typedef CTypeTable<EventGiftInfo> CEventGiftInfo;

C_VS_UI_LOTTERY_CARD::C_VS_UI_LOTTERY_CARD( int step)
{	
	g_RegisterWindow(this);	

	m_pC_lottery_spk = NULL;
	m_pC_lottery_spk = new C_SPRITE_PACK(SPK_LOTTERY_CARD);

	if( step != -1 && step <=5 )
	{
		LoadInfo( step );
	}

	int window_w = m_pC_lottery_spk->GetWidth(BACK);
	int window_h = 98+19*m_GiftList.size()+27;
	
	//Set(RESOLUTION_X/2-window_w/2, RESOLUTION_Y/2 - window_h/2, window_w, window_h);
	Set(g_pUserInformation->iResolution_x/2-window_w/2, g_pUserInformation->iResolution_y/2 - window_h/2, window_w, window_h);
	
	//공통버튼
	m_pC_button_group = new ButtonGroup(this);

	m_pC_button_group->Add(new C_VS_UI_EVENT_BUTTON(141, 99+(19*5), m_pC_lottery_spk->GetWidth(LOTTERY_READY),
		m_pC_lottery_spk->GetHeight(LOTTERY_READY), BUTTON_ID, this, LOTTERY_READY));

	//라디오 버튼
	m_pC_radio_group = new ButtonGroup(this);

	for(int i=0; i<m_GiftList.size(); i++)
	{
		m_pC_radio_group->Add(new C_VS_UI_EVENT_BUTTON(x+20, y+102+(19*i), m_pC_lottery_spk->GetWidth(RADIO_BACK),
			m_pC_lottery_spk->GetHeight(RADIO_BACK), RADIO1+i, this, RADIO_BACK));
	}

	// 서페이스 생성
	CSpritePack	coverSPK;
	coverSPK.Init( 1 );	
	bool re = coverSPK.LoadFromFileData( 0, COVER, SPK_LOTTERY_CARD, SPKI_LOTTERY_CARD );
	
//	assert(re && "Lottery Cover Not Load"); // <- warning C4305 때문에 
	if(re==0)
	{
		MessageBox(NULL, "Error-String-2008.08.22-3:22", "LOTTERY COVER NOT LOAD", MB_OK);
	}

	if(re)
	{
		POINT point = {0, 0};
		
		m_p_cover_surface = new CSpriteSurface;
		m_p_cover_surface->InitOffsurface(coverSPK[0].GetWidth(), coverSPK[0].GetHeight(), DDSCAPS_SYSTEMMEMORY);
		m_p_cover_surface->SetTransparency(0xffff);
		
		m_p_cover_surface->Lock();
		m_p_cover_surface->BltSprite(&point, &coverSPK[0]);
		m_p_cover_surface->Unlock();
	}
	coverSPK.Release();

	m_Type = LOTTERY_TYPE_READY;
	m_radio_select = 1;	
	m_line_select = -1;
	m_backimage[0] = -1;
	m_backimage[1] = -1;
	m_backimage[2] = -1;
	m_step = step;
	m_bl_press = false;
	m_bl_result = false;
}

void C_VS_UI_LOTTERY_CARD::LoadInfo(int &step)
{
	std::map<DWORD, int> GiftImage;

	GiftImage[11] = GIFT_TICKET_1;
	GiftImage[12] = DARKEDEN_PENDANT;
	GiftImage[13] = DARKEDEN_TSHIRTS;
	GiftImage[14] = DARKEDEN_TICKET_1;

	GiftImage[21] = INLINE_SKATE;
	GiftImage[22] = HEELYS;
	GiftImage[23] = DVD_PLAYER;	
	GiftImage[24] = SPEAKER;
	GiftImage[25] = GIFT_TICKET_2;

	GiftImage[31] = WATCH;
	GiftImage[32] = IRIVER_395;//DVD_COMBO;
	GiftImage[33] = CAMCORDER;
	GiftImage[34] = CAMERA;
	GiftImage[35] = GIFT_TICKET_3;

	GiftImage[41] = HOME_THEATER;
	GiftImage[42] = REFRIGERATOR;
	GiftImage[43] = FLAT_TV;
	GiftImage[44] = TFT_MONITOR;
	GiftImage[45] = COMPUTER;

	GiftImage[51] = DIGITAL_TV;
	GiftImage[52] = DARKEDEN_TICKET_2;

	CEventGiftInfo *Event = new CEventGiftInfo;
	ivfstream info("data\\info\\EventQuest.inf", std::ios::binary );
	Event->LoadFromFile ( info );
	info.close();		
	
	for(int i=0;i<Event->GetSize();i++)
	{
		if ( (*Event)[i].m_Step == step )
		{
			GiftInfo* gi = new GiftInfo;
			
			gi->Active = (*Event)[i].m_bActive == TRUE;
			gi->id = (*Event)[i].m_ID;
			gi->name = (*Event)[i].m_Name.GetString();
			gi->image = GiftImage [ gi->id ];

			
	//		if(gi->image < 0) // <- warning C4305 때문에 
	//			assert( 0 );
			
			if(gi->image < 0)
			{
				MessageBox(NULL, "Error-String-2008.08.22-3:25", "LOTTERY COVER NOT LOAD", MB_OK);
			}

			m_GiftList.push_back( gi );
		}
	}
	delete Event;
}

C_VS_UI_LOTTERY_CARD::~C_VS_UI_LOTTERY_CARD()
{
	ClearGiftList();
	DeleteNew(m_pC_button_group);
	DeleteNew(m_pC_radio_group);
	DeleteNew(m_pC_lottery_spk);
	DeleteNew(m_p_cover_surface);	
}

void	C_VS_UI_LOTTERY_CARD::Start()
{
	PI_Processor::Start();
	gpC_window_manager->AppearWindow(this);
	m_pC_button_group->Init();
	m_pC_radio_group->Init();
	AttrTopmost(true);
}

void	C_VS_UI_LOTTERY_CARD::Finish()
{
	
	PI_Processor::Finish();
	gpC_window_manager->DisappearWindow(this);
}

void	C_VS_UI_LOTTERY_CARD::ClearGiftList()
{
	for(int i=0;i<m_GiftList.size();i++)
	{
		GiftInfo *pInfo = m_GiftList[i];

		delete pInfo;
		pInfo = NULL;
	}
	
	m_GiftList.clear();
}

void	C_VS_UI_LOTTERY_CARD::Show()
{
	if(gpC_base->m_p_DDSurface_back->Lock())
	{
		int height = 98 + 5*19 +27;//m_pC_lottery_spk->GetHeight(BACK);
		Rect rect;
		rect.Set(0, 0, m_pC_lottery_spk->GetWidth(BACK), height);
		m_pC_lottery_spk->BltLockedClip(x, y, rect, BACK);
		m_pC_lottery_spk->BltLocked(x, y+height, BOTTOM);
		
		switch(m_Type)
		{
		case LOTTERY_TYPE_WAIT_CLIENT :
		case LOTTERY_TYPE_READY:
			m_pC_radio_group->Show();
			break;
			
		case LOTTERY_TYPE_SCRATCH:
		case LOTTERY_TYPE_CLEARING:
		case LOTTERY_TYPE_CLOSE:
			// 당첨에 유무에 맞는 이미지 출력
			m_pC_lottery_spk->BltLocked(x+20, y+14, m_backimage[0]);
			m_pC_lottery_spk->BltLocked(x+20+68, y+14, m_backimage[1]);
			m_pC_lottery_spk->BltLocked(x+20+68*2, y+14, m_backimage[2]);
			break;
		}
		
		m_pC_button_group->Show();
		
		gpC_base->m_p_DDSurface_back->Unlock();
	}
	
	// Cover 서페이스 찍어주기
	RECT rt = {0,0,m_p_cover_surface->GetWidth(),m_p_cover_surface->GetHeight()};
	POINT point = {x+6, y+6};
	gpC_base->m_p_DDSurface_back->Blt(&point, m_p_cover_surface, &rt);
	
	if(g_FL2_GetDC())
	{
		char sz_temp[100];		
		int i;
		
		switch(m_Type)
		{
		case LOTTERY_TYPE_WAIT_CLIENT :
		case LOTTERY_TYPE_READY:		
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_SELECT_EVENT_GIFT].GetString(), m_step);
			g_PrintColorStrOut( x+14, y+83, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);			
			
			for(i=0;i<m_GiftList.size();i++)
			{		
				if( m_Type == LOTTERY_TYPE_WAIT_CLIENT )
				{
					g_PrintColorStrOut( x+40, y+102+(19*i), m_GiftList[i]->name.c_str(), gpC_base->m_chatting_pi, RGB_GRAY, RGB_BLACK);
				} else
				{
					if( i == m_line_select )
					{
						if(m_bl_press) 
						{
							g_PrintColorStrOut( x+40, y+103+(19*i), m_GiftList[i]->name.c_str(), gpC_base->m_chatting_pi, RGB(80,146,247), RGB(50,50,50));
							m_radio_select = i+1;
						}
						else g_PrintColorStrOut( x+40, y+102+(19*i), m_GiftList[i]->name.c_str(), gpC_base->m_chatting_pi, RGB(80,146,247), RGB(50,50,50));
					}
					else 
					{
						if( m_GiftList[i]->Active )
							g_PrintColorStrOut( x+40, y+102+(19*i), m_GiftList[i]->name.c_str(), gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
						else
							g_PrintColorStrOut( x+40, y+102+(19*i), m_GiftList[i]->name.c_str(), gpC_base->m_chatting_pi, RGB_GRAY, RGB_BLACK);
					}
				}
			}		
			break;
			
		case LOTTERY_TYPE_SCRATCH:
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_PLEASE_SCRATCH_IMAGE].GetString());
			g_PrintColorStrOut( x+25, y+90, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
			wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_WIN_A_PRIZE_SAME_IMAGE].GetString());
			g_PrintColorStrOut( x+25, y+90+30, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
			break;
			
		case LOTTERY_TYPE_CLOSE:
			if(m_bl_result)
			{
				wsprintf(sz_temp,(*g_pGameStringTable)[UI_STRING_MESSAGE_CONGRATULATIONS].GetString());
				g_PrintColorStrOut( x+25, y+90, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				wsprintf(sz_temp, "%s", m_GiftList[m_radio_select-1]->name.c_str());
				g_PrintColorStrOut( x+25, y+90+30, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
				wsprintf(sz_temp, (*g_pGameStringTable)[UI_STRING_MESSAGE_WIN_A_PRIZE].GetString());
				g_PrintColorStrOut( x+25, y+90+30+16, sz_temp, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
			} else
			{
				ShowDesc( x+25, y+85, (*g_pGameStringTable)[UI_STRING_MESSAGE_FAIL_LOTTERY].GetString() );				
			}
			break;
		}		
		
		m_pC_button_group->ShowDescription();
		
		g_FL2_ReleaseDC();
	}
	
	switch(m_Type)
	{
	case LOTTERY_TYPE_SCRATCH:
		if( PeelRate() > 40 ) 
		{
			m_Type = LOTTERY_TYPE_CLEARING;
			gpC_base->SendMessage(UI_FINISH_SCRATCH_LOTTERY);
			if(m_bl_result)
				PlaySound( SOUND_EVENT_FANFARE );
		}
		break;
		
	case LOTTERY_TYPE_CLEARING:
		ClearingCover();
		if( PeelRate() > 90 ) ClearAllCover();
		break;
	}
}

void	C_VS_UI_LOTTERY_CARD::ShowDesc(int strX,int strY,const char *str)
{
	int vx = strX;
	int py = strY;
	int next=0;
	const int char_width = g_GetStringWidth("a", gpC_base->m_dialog_msg_pi.hfont);
	const int print_gap = 18;

	std::string sstr = str;
	char sz_string[512] = {0,};
	while(sstr.size() > next)
	{
		if(sstr.size() - next > 2048)
		{
			memcpy(sz_string,sstr.c_str()+next,2047);
			sz_string[2047] = '\0';
		}
		else
			strcpy(sz_string, sstr.c_str()+next);
		
		char *sz_string2 = sz_string;
		
		while(*sz_string2 == ' ')		// 앞의 공백제거
		{
			sz_string2++;
			next++;
		}
		
		int cut_pos = (x+w-5 -vx)/char_width;			
		
		if(!g_PossibleStringCut(sz_string2, cut_pos))
			cut_pos--;
		sz_string2[cut_pos] = NULL;
		
		char *return_char = NULL;
		if((return_char = strstr(sz_string2, "\\n")) != NULL)	// return 처리
		{
			cut_pos = return_char - sz_string2+2;
			sz_string2[cut_pos-2] = NULL;
		}
		
		//g_PrintColorStr(vx, py, sz_string2, gpC_base->m_dialog_msg_pi, RGB_WHITE);
		g_PrintColorStrOut( vx,py, sz_string2, gpC_base->m_chatting_pi, RGB_WHITE, RGB_BLACK);
		next += cut_pos;
		vx = strX;
		py += print_gap;
	}
}

bool	C_VS_UI_LOTTERY_CARD::MouseControl(UINT message, int _x, int _y)
{
	Window::MouseControl(message, _x, _y);

	_x-=x; _y-=y;
	bool re = m_pC_button_group->MouseControl(message, _x, _y);
	if( m_Type != LOTTERY_TYPE_WAIT_CLIENT )
		re = m_pC_radio_group->MouseControl(message, _x+x, _y+y);

	switch(message)
	{
	case M_MOVING:
		{
			if( m_Type == LOTTERY_TYPE_READY )
			{
				Rect rect;
				Point point(_x,_y);
				for(int i=0;i<m_GiftList.size();i++)
				{
					GiftInfo* pInfo = m_GiftList[i];
					rect.Set(40,102+(19*i),g_GetStringWidth(pInfo->name.c_str(), gpC_base->m_chatting_pi.hfont), 11);

					if(rect.IsInRect(point) && pInfo->Active ) 
					{	
						m_line_select = i;						
						break;
					}
					else m_line_select = -1;
				}
			}
			else if( m_bl_press && m_Type == LOTTERY_TYPE_SCRATCH )
				ScratchCover(_x, _y);	

			//gpC_mouse_pointer->SetCursor()
		}
		break;

	case M_LEFTBUTTON_DOWN:
	case M_LB_DOUBLECLICK:
		{	
			m_bl_press = true;

			m_old_point_x = _x - 7;
			m_old_point_y = _y - 7;

			break;
		}
		break;

	case M_LEFTBUTTON_UP:
		{
			m_bl_press = false;
			break;
		}
	}
	
	return true;
}

void	C_VS_UI_LOTTERY_CARD::KeyboardControl(UINT message, UINT key, long extra)
{	
	if( m_Type == LOTTERY_TYPE_WAIT_CLIENT )
		return;

	if (message == WM_KEYDOWN)
	{
		switch (key)
		{
		case VK_RETURN :
//			gpC_base->SendMessage(UI_CLOSE_LOTTERY_CARD);
			break;
		case VK_ESCAPE :
//			gpC_base->SendMessage(UI_CLOSE_LOTTERY_CARD);
			break;
		}
	}
}

bool	C_VS_UI_LOTTERY_CARD::IsPixel(int _x,int _y)
{
//	return IsInRect(_x, _y);
	return m_pC_lottery_spk->IsPixel(SCR2WIN_X(_x),SCR2WIN_Y(_y),BACK);	
}

void	C_VS_UI_LOTTERY_CARD::ShowButtonWidget(C_VS_UI_EVENT_BUTTON * p_button)
{
	if(p_button->m_image_index == RADIO_BACK)
	{		
		m_pC_lottery_spk->BltLocked(p_button->x, p_button->y, p_button->m_image_index);
		if(p_button->GetPressState())
		{
			m_radio_select = p_button->GetID();
		}

		if( m_radio_select == p_button->GetID())
		{
			if(p_button->GetPressState()) m_pC_lottery_spk->BltLocked(p_button->x+3, p_button->y+4, p_button->m_image_index+1);
			else m_pC_lottery_spk->BltLocked(p_button->x+3, p_button->y+3, p_button->m_image_index+1);
		}
	}
	else
	if(p_button->GetID() == BUTTON_ID)
	{
		int index;

		switch( m_Type )
		{
		case LOTTERY_TYPE_READY:
			index = LOTTERY_READY; 
			m_pC_lottery_spk->BltLocked(x+p_button->x, y+p_button->y, index );
			if(p_button->GetFocusState() && m_Type != LOTTERY_TYPE_CLEARING)
			{
				if(p_button->GetPressState())
					m_pC_lottery_spk->BltLocked(x+p_button->x, y+p_button->y, index+2);
				else
					m_pC_lottery_spk->BltLocked(x+p_button->x, y+p_button->y, index+1);
			}
			break;
		//case LOTTERY_TYPE_SCRATCH:
		//case LOTTERY_TYPE_CLEARING:
		case LOTTERY_TYPE_CLOSE:
			index = LOTTERY_CLOSE; 
			m_pC_lottery_spk->BltLocked(x+p_button->x, y+p_button->y, index );
			if(p_button->GetFocusState() && m_Type != LOTTERY_TYPE_CLEARING)
			{
				if(p_button->GetPressState())
					m_pC_lottery_spk->BltLocked(x+p_button->x, y+p_button->y, index+2);
				else
					m_pC_lottery_spk->BltLocked(x+p_button->x, y+p_button->y, index+1);
			}
			break;
		}		
	}	
}

void	C_VS_UI_LOTTERY_CARD::ShowButtonDescription(C_VS_UI_EVENT_BUTTON *p_button)
{
	
}

void	C_VS_UI_LOTTERY_CARD::WindowEventReceiver(id_t event)
{
}

void	C_VS_UI_LOTTERY_CARD::Run(id_t id)
{
	switch (id)
	{
	case BUTTON_ID:
		if(m_Type == LOTTERY_TYPE_READY)
		{
			// 클라이언트에 준비되는 메세지 날림
			m_Type = LOTTERY_TYPE_WAIT_CLIENT;
			gpC_base->SendMessage( UI_LOTTERY_CARD_STATUS, m_step,(int) m_GiftList[m_radio_select-1]->id);			
		}
		else if(m_Type == LOTTERY_TYPE_SCRATCH)
		{
			//m_Type = LOTTERY_TYPE_CLEARING;
		}
		else if(m_Type == LOTTERY_TYPE_CLOSE)
		{
			int left;
			if(m_bl_result) left = 1; else left= 0;
			gpC_base->SendMessage( UI_CLOSE_LOTTERY_CARD, left ,m_step );
//			Finish();
		}
		break;
	}
}


void	C_VS_UI_LOTTERY_CARD::Process()
{
	switch( m_Type )
	{
	case LOTTERY_TYPE_READY:
		m_pC_radio_group->Process();
		m_pC_button_group->Process();		
		break;

	case LOTTERY_TYPE_SCRATCH:
		break;

	case LOTTERY_TYPE_CLEARING:
		break;

	case LOTTERY_TYPE_CLOSE:
		m_pC_button_group->Process();
		break;
	}
	
	ProcessHide();
}

void	C_VS_UI_LOTTERY_CARD::ScratchCover(int _x, int _y)
{
	m_p_cover_surface->Lock();
	WORD *mem = (WORD *)m_p_cover_surface->GetSurfacePointer();
	int pitch = m_p_cover_surface->GetSurfacePitch();
	
	_x -= 7;
	_y -= 7;

	int sx = _x;
	int sy = _y;
	int dx = ( m_old_point_x - _x);
	int dy = ( m_old_point_y - _y);

	int D = (2*dy-dx);

	int Delta1 = 2 * dy;
	int Delta2 = 2 * dy - 2 * dx;

	for( sx = _x; sx <= m_old_point_x; sx++ )
	{
		if(D>0)
		{
			sy = sy + 1;
			D  = D + Delta2;
		}
		else
			D = D + Delta1;
		
		for(int j=sy-5; j<sy+5; j++)
		{
			for(int i=sx-5; i<sx+5; i++)
			{
				if( i >= 0 && i < m_p_cover_surface->GetWidth() && 
					j >= 0 && j < m_p_cover_surface->GetHeight() ) mem[j*pitch/2+i] = 0xffff;
			}
		}		
	}
	
	m_old_point_x = _x;
	m_old_point_y = _y;
	
	m_p_cover_surface->Unlock();
}

int		C_VS_UI_LOTTERY_CARD::PeelRate()
{
	m_p_cover_surface->Lock();
	WORD *mem = (WORD *)m_p_cover_surface->GetSurfacePointer();
	int pitch = m_p_cover_surface->GetSurfacePitch();
	
	int count = 0;

	for(int j=0; j<m_p_cover_surface->GetHeight(); j++)
	{
		for(int i=0; i<m_p_cover_surface->GetWidth(); i++)
		{
			if(mem[j*pitch/2+i] == 0xffff) count++;
		}
	}
	
	m_p_cover_surface->Unlock();

	return 100 * count / (m_p_cover_surface->GetHeight() * m_p_cover_surface->GetWidth());
}

void	C_VS_UI_LOTTERY_CARD::ClearingCover()
{
	m_p_cover_surface->Lock();
	WORD *mem = (WORD *)m_p_cover_surface->GetSurfacePointer();
	int pitch = m_p_cover_surface->GetSurfacePitch();
	
	int _x, _y;
	int width = m_p_cover_surface->GetWidth();
	int height = m_p_cover_surface->GetHeight();

	for(int i=0; i<300; i++)
	{
		_x = rand()%width/2;
		_y = rand()%height/2;

		mem[_y*pitch/2+_x] = 0xffff;
		mem[_y*pitch/2+(_x+width/2)] = 0xffff;
		mem[(_y+height/2)*pitch/2+_x] = 0xffff;
		mem[(_y+height/2)*pitch/2+(_x+width/2)] = 0xffff;
	}
	
	m_p_cover_surface->Unlock();
}

void	C_VS_UI_LOTTERY_CARD::ClearAllCover()
{
	m_p_cover_surface->Lock();
	WORD *mem = (WORD *)m_p_cover_surface->GetSurfacePointer();
	int pitch = m_p_cover_surface->GetSurfacePitch();
	
	for(int j=0; j<m_p_cover_surface->GetHeight(); j++)
	{
		for(int i=0; i<m_p_cover_surface->GetWidth(); i++)
		{			
			mem[j*pitch/2+i] = 0xffff;
		}
	}
	
	m_p_cover_surface->Unlock();

	m_Type = LOTTERY_TYPE_CLOSE;
}

void	C_VS_UI_LOTTERY_CARD::SetResult(bool	bSuccess)
{
	if( m_Type == LOTTERY_TYPE_WAIT_CLIENT )
	{
		m_Type = LOTTERY_TYPE_SCRATCH;
		
		if(bSuccess )
		{
			// 이미지 성공 세팅
			m_bl_result = true;
			m_backimage[0] = m_GiftList[m_radio_select-1]->image;
			m_backimage[1] = m_GiftList[m_radio_select-1]->image;
			m_backimage[2] = m_GiftList[m_radio_select-1]->image;
		} 
		else
		{
			// 이미지 실패 세팅
			srand(timeGetTime());
			m_backimage[0] = m_GiftList[m_radio_select-1]->image;
			m_backimage[1] = m_GiftList[m_radio_select-1]->image;
			m_backimage[2] = m_GiftList[m_radio_select-1]->image;

			int num ;
			if(m_radio_select-1 == 0)
				num = m_GiftList[1]->image;
			else
				num = m_GiftList[0]->image;			
			
			m_backimage[rand() % 3] = num;
		}		
	}
}

void C_VS_UI_QUEST_STATUS::IncreaseQuestPoint()
{
	m_quest_status.current_point ++;
}



