// VS_UI_Base.cpp

#include "client_PCH.h"
#include "VS_UI_Base.h"
#include "UserInformation.h"
#include <windows.h>
//----------------------------------------------------------------------------
// Globals
//----------------------------------------------------------------------------
Base * gpC_base;

//----------------------------------------------------------------------------
// Operations
//----------------------------------------------------------------------------

//-----------------------------------------------------------------------------
// Base
//
// 
//-----------------------------------------------------------------------------
Base::Base()
{
	m_event_occured = false;
	m_p_DDSurface_back = NULL;

	m_chat_dialog_pi.hfont = NULL;

//	m_slayer_font	= C_FONT_MANAGER::NO_GID;
//	m_vampire_font = C_FONT_MANAGER::NO_GID;
//	m_bbs_font		= C_FONT_MANAGER::NO_GID;
//	m_item_font		= C_FONT_MANAGER::NO_GID;
//	m_normal_font	= C_FONT_MANAGER::NO_GID;
}

//-----------------------------------------------------------------------------
// ~Base
//
// 
//-----------------------------------------------------------------------------
Base::~Base()
{
	DeleteObject(m_small_pi.hfont);
	DeleteObject(m_chatting_pi.hfont);
	DeleteObject(m_user_id_pi.hfont);
	DeleteObject(m_value_pi.hfont);
	DeleteObject(m_value2_pi.hfont);
	DeleteObject(m_item_name_pi.hfont);
	DeleteObject(m_item_desc_pi.hfont);
	DeleteObject(m_dialog_msg_pi.hfont);
	DeleteObject(m_dialog_menu_pi.hfont);
	DeleteObject(m_desc_msg_pi.hfont);
	DeleteObject(m_desc_menu_pi.hfont);
	DeleteObject(m_money_pi.hfont);
	DeleteObject(m_char_value_pi.hfont);

	if (m_chat_dialog_pi.hfont != NULL)
		DeleteObject(m_chat_dialog_pi.hfont);
	DeleteObject(m_info_pi.hfont);
	DeleteObject(m_item_pi.hfont);

	DeleteObject(m_char_name_pi.hfont);		//by larosel
	DeleteObject(m_char_chat_pi.hfont);
	DeleteObject(m_char_chat_large_pi.hfont);
	DeleteObject(m_char_chat_event_pi.hfont);

	DeleteObject(m_party_name_pi.hfont);
	DeleteObject(m_xmas_pi.hfont);
	

	DeleteObject(m_money2_pi.hfont);
#if __CONTENTS(__TITLE_UI_RENWEAL)
	DeleteObject(m_title_menu_pi.hfont);
#endif //__TITLE_UI_RENWEAL
}

//-----------------------------------------------------------------------------
// SetFont
//
// 
//-----------------------------------------------------------------------------
void Base::SetFont(PrintInfo &pi, LOGFONT &lf, COLORREF textcolor, COLORREF backcolor, int bk_mode, int align)
{
	HFONT hfont = CreateFontIndirect(&lf);


#ifdef UNICODE
	int a = 0;
#endif 

	if (hfont == NULL)
	  _Error(FAILED_JOB);

	pi.hfont = hfont;
	pi.text_color = textcolor;
	pi.back_color = backcolor;
	pi.bk_mode = bk_mode;
	pi.text_align = align;
}

//-----------------------------------------------------------------------------
// SetDefaultLogfont
//
// 
//-----------------------------------------------------------------------------
void Base::SetDefaultLogfont(LOGFONT &lf) const
{
	lf.lfHeight = 0; // 0 = default
	lf.lfWidth = 0; // 0 = ³ôÀÌ¿¡ ±âÁØÇÏ¿© ÀÚµ¿À¸·Î ¼³Á¤µÊ.
	lf.lfEscapement = 0; // ¹æÇâ¼³Á¤ (900, 2700)
	lf.lfOrientation = 0;
	lf.lfWeight = FW_NORMAL; // FW_BOLD
	lf.lfItalic = 0; // 0 ¾Æ´Ñ °ªÀÌ¸é italicÀÌ´Ù.
	lf.lfUnderline = 0;
	lf.lfStrikeOut = 0;
	if(gC_ci->IsChinese())
		lf.lfCharSet = GB2312_CHARSET;//*/JOHAB_CHARSET;
		//lf.lfCharSet = THAI_CHARSET;//*/JOHAB_CHARSET;Ì©ÎÄ¿Í»§¶Ë
    else if(gC_ci->IsJapanese())
		lf.lfCharSet = SHIFTJIS_CHARSET ;
	else
		lf.lfCharSet = HANGUL_CHARSET;//*/JOHAB_CHARSET;
	if(gC_ci->IsJapanese())
	{
		lf.lfOutPrecision = OUT_DEFAULT_PRECIS;
		lf.lfClipPrecision = CLIP_DEFAULT_PRECIS;
		lf.lfQuality = PROOF_QUALITY ; //DEFAULT_QUALITY;
		lf.lfPitchAndFamily = DEFAULT_PITCH | FF_ROMAN  ; // FF_DONTCARE;
		strcpy(lf.lfFaceName, "MS PGothic");//"Times New Roman");
	}
	else
	{
		lf.lfOutPrecision = OUT_DEFAULT_PRECIS;
		lf.lfClipPrecision = CLIP_DEFAULT_PRECIS;
		lf.lfQuality = DEFAULT_QUALITY;
		lf.lfPitchAndFamily = DEFAULT_PITCH|FF_DONTCARE;
		strcpy(lf.lfFaceName, "±¼¸²Ã¼");//"Times New Roman");
	}
}

//-----------------------------------------------------------------------------
// SelectFont
//
// 
//-----------------------------------------------------------------------------
/*
void Base::SelectFont(font_id_t id)
{
	switch (id)
	{
		case FONT_SLAYER:
			gC_font.SelectFont(m_slayer_font);
			gC_font.NotUseNoPublicEng();
			break;

		case FONT_VAMPIRE:
			gC_font.SelectFont(m_vampire_font);
			gC_font.NotUseNoPublicEng();
			break;

		case FONT_BBS:
			gC_font.SelectFont(m_bbs_font);
			gC_font.NotUseNoPublicEng();
			break;

		case FONT_ITEM:
			gC_font.SelectFont(m_normal_font);
			gC_font.UseNoPublicEng(OLIVE);
			break;

		case FONT_ITEM_SMALL:
			gC_font.SelectFont(m_item_font);
			gC_font.NotUseNoPublicEng();
			break;

		case FONT_NORMAL:
			gC_font.SelectFont(m_normal_font);
			gC_font.NotUseNoPublicEng();
			break;
	}
}*/

//-----------------------------------------------------------------------------
// Init
//
// 
//-----------------------------------------------------------------------------
void Base::Init(CSpriteSurface *surface, void (*fp)(DWORD, int, int, void *))
{
	InitSurface(surface);
	InitFont();
	m_C_ui_result_receiver.SetResultReceiver(fp);
	gC_ci->RunCursorBlinker();
}

//-----------------------------------------------------------------------------
// InitFont
//
// 
//-----------------------------------------------------------------------------
void Base::InitFont()
{
	LOGFONT lf;

	// 
	// ±¦ÂúÀº style
	//
	// - ¹ÙÅÁ, 13
	//
	// !Times New Romans·Î ÇÏÁö ¸»°Í. OS°£ À§Ä¡ ¾È¸Â´Â ¹®Á¦ ¹ß»ýÇÔ.
	//Tahoma
	//change by rallser  Ì©¹ú¿Í»§¶Ë
	const char szFontName[5][3][20] = {
		// Hangul Font      Chinese Font
		{ "±¼¸²Ã¼",			"ËÎÌå",			"‚l‚r ƒSƒVƒbƒN"},
		{ "MS Sans Serif",	"MS Sans Serif","‚l‚r ƒSƒVƒbƒN"},
		{ "µ¸¿òÃ¼",			"ÐÂËÎÌå",		"‚l‚r ƒSƒVƒbƒN"},
		{ "±¼¸²",			"ËÎÌå",			"‚l‚r –¾’©"},
		{ "¸¼Àº°íµñ",		"ËÎÌå",			"‚l‚r –¾’©"}
	};

    /*   const char szFontName[5][3][20] = {
		// Hangul Font      Chinese Font
		{ "±¼¸²Ã¼",			"Tahoma",			"‚l‚r ƒSƒVƒbƒN"},
		{ "MS Sans Serif",	"Tahoma","‚l‚r ƒSƒVƒbƒN"},
		{ "µ¸¿òÃ¼",			"Tahoma",		"‚l‚r ƒSƒVƒbƒN"},
		{ "±¼¸²",			"Tahoma",			"‚l‚r –¾’©"},
		{ "¸¼Àº°íµñ",		"Tahoma",			"‚l‚r –¾’©"}
	};*/


	char Language;
	int local_font_size = 0;
	
	if(gC_ci->IsChinese())
	{
		Language = 1;
		local_font_size = 0; //by viva ÖÐÎÄÎª0  Ì©ÎÄÎª2
	//	local_font_size = 0; //by viva ÖÐÎÄÎª0  Ì©ÎÄÎª2
	}
	if(gC_ci->IsJapanese())
	{
		Language = 2;
		gC_ci->SetJapanInput() ;  
	}
	else 
		Language = 0;
	
	SetDefaultLogfont(lf); //by larosel
	lf.lfHeight = 10 + local_font_size;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_small_pi, lf, RGB(20, 70, 0));

	SetDefaultLogfont(lf); //by larosel
	lf.lfHeight = 12 + local_font_size;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_chatting_pi, lf, RGB(20, 70, 0));

	SetDefaultLogfont(lf); //by larosel
	lf.lfHeight = 12 + local_font_size;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_user_id_pi, lf, RGB(20, 70, 0));


	//
	SetDefaultLogfont(lf); //by larosel
	lf.lfHeight = 25 + local_font_size;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_haysNameBig, lf, RGB(20, 70, 0));

	SetDefaultLogfont(lf); //by larosel
	lf.lfHeight = 25 + local_font_size;
	lf.lfWeight = FW_HEAVY;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_PayEvent_pi, lf, RGB(20, 70, 0));


	SetDefaultLogfont(lf); //by larosel
	lf.lfHeight = 18 + local_font_size;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_haysLevel, lf, RGB(20, 70, 0));

	

	// new style...
	SetDefaultLogfont(lf);
	lf.lfHeight = 14 + local_font_size;
	lf.lfItalic = 1;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[1][Language]);
	SetFont(m_value_pi, lf, RGB(255, 255, 255), 0, TRANSPARENT, TA_RIGHT);

	// new style...
	SetDefaultLogfont(lf);
	lf.lfHeight = 14 + local_font_size;
	lf.lfItalic = 1;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[1][Language]);
	SetFont(m_value2_pi, lf, RGB(20, 70, 0));

	// new style...
	SetDefaultLogfont(lf);
	lf.lfHeight = 14 + local_font_size;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[2][Language]);
	SetFont(m_item_name_pi, lf, RGB(255, 255, 255));

	// new style...
	SetDefaultLogfont(lf);
	lf.lfHeight = 12 + local_font_size;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_item_desc_pi, lf, RGB(192, 192, 255));

	// new style...
	SetDefaultLogfont(lf);
	lf.lfHeight = 14 + local_font_size;
//	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_dialog_menu_pi, lf, RGB(255, 255, 255));

	// new style...
	SetDefaultLogfont(lf);
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	lf.lfHeight = 13 + local_font_size;
	SetFont(m_dialog_msg_pi, lf, RGB(255, 255, 255));

	// new style...
	SetDefaultLogfont(lf);
	lf.lfHeight = 14 + local_font_size;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_desc_menu_pi, lf, RGB(255, 255, 255));

	// new style...
	SetDefaultLogfont(lf);
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	lf.lfHeight = 14 + local_font_size;
	SetFont(m_desc_msg_pi, lf, RGB(255, 255, 255));

	// new style...
	SetDefaultLogfont(lf);
	lf.lfHeight = 16 + local_font_size;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_money_pi, lf, RGB(255, 255, 255));

	// new style...
	SetDefaultLogfont(lf);
	lf.lfHeight = 16 + local_font_size;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_char_value_pi, lf, RGB(255, 255, 255));

	//
	//font used by Client by larosel ¹ÛÀÇ ÆùÆ®º¸´Ù 2¾¿ Å©°Ô ÇØÁà¾ßÇÔ.
	//
	//SetDefaultLogfont(lf);
	//lf.lfHeight = 12;
	//strcpy(lf.lfFaceName, "±¼¸²");
	//SetFont(m_chat_dialog_pi, lf, RGB(255, 255, 255));

	SetDefaultLogfont(lf);
	lf.lfHeight = 14 + local_font_size;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[3][Language]);
	SetFont(m_info_pi, lf, RGB(255, 255, 255));

	SetDefaultLogfont(lf);
	lf.lfHeight = 12 + local_font_size;
	strcpy(lf.lfFaceName, szFontName[3][Language]);
	SetFont(m_item_pi, lf, RGB(255, 255, 255));

	SetDefaultLogfont(lf);
	lf.lfHeight = 13 + local_font_size;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[3][Language]);
	SetFont(m_char_name_pi, lf, RGB(255, 255, 255));

	SetDefaultLogfont(lf);
	lf.lfHeight = 13 + local_font_size;
	strcpy(lf.lfFaceName, szFontName[3][Language]);
	SetFont(m_char_chat_pi, lf, RGB(255, 255, 255));

	//party
	SetDefaultLogfont(lf); //by larosel
	lf.lfHeight = 12 + local_font_size;
//	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[3][Language]);
	SetFont(m_party_name_pi, lf, RGB(20, 70, 0));

	//xmas
	SetDefaultLogfont(lf); //by larosel
	lf.lfHeight = 10 + local_font_size;
//	lf.lfWeight = FW_BOLD;
	lf.lfItalic = true;
	strcpy(lf.lfFaceName, szFontName[3][Language]);
	SetFont(m_xmas_pi, lf, RGB(20, 70, 0));

	SetDefaultLogfont(lf);
	lf.lfHeight = 16 + local_font_size;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[3][Language]);
	SetFont( m_char_chat_large_pi, lf, RGB(255,255,255));

	// new style...
	SetDefaultLogfont(lf);
	lf.lfHeight = 16 + local_font_size;
	strcpy(lf.lfFaceName, szFontName[0][Language]);
	SetFont(m_money2_pi, lf, RGB(255, 255, 255), 0, TRANSPARENT, TA_RIGHT);

	// Event Message¿ë pi
	SetDefaultLogfont(lf);
	lf.lfHeight = 20 + local_font_size;
	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[4][Language]);
	SetFont(m_char_chat_event_pi, lf, RGB(255, 255, 255), 0, TRANSPARENT, TA_LEFT);

#if __CONTENTS(__TITLE_UI_RENWEAL)
	SetDefaultLogfont(lf);
	lf.lfHeight = 12 + local_font_size;
//	lf.lfWeight = FW_BOLD;
	strcpy(lf.lfFaceName, szFontName[4][Language]);
	SetFont(m_title_menu_pi, lf, RGB(255, 255, 255), 0, TRANSPARENT, TA_LEFT);
#endif // __TITLE_UI_RENWEAL
}

//-----------------------------------------------------------------------------
// InitSurface
//
// 
//-----------------------------------------------------------------------------
void Base::InitSurface(CSpriteSurface *surface)
{
	assert(surface);

	m_p_DDSurface_back = surface;

	//g_pUserInformation->IsResolution1024


	bool ret = m_DDSurface_offscreen.InitOffsurface(g_pUserInformation->iResolution_x, g_pUserInformation->iResolution_y, DDSCAPS_SYSTEMMEMORY);

	//bool ret = m_DDSurface_offscreen.InitOffsurface(RESOLUTION_X, RESOLUTION_Y, DDSCAPS_SYSTEMMEMORY);


	if (!ret)
		_Error(FAILED_JOB);

	//
	// offscreenÀÇ colorkey¸¦ ¼³Á¤ÇÑ´Ù. »óÈ²¿¡ µû¶ó¼­ Image¿¡¼­ ¾È ¾²´Â »öÀ» 
	// °áÁ¤ÇØ¾ß ÇÑ´Ù.
	//
	m_colorkey_red = RED;

	m_DDSurface_offscreen.SetTransparency(m_colorkey_red); // default colorkey = red

	// set Unicorn edit widget surface
	g_SetFL2Surface(m_p_DDSurface_back->GetSurface());
}

//-----------------------------------------------------------------------------
// DispatchMessage
//
// 
//-----------------------------------------------------------------------------
void Base::DispatchMessage()
{
	m_C_ui_result_receiver._DispatchMessage();
}

//-----------------------------------------------------------------------------
// SendMessage
//
// 
//-----------------------------------------------------------------------------
void Base::SendMessage(DWORD message, int left, int right, void * void_ptr)
{
	m_C_ui_result_receiver._SendMessage(message, left, right, void_ptr);
}

//-----------------------------------------------------------------------------
// StartEvent
//
// 
//-----------------------------------------------------------------------------
void	Base::StartEvent() 
{ 
	//assert(m_event_occured == false);

	m_event_occured = true; 
}

//-----------------------------------------------------------------------------
// FinishEvent
//
// 
//-----------------------------------------------------------------------------
void	Base::FinishEvent() 
{ 
	//assert(m_event_occured == true);

	m_event_occured = false; 
}